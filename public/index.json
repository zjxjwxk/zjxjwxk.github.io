[{"content":"Kafka Architecture Kafka Message Deploy Kafka Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:\n--- version: \u0026#39;3\u0026#39; services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \u0026#34;8082:8082\u0026#34; depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: \u0026#39;broker-1:29092,broker-2:29093,broker-3:29094\u0026#39; KAFKA_REST_LISTENERS: \u0026#34;http://0.0.0.0:8082\u0026#34; Pull all images and run all composed containers:\ndocker compose up -d When all containers run like this:\n[+] Running 8/8 ⠿ Network demo1_default Created 0.1s ⠿ Container zookeeper-1 Started 2.6s ⠿ Container zookeeper-2 Started 2.5s ⠿ Container zookeeper-3 Started 2.6s ⠿ Container broker-1 Started 3.6s ⠿ Container broker-2 Started 4.4s ⠿ Container broker-3 Started 5.2s ⠿ Container rest-proxy Started 5.7s We can check the docker logs:\ndocker logs broker-1 We can also check all service statuses:\ndocker compose ps It should show that all services are up:\nNAME IMAGE COMMAND SERVICE CREATED STATUS PORTS broker-1 confluentinc/cp-kafka:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; broker-1 3 minutes ago Up 3 minutes 0.0.0.0:9092-\u0026gt;9092/tcp, 0.0.0.0:29092-\u0026gt;29092/tcp broker-2 confluentinc/cp-kafka:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; broker-2 3 minutes ago Up 3 minutes 0.0.0.0:9093-\u0026gt;9093/tcp, 9092/tcp, 0.0.0.0:29093-\u0026gt;29093/tcp broker-3 confluentinc/cp-kafka:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; broker-3 3 minutes ago Up 3 minutes 0.0.0.0:9094-\u0026gt;9094/tcp, 9092/tcp, 0.0.0.0:29094-\u0026gt;29094/tcp rest-proxy confluentinc/cp-kafka-rest:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; rest-proxy 3 minutes ago Up 3 minutes 0.0.0.0:8082-\u0026gt;8082/tcp zookeeper-1 confluentinc/cp-zookeeper:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; zookeeper-1 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp zookeeper-2 confluentinc/cp-zookeeper:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; zookeeper-2 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp zookeeper-3 confluentinc/cp-zookeeper:7.4.1 \u0026#34;/etc/confluent/dock…\u0026#34; zookeeper-3 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp We can also call the REST APIs provided by the Kafka REST Proxy. For example, display alive brokers:\ncurl localhost:8082/brokers It should show that there are three living brokers:\n{\u0026#34;brokers\u0026#34;:[1,2,3]}% Kafka Ecosystem Packaging Versions:\nConfluent Cloud Cloudera Strimzi offers the Helm charts to deploy Kafka to Kubernetes Logging Plugins:\nSyslog Fluentd Logstash Filebeat DBs:\nJDBC connector to cover RDBMS Dos. Debezium also offers a connector that includes no-SQL Dos. Presto connector that allows us to query Kafka using Presto queries. Interaction with Kafka via the CLI Run Kafka Containers Run composed containers (if not):\ndocker compose up -d Add Kafka PATH Download Kafka from the official website https://kafka.apache.org/downloads:\nAdd Kafka to your PATH. (I use zsh, so it\u0026rsquo;s configured in the ~/.zshrc for me)\nexport KAFKA_HOME=/Users/zjxjwxk/Library/kafka_2.13-3.9.0 export PATH=$PATH:$KAFKA_HOME/bin Then run this command (if you are using a Linux-like OS):\nsource ~/.zshrc Send Messages Send messages by running Kafka Producer:\n❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic \u0026gt;Hello [2024-11-16 15:41:58,970] WARN [Producer clientId=console-producer] The metadata response from the cluster reported a recoverable issue with correlation id 7 : {first_topic=LEADER_NOT_AVAILABLE} (org.apache.kafka.clients.NetworkClient) \u0026gt;Kafka \u0026gt;I\u0026#39;m Xinkang \u0026gt; Receive Messages Receive messages by running Kafka Consumer:\n❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic first_topic --from-beginning Hello Kafka I\u0026#39;m Xinkang Display topics by Kafka REST Proxy:\n❯ curl localhost:8082/topics [\u0026#34;first_topic\u0026#34;]% Topics Kafka Producers send messages to topics of Kafka Brokers:\nRetention Can Be Set To:\nDays: This means only keeping messages of up to N days and then deleting them. Bytes: This means only keeping messages until the topic has more than X bytes and then delete. None: This means storing all messages from the beginning of time. Kafka Consumers consume messages from topics of Kafka Brokers:\nPartitions A topic can be split into partitions and distributed within brokers in the cluster:\nThe partitioner uses the key to distribute the messages to the correct partition:\nConsumer Read Scenarios Consumer Offset: From the Beginning\nConsumer Offset: From the End\nConsumer Offset: Already Have Been Here\nSummary:\nTopics can be partitioned. The partitioner uses the message key to redirect messages to partitions. Consumers read them from partitions and have an offset. Therefore, more partitions enable more consumers, which makes it more scalable. Topic Replication Each topic has a number called the replication factor, which replicates each partition of that topic:\nEach partition is on a different broker. Therefore, a single topic is scaled.\nInteraction with Kafka via the REST Proxy Run Kafka Containers Run composed containers (if not):\ndocker compose up -d Import Postman Collection Use this Open API yaml for Kafka REST Proxy: https://github.com/axel-sirota/getting-started-kafka/blob/main/rest_proxy.yaml, which provides RESTful interfaces to a Kafka cluster.\nWe can import this yaml to the Postman as a collection:\nThen, add an environment for variables like baseUrl and use the environment.\nCreate Topic Create a topic myorders with one replication and three partitions:\nkafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 3 --topic myorders The created topic can be displayed by calling {{baseUrl}}/topics/:topicName via Postman. The path variable :topicName should be myorders. The response will be like:\n{ \u0026#34;name\u0026#34;: \u0026#34;myorders\u0026#34;, ... \u0026#34;partitions\u0026#34;: [ { \u0026#34;partition\u0026#34;: 0, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 1, \u0026#34;leader\u0026#34;: 2, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 2, \u0026#34;leader\u0026#34;: 3, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 3, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] } ] } This is a pretty fragile scenario because if any broker goes down, there is no replica.\nIncrease Replication Prepare a json file increase-replication.json for reassigning partitions of topic myorders:\n{\u0026#34;version\u0026#34;:1, \u0026#34;partitions\u0026#34;:[ {\u0026#34;topic\u0026#34;:\u0026#34;myorders\u0026#34;,\u0026#34;partition\u0026#34;:0,\u0026#34;replicas\u0026#34;:[1,2]}, {\u0026#34;topic\u0026#34;:\u0026#34;myorders\u0026#34;,\u0026#34;partition\u0026#34;:1,\u0026#34;replicas\u0026#34;:[1,2]}, {\u0026#34;topic\u0026#34;:\u0026#34;myorders\u0026#34;,\u0026#34;partition\u0026#34;:2,\u0026#34;replicas\u0026#34;:[2]} ] } Reassign partitions with the json file:\nkafka-reassign-partitions.sh --bootstrap-server localhost:9092 --reassignment-json-file increase_replication.json --execute Then, we can see the replication of partition 0 and 1 are increased, and a leader is elected for each replica.\n{ \u0026#34;name\u0026#34;: \u0026#34;myorders\u0026#34;, ... \u0026#34;partitions\u0026#34;: [ { \u0026#34;partition\u0026#34;: 0, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 1, \u0026#34;leader\u0026#34;: 2, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 2, \u0026#34;leader\u0026#34;: 2, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] } ] } Stop a Broker Stop the broker 2 to test the system resilience.\ndocker stop broker-2 We can see that for partitions 0 and 1, the broker 2 is not in_sync. For partition 2, the leader is -1, which means there is no leader and cannot take any new message.\n{ \u0026#34;name\u0026#34;: \u0026#34;myorders\u0026#34;, ... \u0026#34;partitions\u0026#34;: [ { \u0026#34;partition\u0026#34;: 0, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: false } ] }, { \u0026#34;partition\u0026#34;: 1, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: false } ] }, { \u0026#34;partition\u0026#34;: 2, \u0026#34;leader\u0026#34;: -1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: true } ] } ] } Try to send messages to the topic myorders by running Kafka Producer:\n❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic myorders \u0026gt;Hello \u0026gt;again \u0026gt;from \u0026gt;Wxk And try to receive messages from topic myorders:\nkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning We will find there is no response returned. The topic will be offline if one partition doesn\u0026rsquo;t have any replica online.\nRestart the Broker If we restart the stopped broker, Kafka will self-heal:\ndocker compose up -d We can see that for partitions 0 and 1, broker 2 is in_sync again. And for partition 2, the leader 2 is elected again.\n{ \u0026#34;name\u0026#34;: \u0026#34;myorders\u0026#34;, ... \u0026#34;partitions\u0026#34;: [ { \u0026#34;partition\u0026#34;: 0, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 1, \u0026#34;leader\u0026#34;: 1, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 1, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true }, { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: false, \u0026#34;in_sync\u0026#34;: true } ] }, { \u0026#34;partition\u0026#34;: 2, \u0026#34;leader\u0026#34;: 2, \u0026#34;replicas\u0026#34;: [ { \u0026#34;broker\u0026#34;: 2, \u0026#34;leader\u0026#34;: true, \u0026#34;in_sync\u0026#34;: true } ] } ] } Then we can receive messages successfully:\n❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning Hello again from Wxk ","permalink":"https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/","summary":"\u003ch2 id=\"kafka-architecture\"\u003eKafka Architecture\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"image-20241116015015788\" loading=\"lazy\" src=\"/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116015015788.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"kafka-message\"\u003eKafka Message\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"image-20241116015252987\" loading=\"lazy\" src=\"/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116015252987.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"deploy-kafka\"\u003eDeploy Kafka\u003c/h2\u003e\n\u003cp\u003eCreate a docker-compose file \u003ccode\u003edocker-compose.yaml\u003c/code\u003e containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eversion\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eservices\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ezookeeper-1\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-zookeeper:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-1_data:/var/lib/zookeeper/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-1_log:/var/lib/zookeeper/log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_CLIENT_PORT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_TICK_TIME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_MY_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_SERVERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eserver.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ezookeeper-2\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-zookeeper:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-2_data:/var/lib/zookeeper/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-2_log:/var/lib/zookeeper/log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_CLIENT_PORT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_TICK_TIME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_MY_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_SERVERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eserver.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ezookeeper-3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-zookeeper:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-3_data:/var/lib/zookeeper/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./zookeeper-3_log:/var/lib/zookeeper/log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_CLIENT_PORT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOOKEEPER_TICK_TIME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_MY_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eZOO_SERVERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eserver.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ebroker-1\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-kafka:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./broker-1-data:/var/lib/kafka/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e9092\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e9092\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e29092\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e29092\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_BROKER_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ZOOKEEPER_CONNECT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1:2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ADVERTISED_LISTENERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST://localhost:9092,INTERNAL://broker-1:29092\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_LISTENER_SECURITY_PROTOCOL_MAP\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST:PLAINTEXT,INTERNAL:PLAINTEXT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_INTER_BROKER_LISTENER_NAME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eINTERNAL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_SNAPSHOT_TRUST_EMPTY\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ebroker-2\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-kafka:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./broker-2-data:/var/lib/kafka/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e9093\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e9093\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e29093\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e29093\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_BROKER_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ZOOKEEPER_CONNECT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1:2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ADVERTISED_LISTENERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST://localhost:9093,INTERNAL://broker-2:29093\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_LISTENER_SECURITY_PROTOCOL_MAP\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST:PLAINTEXT,INTERNAL:PLAINTEXT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_INTER_BROKER_LISTENER_NAME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eINTERNAL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_SNAPSHOT_TRUST_EMPTY\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003ebroker-3\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-kafka:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ebroker-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003evolumes\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e./broker-3-data:/var/lib/kafka/data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e9094\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e9094\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003e29094\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e29094\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_BROKER_ID\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ZOOKEEPER_CONNECT\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1:2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_ADVERTISED_LISTENERS\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST://localhost:9094,INTERNAL://broker-3:29094\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_LISTENER_SECURITY_PROTOCOL_MAP\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eHOST:PLAINTEXT,INTERNAL:PLAINTEXT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_INTER_BROKER_LISTENER_NAME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eINTERNAL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_SNAPSHOT_TRUST_EMPTY\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003erest-proxy\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eimage\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003econfluentinc/cp-kafka-rest:7.4.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eports\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;8082:8082\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003edepends_on\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ezookeeper-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - \u003cspan style=\"color:#ae81ff\"\u003ebroker-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ehostname\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003erest-proxy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003econtainer_name\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003erest-proxy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eenvironment\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_REST_HOST_NAME\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003erest-proxy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_REST_BOOTSTRAP_SERVERS\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;broker-1:29092,broker-2:29093,broker-3:29094\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003eKAFKA_REST_LISTENERS\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://0.0.0.0:8082\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePull all images and run all composed containers:\u003c/p\u003e","title":"Meet Kafka"},{"content":"We Call The entity/app creates a message, a publisher, or a producer. The entity/app consuming messages from a channel as a consumer. The system where the channels live and handle these requests as an Event Bus or, more recently, a streaming platform. The channel where messages flow as channel or topic. Definitions We say the pub-sub system is reliable when you ensure there is no message loss. Has at most one processing when you ensure there is no message duplication. And has exactly one processing when you only process a message once ensuring it wasn\u0026rsquo;t lost. Of course, this is the holy grail. We Had a Ton of Other Pub/Sub Systems Before What is Kafka? Event Streaming Platform Scalable High Throughput Difference between Kafka and the Rest of Solutions RabbitMQ: As Kafka uses topics in a unidirectional log without a handshake, the difference in performance is brutal, easily 1000x. Mulesoft: Kafka makes it simple to create a channel of communication. Simply producing a message, the topic will be auto-created. Redis: Redis does not handle streaming data nor has a history past messages. Amazon SQS: It is based on queues, which is way better than RabbitMQ, but still, there is an order of magnitude in throughput and speed between Kafka and SQS. Plus, SQS is not exactly cheap. Amazon SNS: Very, very similar; but way pricer. Azure Streaming Services: This service in particular is not exactly meant for pub-sub in general. Google Pub/Sub: The same as Amazon SNS, very similar but pricer. ","permalink":"https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/1.-pub-sub-system/","summary":"\u003ch2 id=\"we-call\"\u003eWe Call\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eThe entity/app creates a message, a publisher, or a producer.\u003c/li\u003e\n\u003cli\u003eThe entity/app consuming messages from a channel as a consumer.\u003c/li\u003e\n\u003cli\u003eThe system where the channels live and handle these requests as an Event Bus or, more recently, a streaming platform.\u003c/li\u003e\n\u003cli\u003eThe channel where messages flow as channel or topic.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"definitions\"\u003eDefinitions\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eWe say the pub-sub system is reliable when you ensure there is no message loss.\u003c/li\u003e\n\u003cli\u003eHas at most one processing when you ensure there is no message duplication.\u003c/li\u003e\n\u003cli\u003eAnd has exactly one processing when you only process a message once ensuring it wasn\u0026rsquo;t lost. Of course, this is the holy grail.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"we-had-a-ton-of-other-pubsub-systems-before\"\u003eWe Had a Ton of Other Pub/Sub Systems Before\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"image-20241116003710435\" loading=\"lazy\" src=\"/posts/mq/kafka/getting-started-with-apache-kafka/1.-pub-sub-system/images/image-20241116003710435.png\"\u003e\u003c/p\u003e","title":"Pub-sub System"},{"content":"学习目标 认识 Shiro 的整体架构，各组件的概念 Shiro 认证，授权的过程 Shiro 自定义的 Realm，Filter Shiro Session 管理 Shiro 缓存管理 Shiro 集成 Spring Shiro 简介 Apache 的强大灵活的开源安全框架 认证、授权、企业会话管理、安全加密 Shiro 与 Spring Security 比较 Shiro 简单、灵活 可脱离 Spring 粒度较粗 Spring Security 复杂、笨重 不可脱离 Spring 粒度更细 Shiro 整体架构 Shiro 认证和授权 认证过程 创建 SecurityManager -\u0026gt; 主体提交认证 -\u0026gt; SecurityManager 认证 -\u0026gt; Authenticator 认证 -\u0026gt; Realm 验证 授权过程 创建 SecurityManager -\u0026gt; 主体提交授权 -\u0026gt; SecurityManager 授权 -\u0026gt; Authorizer 授权 -\u0026gt; Realm 获取角色权限数据 测试代码如下（这里先使用 SimpleAccountRealm 作为 Realm）：\npublic class AuthenticationTest { private final SimpleAccountRealm simpleAccountRealm = new SimpleAccountRealm(); @Before public void addUser() { simpleAccountRealm.addAccount(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;, \u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;); } @Test public void testAuthentication() { // 1. 构建SecurityManager环境 DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // 2. 给SecurityManager设置Realm defaultSecurityManager.setRealm(simpleAccountRealm); // 3. 给SecurityUtils设置SecurityManager SecurityUtils.setSecurityManager(defaultSecurityManager); // 4. 获取Subject Subject subject = SecurityUtils.getSubject(); // 5. Subject提交认证请求 UsernamePasswordToken token = new UsernamePasswordToken(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); subject.login(token); /* 认证 */ System.out.println(\u0026#34;isAuthenticated: \u0026#34; + subject.isAuthenticated()); /* 授权 */ subject.checkRoles(\u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;); } } Realm 内置 Realm IniRealm JdbcRealm 自定义 Realm IniRealm 在 resources 下创建一个 user.ini 文件： [users] Wxk=123456,admin [roles] admin=user:delete 使用 IniRealm 作为 Realm 测试代码如下：\npublic class IniRealmTest { private final IniRealm iniRealm = new IniRealm(\u0026#34;classpath:user.ini\u0026#34;); @Test public void testAuthentication() { // 1. 构建SecurityManager环境 DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // 2. 给SecurityManager设置Realm defaultSecurityManager.setRealm(iniRealm); // 3. 给SecurityUtils设置SecurityManager SecurityUtils.setSecurityManager(defaultSecurityManager); // 4. 获取Subject Subject subject = SecurityUtils.getSubject(); // 5. Subject提交认证请求 UsernamePasswordToken token = new UsernamePasswordToken(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); subject.login(token); /* 认证 */ System.out.println(\u0026#34;isAuthenticated: \u0026#34; + subject.isAuthenticated()); /* 授权 */ // 检查角色授权 subject.checkRole(\u0026#34;admin\u0026#34;); // 检查权限授权 subject.checkPermission(\u0026#34;user:delete\u0026#34;); } } JdbcRealm 分别创建数据库表：用户表 test_user, 用户角色表 test_user_roles, 用户权限表 test_users_permissions。 给 JdbcRealm 设置数据源 打开权限查询开关 给 JdbcRealm 自定义认证、角色和权限SQL查询语句 使用 JdbcRealm 作为 Realm 数据库表如下：\n测试代码如下：\npublic class JdbcRealmTest { private final DruidDataSource dataSource = new DruidDataSource(); private final JdbcRealm jdbcRealm = new JdbcRealm(); @Test public void testAuthentication() { // 设置数据源 dataSource.setUrl(\u0026#34;jdbc:mysql://localhost:3306/test\u0026#34;); dataSource.setUsername(\u0026#34;root\u0026#34;); dataSource.setPassword(\u0026#34;123456\u0026#34;); jdbcRealm.setDataSource(dataSource); // 打开权限查询开关 jdbcRealm.setPermissionsLookupEnabled(true); // 自定义认证查询SQL String AuthenticationSQL = \u0026#34;SELECT password FROM test_user WHERE username = ?\u0026#34;; jdbcRealm.setAuthenticationQuery(AuthenticationSQL); // 自定义角色查询SQL String rolesSQL = \u0026#34;SELECT role_name FROM test_user_roles WHERE username = ?\u0026#34;; jdbcRealm.setUserRolesQuery(rolesSQL); // 自定义权限查询SQL String permissionsSQL = \u0026#34;SELECT permission FROM test_roles_permissions WHERE role_name = ?\u0026#34;; jdbcRealm.setPermissionsQuery(permissionsSQL); // 1. 构建SecurityManager环境 DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // 2. 给SecurityManager设置Realm defaultSecurityManager.setRealm(jdbcRealm); // 3. 给SecurityUtils设置SecurityManager SecurityUtils.setSecurityManager(defaultSecurityManager); // 4. 获取Subject Subject subject = SecurityUtils.getSubject(); // 5. Subject提交认证请求 UsernamePasswordToken token = new UsernamePasswordToken(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); subject.login(token); /* 认证 */ System.out.println(\u0026#34;isAuthenticated: \u0026#34; + subject.isAuthenticated()); /* 授权 */ // 检查角色授权 subject.checkRoles(\u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;); // 检查权限授权 subject.checkPermission(\u0026#34;user:delete\u0026#34;); } } 自定义 Realm 自定义 MyRealm 类继承自 AuthorizingRealm，重写 doGetAuthenticationInfo 和 doGetAuthorizationInfo 方法来返回认证和授权验证信息： public class MyRealm extends AuthorizingRealm { /** * 模拟数据库或缓存 */ Map\u0026lt;String, String\u0026gt; userMap = new HashMap\u0026lt;String, String\u0026gt;(16){{ put(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); }}; { // 设置Realm名称 super.setName(\u0026#34;myRealm\u0026#34;); } @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { // 1. 获得用户名 String username = (String) principals.getPrimaryPrincipal(); // 2. 通过用户名到数据库或缓存中获取角色集合和权限集合 Set\u0026lt;String\u0026gt; roles = getRolesByUsername(username); Set\u0026lt;String\u0026gt; permissions = getPermissionsByUsername(username); // 3. 给AuthorizationInfo设置角色集合和权限结合 SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo(); simpleAuthorizationInfo.setRoles(roles); simpleAuthorizationInfo.setStringPermissions(permissions); // 4. 返回AuthorizationInfo return simpleAuthorizationInfo; } @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { // 1. 从Subject传来的认证信息中获得用户名 String username = (String) token.getPrincipal(); // 2. 通过用户名到数据库中获取凭证 String password = getPasswordByUsername(username); if (password == null) { return null; } // 3. 返回AuthenticationInfo（将会和token进行匹配） return new SimpleAuthenticationInfo(username, password, getName()); } /** * 模拟数据库查询密码 * @param username 用户名 * @return 密码 */ private String getPasswordByUsername(String username) { return userMap.get(username); } /** * 模拟数据库或缓存查询角色集合 * @param username 用户名 * @return 角色集合 */ private Set\u0026lt;String\u0026gt; getRolesByUsername(String username) { Set\u0026lt;String\u0026gt; roles = new HashSet\u0026lt;String\u0026gt;(); roles.add(\u0026#34;admin\u0026#34;); roles.add(\u0026#34;user\u0026#34;); return roles; } /** * 模拟数据库或缓存查询权限集合 * @param username 用户名 * @return 权限集合 */ private Set\u0026lt;String\u0026gt; getPermissionsByUsername(String username) { Set\u0026lt;String\u0026gt; permissions = new HashSet\u0026lt;String\u0026gt;(); permissions.add(\u0026#34;user:delete\u0026#34;); return permissions; } } 测试代码： public class MyRealmTest { private final MyRealm myRealm = new MyRealm(); @Test public void testAuthentication() { // 1. 构建SecurityManager环境 DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // 2. 给SecurityManager设置Realm defaultSecurityManager.setRealm(myRealm); // 3. 给SecurityUtils设置SecurityManager SecurityUtils.setSecurityManager(defaultSecurityManager); // 4. 获取Subject Subject subject = SecurityUtils.getSubject(); // 5. Subject提交认证请求 UsernamePasswordToken token = new UsernamePasswordToken(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); subject.login(token); /* 认证 */ System.out.println(\u0026#34;isAuthenticated: \u0026#34; + subject.isAuthenticated()); /* 授权 */ // 检查角色授权 subject.checkRoles(\u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;); // 检查权限授权 subject.checkPermission(\u0026#34;user:delete\u0026#34;); } } Shiro 加密 Shiro 散列配置 HashedCredentialsMatcher 自定义 Realm 中使用散列 盐的使用 数据库中的密码加盐后 md5 哈希加密。 在 Realm 返回 AuthenticationInfo 前给其设置盐值： SimpleAuthenticationInfo simpleAuthenticationInfo = new SimpleAuthenticationInfo(username, password, getName()); // 设置盐值 simpleAuthenticationInfo.setCredentialsSalt(ByteSource.Util.bytes(\u0026#34;salt\u0026#34;)); return simpleAuthenticationInfo; 进行认证时，给 Realm 设置 HashedCredentialsMatcher。 // 给Realm设置HashedCredentialsMatcher HashedCredentialsMatcher matcher = new HashedCredentialsMatcher(); // 哈希算法 matcher.setHashAlgorithmName(\u0026#34;md5\u0026#34;); // 哈希次数 matcher.setHashIterations(1); myRealm.setCredentialsMatcher(matcher); 完整 MyRealm 代码：\npublic class MyRealm extends AuthorizingRealm { /** * 模拟数据库或缓存 */ Map\u0026lt;String, String\u0026gt; userMap = new HashMap\u0026lt;String, String\u0026gt;(16){{ put(\u0026#34;Wxk\u0026#34;, \u0026#34;f51703256a38e6bab3d9410a070c32ea\u0026#34;); }}; { // 设置Realm名称 super.setName(\u0026#34;myRealm\u0026#34;); } @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { // 1. 获得用户名 String username = (String) principals.getPrimaryPrincipal(); // 2. 通过用户名到数据库或缓存中获取角色集合和权限集合 Set\u0026lt;String\u0026gt; roles = getRolesByUsername(username); Set\u0026lt;String\u0026gt; permissions = getPermissionsByUsername(username); // 3. 给AuthorizationInfo设置角色集合和权限结合 SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo(); simpleAuthorizationInfo.setRoles(roles); simpleAuthorizationInfo.setStringPermissions(permissions); // 4. 返回AuthorizationInfo return simpleAuthorizationInfo; } @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException { // 1. 从Subject传来的认证信息中获得用户名 String username = (String) token.getPrincipal(); // 2. 通过用户名到数据库中获取凭证 String password = getPasswordByUsername(username); if (password == null) { return null; } // 3. 返回AuthenticationInfo（将会和token进行匹配） SimpleAuthenticationInfo simpleAuthenticationInfo = new SimpleAuthenticationInfo(username, password, getName()); // 设置盐值 simpleAuthenticationInfo.setCredentialsSalt(ByteSource.Util.bytes(\u0026#34;salt\u0026#34;)); return simpleAuthenticationInfo; } /** * 模拟数据库查询密码 * @param username 用户名 * @return 密码 */ private String getPasswordByUsername(String username) { return userMap.get(username); } /** * 模拟数据库或缓存查询角色集合 * @param username 用户名 * @return 角色集合 */ private Set\u0026lt;String\u0026gt; getRolesByUsername(String username) { Set\u0026lt;String\u0026gt; roles = new HashSet\u0026lt;String\u0026gt;(); roles.add(\u0026#34;admin\u0026#34;); roles.add(\u0026#34;user\u0026#34;); return roles; } /** * 模拟数据库或缓存查询权限集合 * @param username 用户名 * @return 权限集合 */ private Set\u0026lt;String\u0026gt; getPermissionsByUsername(String username) { Set\u0026lt;String\u0026gt; permissions = new HashSet\u0026lt;String\u0026gt;(); permissions.add(\u0026#34;user:delete\u0026#34;); return permissions; } public static void main(String[] args) { Md5Hash md5Hash = new Md5Hash(\u0026#34;123456\u0026#34;, \u0026#34;salt\u0026#34;); System.out.println(md5Hash); } } 完整测试代码：\npublic class MyRealmTest { private final MyRealm myRealm = new MyRealm(); @Test public void testAuthentication() { // 1. 构建SecurityManager环境 DefaultSecurityManager defaultSecurityManager = new DefaultSecurityManager(); // 2. 给SecurityManager设置Realm defaultSecurityManager.setRealm(myRealm); // 给Realm设置HashedCredentialsMatcher HashedCredentialsMatcher matcher = new HashedCredentialsMatcher(); // 哈希算法 matcher.setHashAlgorithmName(\u0026#34;md5\u0026#34;); // 哈希次数 matcher.setHashIterations(1); myRealm.setCredentialsMatcher(matcher); // 3. 给SecurityUtils设置SecurityManager SecurityUtils.setSecurityManager(defaultSecurityManager); // 4. 获取Subject Subject subject = SecurityUtils.getSubject(); // 5. Subject提交认证请求 UsernamePasswordToken token = new UsernamePasswordToken(\u0026#34;Wxk\u0026#34;, \u0026#34;123456\u0026#34;); subject.login(token); /* 认证 */ System.out.println(\u0026#34;isAuthenticated: \u0026#34; + subject.isAuthenticated()); /* 授权 */ // 检查角色授权 subject.checkRoles(\u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;); // 检查权限授权 subject.checkPermission(\u0026#34;user:delete\u0026#34;); } } Shiro 过滤器 anon, authBasic, authc, user, logout perms, roles, ssl, port 自定义 Filter 如创建 RolesOrFilter 继承自 AuthorizationFilter，过滤条件为满足 roles 集合其中任何一个即可：：\npublic class RolesOrFilter extends AuthorizationFilter { @Override protected boolean isAccessAllowed(javax.servlet.ServletRequest servletRequest, javax.servlet.ServletResponse servletResponse, Object o) throws Exception { Subject subject = getSubject(servletRequest, servletResponse); String[] roles = (String[]) o; if (roles == null || roles.length == 0) { return true; } for (String role : roles) { if (subject.hasRole(role)) { return true; } } return false; } } Shiro 会话管理 SessionManager、SessionDAO Redis 实现 Session 共享 1. SessionDAO 实现自定义的 SessionDao 继承自 AbstractSessionDAO：\npublic class RedisSessionDao extends AbstractSessionDAO { @Resource private JedisUtil jedisUtil; private final static String SHIRO_SESSION_PREFIX = \u0026#34;session:\u0026#34;; private byte[] getKey(String key) { return (SHIRO_SESSION_PREFIX + key).getBytes(); } private void saveSession(Session session) { if (session != null \u0026amp;\u0026amp; session.getId() != null) { byte[] key = getKey(session.getId().toString()); byte[] value = SerializationUtils.serialize(session); jedisUtil.set(key, value); jedisUtil.expire(key, 600); } } @Override protected Serializable doCreate(Session session) { Serializable sessionId = generateSessionId(session); assignSessionId(session, sessionId); saveSession(session); return sessionId; } @Override protected Session doReadSession(Serializable sessionId) { if (sessionId == null) { return null; } byte[] key = getKey(sessionId.toString()); byte[] value = jedisUtil.get(key); return (Session) SerializationUtils.deserialize(value); } @Override public void update(Session session) throws UnknownSessionException { saveSession(session); } @Override public void delete(Session session) { if (session == null || session.getId() == null) { return; } byte[] key = getKey(session.getId().toString()); jedisUtil.del(key); } @Override public Collection\u0026lt;Session\u0026gt; getActiveSessions() { Set\u0026lt;byte[]\u0026gt; keys = jedisUtil.keys(SHIRO_SESSION_PREFIX); Set\u0026lt;Session\u0026gt; sessions = new HashSet\u0026lt;\u0026gt;(); if (CollectionUtils.isEmpty(keys)) { return sessions; } for (byte[] key : keys) { Session session = (Session) SerializationUtils.deserialize(jedisUtil.get(key)); sessions.add(session); } return sessions; } } 2. SessionManager 实现自定义的 SessionManager 继承自 DefaultSessionManager：\npublic class MySessionManager extends DefaultWebSessionManager { @Override protected Session retrieveSession(SessionKey sessionKey) throws UnknownSessionException { Serializable sessionId = getSessionId(sessionKey); if (sessionId == null) { return null; } ServletRequest request = null; if (sessionKey instanceof WebSessionKey) { request = ((WebSessionKey) sessionKey).getServletRequest(); } Session session = null; if (request != null) { // 先尝试从request中获取，以减少从redis中获取的次数 session = (Session) request.getAttribute(sessionId.toString()); // 若从request获取不到，再按照自己重写的readSession()方法的方式获取，并存入request if (session == null) { session = super.retrieveSession(sessionKey); request.setAttribute(sessionId.toString(), session); } } if (session == null) { String msg = \u0026#34;Could not find session with ID [\u0026#34; + sessionId + \u0026#34;]\u0026#34;; throw new UnknownSessionException(msg); } return session; } } 给 securityManager 设置 sessionManager。 Shiro 缓存管理 CacheManager、Cache Redis 实现 CacheManager 1. RedisCache 自定义 RedisCache 继承自 Cache：\npublic class RedisCache\u0026lt;K, V\u0026gt; implements Cache\u0026lt;K, V\u0026gt; { @Resource private JedisUtil jedisUtil; private final static String CACHE_PREFIX = \u0026#34;cache:\u0026#34;; private byte[] getKey(K k) { if (k instanceof String) { return (CACHE_PREFIX + k).getBytes(); } return SerializationUtils.serialize(k); } @Override public V get(K k) throws CacheException { byte[] value = jedisUtil.get(getKey(k)); if (value != null) { return (V) SerializationUtils.deserialize(value); } return null; } @Override public V put(K k, V v) throws CacheException { byte[] key = getKey(k); byte[] value = SerializationUtils.serialize(v); jedisUtil.set(key, value); jedisUtil.expire(key, 600); return v; } @Override public V remove(K k) throws CacheException { byte[] key = getKey(k); byte[] value = jedisUtil.get(key); jedisUtil.del(key); if (value != null) { return (V) SerializationUtils.deserialize(value); } return null; } @Override public void clear() throws CacheException { } @Override public int size() { return 0; } @Override public Set\u0026lt;K\u0026gt; keys() { return null; } @Override public Collection\u0026lt;V\u0026gt; values() { return null; } } 2. RedisCacheManager 自定义 RedisCacheManager 继承自 CacheManager：\npublic class RedisCacheManager implements CacheManager { @Resource private RedisCache redisCache; @Override public \u0026lt;K, V\u0026gt; Cache\u0026lt;K, V\u0026gt; getCache(String s) throws CacheException { return redisCache; } } 给 securityManager 设置 cacheManager。 Shiro RememberMe 配置 Bean：CookieRememberMeManager 和 SimpleCookie。 设置 CookieRememberMeManager 的 cookie 为 SimpleCookie。 给 securityManager 设置 rememberMeManager。 提交认证前，设置 rememberMe。 token.setRememberMe(true); subject.login(token); ","permalink":"https://zjxjwxk.github.io/posts/shiro/","summary":"\u003ch1 id=\"学习目标\"\u003e学习目标\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e认识 Shiro 的整体架构，各组件的概念\u003c/li\u003e\n\u003cli\u003eShiro 认证，授权的过程\u003c/li\u003e\n\u003cli\u003eShiro 自定义的 Realm，Filter\u003c/li\u003e\n\u003cli\u003eShiro Session 管理\u003c/li\u003e\n\u003cli\u003eShiro 缓存管理\u003c/li\u003e\n\u003cli\u003eShiro 集成 Spring\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"shiro-简介\"\u003eShiro 简介\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eApache 的强大灵活的开源安全框架\u003c/li\u003e\n\u003cli\u003e认证、授权、企业会话管理、安全加密\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"shiro-与-spring-security-比较\"\u003eShiro 与 Spring Security 比较\u003c/h1\u003e\n\u003ch2 id=\"shiro\"\u003eShiro\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e简单、灵活\u003c/li\u003e\n\u003cli\u003e可脱离 Spring\u003c/li\u003e\n\u003cli\u003e粒度较粗\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"spring-security\"\u003eSpring Security\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e复杂、笨重\u003c/li\u003e\n\u003cli\u003e不可脱离 Spring\u003c/li\u003e\n\u003cli\u003e粒度更细\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"shiro-整体架构\"\u003eShiro 整体架构\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"Shiro 整体架构\" loading=\"lazy\" src=\"/posts/shiro/images/ShiroArchitecture-20210319212652355.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"shiro-认证和授权\"\u003eShiro 认证和授权\u003c/h1\u003e\n\u003ch2 id=\"认证过程\"\u003e认证过程\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e创建 SecurityManager -\u0026gt; 主体提交认证 -\u0026gt; SecurityManager 认证 -\u0026gt; Authenticator 认证 -\u0026gt; Realm 验证\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"授权过程\"\u003e授权过程\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e创建 SecurityManager -\u0026gt; 主体提交授权 -\u0026gt; SecurityManager 授权 -\u0026gt; Authorizer 授权 -\u0026gt; Realm 获取角色权限数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e测试代码如下（这里先使用 SimpleAccountRealm 作为 Realm）：\u003c/p\u003e","title":"Shiro入门"},{"content":"1. 以太坊开发环境搭建 1.1 配置以太坊环境 1.1.1 安装 Go 环境 可在 Go 官网 https://golang.org/dl/ 直接下载相应操作系统的安装包，本人使用 MacOS 系统，故点击如下按钮下载：\n根据其提示信息进行安装，无需配置环境变量，在终端中输入 go version ，若出现如下版本信息则 Go 环境安装成功。\n1.1.2 安装 Node.js、NPM 由于 Node.js 的安装包已经包含了 NPM，故只需下载最新稳定版本的 Node.js 安装包即可。\n同样根据提示安装，无需配置环境变量，在终端中输入 node -v 和 npm -v ，若分别出现如下 Node.js 和 NPM 的版本信息，则安装成功。\n1.1.3 安装以太坊 Ethereum 由于本人使用 MacOS 系统，故使用 brew 安装，在终端中输入 brew install ethereum 即可安装。安装完成后，若输入 geth version 出现如下版本信息，则 Ethereum 安装成功。\n1.1.4 安装 solc 编译器 solc 是智能合约 Solidity 的编译器，可以使用 npm 安装，在终端中输入 sudo npm install solc 进行安装。\n安装完成后，若输入 solcjs --version 出现如下版本信息，则 solc 编译器安装成功。\n1.2 搭建以太坊私有链 1.2.1 创建账户（公钥） 在终端中输入以下命令创建以太坊账户，在创建时需要输入该账户的密码：\n所有的账户的公钥都可以在 Ethereum 安装目录的 keystore 下查看，本人的地址为 /Users/zjxjwxk/Library/Ethereum/keystore。\n1.2.2 编写创世块文件 在根目录下 ~/ 下创建 genesis.json 文件，如下配置：\n{ \u0026#34;config\u0026#34;: { \u0026#34;chainId\u0026#34;: 11, \u0026#34;homesteadBlock\u0026#34; : 0, \u0026#34;eip150Block\u0026#34;: 0, \u0026#34;eip155Block\u0026#34;: 0, \u0026#34;eip158Block\u0026#34;: 0 }, \u0026#34;alloc\u0026#34;: { \u0026#34;e68c39884e87fa216b8a9dafbc7f4a5398b648e2\u0026#34;: { \u0026#34;balance\u0026#34;: \u0026#34;20000000000000000000000000000\u0026#34; }, \u0026#34;ffcb1e2a08abca5b5d8a68077441125b8ffe97cd\u0026#34;: { \u0026#34;balance\u0026#34;: \u0026#34;20000000000000000000000000000\u0026#34; }, \u0026#34;24d2a6dd2c503c5dcc1cac7b30028ab3bc44756c\u0026#34;: { \u0026#34;balance\u0026#34;: \u0026#34;20000000000000000000000000000\u0026#34; } }, \u0026#34;coinbase\u0026#34;: \u0026#34;0x0000000000000000000000000000000000000000\u0026#34;, \u0026#34;difficulty\u0026#34;: \u0026#34;0x20000\u0026#34;, \u0026#34;extraData\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;gasLimit\u0026#34;: \u0026#34;0x2fefd8\u0026#34;, \u0026#34;nonce\u0026#34;: \u0026#34;0x0000000000000042\u0026#34;, \u0026#34;mixhash\u0026#34;: \u0026#34;0x0000000000000000000000000000000000000000000000000000000000000000\u0026#34;, \u0026#34;parentHash\u0026#34;: \u0026#34;0x0000000000000000000000000000000000000000000000000000000000000000\u0026#34;, \u0026#34;timestamp\u0026#34;: \u0026#34;0x00\u0026#34; } 1.2.3 初始化创世块 Ethereum 默认安装在 ～/Library/Ethereum 目录下，本人将私链初始化在 ～/Library/Ethereum/privatechain 中，使用以下命令来初始化刚刚创建的创世块文件：\ngeth --datadir \u0026#34;~/Library/Ethereum/privatechain\u0026#34; init ~/genesis.json 1.2.4 配置自动解锁账户的脚本 进入私链安装目录，创建 password 文件，并在该文件中输入在 genesis.json 中每个账户对应的密码，如下所示：\n123456 123456 123456 1.2.5 编写以太坊启动脚本 创建启动脚本文件 private_blockchain.sh 文件，并在文件中编写如下内容：\ngeth --rpc --rpcaddr=\u0026#34;0.0.0.0\u0026#34; --rpccorsdomain=\u0026#34;*\u0026#34; --unlock \u0026#39;0,1,2\u0026#39; --password ~/Library/Ethereum/privatechain/password --nodiscover --maxpeers \u0026#39;5\u0026#39; --networkid \u0026#39;0\u0026#39; --datadir \u0026#39;~/Library/Ethereum/privatechain\u0026#39; console 以后每次启动 geth 结点时，只需要在终端执行以下命令即可：\nsh private_blockchain.sh 1.2.6 启动以太坊 成功启动以太坊私有链的结果如下所示：\n1.2.7 启动挖矿 执行以下命令开始挖矿：\nminer.start() 执行以下命令提示挖矿：\nminer.stop() 挖矿时如下图所示：\n2. 智能合约 2.1 编写合约 编写一个非常简单的合约 Multiply7 为例，该合约有一个 multiply() 方法，传入一个 uint 类型数据，乘 7 后返回结果。\ncontract Multiply7 { event Print(uint); function multiply(uint input) returns (uint) { Print(input * 7); return input * 7; } } 2.2 编译合约 编译合约是为了获取合约的字节码，用于后面合约的部署，由于 go-ethereum 在其 1.6 版本中放弃使用 eth_compileSolidity 方法，当企图用 curl 方式调用时会返回 The method eth_compileSolidity does not exist/is not available 的提示，因此使用 Remix 进行在线编译合约，得到最重要的数据字节码和 abiDefinition 数据。\n点击下方 \u0026ldquo;ABI\u0026rdquo; 和 \u0026ldquo;Bytecode\u0026rdquo; 可复制 ABI 和 Bytecode，点击 Compilation Details 可获取编译相关数据：\n2.3 获得调用账户 当前以太坊私链中可能有多个创建账户，需要选定一个账户作为调用部署合约、调用合约方法的发起者。并且该账户中要包含足够的以太币。这里使用挖矿基地址作为交易的发起者，该地址也就是默认当前账户中的第一个账户。在一个终端 A 启动以太坊，并在另一个终端 B 中执行以下命令:\ncurl --data \u0026#39;{\u0026#34;jsonrpc\u0026#34;: \u0026#34;2.0\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;eth_coinbase\u0026#34;, \u0026#34;id\u0026#34;: 1}\u0026#39; -H \u0026#34;Content-Type: application/json\u0026#34; -X POST localhost:8545 返回结果：\n返回结果中的 0xe68c39884e87fa216b8a9dafbc7f4a5398b648e2 就是要使用的发起交易的账户。\n2.4 部署合约 执行以下代码创建合约，参数为所获得的 ABI：\nvar multiply7Contract = web3.eth.contract([ { \u0026#34;constant\u0026#34;: false, \u0026#34;inputs\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;input\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;uint256\u0026#34; } ], \u0026#34;name\u0026#34;: \u0026#34;multiply\u0026#34;, \u0026#34;outputs\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;uint256\u0026#34; } ], \u0026#34;payable\u0026#34;: false, \u0026#34;stateMutability\u0026#34;: \u0026#34;nonpayable\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;function\u0026#34; }, { \u0026#34;anonymous\u0026#34;: false, \u0026#34;inputs\u0026#34;: [ { \u0026#34;indexed\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;uint256\u0026#34; } ], \u0026#34;name\u0026#34;: \u0026#34;Print\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;event\u0026#34; } ]); 然后执行以下代码提交合约部署：\nvar multiply7 = multiply7Contract.new({ from: web3.eth.accounts[0], data: \u0026#39;0x608060405234801561001057600080fd5b5060fc8061001f6000396000f3fe6080604052600436106039576000357c010000000000000000000000000000000000000000000000000000000090048063c6888fa114603e575b600080fd5b348015604957600080fd5b50607360048036036020811015605e57600080fd5b81019080803590602001909291905050506089565b6040518082815260200191505060405180910390f35b60007f24abdb5865df5079dcc5ac590ff6f01d5c16edbc5fab4e195d9febd1114503da600783026040518082815260200191505060405180910390a160078202905091905056fea165627a7a7230582038bd52c038b56d86557d4dada43f00d8f45736557fb735e6a4519026d96be4800029\u0026#39;, gas: \u0026#39;3100000\u0026#39;, }, function (e, contract) { console.log(e, contract); if (typeof contract.address != \u0026#39;undefined\u0026#39;) { console.log(\u0026#39;Contract mined! address\u0026#39; + contract.address + \u0026#39; transactionHash: \u0026#39; + contract.transactionHash); } } ) 输入合约名称，可以查看合约信息。可以发现合约 address 为 undefined，这时合约还没有部署，需要矿工挖矿共识：\n矿工开始挖矿，将合约部署到区块中：\n过一段时间后，再查看合约信息，发现合约 address 已经生成，合约部署成功：\n2.5 调用合约 输入以下命令调用部署的 multiply7 合约的 multiply 函数，参数为 5，应该返回 5 * 7，即 35：\nmultiply7.multiply.call(5) 以上，就是以太坊私有链的搭建以及合约部署和调用的过程。\n","permalink":"https://zjxjwxk.github.io/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/","summary":"\u003ch1 id=\"1-以太坊开发环境搭建\"\u003e1. 以太坊开发环境搭建\u003c/h1\u003e\n\u003ch2 id=\"11-配置以太坊环境\"\u003e1.1 配置以太坊环境\u003c/h2\u003e\n\u003ch3 id=\"111-安装-go-环境\"\u003e1.1.1 安装 Go 环境\u003c/h3\u003e\n\u003cp\u003e可在 Go 官网 \u003ca href=\"https://golang.org/dl/\"\u003ehttps://golang.org/dl/\u003c/a\u003e 直接下载相应操作系统的安装包，本人使用 MacOS 系统，故点击如下按钮下载：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Go安装包下载\" loading=\"lazy\" src=\"/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/images/image-20201103124547934.png\"\u003e\u003c/p\u003e\n\u003cp\u003e根据其提示信息进行安装，无需配置环境变量，在终端中输入 \u003ccode\u003ego version\u003c/code\u003e ，若出现如下版本信息则 Go 环境安装成功。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Go 版本信息\" loading=\"lazy\" src=\"/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/images/image-20201103132116806.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"112-安装-nodejsnpm\"\u003e1.1.2 安装 Node.js、NPM\u003c/h3\u003e\n\u003cp\u003e由于 Node.js 的安装包已经包含了 NPM，故只需下载最新稳定版本的 Node.js 安装包即可。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Node.js 和 NPM 安装\" loading=\"lazy\" src=\"/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/images/image-20201103125435679.png\"\u003e\u003c/p\u003e\n\u003cp\u003e同样根据提示安装，无需配置环境变量，在终端中输入 \u003ccode\u003enode -v\u003c/code\u003e 和 \u003ccode\u003enpm -v\u003c/code\u003e ，若分别出现如下 Node.js 和 NPM 的版本信息，则安装成功。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Node.js 和 NPM 版本信息\" loading=\"lazy\" src=\"/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/images/image-20201103132211802.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"113-安装以太坊-ethereum\"\u003e1.1.3 安装以太坊 Ethereum\u003c/h3\u003e\n\u003cp\u003e由于本人使用 MacOS 系统，故使用 brew 安装，在终端中输入 \u003ccode\u003ebrew install ethereum\u003c/code\u003e 即可安装。安装完成后，若输入 \u003ccode\u003egeth version\u003c/code\u003e 出现如下版本信息，则 Ethereum 安装成功。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"geth 版本信息\" loading=\"lazy\" src=\"/posts/blockchain/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA/images/image-20201103132306255.png\"\u003e\u003c/p\u003e","title":"以太坊私有链搭建"},{"content":"想要一探 JDK 内部的实现机制，最便捷的捷径之一就是自己编译一套 JDK，通过阅读和跟踪调试 JDK 源码去了解 Java 技术体系的原理。本人选择了 OpenJDK 进行编译。\n由于在编译 OpenJDK 7 时出现了如下不知如何解决的问题：\nllvm-gcc -m64 -m64 -L`pwd` -framework CoreFoundation -o gamma launcher/java_md.o launcher/java.o launcher/jli_util.o launcher/wildcard.o -ljvm -lm -pthread Undefined symbols for architecture x86_64: \u0026#34;_JNI_CreateJavaVM\u0026#34;, referenced from: _LoadJavaVM in java_md.o \u0026#34;_JNI_GetDefaultJavaVMInitArgs\u0026#34;, referenced from: _LoadJavaVM in java_md.o ld: symbol(s) not found for architecture x86_64 clang: error: linker command failed with exit code 1 (use -v to see invocation) make[8]: *** [gamma] Error 1 make[7]: *** [the_vm] Error 2 make[6]: *** [product] Error 2 make[5]: *** [generic_build2] Error 2 make[4]: *** [product] Error 2 make[3]: *** [all_product_universal] Error 2 make[2]: *** [universal_product] Error 2 make[1]: *** [hotspot-build] Error 2 make: *** [build_product_image] Error 2 个人猜想是由于我 Mac OS 系统版本太高的问题（Catalina 10.15.5），XCode 版本也是最新的 11.6。\n于是，我尝试编译更高版本的 OpenJDK 8，在解决一系列编译问题后，成功了。\n获取 JDK 源码 获取 JDK 源码有两种方式：\n（1）通过 Mercurial 代码版本管理工具从 Repository 中直接取得源码\nRepository 地址：http://hg.openjdk.java.net/jdk8/jdk8\n获取过程如以下代码所示\nhg clone http://hg.openjdk.java.net/jdk8/jdk8 cd jdk7u-dev chmod 755 get_source.sh ./get_source.sh 从版本管理中看变更轨迹效果较好，但不足之处是速度太慢，而且 Mercurial 不如 Git、SVN 等版本控制工具那样普及。\n（2）通过 OpenJDK™ Source Releases 页面取得打包好的源码\n页面地址：https://download.java.net/openjdk/jdk8/\n系统需求 建议在 Linux、MacOS 或 Solaris 上构建 OpenJDK\n本人采用的是 64 位操作系统，编译的也是 64 位的 OpenJDK\n构建编译环境 本人使用的是 MacOS ，需要安装最新版本的 XCode 和 Command Line Tools for Xcode，另外还要准备一个 N-1 （N 为要编译的OpenJDK 版本号）以上版本的 JDK，官方称这个 JDK 为 “Bootstrap JDK” 。此处由于编译的是 OpenJDK 8，我选用 JDK 7 作为 Bootstrap JDK。最后，需要下载一个 1.7.1 以上版本的 Apache Ant，并添加环境变量，用于执行 Java 编译代码中的 Ant 脚本。用 brew 安装 freetype 和 CUPS。\n进行编译 最后我们还需要对系统的环境变量做一些简单设置以便编译能够顺利通过，这里给出使用的编译 Shell 脚本。其中添加导出了一些 ALT_ 环境变量（在编译 OpenJDK 8 的时候警告 ALT_ 被弃用了，因此这里注释掉了），如 freetype 和 CUPS。\n并将 COMPILER_WARNINGS_FATAL=false 以避免编译器的语法校验太严格：\n#语言选项,这个必须设置,否则编译好后会出现一个HashTable的NPE错 export LANG=C #Bootstrap JDK的安装路径。必须设置 #export ALT_BOOTDIR=/Library/Java/JavaVirtualMachines/jdk1.7.0_80.jdk/Contents/Home #允许自动下载依赖 export ALLOW_DOWNLOADS=true #并行编译的线程数,设置为和CPU内核数量一致即可 export HOTSPOT_BUILD_J0BS=8 #export ALT_PARALLEL_COMPILE_JOBS=8 #比较本次build出来的映像与先前版本的差异。这对我们来说没有意义, #必须设置为false,香则sanity检查会报缺少先前版本JDK的映像的错误提示。 #如桌已经设置dev或者DEV_ONLY=true,这个不显式设置也行 export SKIP_COMPARE_IMAGES=true #使用预编译头文件,不加这个编译会更慢一些 export USE_PRECOMPILED_HEADER=true #要编译的内容 export BUILD_LANGTOOLS=true #export BUILD_JAXP=false #export BUILD_JAXWS=fa1se #export BUILD_CORBA=false export BUILD_HOTSPOT=true export BUILD_JDK=true #要编译的版本 #export SKIP_DEBUG_BUILD=false #export SKIP_FASTDEBUG_BUILD=true #export DEBUG_NAME=debug #把它设置为false可以避开javaws和浏览器Java插件之类的部分的build BUILD_DEPLOY=false #把它设置为false就不会build出安装包。因为安装包里有些奇怪的依赖, #但即便不build出它也已经能得到完整的JDK映像,所以还是别build它好了 BUILD_INSTALL=false #编译结果所存放的路径 #export ALT_OUTPUTDIR=/Users/zjxjwxk/Documents/JVM/JDK-Build/build #export ALT_FREETYPE_HEADERS_PATH=/usr/local/Cellar/freetype/2.6.2/include/freetype2 #export ALT_FREETYPE_LIB_PATH=/usr/local/Cellar/freetype/2.6.2/lib #export ALT_CUPS_HEADERS_PATH=/usr/local/Cellar/cups/2.3.3/include export COMPILER_WARNINGS_FATAL=false #这两个环境变量必须去掉,不然会有很诡异的事情发生（我没有具体查过这些 \u0026#34;诡异的 #事情” ,Makefile脚本裣查到有这2个变量就会提示警告) unset JAVA_HOME unset CLASSPATH make 2\u0026gt;\u0026amp;1 | tee build/build.log 检查 全部设置结束之后，可以输入 make sanity 来检查我们所做的设置是否全部正确。如果一切顺利，那么几秒钟之后会有类似代码清单1-2所示的输出。\n~/Develop/JVM/jdkBuild/openjdk_7u4$ make sanity Build Machine Information: build machine = IcyFenix-RMBP.local Build Directory Structure: CWD = /Users/IcyFenix/Develop/JVM/jdkBuild/openjdk_7u4 TOPDIR = . LANGTOOLS_TOPDIR = ./langtools JAXP_TOPDIR = ./jaxp JAXWS_TOPDIR = ./jaxws CORBA_TOPDIR = ./corba HOTSPOT_TOPDIR = ./hotspot JDK_TOPDIR = ./jdk Build Directives: BUILD_LANGTOOLS = true BUILD_JAXP = true BUILD_JAXWS = true BUILD_CORBA = true BUILD_HOTSPOT = true BUILD_JDK = true DEBUG_CLASSFILES = DEBUG_BINARIES = ……因篇幅关系，中间省略了大量的输出内容…… OpenJDK-specific settings: FREETYPE_HEADERS_PATH = /usr/X11R6/include ALT_FREETYPE_HEADERS_PATH = FREETYPE_LIB_PATH = /usr/X11R6/lib ALT_FREETYPE_LIB_PATH = Previous JDK Settings: PREVIOUS_RELEASE_PATH = USING-PREVIOUS_RELEASE_IMAGE ALT_PREVIOUS_RELEASE_PATH = PREVIOUS_JDK_VERSION = 1.6.0 ALT_PREVIOUS_JDK_VERSION = PREVIOUS_JDK_FILE = ALT_PREVIOUS_JDK_FILE = PREVIOUS_JRE_FILE = ALT_PREVIOUS_JRE_FILE = PREVIOUS_RELEASE_IMAGE = /Library/Java/JavaVirtualMachines/jdk1.7.0_04.jdk/Contents/Home ALT_PREVIOUS_RELEASE_IMAGE = Sanity check passed. Makefile 的 Sanity 检查过程输出了编译所需的所有环境变量，如果看到 “Sanity check passed” 说明检查过程通过了，可以输入 make 执行整个 OpenJDK 编译 (make 不加参数，默认编译 make all)。\n可能出现的编译错误 error: equality comparison with extraneous error: \u0026#39;\u0026amp;\u0026amp;\u0026#39; within \u0026#39;||\u0026#39; 这是因为编译器语法校验太严格了，添加环境变量 export COMPILER_WARNINGS_FATAL=false 即可。\nclang: error: unknown argument: \u0026#39;-fpch-deps\u0026#39; 这是因为新的编译器已经不再支持这个选项了，打开 hotspot/make/bsd/makefiles/gcc.make，找到 -fpch-deps 所在的那一行，注释掉即可。\ninvalid argument \u0026#39;-std=gnu++98\u0026#39; not allowed with \u0026#39;C/ObjC\u0026#39; 在 common/autoconf/generated-configure.sh 中，注释掉 CXXSTD_CXXFLAG=\u0026quot;-std=gnu++98\u0026quot; 这一行，然后重新执行 configure。\n./configure --with-freetype-include=/usr/local/Cellar/freetype/2.6.2/include/freetype2 --with-freetype-lib=/usr/local/Cellar/freetype/2.6.2/lib 编译完成 编译成功后，显示：\n----- Build times ------- Start 2020-07-16 12:38:50 End 2020-07-16 12:48:23 00:00:17 corba 00:05:36 hotspot 00:00:11 jaxp 00:00:19 jaxws 00:02:44 jdk 00:00:25 langtools 00:09:33 TOTAL ------------------------- Finished building OpenJDK for target \u0026#39;default\u0026#39; 运行 java 命令 编译完成后，进入 OpenJDK 源码下的 build/macosx-x86_64-normal-server-release/jdk 目录，这是整个 JDK 的完整编译结果，复制到 JAVA_HOME 目录，就可以作为一个完整的 JDK 使用，编译出来的虚拟机，在 -version 命令中带有用户的机器名。\n\u0026gt; ./java -version openjdk version \u0026#34;1.8.0-internal\u0026#34; OpenJDK Runtime Environment (build 1.8.0-internal-zjxjxk_2020_07_16_13_03-b00) OpenJDK 64-Bit Server VM (build 25.71-b00, mixed mode) 可能出现的运行问题 我这里运行时出现了一个类似以下的问题：\nError: A fatal exception has occurred. Program will exit. localhost:bin jjchen$ ./java -version openjdk version \u0026#34;1.8.0-internal\u0026#34; OpenJDK Runtime Environment (build 1.8.0-internal-jjchen_2018_09_13_10_00-b00) OpenJDK 64-Bit Server VM (build 25.71-b00, mixed mode) # # A fatal error has been detected by the Java Runtime Environment: # # SIGILL (0x4) at pc=0x0000000107487f47, pid=88445, tid=0x0000000000002603 # # JRE version: OpenJDK Runtime Environment (8.0) (build 1.8.0-internal-jjchen_2018_09_13_10_00-b00) # Java VM: OpenJDK 64-Bit Server VM (25.71-b00 mixed mode bsd-amd64 compressed oops) # Problematic frame: # V [libjvm.dylib+0x487f47] # # Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \u0026#34;ulimit -c unlimited\u0026#34; before starting Java again # # An error report file with more information is saved as: # /Users/jjchen/jvm/jdk8u-dev/build/macosx-x86_64-normal-server-release/jdk/bin/hs_err_pid88445.log # # If you would like to submit a bug report, please visit: # http://bugreport.java.com/bugreport/crash.jsp # 在将 hotspot/src/share/vm/runtime/perfData.cpp 中的 delete p 注释掉，并重新编译后，得以正常运行。\nvoid PerfDataManager::destroy() { if (_all == NULL) // destroy already called, or initialization never happened return; for (int index = 0; index \u0026lt; _all-\u0026gt;length(); index++) { PerfData* p = _all-\u0026gt;at(index); // delete p; } delete(_all); delete(_sampled); delete(_constants); _all = NULL; _sampled = NULL; _constants = NULL; } 单独编译 HotSpot 虚拟机 在大多数时候，如果我们不关心 JDK 中 HotSpot 虚拟机以外的内容，只想单独编译 HotSpot 虚拟机的话（例如调试虚拟机时，每次改动程序都执行整个 OpenJDK 的Makefile，速度肯定受不了），那么使用 hotspot/make 目录 下的 Makefile 进行替换即可，其他参数设置与前面是一致的，这时候虚拟机的输出结果存放在 build/macosx-x86_64-normal-server-release/hotspot/bsd_amd64_compiler2 目录中，进入后可以见到以下几个目录。\ndrwxr-xr-x 11 zjxjwxk staff 352 7 16 13:04 debug drwxr-xr-x 11 zjxjwxk staff 352 7 16 13:04 fastdebug drwxr-xr-x 17 zjxjwxk staff 544 7 16 13:04 generated drwxr-xr-x 11 zjxjwxk staff 352 7 16 13:04 optimized drwxr-xr-x 643 zjxjwxk staff 20576 7 16 13:09 product 这些目录对应了不同的优化级别，优化级别越高，性能自然越好，但是输出代码与源码的差别就越大，难于调试，具体哪个目录有内容，取决于 make 命令后面的参数。\n在编译结束之后、运行虚拟机之前，还要手工编辑目录下的 env.sh 文件，这个文件由编译脚本自动产生，用于设置虚拟机的环境变量，里面已经发布了 “JAVA_HOME、CLASSPATH、HOTSPOT_BUILD_USER” 3个环境变量，还需要增加一个“LD_LIBRARY_PATH”，内容如下：\nLD_LIBRARY_PATH=.:${JAVA_HOME}/jre/lib/amd64/native_threads:${JAVA_HOME}/jre/lib/amd64: export LD_LIBRARY_PATH 然后执行以下命令启动虚拟机（这时的启动器名为gamma），输出版本号。\n. ./env.sh ./gamma -version Using java runtime at: /Library/Java/JavaVirtualMachines/jdk1.7.0_04.jdk/Contents/Home/jre java version \u0026#34;1.7.0_04\u0026#34; Java(TM) SE Runtime Environment (build 1.7.0_04-b21) OpenJDK 64-Bit Server VM (build 23.0-b21, mixed mode) 看到自己编译的虚拟机成功运行起来，很有成就感吧!\n参考：《深入理解Java虚拟机：JVM高级特性与最佳实践（第2版）》\n作者：周志明\n","permalink":"https://zjxjwxk.github.io/posts/java/jvm/%E8%87%AA%E5%B7%B1%E7%BC%96%E8%AF%91openjdk-8/","summary":"\u003cp\u003e想要一探 JDK 内部的实现机制，最便捷的捷径之一就是自己编译一套 JDK，通过阅读和跟踪调试 JDK 源码去了解 Java 技术体系的原理。本人选择了 OpenJDK 进行编译。\u003c/p\u003e\n\u003cp\u003e由于在编译 OpenJDK 7 时出现了如下不知如何解决的问题：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ellvm-gcc -m64   -m64  -L\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003epwd\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e  -framework CoreFoundation  -o gamma launcher/java_md.o launcher/java.o launcher/jli_util.o launcher/wildcard.o -ljvm -lm -pthread\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUndefined symbols \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e architecture x86_64:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;_JNI_CreateJavaVM\u0026#34;\u003c/span\u003e, referenced from:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      _LoadJavaVM in java_md.o\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;_JNI_GetDefaultJavaVMInitArgs\u0026#34;\u003c/span\u003e, referenced from:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      _LoadJavaVM in java_md.o\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eld: symbol\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003es\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e not found \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e architecture x86_64\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eclang: error: linker command failed with exit code \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003euse -v to see invocation\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e8\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003egamma\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e7\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003ethe_vm\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e6\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eproduct\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e5\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003egeneric_build2\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e4\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eproduct\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e3\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eall_product_universal\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e2\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003euniversal_product\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e1\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003ehotspot-build\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emake: *** \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003ebuild_product_image\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Error \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e个人猜想是由于我 Mac OS 系统版本太高的问题（Catalina 10.15.5），XCode 版本也是最新的 11.6。\u003c/p\u003e","title":"自己编译OpenJDK 8"},{"content":"主要问题 前后端分离后，前端使用 Ajax 进行请求，存在一些跨域的问题。\n基于 Spring Boot 的后端通过给 Controlle类或其中的方法添加 @CrossOrigin 注解来解决跨域问题：\n@CrossOrigin @RequestMapping(\u0026#34;/user/\u0026#34;) public class UserController { ... } 添加该注解之后，可以通过匿名访问的接口都没有跨域问题了，而需要通过 JWT 验证的接口仍然存在跨域问题。\n其中，解决问题的关键在于，浏览器会在发送 Ajax 请求之前发送一个预请求，确认当前的接口是不是有效的接口，此时的请求方式是 OPTIONS 的请求方式。\n因此，JWT 的过滤器需要先判断该请求是否为预请求，如果是则需要给返回的响应头中添加跨域相关的信息；如果不是，则按照一般接口进行 JWT 验证。\npublic class AuthFilter extends OncePerRequestFilter { ...... @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException { // 处理浏览器的预请求 if (request.getMethod().equals(\u0026#34;OPTIONS\u0026#34;)) { response.setHeader(\u0026#34;Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34;); response.setHeader(\u0026#34;Access-Control-Allow-Methods\u0026#34;, \u0026#34;POST,GET,PUT,OPTIONS,DELETE\u0026#34;); response.setHeader(\u0026#34;Access-Control-Max-Age\u0026#34;, \u0026#34;3600\u0026#34;); response.setHeader(\u0026#34;Access-Control-Allow-Headers\u0026#34;, \u0026#34;Origin,X-Requested-With,Content-Type,Accept,Authorization,token\u0026#34;); return; } // 验证 JWT ...... } } ","permalink":"https://zjxjwxk.github.io/posts/spring-boot/spring-boot-%E4%B8%AD%E7%9A%84-jwt-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/","summary":"\u003ch1 id=\"主要问题\"\u003e主要问题\u003c/h1\u003e\n\u003cp\u003e前后端分离后，前端使用 Ajax 进行请求，存在一些跨域的问题。\u003c/p\u003e\n\u003cp\u003e基于 Spring Boot 的后端通过给 Controlle类或其中的方法添加 \u003ccode\u003e@CrossOrigin\u003c/code\u003e 注解来解决跨域问题：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@CrossOrigin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@RequestMapping\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/user/\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUserController\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t...\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加该注解之后，可以通过匿名访问的接口都没有跨域问题了，而需要通过 JWT 验证的接口仍然存在跨域问题。\u003c/p\u003e\n\u003cp\u003e其中，\u003cstrong\u003e解决问题的关键\u003c/strong\u003e在于，浏览器会在发送 Ajax 请求之前发送一个预请求，确认当前的接口是不是有效的接口，此时的请求方式是 OPTIONS 的请求方式。\u003c/p\u003e\n\u003cp\u003e因此，JWT 的过滤器需要先判断该请求是否为预请求，如果是则需要给返回的响应头中添加跨域相关的信息；如果不是，则按照一般接口进行 JWT 验证。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eAuthFilter\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eextends\u003c/span\u003e OncePerRequestFilter {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \t......\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003e@Override\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eprotected\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edoFilterInternal\u003c/span\u003e(HttpServletRequest request, HttpServletResponse response, FilterChain chain) \u003cspan style=\"color:#66d9ef\"\u003ethrows\u003c/span\u003e IOException, ServletException {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 处理浏览器的预请求\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (request.\u003cspan style=\"color:#a6e22e\"\u003egetMethod\u003c/span\u003e().\u003cspan style=\"color:#a6e22e\"\u003eequals\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;OPTIONS\u0026#34;\u003c/span\u003e)) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.\u003cspan style=\"color:#a6e22e\"\u003esetHeader\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Access-Control-Allow-Origin\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.\u003cspan style=\"color:#a6e22e\"\u003esetHeader\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Access-Control-Allow-Methods\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;POST,GET,PUT,OPTIONS,DELETE\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.\u003cspan style=\"color:#a6e22e\"\u003esetHeader\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Access-Control-Max-Age\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;3600\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.\u003cspan style=\"color:#a6e22e\"\u003esetHeader\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Access-Control-Allow-Headers\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Origin,X-Requested-With,Content-Type,Accept,Authorization,token\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 验证 JWT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ......\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Spring Boot 中的 JWT 跨域问题"},{"content":"服务 Docker 化 修改项目配置 由于镜像运行时 MySQL 数据库所在的主机地址是动态的，所以将项目中的 MySQL 数据库地址和 Zookeeper 注册中心地址配置为动态变量：\nspring: dubbo: registry: zookeeper://${zk.address}:2181 datasource: url: jdbc:mysql://{mysql.address}:3306/cinema?autoReconnect=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=GMT%2B8 获取 Java 镜像 docker pull openjdk:8-jre 打包 Maven 项目 在项目根目录下，执行 Maven 的清除和打包命令（跳过测试）：\nmvn clean \u0026amp;\u0026amp; mvn package -Dmaven.test.skip=true 这样就会在 target 目录下生成 jar 包（Spring Boot 项目）。\n编写 Dockerfile 在 user 子模块的根目录下，创建 Dockerfile 文件，并编辑如下，Dockerfile 文件用于构建 Docker 镜像：\nFROM openjdk:8-jre MAINTAINER zjxjwxk zjxjwxk@gmail.com COPY target/user.jar /user.jar ENTRYPOINT [\u0026#34;java\u0026#34;, \u0026#34;-jar\u0026#34;, \u0026#34;/user.jar\u0026#34;] 构建项目 Docker 镜像 docker build -t user:latest . 编写 build 脚本 在和 Dockerfile 同一目录下，创建一个 build.sh 脚本，用于打包和构建 Docker 镜像：\nmvn clean \u0026amp;\u0026amp; mvn package -Dmaven.test.skip=true docker build -t user:latest . 启动镜像容器 docker run -it user:latest --mysql.address=172.20.10.3 --zk.address=172.20.10.3 注意：此处 172.20.10.3 为我的本机地址，可通过 ifconfig 查看（不可为 localhost 或 127.0.0.1，因为容器中的网络和本机是隔离的）。\nDocker 下的服务通讯 Docker 容器之间的通讯有三种方法：\n通过容器的 IP 和端口直接访问（不稳定，容器在每次重启时 IP 可能发生变化） 通过主机和容器的端口映射来访问 使用 Docker 的 link 机制，通过名字来访问 对于微服务之间，我们使用第 3 种方式；对于依赖的基础环境，如 MySQL、Zookeeper，我们使用第 2 种方式。\n建立服务之间的 link 关系 创建 Docker Compose Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。\n在项目根目录创建一个 docker-compose.yml 文件，编辑如下：\nversion: \u0026#39;1\u0026#39; services: cinema-user: image: cinema-user:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; cinema-film: image: cinema-film:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; cinema-cinema: image: cinema-cinema:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; cinema-order: image: cinema-order:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; links: - cinema-cinema cinema-alipay: image: cinema-alipay:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; links: - cinema-order cinema-gateway: image: cinema-gateway:latest command: - \u0026#34;--mysql.address=172.20.10.3 --zk.address=172.20.10.3\u0026#34; links: - cinema-user - cinema-film - cinema-cinema - cinema-order - cinema-alipay ports: - 8081:8081 其中，services 为所有需要构建的服务，command 为启动时添加的命令，links 为该服务依赖的服务。\n执行 docker-compose 在有 docker-compose.sh 的目录下，\n创建并运行所有容器：\ndocker-compose up -d 关闭并删除所有容器：\ndocker-compose down 镜像仓库 上传镜像 登录 Docker，执行以下命令，并输入 Docker Hub 的账号密码：\ndocker login 将现有的镜像打个 tag：\ndocker tag cinema-user:latest zjxjwxk/cinema-user:latest 将该镜像 push 到 Docker Hub：\ndocker push zjxjwxk/cinema-user:latest 或是将镜像从 Docker Hub pull 下来：\ndocker pull zjxjwxk/cinema-user:latest 使用 harbor 从 https://github.com/goharbor/harbor/releases 下载 harbor-offline-installer，解压之。\n配置 harbor.yml 配置其目录下的 harbor.yml ：\n将其中的 hostname 为 hub.xxx.com（xxx 为你的域名）。将 http 的 port 修改为 8080（由于 MacOS 80 端口不对外开放）。\n如果是 MacOS 系统，还需要将其中本机 host 相关的目录由根目录 / 改为 /Users/xxx/ (xxx 为你当前系统的用户名)，避免挂载权限不足的问题。\n# Configuration file of Harbor # The IP address or hostname to access admin UI and registry service. # DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients. hostname: hub.zjxjwxk.com # http related config http: # port for http, default is 80. If https enabled, this port will redirect to https port port: 8080 # https related config #https: # https port for harbor, default is 443 # port: 443 # The path of cert and key files for nginx # certificate: /your/certificate/path # private_key: /your/private/key/path # Uncomment external_url if you want to enable external proxy # And when it enabled the hostname will no longer used # external_url: https://reg.mydomain.com:8433 # The initial password of Harbor admin # It only works in first time to install harbor # Remember Change the admin password from UI after launching Harbor. harbor_admin_password: Harbor12345 # Harbor DB configuration database: # The password for the root user of Harbor DB. Change this before any production use. password: root123 # The maximum number of connections in the idle connection pool. If it \u0026lt;=0, no idle connections are retained. max_idle_conns: 50 # The maximum number of open connections to the database. If it \u0026lt;= 0, then there is no limit on the number of open connections. # Note: the default number of connections is 100 for postgres. max_open_conns: 100 # The default data volume data_volume: /Users/zjxjwxk/data # Harbor Storage settings by default is using /data dir on local filesystem # Uncomment storage_service setting If you want to using external storage # storage_service: # # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore # # of registry\u0026#39;s and chart repository\u0026#39;s containers. This is usually needed when the user hosts a internal storage with self signed certificate. # ca_bundle: # # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss # # for more info about this configuration please refer https://docs.docker.com/registry/configuration/ # filesystem: # maxthreads: 100 # # set disable to true when you want to disable registry redirect # redirect: # disabled: false # Clair configuration clair: # The interval of clair updaters, the unit is hour, set to 0 to disable the updaters. updaters_interval: 12 jobservice: # Maximum number of job workers in job service max_job_workers: 10 notification: # Maximum retry count for webhook job webhook_job_max_retry: 10 chart: # Change the value of absolute_url to enabled can enable absolute url in chart absolute_url: disabled # Log configurations log: # options are debug, info, warning, error, fatal level: info # configs for logs in local storage local: # Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated. rotate_count: 50 # Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes. # If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G # are all valid. rotate_size: 200M # The directory on your host that store log location: /Users/zjxjwxk/var/log/harbor # Uncomment following lines to enable external syslog endpoint. # external_endpoint: # # protocol used to transmit log to external endpoint, options is tcp or udp # protocol: tcp # # The host of external endpoint # host: localhost # # Port of external endpoint # port: 5140 #This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY! _version: 1.10.0 # Uncomment external_database if using external database. # external_database: # harbor: # host: harbor_db_host # port: harbor_db_port # db_name: harbor_db_name # username: harbor_db_username # password: harbor_db_password # ssl_mode: disable # max_idle_conns: 2 # max_open_conns: 0 # clair: # host: clair_db_host # port: clair_db_port # db_name: clair_db_name # username: clair_db_username # password: clair_db_password # ssl_mode: disable # notary_signer: # host: notary_signer_db_host # port: notary_signer_db_port # db_name: notary_signer_db_name # username: notary_signer_db_username # password: notary_signer_db_password # ssl_mode: disable # notary_server: # host: notary_server_db_host # port: notary_server_db_port # db_name: notary_server_db_name # username: notary_server_db_username # password: notary_server_db_password # ssl_mode: disable # Uncomment external_redis if using external Redis server # external_redis: # host: redis # port: 6379 # password: # # db_index 0 is for core, it\u0026#39;s unchangeable # registry_db_index: 1 # jobservice_db_index: 2 # chartmuseum_db_index: 3 # clair_db_index: 4 # Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert. # uaa: # ca_file: /path/to/ca # Global proxy # Config http proxy for components, e.g. http://my.proxy.com:3128 # Components doesn\u0026#39;t need to connect to each others via http proxy. # Remove component from `components` array if want disable proxy # for it. If you want use proxy for replication, MUST enable proxy # for core and jobservice, and set `http_proxy` and `https_proxy`. # Add domain to the `no_proxy` field, when you want disable proxy # for some special registry. proxy: http_proxy: https_proxy: # no_proxy endpoints will appended to 127.0.0.1,localhost,.local,.internal,log,db,redis,nginx,core,portal,postgresql,jobservice,registry,registryctl,clair,chartmuseum,notary-server no_proxy: components: - core - jobservice - clair 启动 harbar 执行 sh install.sh 运行 harbar。\n出现以下则说明启动成功：\n[Step 5]: starting Harbor ... Creating network \u0026#34;harbor_harbor\u0026#34; with the default driver Creating harbor-log ... done Creating redis ... done Creating harbor-portal ... done Creating registryctl ... done Creating harbor-db ... done Creating registry ... done Creating harbor-core ... done Creating nginx ... done Creating harbor-jobservice ... done ✔ ----Harbor has been installed and started successfully.---- 访问 localhost:8080 进入 Harbor UI 界面。默认账号为 admin，默认密码为 harbor.yml 中的 harbor_admin_password : Harbor12345。\n","permalink":"https://zjxjwxk.github.io/posts/docker/docker-+-k8s-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96/1.-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%89%8D%E5%A5%8F/","summary":"\u003ch1 id=\"服务-docker-化\"\u003e服务 Docker 化\u003c/h1\u003e\n\u003ch2 id=\"修改项目配置\"\u003e修改项目配置\u003c/h2\u003e\n\u003cp\u003e由于镜像运行时 MySQL 数据库所在的主机地址是动态的，所以将项目中的 MySQL 数据库地址和 Zookeeper 注册中心地址配置为动态变量：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003espring\u003c/span\u003e: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#f92672\"\u003edubbo\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#f92672\"\u003eregistry\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ezookeeper://${zk.address}:2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#f92672\"\u003edatasource\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#f92672\"\u003eurl\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ejdbc:mysql://{mysql.address}:3306/cinema?autoReconnect=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=GMT%2B8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"获取-java-镜像\"\u003e获取 Java 镜像\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edocker pull openjdk:8-jre\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"打包-maven-项目\"\u003e打包 Maven 项目\u003c/h2\u003e\n\u003cp\u003e在项目根目录下，执行 Maven 的清除和打包命令（跳过测试）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emvn clean \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e mvn package -Dmaven.test.skip\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这样就会在 target 目录下生成 jar 包（Spring Boot 项目）。\u003c/p\u003e\n\u003ch2 id=\"编写-dockerfile\"\u003e编写 Dockerfile\u003c/h2\u003e\n\u003cp\u003e在 user 子模块的根目录下，创建 Dockerfile 文件，并编辑如下，Dockerfile 文件用于构建 Docker 镜像：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e openjdk:8-jre\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eMAINTAINER\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e zjxjwxk zjxjwxk@gmail.com\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eCOPY\u003c/span\u003e target/user.jar /user.jar\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eENTRYPOINT\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;java\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;-jar\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/user.jar\u0026#34;\u003c/span\u003e]\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"构建项目-docker-镜像\"\u003e构建项目 Docker 镜像\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edocker build -t user:latest .\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"编写-build-脚本\"\u003e编写 build 脚本\u003c/h2\u003e\n\u003cp\u003e在和 Dockerfile 同一目录下，创建一个 build.sh 脚本，用于打包和构建 Docker 镜像：\u003c/p\u003e","title":"微服务容器化系列（1）：服务编排前奏"},{"content":"概要 概述 深入探索 MapReduce 过程 Hadoop 的分布式缓存 Hadoop 应用——推荐算法 HDFS HDFS 是 Hadoop 分布式文件系统的简称，由若干台计算机组成，用于存放 PB、TB 数量级以上的文件，每份文件可以有多个副本，所以 HDFS 是一个具有高冗余、高容错的文件系统。\nHadoop Hadoop 1.x Hadoop 2.x Hadoop 1.0 到 2.0 的变化：Hadoop 2.0 以后的版本移除了原有的 JobTracker 和 TaskTracker，改由 Yarn 平台的 ResourceManager 负责集群中所有资源的统一管理和分配，NodeManager 管理 Hadoop 集群中单个计算节点。\nYARN 的设计减小了 JobTracker 的资源消耗，减少了 Hadoop 1.0 中发生单点故障的风险。我们还可以在 YARN 平台上运行 Spark 和 Storm 作业，充分利用资源。\n深入探索 MapReduce WordCount 实例回顾 MapReduce 作业是一种大规模数据集的并行计算的编程模型。我们可以将 HDFS 中存放的海量数据，通过 MapReduce 作业进行计算，得到目标数据。\n四个阶段 Split 阶段 Map 阶段（需要编码） Shuffle 阶段 Reduce 阶段（需要编码） Split 阶段 Split 分片（设置文件输入类型为 CombineFileInputFormat ，将文件合并后再分片）：\n分片结果，分别作为 Map 阶段的输入。\nMap 阶段（需要编码） Shuffle 阶段 Shuffle 阶段过程比较复杂，可以理解为 Map 输出到 Reduce 输入的过程，而且涉及到网络传输。\nReduce 阶段（需要编码） 总过程 从分片输入到 Map 输入文件 文件保存在 DataNode 的 block 块中：\nHadoop 1.x 默认的 block 大小：64MB Hadoop 2.x 默认的 block 大小：128MB 可以在 hdfs-site.xml 中设置参数：dfs.block.size\n分片输入（Split） 理想的输入文件：由于 NameNode 内存有限，大量的小文件会给 HDFS 带来性能上的问题。故 HDFS 适合存放大文件，对于大量小文件，可以采用压缩、合并小文件的优化策略。例如，设置文件输入类型为 CombineFileInputFormat 格式。\n节点 Map 任务的个数 在实际情况下，Map 任务的个数是受到多个条件的制约，一般一个 DataNode 的 Map 任务数量控制在 10 到 100 比较合适。\n控制 Map 任务数量的方法：\n增加 Map 个数，可增大 mapred.map.tasks 减少 Map 个数，可增大 mapred.min.split.size 如果要减少 Map 个数，但有很多小文件，可将小文件合并成大文件，再使用准则 2 ","permalink":"https://zjxjwxk.github.io/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E8%BF%9B%E9%98%B6%E7%AF%87/","summary":"\u003ch1 id=\"概要\"\u003e概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e概述\u003c/li\u003e\n\u003cli\u003e深入探索 MapReduce 过程\u003c/li\u003e\n\u003cli\u003eHadoop 的分布式缓存\u003c/li\u003e\n\u003cli\u003eHadoop 应用——推荐算法\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"hdfs\"\u003eHDFS\u003c/h1\u003e\n\u003cp\u003eHDFS 是 Hadoop 分布式文件系统的简称，由若干台计算机组成，用于存放 PB、TB 数量级以上的文件，每份文件可以有多个副本，所以 HDFS 是一个具有高冗余、高容错的文件系统。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"HDFS架构\" loading=\"lazy\" src=\"/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E8%BF%9B%E9%98%B6%E7%AF%87/images/image-20200508165016013.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"hadoop\"\u003eHadoop\u003c/h1\u003e\n\u003ch2 id=\"hadoop-1x\"\u003eHadoop 1.x\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"Hadoop 1.x\" loading=\"lazy\" src=\"/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E8%BF%9B%E9%98%B6%E7%AF%87/images/image-20200508165127618.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"hadoop-2x\"\u003eHadoop 2.x\u003c/h2\u003e\n\u003cp\u003eHadoop 1.0 到 2.0 的变化：Hadoop 2.0 以后的版本移除了原有的 JobTracker 和 TaskTracker，改由 Yarn 平台的 ResourceManager 负责集群中所有资源的统一管理和分配，NodeManager 管理 Hadoop 集群中单个计算节点。\u003c/p\u003e\n\u003cp\u003eYARN 的设计减小了 JobTracker 的资源消耗，减少了 Hadoop 1.0 中发生单点故障的风险。我们还可以在 YARN 平台上运行 Spark 和 Storm 作业，充分利用资源。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Hadoop 1.0 =\u0026gt; Hadoop 2.0\" loading=\"lazy\" src=\"/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E8%BF%9B%E9%98%B6%E7%AF%87/images/image-20200508165216140.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"深入探索-mapreduce\"\u003e深入探索 MapReduce\u003c/h1\u003e\n\u003ch2 id=\"wordcount-实例回顾\"\u003eWordCount 实例回顾\u003c/h2\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E8%BF%9B%E9%98%B6%E7%AF%87/images/image-20200508170750118.png\"\u003e\u003c/p\u003e\n\u003cp\u003eMapReduce 作业是一种大规模数据集的并行计算的编程模型。我们可以将 HDFS 中存放的海量数据，通过 MapReduce 作业进行计算，得到目标数据。\u003c/p\u003e","title":"Hadoop 进阶篇"},{"content":"概要 大数据技术的相关概念 Hadoop 的架构和运行机制 实战：Hadoop 的安装和配置 实战：Hadoop 的开发 目标 掌握大数据存储与处理技术的原理（理论知识） 掌握 Hadoop 的使用和开发能力（实践能力） 结合书本，如《Hadoop 权威指南》 Hadoop 的前世今生 为了解决系统存在的瓶颈：存储容量、读写速率、计算效率\u0026hellip; Google 提出了大数据技术：MapReduce、BigTable、GFS，这三样技术取得了革命性的变化：\n成本降低，能用 PC 机，就不用大型机和高端存储 软件容错硬件故障视为常态，通过软件保证可靠性 简化并行分布式计算，无须控制节点同步和数据交换 但是，Google 只发表了相关的技术论文，没有开放源代码。于是，一个模仿 Google 大数据技术的开源实现出现了：Hadoop。\nHadoop 的功能和优势 Hadoop 是开源的分布式存储和分布式计算框架。\nHadoop 的组成 包含两个核心组件：\nHDFS：分布式文件系统，存储海量的数据 MapReduce：并行处理框架，实现任务分解和调度 Hadoop 可以用来搭建大型数据仓库，PB 级数据的存储、处理、分析、统计等业务。如：搜索引擎、日志分析、商业智能、数据挖掘。\nHadoop 的优势 高扩展 低成本 成熟的生态圈（Hive、HBase 等） Hadoop 生态系统及版本 Hadoop 生态系统 Hive：只需要编写 SQL 语句，Hive 就能够将其转化为一个 Hadoop 任务去执行，降低了使用 Hadoop 的门槛。\nHBase：和传统的关系型数据库不同，HBase 放弃事务特性，追求更高的扩展；和 HDFS 不同，HBase 提供数据的随机读写和实时访问，实现对表数据的读写功能。\nZooKeeper：用于监控 Hadoop 集群的状态，管理一些配置，维护数据间节点的一致性等。\nHadoop 版本 ver1.x较为稳定且容易上手，本人将选择 ver1.x。\n安装 Hadoop 准备 Linux 环境 安装 JDK 配置 Hadoop 下载 Hadoop wget https://archive.apache.org/dist/hadoop/core/hadoop-1.2.1/hadoop-1.2.1.tar.gz 并解压之。\n配置 Hadoop 在 conf 目录下找到 hadoop-env.sh 脚本，编辑之，将 JAVA_HOME 的注释去掉并配置为 Java 目录：\nexport JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home 配置 core.site.xml 添加如下配置：\n\u0026lt;configuration\u0026gt; \u0026lt;!-- Hadoop 的临时工作目录 --\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.tmp.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/hadoop\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!-- Hadoop 的元数据目录 --\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.name.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/hadoop/name\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!-- 文件系统 namenode 的访问地址 --\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;fs.default.name\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;hdfs://localhost:9000\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; 配置 hdfs-site.xml：\n\u0026lt;configuration\u0026gt; \u0026lt;!-- dfs 文件块的存放目录，文件系统的数据目录 --\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.data.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/hadoop/data\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; 配置 mapred-site.xml\n\u0026lt;configuration\u0026gt; \u0026lt;!-- MapReduce 的 job tracker 访问地址 --\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;mapred.job.tracker\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;localhost:9001\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; 配置 Hadoop 环境变量，编辑 /etc/profile，添加以下：\nexport HADOOP_HOME=/Library/hadoop-1.2.1 export PATH=$PATH:$HADOOP_HOME/bin 启动 Hadoop 对 NameNode 进行格式化操作：\nhadoop namenode -format 启动 Hadoop，执行 bin/start-all.sh ，使用 jps 命令查看是否有以下进程，若有则表示 Hadoop 已正常运行：\n10690 NameNode 10773 DataNode 10920 JobTracker 10859 SecondaryNameNode 11003 TaskTracker 11101 Jps 可以查看 Hadoop 下有哪些文件：\nhadoop fs -ls / Hadoop 的核心——HDFS简介 HDFS 设计架构 块（Block） NameNode DataNode 块（Block） HDFS 的文件被分成块进行存储，块的默认大小为 64MB，块是文件存储处理的逻辑单元。\n节点（Node） HDFS 中有两类节点 NameNode 和 DataNode：\nNameNode NameNode 是管理节点，存放文件元数据：\n文件与数据块的映射表 数据块与数据节点的映射表 DataNode DateNode 是 HDFS 的工作节点，存放数据块：\n数据管理策略 冗余数据块 每个数据块 3 个副本，分布在两个机架内的三个节点，存储冗余数据是为了预防数据丢失。\n心跳检测 每隔一段时间，DataNode 就像 NameNode 发送自己的状态：\n二级 NameNode 二级 NameNode 定期同步元数据映像文件和修改日志，NameNode 发生故障时，备胎转正，以保证 NameNode 的高可用性。\nHDFS 中文件的读写操作 HDFS 读取文件的流程 客户端（Java 程序或命令行）向 NameNode 发起文件读取请求，把文件名和路径告诉 NameNode NameNode 查询元数据，并返回给客户端，客户端就知道了这个文件包含哪些块，以及这些块分别能在哪些 DataNode 里找到 然后，客户端就能从这些 DataNode 找到这些块，并读取下载，再对它们进行组装 HDFS 写入文件的流程 客户端将需要写的文件拆分成块，并通知 NameNode NameNode 会找到当前可用的磁盘空间中的 DataNodes，并返回给客户端 根据返回的 DataNodes，客户端将这些块写入 DataNodes 客户端在向 DataNode 写入一个块后，DataNode 就要通过管道进行流水线复制 复制完之后，就对 NameNode 更新元数据 HDFS 的特点 特点 数据冗余，硬件容错 流式的数据访问（写一次，读多次） 存储大文件 适用性和局限性 适合数据批量读写，吞度量高（但不适合交互式应用，低延迟很难满足） 适合一次写入多次读取，顺序读写（但不支持多用户并发写相同文件） HDFS 的使用 格式化 NameNode 先对 NameNode 进行格式化操作：\nhadoop namenode -format 创建文件夹 在 HDFS 中创建一个文件夹 input：\nhadoop fs -mkdir input input 文件夹将会在 HDFS 中的 /user/root/ 下\nMacBook-Pro-of-Wxk:~ root# hadoop fs -ls /user/root/input Found 1 items -rw-r--r-- 3 root supergroup 0 2020-05-07 15:26 /user/root/input 上传文件 将本地 test.txt 文件上传到 HDFS 中刚刚创建的 input 中：\nhadoop fs -put test.txt input/ 这样就能在 /user/root/input/ 下找到该文件了\nMacBook-Pro-of-Wxk:~ root# hadoop fs -ls /user/root/input Found 1 items -rw-r--r-- 3 root supergroup 14 2020-05-07 16:00 /user/root/input/test.txt 读取文件 输出 HDFS 中的文件：\nMacBook-Pro-of-Wxk:~ root# hadoop fs -cat input/test.txt Hello Hadoop! 下载文件 从 HDFS 下载指定路径下的文件到本地：\nhadoop fs -get input/test.txt test2.txt 即可在本地找到该文件：\nMacBook-Pro-of-Wxk:~ root# cat test2.txt Hello Hadoop! 查看 NameNode 信息 MacBook-Pro-of-Wxk:~ root# hadoop dfsadmin -report Configured Capacity: 249531727872 (232.39 GB) Present Capacity: 83015577640 (77.31 GB) DFS Remaining: 83015569408 (77.31 GB) DFS Used: 8232 (8.04 KB) DFS Used%: 0% Under replicated blocks: 2 Blocks with corrupt replicas: 0 Missing blocks: 0 ------------------------------------------------- Datanodes available: 1 (1 total, 0 dead) Name: 127.0.0.1:50010 Decommission Status : Normal Configured Capacity: 249531727872 (232.39 GB) DFS Used: 8232 (8.04 KB) Non DFS Used: 166516150232 (155.08 GB) DFS Remaining: 83015569408(77.31 GB) DFS Used%: 0% DFS Remaining%: 33.27% Last contact: Thu May 07 16:09:02 CST 2020 Hadoop 的核心——MapReduce 原理与实现 MapReduce 原理 分而治之，一个大任务分成多个小的子任务（map），并行执行后，合并结果（reduce）。\n假如有 100 副扑克牌混在了一起，其中少了一张，怎么找出缺少的那一张？\nMap：随机分为 100 副扑克牌，各自统计该副牌总每张牌的出现次数。 Reduce：通过交换每副牌各自统计的结果，再次统计总的每张牌出现次数。一个 Reduce 统计一张牌的总出现次数。 最后对每张牌的总出现次数进行排序，筛选出结果。\n再如：100 GB 的网站访问日志文件，找出访问次数最多的 IP 地址；SELECT 表查询操作、JOIN 表连接操作，都可以通过 MapReduce 来实现。\nMapReduce 的运行流程 Job \u0026amp; Task JobTracker TaskTracker Job \u0026amp; Task 一个 Job 拆分为多个 Task 来解决，Task 又分为 MapTask 和 ReduceTask。\nJobTracker 作业调度 分配任务、监控任务执行进度 监控 TaskTracker 的状态 TaskTracker 执行任务 汇报任务状态 MapReduce 的容错机制 重复执行 重复执行将会最多重复执行四次任务，若仍然失败则放弃执行。\n推测执行 当 JobTracker 发现其中某个 TaskTracker 执行特别慢的时候，就会另开一个 TaskTracker 执行该任务，这两个 Task 谁先执行完，则终止另一个。\n开发 Hadoop 应用程序 WordCount 单词计数 WordCount 单次计数：计算文件中出现每个单词的频数，输出结果按照字母顺序进行排序。\nMapReduce 过程 源码 package com.zjut; import java.io.IOException; import java.util.StringTokenizer; import org.apache.hadoop.conf.Configuration; import org.apache.hadoop.fs.Path; import org.apache.hadoop.io.IntWritable; import org.apache.hadoop.io.LongWritable; import org.apache.hadoop.io.Text; import org.apache.hadoop.mapreduce.Job; import org.apache.hadoop.mapreduce.Mapper; import org.apache.hadoop.mapreduce.Reducer; import org.apache.hadoop.mapreduce.lib.input.FileInputFormat; import org.apache.hadoop.mapreduce.lib.input.TextInputFormat; import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; import org.apache.hadoop.mapreduce.lib.output.TextOutputFormat; /** * @author zjxjwxk */ public class WordCount { public static class WordCountMap extends Mapper\u0026lt;LongWritable, Text, Text, IntWritable\u0026gt; { private final IntWritable one = new IntWritable(1); private Text word = new Text(); @Override public void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException { String line = value.toString(); StringTokenizer token = new StringTokenizer(line); while (token.hasMoreTokens()) { word.set(token.nextToken()); context.write(word, one); } } } public static class WordCountReduce extends Reducer\u0026lt;Text, IntWritable, Text, IntWritable\u0026gt; { @Override public void reduce(Text key, Iterable\u0026lt;IntWritable\u0026gt; values, Context context) throws IOException, InterruptedException { int sum = 0; for (IntWritable val : values) { sum += val.get(); } context.write(key, new IntWritable(sum)); } } public static void main(String[] args) throws Exception { Configuration conf = new Configuration(); Job job = new Job(conf); job.setJarByClass(WordCount.class); job.setJobName(\u0026#34;wordcount\u0026#34;); job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); job.setMapperClass(WordCountMap.class); job.setReducerClass(WordCountReduce.class); job.setInputFormatClass(TextInputFormat.class); job.setOutputFormatClass(TextOutputFormat.class); FileInputFormat.addInputPath(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); job.waitForCompletion(true); } } 编译和打包 编译（添加 classpath 依赖包）：\njavac -classpath /Library/hadoop-1.2.1/hadoop-core-1.2.1.jar:/Library/hadoop-1.2.1/lib/commons-cli-1.2.jar -d WordCountClass/ WordCount.java 打包所有 class 文件为 jar 包：\njar -cvf WordCount.jar *.class 准备文件 创建一个 input 文件夹，在里面添加两个文本文件：\nHello.txt\nHello World Hello Hadoop Hello HDFS Hello Map Hello Reduce Hello2.txt\nHadoop World Hadoop NameNode Hadoop DataNode Hadoop MapReduce Hello BigData 上传文件 在 HDFS 中创建一个 input_wordcount 文件夹：\nhadoop fs -mkdir input_wordcount 将两个文本文件上传到 HDFS：\nhadoop fs -put input/* input_wordcount/ 可以在 HDFS 中找到这两个文件：\nMacBook-Pro-of-Wxk:Project root# hadoop fs -ls input_wordcount Found 2 items -rw-r--r-- 3 root supergroup 59 2020-05-08 13:51 /user/root/input_wordcount/Hello.txt -rw-r--r-- 3 root supergroup 76 2020-05-08 13:51 /user/root/input_wordcount/Hello2.txt 执行 MapReduce hadoop jar Hadoop/WordCount/WordCountClass/WordCount.jar WordCount input_wordcount output_wordcount hadoop 中执行本地 jar 包，最后有两个参数 input_wordcount, output_wordcount，分别为输入路径和输出路径。\n执行过程和结果：\n20/05/08 13:59:11 WARN mapred.JobClient: Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same. 20/05/08 13:59:11 INFO input.FileInputFormat: Total input paths to process : 2 20/05/08 13:59:11 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable 20/05/08 13:59:11 WARN snappy.LoadSnappy: Snappy native library not loaded 20/05/08 13:59:11 INFO mapred.JobClient: Running job: job_202005081303_0001 20/05/08 13:59:12 INFO mapred.JobClient: map 0% reduce 0% 20/05/08 13:59:15 INFO mapred.JobClient: map 100% reduce 0% 20/05/08 13:59:22 INFO mapred.JobClient: map 100% reduce 33% 20/05/08 13:59:23 INFO mapred.JobClient: map 100% reduce 100% 20/05/08 13:59:24 INFO mapred.JobClient: Job complete: job_202005081303_0001 20/05/08 13:59:24 INFO mapred.JobClient: Counters: 26 20/05/08 13:59:24 INFO mapred.JobClient: Map-Reduce Framework 20/05/08 13:59:24 INFO mapred.JobClient: Spilled Records=40 20/05/08 13:59:24 INFO mapred.JobClient: Map output materialized bytes=267 20/05/08 13:59:24 INFO mapred.JobClient: Reduce input records=20 20/05/08 13:59:24 INFO mapred.JobClient: Map input records=10 20/05/08 13:59:24 INFO mapred.JobClient: SPLIT_RAW_BYTES=245 20/05/08 13:59:24 INFO mapred.JobClient: Map output bytes=215 20/05/08 13:59:24 INFO mapred.JobClient: Reduce shuffle bytes=267 20/05/08 13:59:24 INFO mapred.JobClient: Reduce input groups=10 20/05/08 13:59:24 INFO mapred.JobClient: Combine output records=0 20/05/08 13:59:24 INFO mapred.JobClient: Reduce output records=10 20/05/08 13:59:24 INFO mapred.JobClient: Map output records=20 20/05/08 13:59:24 INFO mapred.JobClient: Combine input records=0 20/05/08 13:59:24 INFO mapred.JobClient: Total committed heap usage (bytes)=578813952 20/05/08 13:59:24 INFO mapred.JobClient: File Input Format Counters 20/05/08 13:59:24 INFO mapred.JobClient: Bytes Read=135 20/05/08 13:59:24 INFO mapred.JobClient: FileSystemCounters 20/05/08 13:59:24 INFO mapred.JobClient: HDFS_BYTES_READ=380 20/05/08 13:59:24 INFO mapred.JobClient: FILE_BYTES_WRITTEN=156788 20/05/08 13:59:24 INFO mapred.JobClient: FILE_BYTES_READ=261 20/05/08 13:59:24 INFO mapred.JobClient: HDFS_BYTES_WRITTEN=91 20/05/08 13:59:24 INFO mapred.JobClient: Job Counters 20/05/08 13:59:24 INFO mapred.JobClient: Launched map tasks=2 20/05/08 13:59:24 INFO mapred.JobClient: Launched reduce tasks=1 20/05/08 13:59:24 INFO mapred.JobClient: SLOTS_MILLIS_REDUCES=8065 20/05/08 13:59:24 INFO mapred.JobClient: Total time spent by all reduces waiting after reserving slots (ms)=0 20/05/08 13:59:24 INFO mapred.JobClient: SLOTS_MILLIS_MAPS=4142 20/05/08 13:59:24 INFO mapred.JobClient: Total time spent by all maps waiting after reserving slots (ms)=0 20/05/08 13:59:24 INFO mapred.JobClient: Data-local map tasks=2 20/05/08 13:59:24 INFO mapred.JobClient: File Output Format Counters 20/05/08 13:59:24 INFO mapred.JobClient: Bytes Written=91 查看执行结果 MacBook-Pro-of-Wxk:Project root# hadoop fs -ls output_wordcount Found 3 items -rw-r--r-- 3 root supergroup 0 2020-05-08 13:59 /user/root/output_wordcount/_SUCCESS drwxr-xr-x - root supergroup 0 2020-05-08 13:59 /user/root/output_wordcount/_logs -rw-r--r-- 3 root supergroup 91 2020-05-08 13:59 /user/root/output_wordcount/part-r-00000 其中，part-r-00000 就包含执行的结果，即统计了两个文件中，每个单词的总个数，并且按照字典顺序排序：\nMacBook-Pro-of-Wxk:Project root# hadoop fs -cat output_wordcount/part-r-00000 BigData\t1 DataNode\t1 HDFS\t1 Hadoop\t5 Hello\t6 Map\t1 MapReduce\t1 NameNode\t1 Reduce\t1 World\t2 利用 MapReduce 进行排序 将多个文件中的数字排序。\nMapReduce 过程 Map：将数据分片后，将数字按照区间进行标记。 Reduce：将每个分区的数字分别进行排序，最后合并。 源码 import java.io.IOException; import java.util.StringTokenizer; import org.apache.hadoop.conf.Configuration; import org.apache.hadoop.fs.Path; import org.apache.hadoop.io.IntWritable; import org.apache.hadoop.io.Text; import org.apache.hadoop.mapreduce.Job; import org.apache.hadoop.mapreduce.Mapper; import org.apache.hadoop.mapreduce.Reducer; import org.apache.hadoop.mapreduce.Partitioner; import org.apache.hadoop.mapreduce.lib.input.FileInputFormat; import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; import org.apache.hadoop.util.GenericOptionsParser; public class Sort { public static class Map extends Mapper\u0026lt;Object, Text, IntWritable, IntWritable\u0026gt; { private static IntWritable data = new IntWritable(); public void map(Object key, Text value, Context context) throws IOException, InterruptedException { String line = value.toString(); data.set(Integer.parseInt(line)); context.write(data, new IntWritable(1)); } } public static class Reduce extends Reducer\u0026lt;IntWritable, IntWritable, IntWritable, IntWritable\u0026gt; { private static IntWritable linenum = new IntWritable(1); public void reduce(IntWritable key, Iterable\u0026lt;IntWritable\u0026gt; values, Context context) throws IOException, InterruptedException { for (IntWritable val : values) { context.write(linenum, key); linenum = new IntWritable(linenum.get() + 1); } } } public static class Partition extends Partitioner\u0026lt;IntWritable, IntWritable\u0026gt; { @Override public int getPartition(IntWritable key, IntWritable value, int numPartitions) { int MaxNumber = 65223; int bound = MaxNumber / numPartitions + 1; int keynumber = key.get(); for (int i = 0; i \u0026lt; numPartitions; i++) { if (keynumber \u0026lt; bound * i \u0026amp;\u0026amp; keynumber \u0026gt;= bound * (i - 1)) return i - 1; } return 0; } } /** * @param args */ public static void main(String[] args) throws Exception { // TODO Auto-generated method stub Configuration conf = new Configuration(); String[] otherArgs = new GenericOptionsParser(conf, args) .getRemainingArgs(); if (otherArgs.length != 2) { System.err.println(\u0026#34;Usage Sort \u0026lt;int\u0026gt; \u0026lt;out\u0026gt;\u0026#34;); System.exit(2); } Job job = new Job(conf, \u0026#34;Sort\u0026#34;); job.setJarByClass(Sort.class); job.setMapperClass(Map.class); job.setPartitionerClass(Partition.class); job.setReducerClass(Reduce.class); job.setOutputKeyClass(IntWritable.class); job.setOutputValueClass(IntWritable.class); FileInputFormat.addInputPath(job, new Path(otherArgs[0])); FileOutputFormat.setOutputPath(job, new Path(otherArgs[1])); System.exit(job.waitForCompletion(true) ? 0 : 1); } } 编译和打包 编译：\njavac -classpath /Library/hadoop-1.2.1/hadoop-core-1.2.1.jar:/Library/hadoop-1.2.1/lib/commons-cli-1.2.jar -d SortClass/ Sort.java 打包：\njar -cvf Sort.jar *.class 准备文件 Numbers.txt\n199 3 609 456 789 119 Numbers2.txt\n478 971 988 125 9 3 1 上传文件 在 HDFS 中创建 input_sort 文件夹：\nhadoop fs -mkdir input_sort 将两个文本文件上传到 HDFS：\nhadoop fs -put Sort/* input_sort/ 执行 MapReduce hadoop jar Hadoop/WordCount/WordCountClass/WordCount.jar WordCount input_wordcount output_wordcount 执行过程和结果：\nMacBook-Pro-of-Wxk:Project root# hadoop jar Hadoop/Sort/SortClass/Sort.jar Sort input_sort output_sort 20/05/08 14:58:36 INFO input.FileInputFormat: Total input paths to process : 2 20/05/08 14:58:36 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable 20/05/08 14:58:36 WARN snappy.LoadSnappy: Snappy native library not loaded 20/05/08 14:58:36 INFO mapred.JobClient: Running job: job_202005081303_0002 20/05/08 14:58:37 INFO mapred.JobClient: map 0% reduce 0% 20/05/08 14:58:40 INFO mapred.JobClient: map 100% reduce 0% 20/05/08 14:58:48 INFO mapred.JobClient: map 100% reduce 100% 20/05/08 14:58:48 INFO mapred.JobClient: Job complete: job_202005081303_0002 20/05/08 14:58:48 INFO mapred.JobClient: Counters: 26 20/05/08 14:58:48 INFO mapred.JobClient: Map-Reduce Framework 20/05/08 14:58:48 INFO mapred.JobClient: Spilled Records=26 20/05/08 14:58:48 INFO mapred.JobClient: Map output materialized bytes=142 20/05/08 14:58:48 INFO mapred.JobClient: Reduce input records=13 20/05/08 14:58:48 INFO mapred.JobClient: Map input records=13 20/05/08 14:58:48 INFO mapred.JobClient: SPLIT_RAW_BYTES=239 20/05/08 14:58:48 INFO mapred.JobClient: Map output bytes=104 20/05/08 14:58:48 INFO mapred.JobClient: Reduce shuffle bytes=142 20/05/08 14:58:48 INFO mapred.JobClient: Reduce input groups=12 20/05/08 14:58:48 INFO mapred.JobClient: Combine output records=0 20/05/08 14:58:48 INFO mapred.JobClient: Reduce output records=13 20/05/08 14:58:48 INFO mapred.JobClient: Map output records=13 20/05/08 14:58:48 INFO mapred.JobClient: Combine input records=0 20/05/08 14:58:48 INFO mapred.JobClient: Total committed heap usage (bytes)=578813952 20/05/08 14:58:48 INFO mapred.JobClient: File Input Format Counters 20/05/08 14:58:48 INFO mapred.JobClient: Bytes Read=44 20/05/08 14:58:48 INFO mapred.JobClient: FileSystemCounters 20/05/08 14:58:48 INFO mapred.JobClient: HDFS_BYTES_READ=283 20/05/08 14:58:48 INFO mapred.JobClient: FILE_BYTES_WRITTEN=156172 20/05/08 14:58:48 INFO mapred.JobClient: FILE_BYTES_READ=136 20/05/08 14:58:48 INFO mapred.JobClient: HDFS_BYTES_WRITTEN=74 20/05/08 14:58:48 INFO mapred.JobClient: Job Counters 20/05/08 14:58:48 INFO mapred.JobClient: Launched map tasks=2 20/05/08 14:58:48 INFO mapred.JobClient: Launched reduce tasks=1 20/05/08 14:58:48 INFO mapred.JobClient: SLOTS_MILLIS_REDUCES=7980 20/05/08 14:58:48 INFO mapred.JobClient: Total time spent by all reduces waiting after reserving slots (ms)=0 20/05/08 14:58:48 INFO mapred.JobClient: SLOTS_MILLIS_MAPS=3902 20/05/08 14:58:48 INFO mapred.JobClient: Total time spent by all maps waiting after reserving slots (ms)=0 20/05/08 14:58:48 INFO mapred.JobClient: Data-local map tasks=2 20/05/08 14:58:48 INFO mapred.JobClient: File Output Format Counters 20/05/08 14:58:48 INFO mapred.JobClient: Bytes Written=74 查看执行结果 MacBook-Pro-of-Wxk:Project root# hadoop fs -ls output_sort Found 3 items -rw-r--r-- 3 root supergroup 0 2020-05-08 14:58 /user/root/output_sort/_SUCCESS drwxr-xr-x - root supergroup 0 2020-05-08 14:58 /user/root/output_sort/_logs -rw-r--r-- 3 root supergroup 74 2020-05-08 14:58 /user/root/output_sort/part-r-00000 其中，part-r-00000 就包含执行的结果，即两个文件中所有数字从小到大排序后的排名和数字。\nMacBook-Pro-of-Wxk:Project root# hadoop fs -cat output_sort/part-r-00000 1\t1 2\t3 3\t3 4\t9 5\t119 6\t125 7\t199 8\t456 9\t478 10\t609 11\t789 12\t971 13\t988 ","permalink":"https://zjxjwxk.github.io/posts/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hadoop%E5%9F%BA%E7%A1%80%E7%AF%87/","summary":"\u003ch1 id=\"概要\"\u003e概要\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e大数据技术的相关概念\u003c/li\u003e\n\u003cli\u003eHadoop 的架构和运行机制\u003c/li\u003e\n\u003cli\u003e实战：Hadoop 的安装和配置\u003c/li\u003e\n\u003cli\u003e实战：Hadoop 的开发\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"目标\"\u003e目标\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e掌握大数据存储与处理技术的原理（理论知识）\u003c/li\u003e\n\u003cli\u003e掌握 Hadoop 的使用和开发能力（实践能力）\u003c/li\u003e\n\u003cli\u003e结合书本，如《Hadoop 权威指南》\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"hadoop-的前世今生\"\u003eHadoop 的前世今生\u003c/h1\u003e\n\u003cp\u003e为了解决系统存在的瓶颈：存储容量、读写速率、计算效率\u0026hellip; Google 提出了大数据技术：MapReduce、BigTable、GFS，这三样技术取得了革命性的变化：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e成本降低，能用 PC 机，就不用大型机和高端存储\u003c/li\u003e\n\u003cli\u003e软件容错硬件故障视为常态，通过软件保证可靠性\u003c/li\u003e\n\u003cli\u003e简化并行分布式计算，无须控制节点同步和数据交换\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e但是，Google 只发表了相关的技术论文，没有开放源代码。于是，一个模仿 Google 大数据技术的开源实现出现了：Hadoop。\u003c/p\u003e\n\u003ch1 id=\"hadoop-的功能和优势\"\u003eHadoop 的功能和优势\u003c/h1\u003e\n\u003cp\u003eHadoop 是开源的分布式存储和分布式计算框架。\u003c/p\u003e\n\u003ch2 id=\"hadoop-的组成\"\u003eHadoop 的组成\u003c/h2\u003e\n\u003cp\u003e包含两个核心组件：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHDFS：分布式文件系统，存储海量的数据\u003c/li\u003e\n\u003cli\u003eMapReduce：并行处理框架，实现任务分解和调度\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eHadoop 可以用来搭建大型数据仓库，PB 级数据的存储、处理、分析、统计等业务。如：搜索引擎、日志分析、商业智能、数据挖掘。\u003c/p\u003e\n\u003ch2 id=\"hadoop-的优势\"\u003eHadoop 的优势\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e高扩展\u003c/li\u003e\n\u003cli\u003e低成本\u003c/li\u003e\n\u003cli\u003e成熟的生态圈（Hive、HBase 等）\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"hadoop-生态系统及版本\"\u003eHadoop 生态系统及版本\u003c/h1\u003e\n\u003ch2 id=\"hadoop-生态系统\"\u003eHadoop 生态系统\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eHive：只需要编写 SQL 语句，Hive 就能够将其转化为一个 Hadoop 任务去执行，降低了使用 Hadoop 的门槛。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHBase：和传统的关系型数据库不同，HBase 放弃事务特性，追求更高的扩展；和 HDFS 不同，HBase 提供数据的随机读写和实时访问，实现对表数据的读写功能。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eZooKeeper：用于监控 Hadoop 集群的状态，管理一些配置，维护数据间节点的一致性等。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"hadoop-版本\"\u003eHadoop 版本\u003c/h2\u003e\n\u003cp\u003ever1.x较为稳定且容易上手，本人将选择 ver1.x。\u003c/p\u003e","title":"Hadoop 基础篇"},{"content":"运行环境 CentOS 6 云服务器 创建用户 创建一个 cinema 用户：\n[root@huawei ~]# useradd cinema [root@huawei ~]# passwd cinema Changing password for user cinema. New password: BAD PASSWORD: it does not contain enough DIFFERENT characters Retype new password: passwd: all authentication tokens updated successfully. 给予其权限，首先需要赋予当前用户对 /etc/sudoers 的写权限，然后在 sudoers 文件中的 root ALL = (ALL) ALL 下增加一行，赋予其在任何地方执行任何命令的权限：\nchmod u+w /etc/sudoers vim sudoers ## Allow root to run any commands anywhere root ALL=(ALL) ALL cinema ALL=(ALL) ALL 最后，取消当前用户的写权限：\nchmod u-w /etc/sudoers 关闭 iptables 防火墙 我们只需要使用云服务器提供的防火墙就够了\nservice iptables stop 并且关闭开机启动\nchkconfig iptables off 安装数据库 下载并安装 MySQL Yum Repository（MySQL 镜像源）：\nwget https://dev.mysql.com/get/mysql80-community-release-el6-3.noarch.rpm sudo yum install mysql80-community-release-el6-3.noarch.rpm 验证安装是否成功：\nls /etc/yum.repos.d/ 若存在 mysql-community.repo 和 mysql-community-source.repo，则表示 MySQL Yum Repository 安装成功。\n查看所有 MySQL 版本：\nyum repolist all | grep mysql 禁用最新版，使用 5.7 版本：\nsudo yum-config-manager --disable mysql80-community sudo yum-config-manager --enable mysql57-community 安装 MySQL：\nsudo yum install mysql-community-server 开启 MySQL 服务：\nsudo service mysqld start 查看 MySQL 初始密码：\nsudo grep \u0026#34;password\u0026#34; /var/log/mysqld.log 利用初始密码登录数据库：\nmysql -uroot -p 修改初始密码：\nset password for \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; = password(\u0026#39;Zjxjwxk19981018_\u0026#39;); 查看当前有哪些用户：\nmysql\u0026gt; select host, user from mysql.user; +---------+---------------+ | host | user | +-------- +---------------+ | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+-------------+ 修改 root 用户访问权限，使得其可以被远程访问：\nUPDATE mysql.user SET host = \u0026#39;%\u0026#39; WHERE user = \u0026#39;root\u0026#39; and host = \u0026#39;localhost\u0026#39;; 修改后重启 MySQL：\nsudo service mysqld restart 安装 vsftpd 阿里云文档：https://help.aliyun.com/knowledge_detail/60152.html\n安装 JDK 和 Zookeeper 安装 JDK 在本地上，从 Oracle 官网下载 jdk 的 tar.gz 包 https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html ，并上传到服务器上：\nsudo scp jdk-8u251-linux-x64.tar.gz cinema@34.80.107.207:~/install/ 如果 scp 出现 Permission denied (publickey,gssapi-keyex,gssapi-with-mic). ，则可能需要在服务器上设置密码登录为 yes：\nsudo vim /etc/ssh/sshd_config 将 PasswordAuthentication no 中的 “no” 改为 \u0026ldquo;yes\u0026rdquo;。\n在服务器解压：\ntar -zxvf jdk-8u251-linux-x64.tar.gz 添加 JAVA_HOME 环境变量：\nvim /etc/profile 添加以下几行：\n## JAVA_HOME export JAVA_HOME=/developer/jdk1.8.0_251 export PATH=$PATH:$JAVA_HOME/bin 生效环境变量：\nsource /etc/profile 安装 Zookeeper 从 Apache Zookeeper 官网获取 tar.gz 包：\nwget https://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz 同样，解压之：\ntar -zxvf zookeeper-3.4.14.tar.gz 重命名 zoo_sample.cfg 为 zoo.cfg：\nmv zookeeper-3.4.14/conf/zoo_sample.cfg zoo.cfg 启动 Zookeeper：\nsh zookeeper-3.4.14/bin/zkServer.sh start 查看服务进程：\nps -ef | grep zookeeper 数据初始化、工程打包和部署 将各个模块的 application.yml 配置为线上环境，包括数据库和 FTP 服务器的地址、用户名和密码等。然后直接对父模块使用 maven clean 和 package 打包各个模块为 jar 包，发送到服务器上部署运行即可（jar 包后台运行和日志输出重定向见 [CentOS jar包后台运行](https://zjxjwxk.com/2019/01/30/Linux/CentOS/CentOS jar包后台运行/)）。当然，这里是一种比较 low 的部署方式，可以通过 Jenkins，k8s 等进行持续集成。\n可以通过以下命令查看是否启动成功：\nps -ef | grep xxx 或者 jobs 安装 OpenResty 安装前的准备 您必须将这些库 perl 5.6.1+, libpcre, libssl安装在您的电脑之中。 对于 Linux来说, 您需要确认使用 ldconfig 命令，让其在您的系统环境路径中能找到它们。\nFedora 和 RedHat 用户 推荐您使用yum安装以下的开发库:\nyum install pcre-devel openssl-devel gcc curl 构建 OpenResty 下载 从下载页 Download下载最新的 OpenResty® 源码包，并且像下面的示例一样将其解压:\ntar -xzvf openresty-VERSION.tar.gz VERSION 的地方替换成您下载的源码包的版本号，比如说 0.8.54.6。\n./configure 然后在进入 openresty-VERSION/ 目录, 然后输入以下命令配置:\n./configure 默认, --prefix=/usr/local/openresty 程序会被安装到/usr/local/openresty目录。\n您可以指定各种选项，比如\n./configure --prefix=/developer/openresty \\ --with-luajit \\ --without-http_redis2_module \\ --with-http_iconv_module 试着使用 ./configure --help 查看更多的选项。\n配置文件（./configure script）运行出错可以到 build/nginx-VERSION/objs/autoconf.err 找到。 VERSION 的地方必须与OpenResty版本号相对应, 比如 0.8.54.6。\n需要额外安装 postersql-devel\nsudo yum install -y postgresql-devel make 您可以使用下面的命令来编译：\nmake 如果您的电脑支持多核 make 工作的特性, 您可以这样编译:\nmake -j2 假设您是的机器是双核。\nmake install 如果前面的步骤都没有问题的话,您可以使用下面的命令安装 OpenResty 到您的系统中：\nmake install 在 Linux 上，通常需要使用 sudo 来获取 root 权限来完成安装。\n如果在 prefix 目录有了 openresty 目录，这代表安装完成。\n配置 Nginx 编辑 Nginx 的 nginx.conf\nvim openresty/nginx/conf/nginx.conf 在其中启用（去掉注释） error_log, pid, http 中的 log_format 和 access_log。\n在 http 的 server 中，去掉 access_log 的注释（全局也有一个 access_log，局部优先），并给 server_name 添加域名，将 location / 中修改为 proxy_pass http://127.0.0.1:8081 （此处为我的 gateway 网关模块运行端口），即代理访问 gateway 服务。FTP 服务器代理则为 root /ftpfile/ 。\n#user nobody; worker_processes 1; error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server { listen 80; server_name localhost www.cinema.zjxjwxk.com cinema.zjxjwxk.com #charset koi8-r; access_log logs/host.access.log main; location / { proxy_pass http://127.0.0.1:8081 } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ { # proxy_pass http://127.0.0.1; #} # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ { # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #} # deny access to .htaccess files, if Apache\u0026#39;s document root # concurs with nginx\u0026#39;s one # #location ~ /\\.ht { # deny all; #} } # another virtual host using mix of IP-, name-, and port-based configuration # # vsftpd FTP server #server { # listen 80; # server_name localhost img-cinema.zjxjwxk.com; # location / { # root /ftpfile/; # } #} # HTTPS server # #server { # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / { # root html; # index index.html index.htm; # } #} } 在 sbin 中执行以下命令查看配置是否合法\nsudo ./nginx -t 运行 nginx\n./nginx 验证是否运行成功\nnetstat -nlp | grep \u0026#34;nginx\u0026#34; ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/12.%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/","summary":"\u003ch1 id=\"运行环境\"\u003e运行环境\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eCentOS 6\u003c/li\u003e\n\u003cli\u003e云服务器\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"创建用户\"\u003e创建用户\u003c/h1\u003e\n\u003cp\u003e创建一个 cinema 用户：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eroot@huawei ~\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e# useradd cinema\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eroot@huawei ~\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e# passwd cinema\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eChanging password \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e user cinema.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNew password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBAD PASSWORD: it does not contain enough DIFFERENT characters\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRetype new password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epasswd: all authentication tokens updated successfully.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e给予其权限，首先需要赋予当前用户对 /etc/sudoers 的写权限，然后在 sudoers 文件中的 root ALL = (ALL) ALL 下增加一行，赋予其在任何地方执行任何命令的权限：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echmod u+w /etc/sudoers\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evim sudoers\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e## Allow root to run any commands anywhere \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot    ALL\u003cspan style=\"color:#f92672\"\u003e=(\u003c/span\u003eALL\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e       ALL\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecinema  ALL\u003cspan style=\"color:#f92672\"\u003e=(\u003c/span\u003eALL\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e       ALL\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e最后，取消当前用户的写权限：\u003c/p\u003e","title":"Dubbo微服务影院系列（12）：系统部署"},{"content":"方法1（暂时）: 在终端中直接运行命令\nexport http_proxy=http://proxyAddres.s:port 这个办法的好处是简单直接，并且影响面很小（只对当前终端有效，退出就不行了）。\n如果你用的是 s.s 代理，在当前终端运行以下命令，那么wget curl 这类网络命令都会经过 s.s 代理，port 端口号可以从 s.s 高级设置中查看，我的是1086。\nexport ALL_PROXY=socks5://127.0.0.1:1086 安装完软件以后，我们再执行以下命令取消终端代理\nunset ALL_PROXY 方法2（永久）: 把代理服务器地址写入 shell 配置文件.bashrc或者.zshrc\n直接在.bashrc或者.zshrc添加下面内容\nexport http_proxy=\u0026#34;http://localhost:port\u0026#34; export https_proxy=\u0026#34;http://localhost:port\u0026#34; 以使用 s.s 代理为例，s.s 的代理端口为1086,那么应该设置为\nexport http_proxy=\u0026#34;socks5://127.0.0.1:1086\u0026#34; export https_proxy=\u0026#34;socks5://127.0.0.1:1086\u0026#34; 或者直接设置 ALL_PROXY\nexport ALL_PROXY=socks5://127.0.0.1:1086 localhost就是一个域名，域名默认指向 127.0.0.1，两者是一样的。\n然后ESC后:wq保存文件，接着在终端中执行source ~/.bashrc\n这个办法的好处是把代理服务器永久保存了，下次就可以直接用了。\n或者通过设置 alias 简写来简化操作，每次要用的时候输入setproxy，不用了就unsetproxy。\nalias setproxy=\u0026#34;export ALL_PROXY=socks5://127.0.0.1:1086\u0026#34; alias unsetproxy=\u0026#34;unset ALL_PROXY\u0026#34; Git 代理 git 设置全局代理：\ngit config --global http.proxy \u0026#39;socks5://127.0.0.1:1086\u0026#39; git config --global https.proxy \u0026#39;socks5://127.0.0.1:1086\u0026#39; git 仅针对 GitHub 的单独配置：\ngit config --global http.https://github.com.proxy \u0026#39;socks5://127.0.0.1:1086\u0026#39; git 取消全局代理，只需加个 \u0026ndash;unset，单独配置同理：\ngit config --global --unset http.proxy \u0026#39;socks5://127.0.0.1:1086\u0026#39; git config --global --unset https.proxy \u0026#39;socks5://127.0.0.1:1086\u0026#39; ","permalink":"https://zjxjwxk.github.io/posts/linux/macos/","summary":"\u003ch1 id=\"方法1暂时\"\u003e方法1（暂时）:\u003c/h1\u003e\n\u003cp\u003e在终端中直接运行命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport http_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehttp://proxyAddres.s:port\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这个办法的好处是简单直接，并且影响面很小（只对当前终端有效，退出就不行了）。\u003c/p\u003e\n\u003cp\u003e如果你用的是 s.s 代理，在当前终端运行以下命令，那么\u003ccode\u003ewget\u003c/code\u003e \u003ccode\u003ecurl\u003c/code\u003e 这类网络命令都会经过 s.s 代理，port 端口号可以从 s.s 高级设置中查看，我的是1086。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport ALL_PROXY\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esocks5://127.0.0.1:1086\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"s.s端口\" loading=\"lazy\" src=\"/posts/linux/macos/images/image-20200426235228770.png\"\u003e\u003c/p\u003e\n\u003cp\u003e安装完软件以后，我们再执行以下命令取消终端代理\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eunset ALL_PROXY\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"方法2永久\"\u003e方法2（永久）:\u003c/h1\u003e\n\u003cp\u003e把代理服务器地址写入 shell 配置文件\u003ccode\u003e.bashrc\u003c/code\u003e或者\u003ccode\u003e.zshrc\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e直接在\u003ccode\u003e.bashrc\u003c/code\u003e或者\u003ccode\u003e.zshrc\u003c/code\u003e添加下面内容\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport http_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://localhost:port\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport https_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http://localhost:port\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e以使用 s.s 代理为例，s.s 的代理端口为\u003ccode\u003e1086\u003c/code\u003e,那么应该设置为\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport http_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;socks5://127.0.0.1:1086\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport https_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;socks5://127.0.0.1:1086\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或者直接设置 ALL_PROXY\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport ALL_PROXY\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esocks5://127.0.0.1:1086\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003elocalhost\u003c/code\u003e就是一个域名，域名默认指向 \u003ccode\u003e127.0.0.1\u003c/code\u003e，两者是一样的。\u003c/p\u003e\n\u003cp\u003e然后\u003ccode\u003eESC\u003c/code\u003e后\u003ccode\u003e:wq\u003c/code\u003e保存文件，接着在终端中执行\u003ccode\u003esource ~/.bashrc\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e这个办法的好处是把代理服务器永久保存了，下次就可以直接用了。\u003c/p\u003e\n\u003cp\u003e或者通过设置 alias 简写来简化操作，每次要用的时候输入\u003ccode\u003esetproxy\u003c/code\u003e，不用了就\u003ccode\u003eunsetproxy\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ealias setproxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;export ALL_PROXY=socks5://127.0.0.1:1086\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ealias unsetproxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;unset ALL_PROXY\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"git-代理\"\u003eGit 代理\u003c/h1\u003e\n\u003cp\u003egit 设置全局代理：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit config --global http.proxy \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;socks5://127.0.0.1:1086\u0026#39;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003egit config --global https.proxy \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;socks5://127.0.0.1:1086\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003egit 仅针对 GitHub 的单独配置：\u003c/p\u003e","title":"Terminal 终端代理加速"},{"content":"章节概要 了解 Dubbo 监控相关内容 熟练掌握 Dubbo-admin 使用 熟练掌握链路监控 完成业务系统部署 Dubbo-monitor 源码下载和打包 目前，还可以从当当网的项目 Dubbox 中获取（很久没有维护了）：https://github.com/dangdangdotcom/dubbox ，在项目中执行以下命令打包并拷贝到本地仓库（跳过单元测试）：\nmvn package -Dmaven.test.skip=true 其中，可能会遇到 Missing artifact com.alibaba:dubbo:jar:2.8.4 的坑，需要在根项目的 pom.xml 文件中添加以下 maven 插件：\n这样在本地仓库就有了 ~/.m2/repository/com/alibaba/dubbo-monitor-simple/2.8.4/dubbo-monitor-simple-2.8.4-assembly.tar.gz 这个 tar.gz 包，解压它可以得到以下文件：\n启动服务监控 在 conf 文件夹下，编辑 dubbo.properties，将相关参数配置如下：\ndubbo.container=log4j,spring,registry,jetty dubbo.application.name=simple-monitor dubbo.application.owner= #dubbo.registry.address=multicast://224.5.6.7:1234 dubbo.registry.address=zookeeper://127.0.0.1:2181 #dubbo.registry.address=redis://127.0.0.1:6379 #dubbo.registry.address=dubbo://127.0.0.1:9090 dubbo.protocol.port=7070 dubbo.jetty.port=8090 dubbo.jetty.directory=monitor dubbo.charts.directory=monitor/charts dubbo.statistics.directory=monitor/statistics dubbo.log4j.file=monitor/dubbo-monitor-simple.log dubbo.log4j.level=WARN 然后，进入 bin 目录，运行 start.sh 就可以启动 Dubbo-Monitor 了，运行在配置好的 8090 端口（需要先打开 Zookeeper）。\n启动服务提供者和消费者后，可以在 Applications 中看到如下信息：\n同时，可以点击 Providers 查看服务某一服务提供者的详细信息，并且可以将其取消注册：\n取消注册后，服务消费者将不能够调用该提供者的服务：\nDubbo-admin 现在有两种版本：\nDubbo 原生的 admin 工程 Apache 修正版 Apache 修正版 官方文档：https://dubbo.apache.org/zh-cn/docs/admin/introduction.html\nMaven方式部署 安装 git clone https://github.com/apache/dubbo-admin.git cd dubbo-admin mvn clean package cd dubbo-admin-distribution/target java -jar dubbo-admin-0.1.jar 访问 http://localhost:8080 Dubbo 原生 现在很少能找到，但目前还能在当当网的 dubbox 项目中找到，打包当当网的 dubbox 项目后，可以在 dubbo-admin 模块下找到其 war 包。\n将其放到 tomcat 目录的 webapps 下，启动 tomcat 即可在默认的 8080 端口访问到 Dubbo-admin 的界面，http://localhost:8080/dubbo-admin ，dubbo-admin 为 war 包名称。默认 root 的登录密码为 root，可以在 WEB-INF 中的 dubbo.properties 中配置。\n可以在服务治理的服务中查看所有服务，点击服务名可以查看该服务的提供者、消费者等详细信息。\n服务提供者 可以对其提供者进行权重修改（用于 Dubbo 的负载均衡特性），权重越高越容易被调用。也可以禁用某一台机器的服务，消费者将不会对其进行调用。\n服务消费者 可以对服务消费者进行静止、屏蔽和容错。\n若禁止某一台消费者，则该消费者调用时将会抛出异常。 若屏蔽某一台消费者，则该消费者将不会进行远程调用，并且直接返回空对象。 若对某一台消费者开启容错，则报任何错误时都会返回一个空对象。 应用 可以查看所有应用，包括提供者和消费者。\n路由规则 路由规则在发起一次RPC调用前起到过滤目标服务器地址的作用，过滤后的地址列表，将作为消费端最终发起RPC调用的备选地址。\n官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/routing-rule.html\n根据官方文档的配置说明，可以在 Dubbo Admin 的服务治理的路由规则中新增配置：\n动态配置 覆盖规则是Dubbo设计的在无需重启应用的情况下，动态调整RPC调用行为的一种能力。2.7.0版本开始，支持从服务和应用两个粒度来调整动态配置。\n官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/config-rule.html\n链路监控 首先，我们需要先熟悉一下 Dubbo-Filter 拦截器：\nDubbo-Filter 官方文档：http://dubbo.apache.org/zh-cn/docs/dev/impls/filter.html\nDubbo 支持 Filter 机制 Dubbo 诸多工作都是通过 Filter 实现 常见自定义 Filter：例子记录、trace 功能等 拦截器简介 Dubbo-Filter 使用 Spring XML 配置：\n\u0026lt;!-- 消费方调用过程拦截 --\u0026gt; \u0026lt;dubbo:reference filter=\u0026#34;xxx,yyy\u0026#34; /\u0026gt; \u0026lt;!-- 消费方调用过程缺省拦截器，将拦截所有reference --\u0026gt; \u0026lt;dubbo:consumer filter=\u0026#34;xxx,yyy\u0026#34;/\u0026gt; \u0026lt;!-- 提供方调用过程拦截 --\u0026gt; \u0026lt;dubbo:service filter=\u0026#34;xxx,yyy\u0026#34; /\u0026gt; \u0026lt;!-- 提供方调用过程缺省拦截器，将拦截所有service --\u0026gt; \u0026lt;dubbo:provider filter=\u0026#34;xxx,yyy\u0026#34;/\u0026gt; 创建一个 Filter 类，实现 com.alibaba.dubbo.rpc.Filter 接口，可以在服务调用前后做一些事情，这里用控制台输出表示：\npublic class MyFilter implements Filter { @Override public Result invoke(Invoker\u0026lt;?\u0026gt; invoker, Invocation invocation) throws RpcException { // do something... System.out.println(\u0026#34;服务调用之前\u0026#34;); Result result = invoker.invoke(invocation); System.out.println(\u0026#34;服务调用之后\u0026#34;); // do something... return result; } } 在模块的 resources 下创建 META-INF 文件夹，并在 META-INF 下创建 dubbo 文件夹，在其中创建一个名为 com.alibaba.dubbo.rpc.Filter 的纯文件（File），并在其中添加之前创建的 Filter 类：\nMyFilter=com.zjut.zjxjwxk.springboot.provider.filter.MyFilter 这样，在调用服务时，就会被 MyFilter 拦截器拦截，并在调用前后可以做一些事情，比如链路监控。\n服务调用之前 quickstart-provider-message=Hello World! 服务调用之后 然后，介绍一下 Zipkin：\nZipkin 官网：https://zipkin.io\nZipkin 是一个分布式跟踪系统。它有助于收集解决服务体系结构中的延迟问题所需的时序数据。功能包括该数据的收集和查找。\nZipkin 架构 Zipkin 简介 构成 作用 TraceID 全局唯一表示，单次请求唯一 SpanID 调用编号，每次远程调用唯一 ParentID 父请求编号，上一级 SpanID Client Start cs，表示客户端发起请求 Server Receive sr，表示服务端收到请求 Server Send ss，表示服务端完成处理 Client Receive cr，表示客户端收到相应 Zipkin 运行 The quickest way to get started is to fetch the latest released server as a self-contained executable jar. Note that the Zipkin server requires minimum JRE 8. For example:\ncurl -sSL https://zipkin.io/quickstart.sh | bash -s java -jar zipkin.jar 可以在默认的 9411 端口上看到 Zipkin 的界面：\nDubbo Spring 项目配置 主模块 pom.xml：\n\u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-bom\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.5.0\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.reporter2\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zipkin-reporter-bom\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.9\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; provider 模块 pom.xml：\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-instrumentation-dubbo-rpc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-spring-beans\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-context-slf4j\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.reporter2\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zipkin-sender-okhttp3\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; provider spring 配置文件：\n\u0026lt;bean id=\u0026#34;sender\u0026#34; class=\u0026#34;zipkin2.reporter.beans.OkHttpSenderFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;endpoint\u0026#34; value=\u0026#34;http://localhost:9411/api/v2/spans\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;tracing\u0026#34; class=\u0026#34;brave.spring.beans.TracingFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;localServiceName\u0026#34; value=\u0026#34;hello-service\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;spanReporter\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;zipkin2.reporter.beans.AsyncReporterFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;sender\u0026#34; ref=\u0026#34;sender\u0026#34;/\u0026gt; \u0026lt;!-- wait up to half a second for any in-flight spans on close --\u0026gt; \u0026lt;property name=\u0026#34;closeTimeout\u0026#34; value=\u0026#34;500\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property name=\u0026#34;currentTraceContext\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;brave.spring.beans.CurrentTraceContextFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;scopeDecorators\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;brave.context.slf4j.MDCScopeDecorator\u0026#34; factory-method=\u0026#34;create\u0026#34;/\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; 根据 openzipkin/brave GitHub 仓库中，brave/instrumentation/dubbo-rpc 中的文档说明：https://github.com/openzipkin/brave/tree/master/instrumentation/dubbo-rpc ，要在需要监控的服务上添加 filter=\u0026ldquo;tracing\u0026rdquo; ，如：\n\u0026lt;dubbo:service interface=\u0026#34;com.zjut.zjxjwxk.dubbo.ServiceAPI\u0026#34; ref=\u0026#34;quickStartService\u0026#34; filter=\u0026#34;tracing\u0026#34; /\u0026gt; 或者监控所有服务，则加在 consumer 和 provider 上：\n\u0026lt;dubbo:consumer filter=\u0026#34;tracing\u0026#34; /\u0026gt; \u0026lt;dubbo:provider filter=\u0026#34;tracing\u0026#34; /\u0026gt; 这样，在调用服务后，就能在 Zipkin 中找到对应的服务请求状态了：\nDubbo SpringBoot 项目配置 主模块 pom.xml：\n\u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-bom\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.5.0\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.reporter2\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zipkin-reporter-bom\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.9\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; provider 模块 pom.xml：\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-instrumentation-dubbo-rpc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-spring-beans\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.brave\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;brave-context-slf4j\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.zipkin.reporter2\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zipkin-sender-okhttp3\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- SpringBoot 需要的额外依赖 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.curator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;curator-framework\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.0.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; SpringBoot 不需要 Spring XML 文件，只需要创建一个 TraceConfig 配置类，该类每个需要监控的模块都需要一个，其 LocalServiceName 可以设置为服务名，如 order 模块中的该配置类（别忘了在 @Bean 中加上 \u0026ldquo;tracing\u0026rdquo; 名称）：\n@Configuration public class TraceConfig { @Bean(\u0026#34;tracing\u0026#34;) public TracingFactoryBean getTracingBean() { TracingFactoryBean tracingFactoryBean = new TracingFactoryBean(); tracingFactoryBean.setLocalServiceName(\u0026#34;order\u0026#34;); tracingFactoryBean.setSpanReporter(AsyncReporter.create(OkHttpSender.create(\u0026#34;http://localhost:9411/api/v2/spans\u0026#34;))); return tracingFactoryBean; } } 方法级别 在需要监控的消费者的 @Reference 和提供者的 @Service 中添加 filter 属性为 \u0026ldquo;tracing\u0026rdquo; 即可：\n消费者：\n@Reference(interfaceClass = AlipayServiceApi.class, filter = \u0026#34;tracing\u0026#34;) private AlipayServiceApi alipayServiceApi; 提供者：\n@Service(interfaceClass = OrderServiceApi.class, filter = \u0026#34;tracing\u0026#34;) 服务级别 在需要监控的服务的 application.yml 中添加如下配置，则对该服务的服务消费和提供均进行监控：\nspring: dubbo: provider: filter: tracing consumer: filter: tracing Zipkin 监控面板 之后每次调用被监控的服务，就能在 Zipkin 面板中找到对应的调用链路：\n可以在 Discover 面板中，找到一定时间内被监控的服务调用。\n接口调用详情中，接口的调用链路和时间一目了然，可以找出哪个接口调用的时间较长，或者错误发生在哪个接口的调用过程中，还可以从右侧的 Annotaions 中看到客户端和服务器的 Start 和 Finish 时间，以判断哪一台服务器的访问速度较慢等。\nDependencies 面板中，服务之间的依赖关系以及访问流量以可视化的方式呈现出来。\n（Zipkin 默认使用内存的形式存储数据，它也支持 MySQL 等持久化存储方式，以便于以后的数据分析）\n","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e了解 Dubbo 监控相关内容\u003c/li\u003e\n\u003cli\u003e熟练掌握 Dubbo-admin 使用\u003c/li\u003e\n\u003cli\u003e熟练掌握链路监控\u003c/li\u003e\n\u003cli\u003e完成业务系统部署\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"dubbo-monitor\"\u003eDubbo-monitor\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"Dubbo架构\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/images/image-20200424231550404.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"源码下载和打包\"\u003e源码下载和打包\u003c/h2\u003e\n\u003cp\u003e目前，还可以从当当网的项目 Dubbox 中获取（很久没有维护了）：https://github.com/dangdangdotcom/dubbox ，在项目中执行以下命令打包并拷贝到本地仓库（跳过单元测试）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emvn package -Dmaven.test.skip\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e其中，可能会遇到 Missing artifact com.alibaba:dubbo:jar:2.8.4 的坑，需要在根项目的 pom.xml 文件中添加以下 maven 插件：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"添加插件依赖\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/images/image-20200425004851922.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这样在本地仓库就有了 ~/.m2/repository/com/alibaba/dubbo-monitor-simple/2.8.4/dubbo-monitor-simple-2.8.4-assembly.tar.gz 这个 tar.gz 包，解压它可以得到以下文件：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Dubbo-Monitor文件目录\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/images/image-20200425004950736.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"启动服务监控\"\u003e启动服务监控\u003c/h2\u003e\n\u003cp\u003e在 conf 文件夹下，编辑 dubbo.properties，将相关参数配置如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-properties\" data-lang=\"properties\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.container\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003elog4j,spring,registry,jetty\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.application.name\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003esimple-monitor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.application.owner\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#dubbo.registry.address=multicast://224.5.6.7:1234\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.registry.address\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003ezookeeper://127.0.0.1:2181\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#dubbo.registry.address=redis://127.0.0.1:6379\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#dubbo.registry.address=dubbo://127.0.0.1:9090\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.protocol.port\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e7070\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.jetty.port\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e8090\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.jetty.directory\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003emonitor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.charts.directory\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003emonitor/charts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.statistics.directory\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003emonitor/statistics\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.log4j.file\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003emonitor/dubbo-monitor-simple.log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edubbo.log4j.level\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003eWARN\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然后，进入 bin 目录，运行 start.sh 就可以启动 Dubbo-Monitor 了，运行在配置好的 8090 端口（需要先打开 Zookeeper）。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Dubbo-Monitor界面\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/images/image-20200425005304792.png\"\u003e\u003c/p\u003e\n\u003cp\u003e启动服务提供者和消费者后，可以在 Applications 中看到如下信息：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"服务提供者和消费者\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/images/image-20200425010612712.png\"\u003e\u003c/p\u003e\n\u003cp\u003e同时，可以点击 Providers 查看服务某一服务提供者的详细信息，并且可以将其取消注册：\u003c/p\u003e","title":"Dubbo微服务影院系列（11）：服务监控"},{"content":"章节概要 事务简介 分布式事务的前世今生 分布式事务解决方案 主流分布式事务框架介绍 事务简介 事务是用来保证一组数据操作的完整性和一致性的 事务必须满足 ACID 的四大特性 事务具有四种隔离级别 事务具有七种传播行为 事务属性 原子性（Atomicity） 一致性（Consistency） 隔离型（Isolation） 持久性（Durability） 分布式事务 概念 分布式事务就是将多个节点的事务看成一个整体处理 分布式事务由事务参与者、资源服务器、事务管理器等组成 常见的分布式事务的例子：支付、下订单等 实现思路 两段式事务和三段式事务 基于 XA 的分布式事务 基于消息的最终一致性方案 TCC 编程式补偿性事务 分布式事务类型 两段式和三段式事务 两段式事务 三段式事务 基于 XA 的分布式事务 基于消息的一致性方案 TCC 补偿性事务 基于消息的一致性方案和 TCC 补偿性事务的区别 基于消息的事务是强一致性事务，会存在浪费 TCC 事务是柔性事务，在 try 阶段要对资源做预留 TCC 事务在确认或取消阶段释放资源 与基于消息的事务对比，TCC 的时效性更好 分布式事务框架 全局事务服务（Global Transaction Service，简称 GTS） 蚂蚁金服分布式事务（Distributed Transaction-eXtended，简称 DTX） 开源 TCC 框架（TCC-Transaction）（https://github.com/changmingxie/tcc-transaction） 开源 TCC 框架（ByteTCC）（https://github.com/liuyangming/ByteTCC） TCC-Transaction 分布式事务框架 Github 仓库：https://github.com/changmingxie/tcc-transaction\n在需要提供分布式事务支持的接口方法上添加 @Compensable 在对应的接口实现方法上也添加 @Compensable，并添加注解参数 confirmMethod, cancelMethod 和 transactionContextEditor 实现对应的 confirmMethod 和 cancelMethod（必须和 try 方法在同一个类中） 注意：\n在分布式事务框架中，不要轻易在业务层捕获所有异常，只有在抛出异常的情况下，分布式事务框架才知道该业务是执行失败的。 使用 TCC-Transaction 时，confirm 和 cancel 的幂等性问题需要自己解决。 TCC 的数据库应该和业务数据库分开，以保证分布式事务的正常进行。 建立用于分布式事务的数据库 TCC 的数据库应该和业务数据库分开，以保证分布式事务的正常进行。\n其中，TCC 库用于实现分布式事务，其包含的表和表结构如下：\nDubbo Demo 子事务：红包模块 接口\npublic interface RedPacketTradeOrderService { @Compensable public String record(RedPacketTradeOrderDto tradeOrderDto); } 实现类\n@Service(\u0026#34;redPacketTradeOrderService\u0026#34;) public class RedPacketTradeOrderServiceImpl implements RedPacketTradeOrderService { @Autowired RedPacketAccountRepository redPacketAccountRepository; @Autowired TradeOrderRepository tradeOrderRepository; @Override @Compensable(confirmMethod = \u0026#34;confirmRecord\u0026#34;, cancelMethod = \u0026#34;cancelRecord\u0026#34;, transactionContextEditor = DubboTransactionContextEditor.class) @Transactional public String record(RedPacketTradeOrderDto tradeOrderDto) { TradeOrder foundTradeOrder = tradeOrderRepository.findByMerchantOrderNo(tradeOrderDto.getMerchantOrderNo()); // check if trade order has been recorded, if yes, return success directly. if (foundTradeOrder == null) { TradeOrder tradeOrder = new TradeOrder( tradeOrderDto.getSelfUserId(), tradeOrderDto.getOppositeUserId(), tradeOrderDto.getMerchantOrderNo(), tradeOrderDto.getAmount() ); try { tradeOrderRepository.insert(tradeOrder); RedPacketAccount transferFromAccount = redPacketAccountRepository.findByUserId(tradeOrderDto.getSelfUserId()); transferFromAccount.transferFrom(tradeOrderDto.getAmount()); redPacketAccountRepository.save(transferFromAccount); } catch (DataIntegrityViolationException e) { // this exception may happen when insert trade order concurrently, if happened, ignore this insert operation. } } return \u0026#34;success\u0026#34;; } @Transactional public void confirmRecord(RedPacketTradeOrderDto tradeOrderDto) { TradeOrder tradeOrder = tradeOrderRepository.findByMerchantOrderNo(tradeOrderDto.getMerchantOrderNo()); // check if the trade order status is DRAFT, if yes, return directly, ensure idempotency. if (tradeOrder != null \u0026amp;\u0026amp; tradeOrder.getStatus().equals(\u0026#34;DRAFT\u0026#34;)) { tradeOrder.confirm(); tradeOrderRepository.update(tradeOrder); RedPacketAccount transferToAccount = redPacketAccountRepository.findByUserId(tradeOrderDto.getOppositeUserId()); transferToAccount.transferTo(tradeOrderDto.getAmount()); redPacketAccountRepository.save(transferToAccount); } } @Transactional public void cancelRecord(RedPacketTradeOrderDto tradeOrderDto) { TradeOrder tradeOrder = tradeOrderRepository.findByMerchantOrderNo(tradeOrderDto.getMerchantOrderNo()); // check if the trade order status is DRAFT, if yes, return directly, ensure idempotency. if (null != tradeOrder \u0026amp;\u0026amp; \u0026#34;DRAFT\u0026#34;.equals(tradeOrder.getStatus())) { tradeOrder.cancel(); tradeOrderRepository.update(tradeOrder); RedPacketAccount capitalAccount = redPacketAccountRepository.findByUserId(tradeOrderDto.getSelfUserId()); capitalAccount.cancelTransfer(tradeOrderDto.getAmount()); redPacketAccountRepository.save(capitalAccount); } } } 思考：为什么要在 confirm 和 cancel 方法里先检查订单状态是否为 DRAFT（在 try 方法中新增的一个订单），而不直接修改为结束状态？\n答：为了保证服务的幂等性，即使用相同参数对同一资源重复调用某个接口的结果与调用一次的结果相同。\n主事务：订单模块 注意：要在主事务的业务已经实现的差不多的时候才调用子事务。\n@Service public class PaymentServiceImpl { @Autowired CapitalTradeOrderService capitalTradeOrderService; @Autowired RedPacketTradeOrderService redPacketTradeOrderService; @Autowired OrderRepository orderRepository; @Compensable(confirmMethod = \u0026#34;confirmMakePayment\u0026#34;, cancelMethod = \u0026#34;cancelMakePayment\u0026#34;, asyncConfirm = false, delayCancelExceptions = {SocketTimeoutException.class, org.apache.dubbo.remoting.TimeoutException.class}) public void makePayment(@UniqueIdentity String orderNo, BigDecimal redPacketPayAmount, BigDecimal capitalPayAmount) { Order order = orderRepository.findByMerchantOrderNo(orderNo); // check if the order status is DRAFT, if no, means that another call makePayment for the same order happened, ignore this call makePayment. if (order.getStatus().equals(\u0026#34;DRAFT\u0026#34;)) { order.pay(redPacketPayAmount, capitalPayAmount); try { orderRepository.updateOrder(order); } catch (OptimisticLockingFailureException e) { // ignore the concurrently update order exception, ensure idempotency. } } // 调用子事务 String result = capitalTradeOrderService.record(buildCapitalTradeOrderDto(order)); String result2 = redPacketTradeOrderService.record(buildRedPacketTradeOrderDto(order)); } public void confirmMakePayment(String orderNo, BigDecimal redPacketPayAmount, BigDecimal capitalPayAmount) { Order foundOrder = orderRepository.findByMerchantOrderNo(orderNo); // check if the trade order status is PAYING, if no, means another call confirmMakePayment happened, return directly, ensure idempotency. if (foundOrder != null \u0026amp;\u0026amp; foundOrder.getStatus().equals(\u0026#34;PAYING\u0026#34;)) { foundOrder.confirm(); orderRepository.updateOrder(foundOrder); } } public void cancelMakePayment(String orderNo, BigDecimal redPacketPayAmount, BigDecimal capitalPayAmount) { Order foundOrder = orderRepository.findByMerchantOrderNo(orderNo); // check if the trade order status is PAYING, if no, means another call cancelMakePayment happened, return directly, ensure idempotency. if (foundOrder != null \u0026amp;\u0026amp; foundOrder.getStatus().equals(\u0026#34;PAYING\u0026#34;)) { foundOrder.cancelPayment(); orderRepository.updateOrder(foundOrder); } } } 流程图 隐式参数 根据官方文档可以得知，1.2.x 版本支持 rpc 框架支持隐式传参情况下将事务上下文参数 TransactionContext 以隐式传参方式进行传递。\n那么，在子事务的 Service 实现代码中获取 Dubbo 隐式参数：\nMap\u0026lt;String, String\u0026gt; attachments = RpcContext.getContext().getAttachments(); 打一个断点，可以从隐式参数中得到 key 为 TRANSACTION_CONTEXT，value 为以下信息的键值对：\n{ \u0026#34;attachments\u0026#34;:{}, \u0026#34;status\u0026#34;:1, \u0026#34;xid\u0026#34;:{ \u0026#34;branchQualifier\u0026#34;:\u0026#34;hMBMmir6Q56M0hskfmPebw==\u0026#34;, \u0026#34;formatId\u0026#34;:1, \u0026#34;globalTransactionId\u0026#34;:\u0026#34;trSosXg0Soi8Q9xlauTToQ==\u0026#34; } } 其中，包含了 globalTransactionId 这一全局事务 id，和 branchQualifier 分支事务 id。\n##提出疑问\n什么时候生成的 TRANSACTION_CONTEXT 隐式参数？ 如何判断一个大的事务下，都有哪些小的事务？ 为什么要有 @Compensable 注解？ 两个拦截器都没有处理 confirm 和 cancel，谁来处理？ 源码分析 事务拦截器 重点介绍 tcc-transaction-core 核心包的 interceptor 包，也就是拦截器包。\nCompensableMethodContext\n这是加了 @Compensable 注释的目标方法对象的上下文类。通过构造函数，利用拦截的目标对象上下文，获取被拦截目标对象方法的各种信息。\npublic CompensableMethodContext(ProceedingJoinPoint pjp) { this.pjp = pjp; // 获取待访问对象的方法名称 this.method = getCompensableMethod(); // 获取目标对象的 Compensable 注解 this.compensable = method.getAnnotation(Compensable.class); // 获取目标对象的事务传播属性（默认为 REQUIRED） this.propagation = compensable.propagation(); // 获取事务上下文 this.transactionContext = FactoryBuilder.factoryOf(compensable.transactionContextEditor()).getInstance().get(pjp.getTarget(), method, pjp.getArgs()); } 其中，transactionContext 是一个 TransactionContext 类，定义在 tcc-transaction-api 模块中：\npublic class TransactionContext implements Serializable { private static final long serialVersionUID = -8199390103169700387L; private TransactionXid xid; private int status; /** * 保存当前事务有几个子事务 */ private Map\u0026lt;String, String\u0026gt; attachments = new ConcurrentHashMap\u0026lt;String, String\u0026gt;(); public TransactionContext() { } public TransactionContext(TransactionXid xid, int status) { this.xid = xid; this.status = status; } public void setXid(TransactionXid xid) { this.xid = xid; } public TransactionXid getXid() { return xid.clone(); } public void setAttachments(Map\u0026lt;String, String\u0026gt; attachments) { if (attachments != null \u0026amp;\u0026amp; !attachments.isEmpty()) { this.attachments.putAll(attachments); } } public Map\u0026lt;String, String\u0026gt; getAttachments() { return attachments; } public void setStatus(int status) { this.status = status; } public int getStatus() { return status; } } CompensableTransactionAspect\n这是一个 AOP 切面类。@Pointcut 将 @Compensable 注解标记为切入点，其签名为 compensableService()。@Around 表示在 compensableService() 之前和之后调用 interceptCompensableMethod()，其中调用了 CompensableTransactionInterceptor 的 interceptCompensableMethod()。\n@Pointcut(\u0026#34;@annotation(org.mengyun.tcctransaction.api.Compensable)\u0026#34;) public void compensableService() { } @Around(\u0026#34;compensableService()\u0026#34;) public Object interceptCompensableMethod(ProceedingJoinPoint pjp) throws Throwable { return compensableTransactionInterceptor.interceptCompensableMethod(pjp); } CompensableTransactionInterceptor\n这是事务拦截器，具有以下作用：\n将事务区分为 ROOT 事务和 PROVIDER 分支事务 不断地修改数据库内的状态（初始化事务、修改事务状态） 修改和清除事务管理区中的事务队列 （并没有执行目标对象方法，pjp.proceed() 其实是交给了下一个拦截器 ResourceCoordinatorInterceptor） interceptCompensableMethod\n其中interceptCompensableMethod() 方法中，参数 pjp 表示被代理的目标对象，比如被加了 @Compensable 注解的 makePayment 方法对象，就会作为该参数，通过其获取该方法的各种信息。\npublic Object interceptCompensableMethod(ProceedingJoinPoint pjp) throws Throwable { // 通过上下文对象，获取待访问对象的各种信息，见下方 CompensableMethodContext() 构造函数 CompensableMethodContext compensableMethodContext = new CompensableMethodContext(pjp); // 通过事务管理器，来判断是否有存在的事务队列（从 ThreadLocal 获取 transactions 来判断当前线程是否已经有事务） boolean isTransactionActive = transactionManager.isTransactionActive(); if (!TransactionUtils.isLegalTransactionContext(isTransactionActive, compensableMethodContext)) { throw new SystemException(\u0026#34;no active compensable transaction while propagation is mandatory for method \u0026#34; + compensableMethodContext.getMethod().getName()); } // 获取并判断当前事务的角色（ROOT 表示主事务，PROVIDER 表示分支事务或事务参与者），并根据其角色调用不同的方法来处理 switch (compensableMethodContext.getMethodRole(isTransactionActive)) { case ROOT: return rootMethodProceed(compensableMethodContext); case PROVIDER: return providerMethodProceed(compensableMethodContext); default: return pjp.proceed(); } } rootMethodProceed\n处理主事务的 rootMethodProceed() 方法，它会完成：\n开启全局事务 持久化全局事务 注册全局事务 判断应该 confirm 还是 cancel 清除事务队列 private Object rootMethodProceed(CompensableMethodContext compensableMethodContext) throws Throwable { Object returnValue = null; Transaction transaction = null; boolean asyncConfirm = compensableMethodContext.getAnnotation().asyncConfirm(); boolean asyncCancel = compensableMethodContext.getAnnotation().asyncCancel(); Set\u0026lt;Class\u0026lt;? extends Exception\u0026gt;\u0026gt; allDelayCancelExceptions = new HashSet\u0026lt;Class\u0026lt;? extends Exception\u0026gt;\u0026gt;(); allDelayCancelExceptions.addAll(this.delayCancelExceptions); allDelayCancelExceptions.addAll(Arrays.asList(compensableMethodContext.getAnnotation().delayCancelExceptions())); try { // 让事务管理器开启一个全新的事务，持久化事务，并事务管理器注册该事务（加入事务队列） transaction = transactionManager.begin(compensableMethodContext.getUniqueIdentity()); try { // 执行目标方法（实际上会先调用 ResourceCoordinatorIntercepter 拦截器） returnValue = compensableMethodContext.proceed(); // 如果执行异常，就回滚，否则提交 } catch (Throwable tryingException) { if (!isDelayCancelException(tryingException, allDelayCancelExceptions)) { logger.warn(String.format(\u0026#34;compensable transaction trying failed. transaction content:%s\u0026#34;, JSON.toJSONString(transaction)), tryingException); /* 1. 修改数据库状态 2. 执行 rollback 方法 3. 如果执行成功，则删除事务资源数据 */ transactionManager.rollback(asyncCancel); } throw tryingException; } /* 1. 修改数据库状态 2. 执行 confirm 方法 3. 如果执行成功，则删除事务资源数据 */ transactionManager.commit(asyncConfirm); } finally { // 到这里，分支事务就都执行完了，就清除队列中的事务 transactionManager.cleanAfterCompletion(transaction); } return returnValue; } 其中事务管理器 TransactionManager 的 begin() 方法：\npublic Transaction begin(Object uniqueIdentify) { Transaction transaction = new Transaction(uniqueIdentify,TransactionType.ROOT); // 持久化事务 transactionRepository.create(transaction); // 注册事务，向事务队列中加入该事务 registerTransaction(transaction); return transaction; } providerMethodProceed\n处理分支事务的 providerMethodProceed() 方法：\nprivate Object providerMethodProceed(CompensableMethodContext compensableMethodContext) throws Throwable { Transaction transaction = null; boolean asyncConfirm = compensableMethodContext.getAnnotation().asyncConfirm(); boolean asyncCancel = compensableMethodContext.getAnnotation().asyncCancel(); try { // 根据事务的不同状态，执行不同的动作 switch (TransactionStatus.valueOf(compensableMethodContext.getTransactionContext().getStatus())) { case TRYING: // propagationNewBegin() 持久化事务参与者的数据到当前服务中（默认状态为 TRYING），并向事务管理器注册事务 transaction = transactionManager.propagationNewBegin(compensableMethodContext.getTransactionContext()); return compensableMethodContext.proceed(); case CONFIRMING: try { // propagationExistBegin() 修改事务状态，并注册事务 transaction = transactionManager.propagationExistBegin(compensableMethodContext.getTransactionContext()); // commit() 修改事务状态为 CONFIRMING，并持久化更新，提交事务 transactionManager.commit(asyncConfirm); } catch (NoExistedTransactionException excepton) { //the transaction has been commit,ignore it. } break; case CANCELLING: try { // propagationExistBegin() 修改事务状态，并注册事务 transaction = transactionManager.propagationExistBegin(compensableMethodContext.getTransactionContext()); // rollback() 修改事务状态为 CANCELLING，并持久化更新，回滚事务 transactionManager.rollback(asyncCancel); } catch (NoExistedTransactionException exception) { //the transaction has been rollback,ignore it. } break; } } finally { // 清除事务队列 transactionManager.cleanAfterCompletion(transaction); } Method method = compensableMethodContext.getMethod(); return ReflectionUtils.getNullValue(method.getReturnType()); } ResourceCoordinatorAspect\n资源协调切面类和 CompensableTransactionAspect 类似，几乎一样，不再赘述。\n@Pointcut(\u0026#34;@annotation(org.mengyun.tcctransaction.api.Compensable)\u0026#34;) public void transactionContextCall() { } @Around(\u0026#34;transactionContextCall()\u0026#34;) public Object interceptTransactionContextMethod(ProceedingJoinPoint pjp) throws Throwable { return resourceCoordinatorInterceptor.interceptTransactionContextMethod(pjp); } ResourceCoordinatorInterceptor\n主要处理 try 阶段的事情，在 try 阶段，就将所有的“资源”封装完成并交给事务管理器。\n其中“资源”指的是“事务资源”：\n即事务的参与者：\nconfirm 上下文 cancel 上下文 分支事务信息 然后事务管理器修改数据库状态。\ninterceptTransactionContextMethod\npublic Object interceptTransactionContextMethod(ProceedingJoinPoint pjp) throws Throwable { // 使用事务管理器，传递一些事务相关的信息（线程共享） Transaction transaction = transactionManager.getCurrentTransaction(); if (transaction != null) { switch (transaction.getStatus()) { case TRYING: enlistParticipant(pjp); break; case CONFIRMING: break; case CANCELLING: break; } } return pjp.proceed(pjp.getArgs()); } enlistParticipant\nprivate void enlistParticipant(ProceedingJoinPoint pjp) throws IllegalAccessException, InstantiationException { // 获取对象的方法 Method method = CompensableMethodUtils.getCompensableMethod(pjp); if (method == null) { throw new RuntimeException(String.format(\u0026#34;join point not found method, point is : %s\u0026#34;, pjp.getSignature().getName())); } // 获取对应的 @Compensable 对象 Compensable compensable = method.getAnnotation(Compensable.class); // 获取配置的 confirm 和 cancel 方法 String confirmMethodName = compensable.confirmMethod(); String cancelMethodName = compensable.cancelMethod(); Transaction transaction = transactionManager.getCurrentTransaction(); TransactionXid xid = new TransactionXid(transaction.getXid().getGlobalTransactionId()); if (FactoryBuilder.factoryOf(compensable.transactionContextEditor()).getInstance().get(pjp.getTarget(), method, pjp.getArgs()) == null) { FactoryBuilder.factoryOf(compensable.transactionContextEditor()).getInstance().set(new TransactionContext(xid, TransactionStatus.TRYING.getId()), pjp.getTarget(), ((MethodSignature) pjp.getSignature()).getMethod(), pjp.getArgs()); } Class targetClass = ReflectionUtils.getDeclaringType(pjp.getTarget().getClass(), method.getName(), method.getParameterTypes()); InvocationContext confirmInvocation = new InvocationContext(targetClass, confirmMethodName, method.getParameterTypes(), pjp.getArgs()); InvocationContext cancelInvocation = new InvocationContext(targetClass, cancelMethodName, method.getParameterTypes(), pjp.getArgs()); Participant participant = new Participant( xid, confirmInvocation, cancelInvocation, compensable.transactionContextEditor()); transactionManager.enlistParticipant(participant); } 这样，经过两个拦截器后，才调用目标对象方法。\n幂等性问题 TCC-Transaction 不能保证幂等性，需要自己实现幂等性。如以下 confirm 和 cancel 方法就实现了幂等性：\nconfirm 的幂等性\n@Transactional public void confirmRecord(RedPacketTradeOrderDto tradeOrderDto) { try { Thread.sleep(1000l); } catch (InterruptedException e) { throw new RuntimeException(e); } System.out.println(\u0026#34;red packet confirm record called. time seq:\u0026#34; + DateFormatUtils.format(Calendar.getInstance(), \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;)); TradeOrder tradeOrder = tradeOrderRepository.findByMerchantOrderNo(tradeOrderDto.getMerchantOrderNo()); // 保证幂等性 check if the trade order status is DRAFT, if yes, return directly, ensure idempotency. if (tradeOrder != null \u0026amp;\u0026amp; tradeOrder.getStatus().equals(\u0026#34;DRAFT\u0026#34;)) { tradeOrder.confirm(); tradeOrderRepository.update(tradeOrder); RedPacketAccount transferToAccount = redPacketAccountRepository.findByUserId(tradeOrderDto.getOppositeUserId()); transferToAccount.transferTo(tradeOrderDto.getAmount()); redPacketAccountRepository.save(transferToAccount); } } cancel 的幂等性\n@Transactional public void cancelRecord(RedPacketTradeOrderDto tradeOrderDto) { try { Thread.sleep(1000l); } catch (InterruptedException e) { throw new RuntimeException(e); } System.out.println(\u0026#34;red packet cancel record called. time seq:\u0026#34; + DateFormatUtils.format(Calendar.getInstance(), \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;)); TradeOrder tradeOrder = tradeOrderRepository.findByMerchantOrderNo(tradeOrderDto.getMerchantOrderNo()); // 保证幂等性 check if the trade order status is DRAFT, if yes, return directly, ensure idempotency. if (null != tradeOrder \u0026amp;\u0026amp; \u0026#34;DRAFT\u0026#34;.equals(tradeOrder.getStatus())) { tradeOrder.cancel(); tradeOrderRepository.update(tradeOrder); RedPacketAccount capitalAccount = redPacketAccountRepository.findByUserId(tradeOrderDto.getSelfUserId()); capitalAccount.cancelTransfer(tradeOrderDto.getAmount()); redPacketAccountRepository.save(capitalAccount); } } 小结 事务的相关信息（全局事务编号，乐观锁版本等要持久化存储）\n资源 try 核心点：预留资源（业务资源、事务数据资源）\n流程 注册和初始化事务 -\u0026gt; 组织事务参与者 -\u0026gt; 执行目标方法（try） -\u0026gt; 执行 confirm 和 cancel 方法\n总结 熟悉 TCC-Transaction 的分布式事务处理流程 TCC-Transaction 不能保证幂等性 TCC 分布式事务的核心是资源（业务资源和事务资源） ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e事务简介\u003c/li\u003e\n\u003cli\u003e分布式事务的前世今生\u003c/li\u003e\n\u003cli\u003e分布式事务解决方案\u003c/li\u003e\n\u003cli\u003e主流分布式事务框架介绍\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"事务简介\"\u003e事务简介\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e事务是用来保证一组\u003cstrong\u003e数据操作\u003c/strong\u003e的完整性和一致性的\u003c/li\u003e\n\u003cli\u003e事务必须满足 ACID 的四大特性\u003c/li\u003e\n\u003cli\u003e事务具有四种隔离级别\u003c/li\u003e\n\u003cli\u003e事务具有七种传播行为\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"事务属性\"\u003e事务属性\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e原子性（Atomicity）\u003c/li\u003e\n\u003cli\u003e一致性（Consistency）\u003c/li\u003e\n\u003cli\u003e隔离型（Isolation）\u003c/li\u003e\n\u003cli\u003e持久性（Durability）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"分布式事务\"\u003e分布式事务\u003c/h1\u003e\n\u003ch2 id=\"概念\"\u003e概念\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e分布式事务就是将多个节点的事务看成一个整体处理\u003c/li\u003e\n\u003cli\u003e分布式事务由事务参与者、资源服务器、事务管理器等组成\u003c/li\u003e\n\u003cli\u003e常见的分布式事务的例子：支付、下订单等\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"实现思路\"\u003e实现思路\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e两段式事务和三段式事务\u003c/li\u003e\n\u003cli\u003e基于 XA 的分布式事务\u003c/li\u003e\n\u003cli\u003e基于消息的最终一致性方案\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTCC 编程式补偿性事务\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"分布式事务类型\"\u003e分布式事务类型\u003c/h1\u003e\n\u003ch2 id=\"两段式和三段式事务\"\u003e两段式和三段式事务\u003c/h2\u003e\n\u003ch3 id=\"两段式事务\"\u003e两段式事务\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"两段式事务\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/images/63d3220513cf709f84fdcd06457c3b65.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"三段式事务\"\u003e三段式事务\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"三段式事务\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/images/image-20200416213159506.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"基于-xa-的分布式事务\"\u003e基于 XA 的分布式事务\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"基于XA的分布式事务\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/images/image-20200416213551917.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"基于消息的一致性方案\"\u003e基于消息的一致性方案\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"基于消息的一致性方案\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/images/image-20200416215409588.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"tcc-补偿性事务\"\u003eTCC 补偿性事务\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"TCC补偿性事务\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/images/image-20200416220735799.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"基于消息的一致性方案和-tcc-补偿性事务的区别\"\u003e基于消息的一致性方案和 TCC 补偿性事务的区别\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e基于消息的事务是强一致性事务，会存在浪费\u003c/li\u003e\n\u003cli\u003eTCC 事务是柔性事务，在 try 阶段要对资源做预留\u003c/li\u003e\n\u003cli\u003eTCC 事务在确认或取消阶段释放资源\u003c/li\u003e\n\u003cli\u003e与基于消息的事务对比，TCC 的时效性更好\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"分布式事务框架\"\u003e分布式事务框架\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e全局事务服务（Global Transaction Service，简称 GTS）\u003c/li\u003e\n\u003cli\u003e蚂蚁金服分布式事务（Distributed Transaction-eXtended，简称 DTX）\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e开源 TCC 框架（TCC-Transaction）\u003c/strong\u003e（https://github.com/changmingxie/tcc-transaction）\u003c/li\u003e\n\u003cli\u003e开源 TCC 框架（ByteTCC）（https://github.com/liuyangming/ByteTCC）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"tcc-transaction-分布式事务框架\"\u003eTCC-Transaction 分布式事务框架\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGithub 仓库：https://github.com/changmingxie/tcc-transaction\u003c/p\u003e","title":"Dubbo微服务影院系列（10）：分布式事务"},{"content":"The basic task is simple: given N real numbers, you are supposed to calculate their average. But what makes it complicated is that some of the input numbers might not be legal. A legal input is a real number in [−1000,1000] and is accurate up to no more than 2 decimal places. When you calculate the average, those illegal numbers must not be counted in.\nInput Specification: Each input file contains one test case. For each case, the first line gives a positive integer N (≤100). Then N numbers are given in the next line, separated by one space.\nOutput Specification: For each illegal input number, print in a line ERROR: X is not a legal number where X is the input. Then finally print in a line the result: The average of K numbers is Y where K is the number of legal inputs and Y is their average, accurate to 2 decimal places. In case the average cannot be calculated, output Undefined instead of Y. In case K is only 1, output The average of 1 number is Y instead.\nSample Input 1: 7 5 -3.2 aaa 9999 2.3.4 7.123 2.35 Sample Output 1: ERROR: aaa is not a legal number ERROR: 9999 is not a legal number ERROR: 2.3.4 is not a legal number ERROR: 7.123 is not a legal number The average of 3 numbers is 1.38 Sample Input 2: 2 aaa -9999 Sample Output 2: ERROR: aaa is not a legal number ERROR: -9999 is not a legal number The average of 0 numbers is Undefined 注意点 字符串数组不能开太小，否则会造成 “运行时错误”，即数组越界。实测大小至少为50. 方法一 来自柳神，不容易想到。运用 sscanf 和 sprintf 后可以方便判断是否为合法数字。利用 sscanf(a, \u0026ldquo;%lf\u0026rdquo;, \u0026amp;temp) 将原字符串输入为 double 型，再利用 sprintf(b, \u0026ldquo;%.2f\u0026rdquo;,temp) 将该 double 型数字输出为保留两位小数的字符串。之后判断保留两位小数后的字符串和原字符串是否相同，即可判断是否合法。\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;cstdio\u0026gt; #include \u0026lt;string.h\u0026gt; using namespace std; int main() { int n, cnt = 0; char a[50], b[50]; double temp, sum = 0.0; cin \u0026gt;\u0026gt; n; for(int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%s\u0026#34;, a); sscanf(a, \u0026#34;%lf\u0026#34;, \u0026amp;temp); sprintf(b, \u0026#34;%.2f\u0026#34;,temp); int flag = 0; for(int j = 0; j \u0026lt; strlen(a); j++) if(a[j] != b[j]) flag = 1; if(flag || temp \u0026lt; -1000 || temp \u0026gt; 1000) { printf(\u0026#34;ERROR: %s is not a legal number\\n\u0026#34;, a); continue; } else { sum += temp; cnt++; } } if(cnt == 1) printf(\u0026#34;The average of 1 number is %.2f\u0026#34;, sum); else if(cnt \u0026gt; 1) printf(\u0026#34;The average of %d numbers is %.2f\u0026#34;, cnt, sum / cnt); else printf(\u0026#34;The average of 0 numbers is Undefined\u0026#34;); return 0; } 方法二 我的方法比较笨，但最直接，思路简单，就是直接遍历原字符串的每个字符，判断是否合法。\n#include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; int main() { int n, cnt = 0; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); char str[50]; double total = 0; for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%s\u0026#34;, str); int len = strlen(str), index = -1; bool flag = true; for (int i = 0; i \u0026lt; len; i++) { if (str[i] == \u0026#39;.\u0026#39;) { if (i \u0026lt; len - 3 || index != -1) { flag = false; break; } index = i; } else if ((str[i] \u0026lt; \u0026#39;0\u0026#39; || str[i] \u0026gt; \u0026#39;9\u0026#39;) \u0026amp;\u0026amp; !(i == 0 \u0026amp;\u0026amp; str[i] == \u0026#39;-\u0026#39;)) { flag = false; } } if (!flag) { printf(\u0026#34;ERROR: %s is not a legal number\\n\u0026#34;, str); } else { double num = stod(str); if (num \u0026lt; -1000 || num \u0026gt; 1000) { printf(\u0026#34;ERROR: %s is not a legal number\\n\u0026#34;, str); } else { cnt++; total += num; } } } if (cnt == 0) { printf(\u0026#34;The average of 0 numbers is Undefined\u0026#34;); } else if (cnt == 1) { printf(\u0026#34;The average of 1 number is %.2f\u0026#34;, total / cnt); } else { printf(\u0026#34;The average of %d numbers is %.2f\u0026#34;, cnt, total / cnt); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1108/","summary":"\u003cp\u003eThe basic task is simple: given \u003cem\u003eN\u003c/em\u003e real numbers, you are supposed to calculate their average. But what makes it complicated is that some of the input numbers might not be legal. A \u003cstrong\u003elegal\u003c/strong\u003e input is a real number in [−1000,1000] and is accurate up to no more than 2 decimal places. When you calculate the average, those illegal numbers must not be counted in.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. For each case, the first line gives a positive integer \u003cem\u003eN\u003c/em\u003e (≤100). Then \u003cem\u003eN\u003c/em\u003e numbers are given in the next line, separated by one space.\u003c/p\u003e","title":"PAT甲级 1108 Finding Average (20分)"},{"content":"A gas station has to be built at such a location that the minimum distance between the station and any of the residential housing is as far away as possible. However it must guarantee that all the houses are in its service range.\nNow given the map of the city and several candidate locations for the gas station, you are supposed to give the best recommendation. If there are more than one solution, output the one with the smallest average distance to all the houses. If such a solution is still not unique, output the one with the smallest index number.\nInput Specification: Each input file contains one test case. For each case, the first line contains 4 positive integers: N (≤10^3), the total number of houses; M (≤10), the total number of the candidate locations for the gas stations; K (≤ 10^4 ), the number of roads connecting the houses and the gas stations; and D S, the maximum service range of the gas station. It is hence assumed that all the houses are numbered from 1 to N, and all the candidate locations are numbered from G1 to GM.\nThen K lines follow, each describes a road in the format\nP1 P2 Dist where P1 and P2 are the two ends of a road which can be either house numbers or gas station numbers, and Dist is the integer length of the road.\nOutput Specification: For each test case, print in the first line the index number of the best location. In the next line, print the minimum and the average distances between the solution and all the houses. The numbers in a line must be separated by a space and be accurate up to 1 decimal place. If the solution does not exist, simply output No Solution.\nSample Input 1: 4 3 11 5 1 2 2 1 4 2 1 G1 4 1 G2 3 2 3 2 2 G2 1 3 4 2 3 G3 2 4 G1 3 G2 G1 1 G3 G2 2 Sample Output 1: G1 2.0 3.3 Sample Input 2: 2 1 2 10 1 G1 9 2 G1 20 Sample Output 2: No Solution 注意点 加油站和居民房的编号都有可能为两位数，所以字符串数组起码要开 4 个大小。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 1011, INF = 1000000000; int n, m, k, ds, G[maxn][maxn], d[maxn], minD = 0, minG = -1; double minAvgD = INF; bool vis[maxn] = {false}; int getIndex(char str[]) { int i = 0, index = 0; if (str[0] == \u0026#39;G\u0026#39;) { i++; } while (str[i] != \u0026#39;\\0\u0026#39;) { index = index * 10 + str[i] - \u0026#39;0\u0026#39;; i++; } if (str[0] == \u0026#39;G\u0026#39;) { return n + index; } else { return index; } } void Dijkstra(int root) { fill(d, d + maxn, INF); fill(vis, vis + maxn, false); d[root] = 0; for (int i = 1; i \u0026lt;= n + m; i++) { int u = -1, min = INF; for (int j = 1; j \u0026lt;= n + m; j++) { if (vis[j] == false \u0026amp;\u0026amp; d[j] \u0026lt; min) { min = d[j]; u = j; } } if (u == -1) { return; } vis[u] = true; for (int v = 1; v \u0026lt;= n + m; v++) { if (vis[v] == false \u0026amp;\u0026amp; G[u][v] != INF \u0026amp;\u0026amp; d[u] + G[u][v] \u0026lt; d[v]) { d[v] = d[u] + G[u][v]; } } } } int main() { scanf(\u0026#34;%d %d %d %d\u0026#34;, \u0026amp;n, \u0026amp;m, \u0026amp;k, \u0026amp;ds); fill(G[0], G[0] + maxn * maxn, INF); char str1[4], str2[4]; int v1, v2, dist; for (int i = 0; i \u0026lt; k; i++) { scanf(\u0026#34;%s %s %d\u0026#34;, str1, str2, \u0026amp;dist); v1 = getIndex(str1); v2 = getIndex(str2); G[v1][v2] = G[v2][v1] = dist; } for (int i = n + 1; i \u0026lt;= n + m; i++) { Dijkstra(i); double tempAvgD = 0; int tempMinD = INF; for (int j = 1; j \u0026lt;= n; j++) { if (d[j] \u0026gt; ds) { tempMinD = -1; break; } if (d[j] \u0026lt; tempMinD) { tempMinD = d[j]; } tempAvgD += 1.0 * d[j] / n; } if (tempMinD != -1) { if (tempMinD \u0026gt; minD) { minD = tempMinD; minG = i - n; minAvgD = tempAvgD; } else if (tempMinD == minD \u0026amp;\u0026amp; tempAvgD \u0026lt; minAvgD) { minG = i - n; minAvgD = tempAvgD; } } } if (minG == -1) { printf(\u0026#34;No Solution\u0026#34;); } else { printf(\u0026#34;G%d\\n\u0026#34;, minG); printf(\u0026#34;%.1f %.1f\u0026#34;, 1.0 * minD, minAvgD); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1072/","summary":"\u003cp\u003eA gas station has to be built at such a location that the minimum distance between the station and any of the residential housing is as far away as possible. However it must guarantee that all the houses are in its service range.\u003c/p\u003e\n\u003cp\u003eNow given the map of the city and several candidate locations for the gas station, you are supposed to give the best recommendation. If there are more than one solution, output the one with the smallest average distance to all the houses. If such a solution is still not unique, output the one with the smallest index number.\u003c/p\u003e","title":"PAT甲级 1072 Gas Station (30分)"},{"content":"There is a public bike service in Hangzhou City which provides great convenience to the tourists from all over the world. One may rent a bike at any station and return it to any other stations in the city.\nThe Public Bike Management Center (PBMC) keeps monitoring the real-time capacity of all the stations. A station is said to be in perfect condition if it is exactly half-full. If a station is full or empty, PBMC will collect or send bikes to adjust the condition of that station to perfect. And more, all the stations on the way will be adjusted as well.\nWhen a problem station is reported, PBMC will always choose the shortest path to reach that station. If there are more than one shortest path, the one that requires the least number of bikes sent from PBMC will be chosen.\nThe above figure illustrates an example. The stations are represented by vertices and the roads correspond to the edges. The number on an edge is the time taken to reach one end station from another. The number written inside a vertex S is the current number of bikes stored at S. Given that the maximum capacity of each station is 10. To solve the problem at S3, we have 2 different shortest paths:\nPBMC -\u0026gt; S1 -\u0026gt; S3. In this case, 4 bikes must be sent from PBMC, because we can collect 1 bike from S1 and then take 5 bikes to S3, so that both stations will be in perfect conditions. PBMC -\u0026gt; S2 -\u0026gt; S3. This path requires the same time as path 1, but only 3 bikes sent from PBMC and hence is the one that will be chosen. Input Specification: Each input file contains one test case. For each case, the first line contains 4 numbers: Cmax (≤100), always an even number, is the maximum capacity of each station; N (≤500), the total number of stations; Sp, the index of the problem station (the stations are numbered from 1 to N, and PBMC is represented by the vertex 0); and M, the number of roads. The second line contains N non-negative numbers Ci (i=1,⋯,N) where each Ci is the current number of bikes at Si respectively. Then M lines follow, each contains 3 numbers: Si, Sj, and Tij which describe the time Tij taken to move betwen stations Si and Sj. All the numbers in a line are separated by a space.\nOutput Specification: For each test case, print your results in one line. First output the number of bikes that PBMC must send. Then after one space, output the path in the format: 0−\u0026gt;S1−\u0026gt;⋯−\u0026gt;Sp. Finally after another space, output the number of bikes that we must take back to PBMC after the condition of Sp is adjusted to perfect.\nNote that if such a path is not unique, output the one that requires minimum number of bikes that we must take back to PBMC. The judge\u0026rsquo;s data guarantee that such a path is unique.\nSample Input: 10 3 3 5 6 7 0 0 1 1 0 2 1 0 3 3 1 3 1 2 3 1 Sample Output: 3 0-\u0026gt;2-\u0026gt;3 0 注意点 在更新 minNeed 的时候，别忘了更新相应的 minBack #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; #include \u0026lt;vector\u0026gt; using namespace std; const int maxn = 501, INF = 1000000000; int cmax, n, sp, m, c[maxn], G[maxn][maxn], t[maxn], minNeed = INF, minBack = INF; vector\u0026lt;int\u0026gt; path[maxn], temp, ans; bool vis[maxn] = {false}; void Dijkstra() { fill(t, t + maxn, INF); t[0] = 0; for (int i = 0; i \u0026lt;= n; i++) { int u = -1, min = INF; for (int j = 0; j \u0026lt; n; j++) { if (vis[j] == false \u0026amp;\u0026amp; t[j] \u0026lt; min) { min = t[j]; u = j; } } if (u == -1) { return; } vis[u] = true; for (int v = 0; v \u0026lt;= n; v++) { if (vis[v] == false \u0026amp;\u0026amp; G[u][v] != INF) { if (t[u] + G[u][v] \u0026lt; t[v]) { t[v] = t[u] + G[u][v]; path[v].clear(); path[v].push_back(u); } else if (t[u] + G[u][v] == t[v]) { path[v].push_back(u); } } } } } void DFS(int root) { temp.push_back(root); if (root == 0) { int now = 0, need = 0; for (int i = temp.size() - 2; i \u0026gt;= 0; i--) { if (c[temp[i]] \u0026lt; cmax / 2) { if (now \u0026gt;= (cmax / 2 - c[temp[i]])) { now -= cmax / 2 - c[temp[i]]; } else { need += cmax / 2 - c[temp[i]] - now; now = 0; } } else { now += c[temp[i]] - cmax / 2; } } if (need \u0026lt; minNeed) { minNeed = need; minBack = now; ans = temp; } else if (need == minNeed) { if (now \u0026lt; minBack) { minBack = now; ans = temp; } } temp.pop_back(); return; } for (int i = 0; i \u0026lt; path[root].size(); i++) { DFS(path[root][i]); } temp.pop_back(); } int main() { scanf(\u0026#34;%d %d %d %d\u0026#34;, \u0026amp;cmax, \u0026amp;n, \u0026amp;sp, \u0026amp;m); fill(G[0], G[0] + maxn * maxn, INF); for (int i = 1; i \u0026lt;= n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;c[i]); } int s1, s2, t; for (int i = 0; i \u0026lt; m; i++) { scanf(\u0026#34;%d %d %d\u0026#34;, \u0026amp;s1, \u0026amp;s2, \u0026amp;t); G[s1][s2] = G[s2][s1] = t; } Dijkstra(); DFS(sp); printf(\u0026#34;%d \u0026#34;, minNeed); for (int i = ans.size() - 1; i \u0026gt;= 0; i--) { printf(\u0026#34;%d\u0026#34;, ans[i]); if (i != 0) { printf(\u0026#34;-\u0026gt;\u0026#34;); } } printf(\u0026#34; %d\u0026#34;, minBack); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1018/","summary":"\u003cp\u003eThere is a public bike service in Hangzhou City which provides great convenience to the tourists from all over the world. One may rent a bike at any station and return it to any other stations in the city.\u003c/p\u003e\n\u003cp\u003eThe Public Bike Management Center (PBMC) keeps monitoring the real-time capacity of all the stations. A station is said to be in \u003cstrong\u003eperfect\u003c/strong\u003e condition if it is exactly half-full. If a station is full or empty, PBMC will collect or send bikes to adjust the condition of that station to perfect. And more, all the stations on the way will be adjusted as well.\u003c/p\u003e","title":"PAT甲级 1018 Public Bike Management (30分)"},{"content":"章节概要 完成支付模块业务开发 Dubbo 特性学习：隐式参数、参数验证等 Dubbo 本地存根 本地存根类似于 Dubbo 的静态代理 Dubbo 会在客户端生成一个代理，处理部分业务 Stub 必须有可传入 Proxy 的构造函数 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-stub.html\n远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。\n在 spring 配置文件中按以下方式配置：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; stub=\u0026#34;true\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; stub=\u0026#34;com.foo.BarServiceStub\u0026#34; /\u0026gt; 提供 Stub 的实现：\npackage com.foo; public class BarServiceStub implements BarService { private final BarService barService; // 构造函数传入真正的远程代理对象 public BarServiceStub(BarService barService){ this.barService = barService; } public String sayHello(String name) { // 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等 try { return barService.sayHello(name); } catch (Exception e) { // 你可以容错，可以做任何AOP拦截事项 return \u0026#34;容错数据\u0026#34;; } } } Stub 必须有可传入 Proxy 的构造函数。 在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数 Dubbo 本地伪装 本地伪装是本地存根的一个子集 通常会使用本地伪装处理服务降级 建议本地伪装在客户端实现 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-mock.html\n本地伪装通常用于服务降级，比如某验权服务，当服务提供方全部挂掉后，客户端不抛出异常，而是通过 Mock 数据返回授权失败。\n在 spring 配置文件中按以下方式配置：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;true\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;com.foo.BarServiceMock\u0026#34; /\u0026gt; 在工程中提供 Mock 实现：\npackage com.foo; public class BarServiceMock implements BarService { public String sayHello(String name) { // 你可以伪造容错数据，此方法只在出现RpcException时被执行 return \u0026#34;容错数据\u0026#34;; } } 如果服务的消费方经常需要 try-catch 捕获异常，如：\nOffer offer = null; try { offer = offerService.findOffer(offerId); } catch (RpcException e) { logger.error(e); } 请考虑改为 Mock 实现，并在 Mock 实现中 return null。如果只是想简单的忽略异常，在 2.0.11 以上版本可用：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;return null\u0026#34; /\u0026gt; 进阶用法 return 使用 return 来返回一个字符串表示的对象，作为 Mock 的返回值。合法的字符串可以是：\nempty: 代表空，基本类型的默认值，或者集合类的空值 null: null true: true false: false JSON 格式: 反序列化 JSON 所得到的对象 throw 使用 throw 来返回一个 Exception 对象，作为 Mock 的返回值。\n当调用出错时，抛出一个默认的 RPCException:\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;throw\u0026#34; /\u0026gt; 当调用出错时，抛出指定的 Exception：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;throw com.foo.MockException\u0026#34; /\u0026gt; force 和 fail 在 2.6.6 以上的版本，可以开始在 Spring XML 配置文件中使用 fail: 和 force:。force: 代表强制使用 Mock 行为，在这种情况下不会走远程调用。fail: 与默认行为一致，只有当远程调用发生错误时才使用 Mock 行为。force: 和 fail: 都支持与 throw 或者 return 组合使用。\n强制返回指定值：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;force:return fake\u0026#34; /\u0026gt; 强制抛出指定异常：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; mock=\u0026#34;force:throw com.foo.MockException\u0026#34; /\u0026gt; 在方法级别配置 Mock Mock 可以在方法级别上指定，假定 com.foo.BarService 上有好几个方法，我们可以单独为 sayHello() 方法指定 Mock 行为。具体配置如下所示，在本例中，只要 sayHello() 被调用到时，强制返回 \u0026ldquo;fake\u0026rdquo;:\n\u0026lt;dubbo:reference id=\u0026#34;demoService\u0026#34; check=\u0026#34;false\u0026#34; interface=\u0026#34;com.foo.BarService\u0026#34;\u0026gt; \u0026lt;dubbo:parameter key=\u0026#34;sayHello.mock\u0026#34; value=\u0026#34;force:return fake\u0026#34;/\u0026gt; \u0026lt;/dubbo:reference\u0026gt; Mock 是 Stub 的一个子集，便于服务提供方在客户端执行容错逻辑，因经常需要在出现 RpcException (比如网络失败，超时等)时进行容错，而在出现业务异常(比如登录用户名密码错误)时不需要容错，如果用 Stub，可能就需要捕获并依赖 RpcException 类，而用 Mock 就可以不依赖 RpcException，因为它的约定就是只有出现 RpcException 时才执行。 在 interface 旁放一个 Mock 实现，它实现 BarService 接口，并有一个无参构造函数。 在使用 SpringBoot + Dubbo 的项目中，优先使用 Hystrix 提供的熔断降级，因为 Mock 只能捕获 RpcException (比如网络失败，超时等)，而不能捕获 Java 异常。\nDubbo 隐式参数 Dubbo 提供了参数的隐式传递 Dubbo 的隐式参数仅单次调用可用 注意隐式参数的保留字段 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/attachment.html\n可以通过 RpcContext 上的 setAttachment 和 getAttachment 在服务消费方和提供方之间进行参数的隐式传递。\n在服务消费方端设置隐式参数 setAttachment 设置的 KV 对，在完成下面一次远程调用会被清空，即多次远程调用要多次设置。\nRpcContext.getContext().setAttachment(\u0026#34;index\u0026#34;, \u0026#34;1\u0026#34;); // 隐式传参，后面的远程调用都会隐式将这些参数发送到服务器端，类似cookie，用于框架集成，不建议常规业务使用 xxxService.xxx(); // 远程调用 // ... 在服务提供方端获取隐式参数 public class XxxServiceImpl implements XxxService { public void xxx() { // 获取客户端隐式传入的参数，用于框架集成，不建议常规业务使用 String index = RpcContext.getContext().getAttachment(\u0026#34;index\u0026#34;); } } 注意：path, group, version, dubbo, token, timeout 几个 key 是保留字段，请使用其它值。 总结 Dubbo 特性之隐式参数 Dubbo 特性之本地存根和本地伪装（更常用） 支付宝当面付功能对接 ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/9.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E6%94%AF%E4%BB%98%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e完成支付模块业务开发\u003c/li\u003e\n\u003cli\u003eDubbo 特性学习：隐式参数、参数验证等\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"dubbo-本地存根\"\u003eDubbo 本地存根\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e本地存根类似于 Dubbo 的静态代理\u003c/li\u003e\n\u003cli\u003eDubbo 会在客户端生成一个代理，处理部分业务\u003c/li\u003e\n\u003cli\u003eStub 必须有可传入 Proxy 的构造函数\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-stub.html\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Dubbo本地存根\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/9.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E6%94%AF%E4%BB%98%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/images/stub.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003e在 spring 配置文件中按以下方式配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estub=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003estub=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarServiceStub\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e提供 Stub 的实现：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003epackage\u003c/span\u003e com.foo;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eBarServiceStub\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eimplements\u003c/span\u003e BarService {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eprivate\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efinal\u003c/span\u003e BarService barService;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e// 构造函数传入真正的远程代理对象\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eBarServiceStub\u003c/span\u003e(BarService barService){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebarService\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e barService;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e String \u003cspan style=\"color:#a6e22e\"\u003esayHello\u003c/span\u003e(String name) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e barService.\u003cspan style=\"color:#a6e22e\"\u003esayHello\u003c/span\u003e(name);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        } \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (Exception e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e// 你可以容错，可以做任何AOP拦截事项\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;容错数据\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col\u003e\n\u003cli\u003eStub 必须有可传入 Proxy 的构造函数。\u003c/li\u003e\n\u003cli\u003e在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"dubbo-本地伪装\"\u003eDubbo 本地伪装\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e本地伪装是本地存根的一个子集\u003c/li\u003e\n\u003cli\u003e通常会使用本地伪装处理服务降级\u003c/li\u003e\n\u003cli\u003e建议本地伪装在客户端实现\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-mock.html\u003c/p\u003e","title":"Dubbo微服务影院系列（9）：Dubbo服务开发（支付模块开发）"},{"content":"根据往年 (2019) 年浙大软件学院的考研复试公告，如果今年 (2020) 是线下复试，且考场没有变化的话，机试应该还是在 浙大紫金港校区（如下图）。\n浙大软院招生通知：http://www.cst.zju.edu.cn/2019/0307/c36207a1478348/page.htm\n从 PAT 官网可以找到紫金港的机房配置：\nPAT 考点联盟：https://www.patest.cn/location\n我本人选择使用 Dev C++ 5.10 版本，考试那天在考场需要先对其作以下配置（当然也许已经配置好了）：\n打开产生调试信息 在 “工具(Tools)” -\u0026gt; “编译选项(Compiler Options)\u0026quot; 中：\n点击 “代码生成/优化(Settings)” 选项卡中的 \u0026quot;连接器(Linker)\u0026quot; 选项卡，将 \u0026quot;产生调试信息(Generate debugging information)\u0026quot; 选项改为 “Yes”。\n这样，就可以愉快的 Debug 了～\n添加 C++ 11 支持 由于 PAT 的 OJ 是支持 C++ 11 的，故最好打开 C++ 11 支持。\n方法一（推荐） 在 “工具(Tools)” -\u0026gt; “编译选项(Compiler Options)\u0026quot; 中，“代码生成/优化(Settings)” 选项卡下的 “代码生成(Code Generation)” 选项卡中，将 “语言标准(Language Standard)(-std)” 设置为 ISO C++11 即可。\n方法二 同样，也可以在“工具(Tools)” -\u0026gt; “编译选项(Compiler Options)\u0026quot;中，在\u0026quot;编译器(General)\u0026quot;选项卡中，勾选\u0026quot;编译时加入以下命令：(Add the following commands when calling the compiler:)\u0026quot;，并在下方加入 -std=c++11。\n字体大小 由于默认字体是 10，实在太小了不能接受，可以在 “工具(Tools)” -\u0026gt; “编译器选项(Editor Options)\u0026quot; 中的\u0026quot;显示(Fonts)\u0026quot;选项卡，修改字体大小(Size)。或者通过 Ctrl + 滚轮 修改字体大小（更方便）。\n代码补全 打开代码补全 Dev C++ 是有一定的代码补全功能的，在“工具(Tools)” -\u0026gt; “编译器选项(Editor Options)\u0026quot;中，在 “代码补全(Completion)” 选项卡下的 Code Completion 选项卡中，将所有勾勾上即可。\n快捷键 同时，可以通过“工具(Tools)” -\u0026gt; “快捷键选项(Configure Shortcuts)” 来配置 Show Code Completion 的快捷键以唤出代码补全（默认为 Ctrl + Space）：\n然后，就可以愉快地考试了～\n","permalink":"https://zjxjwxk.github.io/posts/pat/%E8%80%83%E8%AF%95%E6%94%BB%E7%95%A5/","summary":"\u003cp\u003e根据往年 (2019) 年浙大软件学院的考研复试公告，如果今年 (2020) 是线下复试，且考场没有变化的话，机试应该还是在 \u003ccode\u003e浙大紫金港校区\u003c/code\u003e（如下图）。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e浙大软院招生通知：http://www.cst.zju.edu.cn/2019/0307/c36207a1478348/page.htm\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"软件学院2019年统考研究生招生复试安排\" loading=\"lazy\" src=\"/posts/pat/%E8%80%83%E8%AF%95%E6%94%BB%E7%95%A5/images/image-20200411162644696.png\"\u003e\u003c/p\u003e\n\u003cp\u003e从 PAT 官网可以找到紫金港的机房配置：\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePAT 考点联盟：https://www.patest.cn/location\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"PAT紫金港配置.png\" loading=\"lazy\" src=\"/posts/pat/%E8%80%83%E8%AF%95%E6%94%BB%E7%95%A5/images/PAT%E7%B4%AB%E9%87%91%E6%B8%AF%E9%85%8D%E7%BD%AE.png\"\u003e\u003c/p\u003e\n\u003cp\u003e我本人选择使用 \u003ccode\u003eDev C++ 5.10\u003c/code\u003e 版本，考试那天在考场需要先对其作以下配置（当然也许已经配置好了）：\u003c/p\u003e\n\u003ch1 id=\"打开产生调试信息\"\u003e打开产生调试信息\u003c/h1\u003e\n\u003cp\u003e在 \u003ccode\u003e“工具(Tools)”\u003c/code\u003e -\u0026gt; \u003ccode\u003e“编译选项(Compiler Options)\u0026quot;\u003c/code\u003e 中：\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"编译选项\" loading=\"lazy\" src=\"/posts/pat/%E8%80%83%E8%AF%95%E6%94%BB%E7%95%A5/images/image-20200411163457056.png\"\u003e\u003c/p\u003e\n\u003cp\u003e点击 \u003ccode\u003e“代码生成/优化(Settings)”\u003c/code\u003e 选项卡中的 \u003ccode\u003e\u0026quot;连接器(Linker)\u0026quot;\u003c/code\u003e 选项卡，将 \u003ccode\u003e\u0026quot;产生调试信息(Generate debugging information)\u0026quot;\u003c/code\u003e 选项改为 \u003ccode\u003e“Yes”\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"产生调试信息\" loading=\"lazy\" src=\"/posts/pat/%E8%80%83%E8%AF%95%E6%94%BB%E7%95%A5/images/image-20200411163800036.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这样，就可以愉快的 Debug 了～\u003c/p\u003e\n\u003ch1 id=\"添加-c-11-支持\"\u003e添加 C++ 11 支持\u003c/h1\u003e\n\u003cp\u003e由于 PAT 的 OJ 是支持 C++ 11 的，故最好打开 C++ 11 支持。\u003c/p\u003e\n\u003ch2 id=\"方法一推荐\"\u003e方法一（推荐）\u003c/h2\u003e\n\u003cp\u003e在 \u003ccode\u003e“工具(Tools)”\u003c/code\u003e -\u0026gt; \u003ccode\u003e“编译选项(Compiler Options)\u0026quot;\u003c/code\u003e 中，\u003ccode\u003e“代码生成/优化(Settings)”\u003c/code\u003e 选项卡下的 \u003ccode\u003e“代码生成(Code Generation)”\u003c/code\u003e 选项卡中，将 \u003ccode\u003e“语言标准(Language Standard)(-std)”\u003c/code\u003e 设置为 \u003ccode\u003eISO C++11\u003c/code\u003e 即可。\u003c/p\u003e","title":"PAT考场 Dev C++ 5.10 配置"},{"content":"A graph which is connected and acyclic can be considered a tree. The height of the tree depends on the selected root. Now you are supposed to find the root that results in a highest tree. Such a root is called the deepest root.\nInput Specification: Each input file contains one test case. For each case, the first line contains a positive integer N (≤10^4) which is the number of nodes, and hence the nodes are numbered from 1 to N. Then N−1 lines follow, each describes an edge by given the two adjacent nodes\u0026rsquo; numbers.\nOutput Specification: For each test case, print each of the deepest roots in a line. If such a root is not unique, print them in increasing order of their numbers. In case that the given graph is not a tree, print Error: K components where K is the number of connected components in the graph.\nSample Input 1: 5 1 2 1 3 1 4 2 5 Sample Output 1: 3 4 5 Sample Input 2: 5 1 3 1 4 2 5 3 4 Sample Output 2: Error: 2 components 思路 以每个未访问的结点为根结点进行 DFS，可以求出该图的连通分量，若不为 1，则表示不为树。同时，将以第一个结点作为树的根结点进行 DFS 时所得到的最高高度的相应叶子结点插入 set 集合 ans 中，此为第一个结点集合。在第一个集合中随机选取一个结点作为根结点（这里选取了 ans 集合中的第一个元素），再次进行一遍 DFS，得到第二个结点集合。这两个结点集合的并集，即为题目所求最深根结点。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;set\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;cstring\u0026gt; using namespace std; const int maxn = 10001; vector\u0026lt;int\u0026gt; G[maxn], temp; set\u0026lt;int\u0026gt; ans; int n, maxLevel = 0, cnt = 0; bool vis[maxn] = {false}; void DFS(int root, int level) { vis[root] = true; if (level \u0026gt; maxLevel) { maxLevel = level; temp.clear(); temp.push_back(root); } else if (level == maxLevel) { temp.push_back(root); } for (int i = 0; i \u0026lt; G[root].size(); i++) { if (vis[G[root][i]] == false) { DFS(G[root][i], level + 1); } } } int main() { scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); int v1, v2; for (int i = 0; i \u0026lt; n - 1; i++) { scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;v1, \u0026amp;v2); G[v1].push_back(v2); G[v2].push_back(v1); } for (int i = 1; i \u0026lt;= n; i++) { if (vis[i] == false) { cnt++; DFS(i, 1); if (i == 1) { for (int i = 0; i \u0026lt; temp.size(); i++) { ans.insert(temp[i]); } } } } if (cnt != 1) { printf(\u0026#34;Error: %d components\u0026#34;, cnt); } else { temp.clear(); memset(vis + 1, false, n); DFS(*(ans.begin()), 1); for (int i = 0; i \u0026lt; temp.size(); i++) { ans.insert(temp[i]); } for (auto it = ans.begin(); it != ans.end(); it++) { printf(\u0026#34;%d\\n\u0026#34;, *it); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1021/","summary":"\u003cp\u003eA graph which is connected and acyclic can be considered a tree. The height of the tree depends on the selected root. Now you are supposed to find the root that results in a highest tree. Such a root is called \u003cstrong\u003ethe deepest root\u003c/strong\u003e.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. For each case, the first line contains a positive integer \u003cem\u003eN\u003c/em\u003e (≤10^4) which is the number of nodes, and hence the nodes are numbered from 1 to \u003cem\u003eN\u003c/em\u003e. Then \u003cem\u003eN\u003c/em\u003e−1 lines follow, each describes an edge by given the two adjacent nodes\u0026rsquo; numbers.\u003c/p\u003e","title":"PAT甲级 1021 Deepest Root (25分)"},{"content":"It is vitally important to have all the cities connected by highways in a war. If a city is occupied by the enemy, all the highways from/toward that city are closed. We must know immediately if we need to repair any other highways to keep the rest of the cities connected. Given the map of cities which have all the remaining highways marked, you are supposed to tell the number of highways need to be repaired, quickly.\nFor example, if we have 3 cities and 2 highways connecting city1-city2 and city1-city3. Then if city1 is occupied by the enemy, we must have 1 highway repaired, that is the highway city2-city3.\nInput Specification: Each input file contains one test case. Each case starts with a line containing 3 numbers N (\u0026lt;1000), M and K, which are the total number of cities, the number of remaining highways, and the number of cities to be checked, respectively. Then M lines follow, each describes a highway by 2 integers, which are the numbers of the cities the highway connects. The cities are numbered from 1 to N. Finally there is a line containing K numbers, which represent the cities we concern.\nOutput Specification: For each of the K cities, output in a line the number of highways need to be repaired if that city is lost.\nSample Input: 3 2 3 1 2 1 3 1 2 3 Sample Output: 1 0 0 注意点 可能原图就是不连通的，所以需要对每个顶点进行 DFS #include \u0026lt;cstdio\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;cstring\u0026gt; using namespace std; const int maxn = 1000; int n, m, k, q; vector\u0026lt;int\u0026gt; G[maxn]; bool vis[maxn] = {false}; void DFS(int root) { vis[root] = true; for (int i = 0; i \u0026lt; G[root].size(); i++) { if (G[root][i] != q \u0026amp;\u0026amp; vis[G[root][i]] == false) { DFS(G[root][i]); } } } int main() { scanf(\u0026#34;%d %d %d\u0026#34;, \u0026amp;n, \u0026amp;m, \u0026amp;k); int c1, c2; for (int i = 0; i \u0026lt; m; i++) { scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;c1, \u0026amp;c2); G[c1].push_back(c2); G[c2].push_back(c1); } for (int i = 0; i \u0026lt; k; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;q); int cnt = -1; memset(vis + 1, false, n); for (int j = 1; j \u0026lt;= n; j++) { if (j != q \u0026amp;\u0026amp; vis[j] == false) { DFS(j); cnt++; } } printf(\u0026#34;%d\\n\u0026#34;, cnt); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1013/","summary":"\u003cp\u003eIt is vitally important to have all the cities connected by highways in a war. If a city is occupied by the enemy, all the highways from/toward that city are closed. We must know immediately if we need to repair any other highways to keep the rest of the cities connected. Given the map of cities which have all the remaining highways marked, you are supposed to tell the number of highways need to be repaired, quickly.\u003c/p\u003e","title":"PAT甲级 1013 Battle Over Cities (25分)"},{"content":"To store English words, one method is to use linked lists and store a word letter by letter. To save some space, we may let the words share the same sublist if they share the same suffix. For example, loading and being are stored as showed in Figure 1.\nYou are supposed to find the starting position of the common suffix (e.g. the position of i in Figure 1).\nInput Specification: Each input file contains one test case. For each case, the first line contains two addresses of nodes and a positive N (≤ 10^5), where the two addresses are the addresses of the first nodes of the two words, and N is the total number of nodes. The address of a node is a 5-digit positive integer, and NULL is represented by −1.\nThen N lines follow, each describes a node in the format:\nAddress Data Next whereAddress is the position of the node, Data is the letter contained by this node which is an English letter chosen from { a-z, A-Z }, and Next is the position of the next node.\nOutput Specification: For each case, simply output the 5-digit starting position of the common suffix. If the two words have no common suffix, output -1 instead.\nSample Input 1: 11111 22222 9 67890 i 00002 00010 a 12345 00003 g -1 12345 D 67890 00002 n 00003 22222 B 23456 11111 L 00001 23456 e 67890 00001 o 00010 Sample Output 1: 67890 Sample Input 2: 00001 00002 4 00001 a 10001 10001 s -1 00002 a 10002 10002 t -1 Sample Output 2: -1 思路 由于地址的范围较小，可以使用静态链表。并根据题意，为链表节点结构体增加一个 flag 变量，用于表示该节点是否在第一条链表中，默认为 false。先由第一条链表的首地址出发，遍历第一条链表，并将其节点的 flag 都设为 true。当遍历第二条链表时，只需输出第一个 flag 为true 的节点的地址即可。 注意点 使用 %05d 格式输出地址，使其高位补 0。 #include \u0026lt;cstdio\u0026gt; const int maxn = 100000; struct Node { char data; int next; bool flag = false; } nodes[maxn]; int main() { int root1, root2, n, address, next; char data; scanf(\u0026#34;%d %d %d\u0026#34;, \u0026amp;root1, \u0026amp;root2, \u0026amp;n); for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;address); scanf(\u0026#34; %c %d\u0026#34;, \u0026amp;nodes[address].data, \u0026amp;nodes[address].next); } int cur = root1; while (cur != -1) { nodes[cur].flag = true; cur = nodes[cur].next; } cur = root2; while (cur != -1) { if (nodes[cur].flag == true) { printf(\u0026#34;%05d\u0026#34;, cur); return 0; } cur = nodes[cur].next; } printf(\u0026#34;-1\u0026#34;); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1032/","summary":"\u003cp\u003eTo store English words, one method is to use linked lists and store a word letter by letter. To save some space, we may let the words share the same sublist if they share the same suffix. For example, \u003ccode\u003eloading\u003c/code\u003e and \u003ccode\u003ebeing\u003c/code\u003e are stored as showed in Figure 1.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Figure 1\" loading=\"lazy\" src=\"../images/image-A1032.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003eYou are supposed to find the starting position of the common suffix (e.g. the position of \u003ccode\u003ei\u003c/code\u003e in Figure 1).\u003c/p\u003e","title":"PAT甲级 1032 Sharing (25分)"},{"content":"Mice and Rice is the name of a programming contest in which each programmer must write a piece of code to control the movements of a mouse in a given map. The goal of each mouse is to eat as much rice as possible in order to become a FatMouse.\nFirst the playing order is randomly decided for N P programmers. Then every N G programmers are grouped in a match. The fattest mouse in a group wins and enters the next turn. All the losers in this turn are ranked the same. Every N G winners are then grouped in the next match until a final winner is determined.\nFor the sake of simplicity, assume that the weight of each mouse is fixed once the programmer submits his/her code. Given the weights of all the mice and the initial playing order, you are supposed to output the ranks for the programmers.\nInput Specification: Each input file contains one test case. For each case, the first line contains 2 positive integers: N P and N G (≤1000), the number of programmers and the maximum number of mice in a group, respectively. If there are less than N G mice at the end of the player\u0026rsquo;s list, then all the mice left will be put into the last group. The second line contains N P distinct non-negative numbers W i (i=0,⋯,N P − 1) where each W i is the weight of the i-th mouse respectively. The third line gives the initial playing order which is a permutation of 0,⋯,N P − 1 (assume that the programmers are numbered from 0 to N P - 1). All the numbers in a line are separated by a space.\nOutput Specification: For each test case, print the final ranks in a line. The i-th number is the rank of the i-th programmer, and all the numbers must be separated by a space, with no extra space at the end of the line.\nSample Input: 11 3 25 18 0 46 37 3 19 22 57 56 10 6 0 8 7 10 5 9 1 4 2 3 Sample Output: 5 5 5 2 5 5 5 3 1 3 5 注意点 在计算当前循环所要确定的排名时，需要分为是否能整除两种情况：\n如果剩下还未确定排名的数量（len）不能整除每组的人数（ng），则该轮循环可以确定的排名是 len / ng + 2 否则，该轮循环可以确定的排名是 len / ng + 1 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;queue\u0026gt; using namespace std; const int maxn = 1000; int main() { int np, ng, index, w[maxn], rank[maxn]; scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;np, \u0026amp;ng); queue\u0026lt;int\u0026gt; que; for (int i = 0; i \u0026lt; np; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;w[i]); } for (int i = 0; i \u0026lt; np; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;index); que.push(index); } int len = que.size(), nowRank; while (len \u0026gt; 1) { if (len % ng == 0) { nowRank = len / ng + 1; } else { nowRank = len / ng + 2; } for (int i = 0; i \u0026lt; len; i += ng) { int maxW = -1, maxI = -1; for (int j = i; j \u0026lt; i + ng \u0026amp;\u0026amp; j \u0026lt; len; j++) { int tempI = que.front(); if (w[tempI] \u0026gt; maxW) { maxW = w[tempI]; maxI = tempI; } rank[tempI] = nowRank; que.pop(); } que.push(maxI); } len = que.size(); } rank[que.front()] = 1; for (int i = 0; i \u0026lt; np; i++) { printf(\u0026#34;%d\u0026#34;, rank[i]); if (i != np - 1) { printf(\u0026#34; \u0026#34;); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1056/","summary":"\u003cp\u003e\u003cstrong\u003eMice and Rice\u003c/strong\u003e is the name of a programming contest in which each programmer must write a piece of code to control the movements of a mouse in a given map. The goal of each mouse is to eat as much rice as possible in order to become a FatMouse.\u003c/p\u003e\n\u003cp\u003eFirst the playing order is randomly decided for N \u003c!-- raw HTML omitted --\u003eP\u003c!-- raw HTML omitted --\u003e programmers. Then every N \u003c!-- raw HTML omitted --\u003eG\u003c!-- raw HTML omitted --\u003e programmers are grouped in a match. The fattest mouse in a group wins and enters the next turn. All the losers in this turn are ranked the same. Every N \u003c!-- raw HTML omitted --\u003eG\u003c!-- raw HTML omitted --\u003e winners are then grouped in the next match until a final winner is determined.\u003c/p\u003e","title":"PAT甲级 1056 Mice and Rice (25分)"},{"content":"People on Mars count their numbers with base 13:\nZero on Earth is called \u0026ldquo;tret\u0026rdquo; on Mars. The numbers 1 to 12 on Earth is called \u0026ldquo;jan, feb, mar, apr, may, jun, jly, aug, sep, oct, nov, dec\u0026rdquo; on Mars, respectively. For the next higher digit, Mars people name the 12 numbers as \u0026ldquo;tam, hel, maa, huh, tou, kes, hei, elo, syy, lok, mer, jou\u0026rdquo;, respectively. For examples, the number 29 on Earth is called \u0026ldquo;hel mar\u0026rdquo; on Mars; and \u0026ldquo;elo nov\u0026rdquo; on Mars corresponds to 115 on Earth. In order to help communication between people from these two planets, you are supposed to write a program for mutual translation between Earth and Mars number systems.\nInput Specification: Each input file contains one test case. For each case, the first line contains a positive integer N (\u0026lt;100). Then N lines follow, each contains a number in [0, 169), given either in the form of an Earth number, or that of Mars.\nOutput Specification: For each number, print in a line the corresponding number in the other language.\nSample Input: 4 29 5 elo nov tam Sample Output: hel mar may 115 13 思路 直接针对给出的输入进行模拟会相对复杂，考虑到数据范围最多不超过168，因此不妨将 [0, 168] 的所有数都预处理出来（即打表），然后查询一个输出一个即可。\n注意点 由于个位或十位为 0 时，不应该将其输出为 \u0026ldquo;tret\u0026rdquo;，所以在大表时，应该将个位或十位为 0 的数与其他数分开考虑。 #include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;map\u0026gt; using namespace std; int n; string num[4]; string unitDigit[13] = {\u0026#34;tret\u0026#34;, \u0026#34;jan\u0026#34;, \u0026#34;feb\u0026#34;, \u0026#34;mar\u0026#34;, \u0026#34;apr\u0026#34;, \u0026#34;may\u0026#34;, \u0026#34;jun\u0026#34;, \u0026#34;jly\u0026#34;, \u0026#34;aug\u0026#34;, \u0026#34;sep\u0026#34;, \u0026#34;oct\u0026#34;, \u0026#34;nov\u0026#34;, \u0026#34;dec\u0026#34;}; string tenDigit[13] = {\u0026#34;tret\u0026#34;, \u0026#34;tam\u0026#34;, \u0026#34;hel\u0026#34;, \u0026#34;maa\u0026#34;, \u0026#34;huh\u0026#34;, \u0026#34;tou\u0026#34;, \u0026#34;kes\u0026#34;, \u0026#34;hei\u0026#34;, \u0026#34;elo\u0026#34;, \u0026#34;syy\u0026#34;, \u0026#34;lok\u0026#34;, \u0026#34;mer\u0026#34;, \u0026#34;jou\u0026#34;}; map\u0026lt;string, int\u0026gt; marsToNum; string numToMars[170]; void init() { for (int i = 0; i \u0026lt; 13; i++) { numToMars[i] = unitDigit[i]; marsToNum[unitDigit[i]] = i; numToMars[i * 13] = tenDigit[i]; marsToNum[tenDigit[i]] = i * 13; } for (int i = 1; i \u0026lt; 13; i++) { for (int j = 1; j \u0026lt; 13; j++) { string mars = tenDigit[i] + \u0026#34; \u0026#34; + unitDigit[j]; numToMars[i * 13 + j] = mars; marsToNum[mars] = i * 13 + j; } } } int main() { scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); getchar(); string str; init(); for (int i = 0; i \u0026lt; n; i++) { getline(cin, str); if (str[0] \u0026gt;= \u0026#39;0\u0026#39; \u0026amp;\u0026amp; str[0] \u0026lt;= \u0026#39;9\u0026#39;) { printf(\u0026#34;%s\\n\u0026#34;, numToMars[stoi(str)].c_str()); } else { printf(\u0026#34;%d\\n\u0026#34;, marsToNum[str]); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1100/","summary":"\u003cp\u003ePeople on Mars count their numbers with base 13:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eZero on Earth is called \u0026ldquo;tret\u0026rdquo; on Mars.\u003c/li\u003e\n\u003cli\u003eThe numbers 1 to 12 on Earth is called \u0026ldquo;jan, feb, mar, apr, may, jun, jly, aug, sep, oct, nov, dec\u0026rdquo; on Mars, respectively.\u003c/li\u003e\n\u003cli\u003eFor the next higher digit, Mars people name the 12 numbers as \u0026ldquo;tam, hel, maa, huh, tou, kes, hei, elo, syy, lok, mer, jou\u0026rdquo;, respectively.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor examples, the number 29 on Earth is called \u0026ldquo;hel mar\u0026rdquo; on Mars; and \u0026ldquo;elo nov\u0026rdquo; on Mars corresponds to 115 on Earth. In order to help communication between people from these two planets, you are supposed to write a program for mutual translation between Earth and Mars number systems.\u003c/p\u003e","title":"PAT甲级 1100 Mars Numbers (20分)"},{"content":"章节概要 完成订单模块业务开发 完成限流和熔断、降级相关内容 Dubbo 特性之分组、聚合和版本控制 订单模块问题 订单模块的横向和纵向分表如何解决？ 服务限流如何处理？ 服务熔断和降级？ 如何保证多版本的蓝绿上线？ 横向拆分和纵向拆分 Dubbo 服务分组 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/service-group.html\n当一个接口有多种实现时，可以用 group 区分。\n服务 \u0026lt;dubbo:service group=\u0026#34;feedback\u0026#34; interface=\u0026#34;com.xxx.IndexService\u0026#34; /\u0026gt; \u0026lt;dubbo:service group=\u0026#34;member\u0026#34; interface=\u0026#34;com.xxx.IndexService\u0026#34; /\u0026gt; 引用 \u0026lt;dubbo:reference id=\u0026#34;feedbackIndexService\u0026#34; group=\u0026#34;feedback\u0026#34; interface=\u0026#34;com.xxx.IndexService\u0026#34; /\u0026gt; \u0026lt;dubbo:reference id=\u0026#34;memberIndexService\u0026#34; group=\u0026#34;member\u0026#34; interface=\u0026#34;com.xxx.IndexService\u0026#34; /\u0026gt; 任意组：\n\u0026lt;dubbo:reference id=\u0026#34;barService\u0026#34; interface=\u0026#34;com.foo.BarService\u0026#34; group=\u0026#34;*\u0026#34; /\u0026gt; Dubbo 分组聚合 https://dubbo.apache.org/zh-cn/docs/user/demos/group-merger.html\n按组合并返回结果，比如菜单服务，接口一样，但有多种实现，用 group 区分，现在消费方需从每种 group 中调用一次返回结果，合并结果返回，这样就可以实现聚合菜单项。\n配置 搜索所有分组\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;*\u0026#34; merger=\u0026#34;true\u0026#34; /\u0026gt; 合并指定分组\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;aaa,bbb\u0026#34; merger=\u0026#34;true\u0026#34; /\u0026gt; 指定方法合并结果，其它未指定的方法，将只调用一个 Group\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;*\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;getMenuItems\u0026#34; merger=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 某个方法不合并结果，其它都合并结果\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;*\u0026#34; merger=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;getMenuItems\u0026#34; merger=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 指定合并策略，缺省根据返回值类型自动匹配，如果同一类型有两个合并器时，需指定合并器的名称\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;*\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;getMenuItems\u0026#34; merger=\u0026#34;mymerge\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 指定合并方法，将调用返回结果的指定方法进行合并，合并方法的参数类型必须是返回结果类型本身\n\u0026lt;dubbo:reference interface=\u0026#34;com.xxx.MenuService\u0026#34; group=\u0026#34;*\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;getMenuItems\u0026#34; merger=\u0026#34;.addAll\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; Dubbo 多版本 当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。\n可以按照以下的步骤进行版本迁移：\n在低压力时间段，先升级一半提供者为新版本 再将所有消费者升级为新版本 然后将剩下的一半提供者升级为新版本 配置 老版本服务提供者配置：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; version=\u0026#34;1.0.0\u0026#34; /\u0026gt; 新版本服务提供者配置：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; version=\u0026#34;2.0.0\u0026#34; /\u0026gt; 老版本服务消费者配置：\n\u0026lt;dubbo:reference id=\u0026#34;barService\u0026#34; interface=\u0026#34;com.foo.BarService\u0026#34; version=\u0026#34;1.0.0\u0026#34; /\u0026gt; 新版本服务消费者配置：\n\u0026lt;dubbo:reference id=\u0026#34;barService\u0026#34; interface=\u0026#34;com.foo.BarService\u0026#34; version=\u0026#34;2.0.0\u0026#34; /\u0026gt; 如果不需要区分版本，可以按照以下的方式配置：\n\u0026lt;dubbo:reference id=\u0026#34;barService\u0026#34; interface=\u0026#34;com.foo.BarService\u0026#34; version=\u0026#34;*\u0026#34; /\u0026gt; 限流思路 限流措施是系统高可用的一种手段 使用并发与连接控制进行限流 使用**漏桶算法（Leaky Bucket）和令牌桶算法（Token Bucket）**算法进行限流 漏桶算法（Leaky Bucket） 令牌桶算法（Token Bucket） 区别 漏桶算法以均匀的速度处理请求，不需要承载较高的访问峰值 令牌桶算法则可能在短时间内处理大量请求，所以需要可以承载较高的访问峰值 令牌桶算法实现 public class TokenBucket { /** * 桶的容量 */ private int bucketNums = 100; /** * 流入速度 */ private int rate = 1; /** * 当前令牌数 */ private int nowTokens; /** * 上次刷新当前令牌数的时间 */ private long lastTime = getNowTime(); private long getNowTime() { return System.currentTimeMillis(); } public boolean getToken() { // 记录当前时间 long nowTime = getNowTime(); // 刷新令牌 nowTokens += (nowTime - lastTime) * rate; // 若令牌数比桶容量大，则改为桶容量 nowTokens = Math.min(bucketNums, nowTokens); System.out.println(\u0026#34;当前令牌数：\u0026#34; + nowTokens); // 修改上次刷新令牌数的时间为当前时间 lastTime = nowTime; // 判断令牌是否足够 if (nowTokens \u0026gt; 0) { nowTokens--; return true; } else { return false; } } } Hystrix 熔断降级 网关模块添加依赖：\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-hystrix\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.0.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-actuator\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-hystrix-dashboard\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.0.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; GatewayApplication 添加注解：\n@EnableHystrixDashboard @EnableCircuitBreaker @EnableHystrix 给需要熔断器的控制器方法添加注解：\n@HystrixCommand(fallbackMethod = \u0026#34;error\u0026#34;, commandProperties = { @HystrixProperty(name = \u0026#34;execution.isolation.strategy\u0026#34;, value = \u0026#34;THREAD\u0026#34;), @HystrixProperty(name = \u0026#34;execution.isolation.thread.timeoutInMilliseconds\u0026#34;, value = \u0026#34;4000\u0026#34;), @HystrixProperty(name = \u0026#34;circuitBreaker.requestVolumeThreshold\u0026#34;, value = \u0026#34;10\u0026#34;), @HystrixProperty(name = \u0026#34;circuitBreaker.errorThresholdPercentage\u0026#34;, value = \u0026#34;50\u0026#34;) }, threadPoolProperties = { @HystrixProperty(name = \u0026#34;coreSize\u0026#34;, value = \u0026#34;1\u0026#34;), @HystrixProperty(name = \u0026#34;maxQueueSize\u0026#34;, value = \u0026#34;10\u0026#34;), @HystrixProperty(name = \u0026#34;keepAliveTimeMinutes\u0026#34;, value = \u0026#34;1000\u0026#34;), @HystrixProperty(name = \u0026#34;queueSizeRejectionThreshold\u0026#34;, value = \u0026#34;8\u0026#34;), @HystrixProperty(name = \u0026#34;metrics.rollingStats.numBuckets\u0026#34;, value = \u0026#34;12\u0026#34;), @HystrixProperty(name = \u0026#34;metrics.rollingStats.timeInMilliseconds\u0026#34;, value = \u0026#34;1500\u0026#34;) }) 定义 fallbackMethod 方法，用于服务降级：\npublic ResponseVO error(Integer fieldId, String soldSeats, String seatsName) { return ResponseVO.serviceFail(\u0026#34;抱歉，下单的人太多了，请稍后重试\u0026#34;); } 总结 学习了限流措施以及实现方法（在真实业务环境中，可能会根据请求的字节数大小分配 TokenBucket） 掌握了 Dubbo 的分组聚合、版本控制 留下一个思考，如何处理事务？假如，下订单时，将 1. 验证所购买的票是否为真和 2. 检查所购买的票是否已售出，这两个 service 接口改为异步调用（因为要连接 FTP 和读取文件，速度较慢），那么可能还没有调用结束，就已经生成了订单\u0026hellip;\u0026hellip;但是如果异步调用的验证结果不为真，该怎么办？这时候就需要事务来保证 ACID 了。那么应该如何处理分布式事务呢？且看下回分解。 ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/8.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e完成订单模块业务开发\u003c/li\u003e\n\u003cli\u003e完成限流和熔断、降级相关内容\u003c/li\u003e\n\u003cli\u003eDubbo 特性之分组、聚合和版本控制\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"订单模块问题\"\u003e订单模块问题\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e订单模块的横向和纵向分表如何解决？\u003c/li\u003e\n\u003cli\u003e服务限流如何处理？\u003c/li\u003e\n\u003cli\u003e服务熔断和降级？\u003c/li\u003e\n\u003cli\u003e如何保证多版本的蓝绿上线？\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"横向拆分和纵向拆分\"\u003e横向拆分和纵向拆分\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"横向拆分和纵向拆分\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/8.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/images/image-20200408000355380.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"dubbo-服务分组\"\u003eDubbo 服务分组\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/service-group.html\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e当一个接口有多种实现时，可以用 group 区分。\u003c/p\u003e\n\u003ch2 id=\"服务\"\u003e服务\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;feedback\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.IndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;member\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.IndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"引用\"\u003e引用\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;feedbackIndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;feedback\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.IndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;memberIndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;member\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.IndexService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e任意组：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;barService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"dubbo-分组聚合\"\u003eDubbo 分组聚合\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://dubbo.apache.org/zh-cn/docs/user/demos/group-merger.html\"\u003ehttps://dubbo.apache.org/zh-cn/docs/user/demos/group-merger.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e按组合并返回结果，比如菜单服务，接口一样，但有多种实现，用 group 区分，现在消费方需从每种 group 中调用一次返回结果，合并结果返回，这样就可以实现聚合菜单项。\u003c/p\u003e\n\u003ch2 id=\"配置\"\u003e配置\u003c/h2\u003e\n\u003cp\u003e搜索所有分组\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e合并指定分组\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;aaa,bbb\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e指定方法合并结果，其它未指定的方法，将只调用一个 Group\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:method\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;getMenuItems\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dubbo:reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e某个方法不合并结果，其它都合并结果\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:method\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;getMenuItems\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dubbo:reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e指定合并策略，缺省根据返回值类型自动匹配，如果同一类型有两个合并器时，需指定合并器的名称\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:method\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;getMenuItems\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;mymerge\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dubbo:reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e指定合并方法，将调用返回结果的指定方法进行合并，合并方法的参数类型必须是返回结果类型本身\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.xxx.MenuService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egroup=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:method\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;getMenuItems\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emerger=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;.addAll\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dubbo:reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"dubbo-多版本\"\u003eDubbo 多版本\u003c/h1\u003e\n\u003cp\u003e当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。\u003c/p\u003e\n\u003cp\u003e可以按照以下的步骤进行版本迁移：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e在低压力时间段，先升级一半提供者为新版本\u003c/li\u003e\n\u003cli\u003e再将所有消费者升级为新版本\u003c/li\u003e\n\u003cli\u003e然后将剩下的一半提供者升级为新版本\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"配置-1\"\u003e配置\u003c/h2\u003e\n\u003cp\u003e老版本服务提供者配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eversion=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1.0.0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新版本服务提供者配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eversion=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2.0.0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e老版本服务消费者配置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;barService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eversion=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1.0.0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新版本服务消费者配置：\u003c/p\u003e","title":"Dubbo微服务影院系列（8）：Dubbo服务开发（订单模块开发）"},{"content":"If a machine can save only 3 significant digits, the float numbers 12300 and 12358.9 are considered equal since they are both saved as 0.123×105 with simple chopping. Now given the number of significant digits on a machine and two float numbers, you are supposed to tell if they are treated equal in that machine.\nInput Specification: Each input file contains one test case which gives three numbers N, A and B, where N (\u0026lt;100) is the number of significant digits, and A and B are the two float numbers to be compared. Each float number is non-negative, no greater than 10100, and that its total digit number is less than 100.\nOutput Specification: For each test case, print in a line YES if the two numbers are treated equal, and then the number in the standard form 0.d[1]...d[N]*10^k (d[1]\u0026gt;0 unless the number is 0); or NO if they are not treated equal, and then the two numbers in their standard form. All the terms must be separated by a space, with no extra space at the end of a line.\nNote: Simple chopping is assumed without rounding.\nSample Input 1: 3 12300 12358.9 Sample Output 1: YES 0.123*10^5 Sample Input 2: 3 120 128 Sample Output 2: NO 0.120*10^3 0.128*10^3 思路 按整数部分是否为 0 来分情况讨论，求出本体和指数，然后判断两者是否都相等：\n整数部分为 0：由于在小数点后面还可能跟着若干个 0，因此本体部分是从小数点后第一个非零位开始的部分（不足 n 位则补 0），指数则是小数点与该非零位之间的 0 的个数的相反数。 整数部分不为 0：本体部分是去掉小数点后的第一个非零位开始的 n 个字符（不足 n 位则补 0），指数则是小数点或最后一位（如没有小数点）之前的非零位数。 不管是哪种情况，如果有小数点，都需要把小数点去掉，这样才能输出正确的本体。\n注意点 此题有一个陷阱：数据有可能出现前导 0，应该先去除前导零，然后再根据首位是否为小数点来判断是情况 1，还是情况2。 去除前导零后，若字符串长度为 0，则代表该数为 0，应将指数值为 0，否则有可能因小数点后全为 0 的情况，指数变为负数。 #include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; int n; string a, b; void chopping(string \u0026amp;str, int \u0026amp;e) { while (str[0] == \u0026#39;0\u0026#39; \u0026amp;\u0026amp; str.length() \u0026gt; 0) { str.erase(0, 1); } if (str[0] == \u0026#39;.\u0026#39;) { str.erase(0, 1); while (str[0] == \u0026#39;0\u0026#39; \u0026amp;\u0026amp; str.length() \u0026gt; 0) { str.erase(0, 1); e--; } } else { if (str.find(\u0026#39;.\u0026#39;) == string::npos) { e = str.length(); } else { e = str.find(\u0026#39;.\u0026#39;); str.erase(str.find(\u0026#39;.\u0026#39;), 1); } } int len = str.length(); if (len == 0) { e = 0; } if (str.length() \u0026lt; n) { for (int i = 0; i \u0026lt; n - len; i++) { str.append(\u0026#34;0\u0026#34;); } } else if (len \u0026gt; n) { str = str.substr(0, n); } } int main() { cin \u0026gt;\u0026gt; n \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b; int e1 = 0, e2 = 0; chopping(a, e1); chopping(b, e2); if (a == b \u0026amp;\u0026amp; e1 == e2) { printf(\u0026#34;YES\u0026#34;); cout \u0026lt;\u0026lt; \u0026#34; 0.\u0026#34; \u0026lt;\u0026lt; a \u0026lt;\u0026lt; \u0026#34;*10^\u0026#34; \u0026lt;\u0026lt; e1; } else { printf(\u0026#34;NO\u0026#34;); cout \u0026lt;\u0026lt; \u0026#34; 0.\u0026#34; \u0026lt;\u0026lt; a \u0026lt;\u0026lt; \u0026#34;*10^\u0026#34; \u0026lt;\u0026lt; e1; cout \u0026lt;\u0026lt; \u0026#34; 0.\u0026#34; \u0026lt;\u0026lt; b \u0026lt;\u0026lt; \u0026#34;*10^\u0026#34; \u0026lt;\u0026lt; e2; } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1060/","summary":"\u003cp\u003eIf a machine can save only 3 significant digits, the float numbers 12300 and 12358.9 are considered equal since they are both saved as 0.123×105 with simple chopping. Now given the number of significant digits on a machine and two float numbers, you are supposed to tell if they are treated equal in that machine.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case which gives three numbers \u003cem\u003eN\u003c/em\u003e, \u003cem\u003eA\u003c/em\u003e and \u003cem\u003eB\u003c/em\u003e, where \u003cem\u003eN\u003c/em\u003e (\u0026lt;100) is the number of significant digits, and \u003cem\u003eA\u003c/em\u003e and \u003cem\u003eB\u003c/em\u003e are the two float numbers to be compared. Each float number is non-negative, no greater than 10100, and that its total digit number is less than 100.\u003c/p\u003e","title":"PAT甲级 1060 Are They Equal (25分)"},{"content":"Zhejiang University has 40000 students and provides 2500 courses. Now given the student name lists of all the courses, you are supposed to output the registered course list for each student who comes for a query.\nInput Specification: Each input file contains one test case. For each case, the first line contains 2 positive integers: N (≤40,000), the number of students who look for their course lists, and K (≤2,500), the total number of courses. Then the student name lists are given for the courses (numbered from 1 to K) in the following format: for each course i, first the course index i and the number of registered students N i (≤200) are given in a line. Then in the next line, N i student names are given. A student name consists of 3 capital English letters plus a one-digit number. Finally the last line contains the N names of students who come for a query. All the names and numbers in a line are separated by a space.\nOutput Specification: For each test case, print your results in N lines. Each line corresponds to one student, in the following format: first print the student\u0026rsquo;s name, then the total number of registered courses of that student, and finally the indices of the courses in increasing order. The query results must be printed in the same order as input. All the data in a line must be separated by a space, with no extra space at the end of the line.\nSample Input: 11 5 4 7 BOB5 DON2 FRA8 JAY9 KAT3 LOR6 ZOE1 1 4 ANN0 BOB5 JAY9 LOR6 2 7 ANN0 BOB5 FRA8 JAY9 JOE4 KAT3 LOR6 3 1 BOB5 5 9 AMY7 ANN0 BOB5 DON2 FRA8 JAY9 KAT3 LOR6 ZOE1 ZOE1 ANN0 BOB5 JOE4 JAY9 FRA8 DON2 AMY7 KAT3 LOR6 NON9 Sample Output: ZOE1 2 4 5 ANN0 3 1 2 5 BOB5 5 1 2 3 4 5 JOE4 1 2 JAY9 4 1 2 4 5 FRA8 3 2 4 5 DON2 2 4 5 AMY7 1 5 KAT3 3 2 4 5 LOR6 4 1 2 4 5 NON9 0 注意点 本题最后一个测试点数据量比较大，使用 map, string 会导致超时，因此只能使用字符串 hash 进行求解，使用 vector 数组或 set 数组（自动排序课程号）。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;set\u0026gt; using namespace std; const int maxn = 26 * 26 * 26 * 10; set\u0026lt;int\u0026gt; course[maxn]; int getID(char name[]) { int id = 0; for (int i = 0; i \u0026lt; 3; i++) { id = id * 26 + (name[i] - \u0026#39;A\u0026#39;); } id = id * 10 + (name[3] - \u0026#39;0\u0026#39;); return id; } int main() { int n, k, index, num; scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;n, \u0026amp;k); char name[5]; for (int i = 0; i \u0026lt; k; i++) { scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;index, \u0026amp;num); for (int j = 0; j \u0026lt; num; j++) { scanf(\u0026#34;%s\u0026#34;, name); course[getID(name)].insert(index); } } for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%s\u0026#34;, name); int id = getID(name); printf(\u0026#34;%s %d\u0026#34;, name, course[id].size()); for (auto it = course[id].begin(); it != course[id].end(); it++) { printf(\u0026#34;% d\u0026#34;, *it); } printf(\u0026#34;\\n\u0026#34;); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1039/","summary":"\u003cp\u003eZhejiang University has 40000 students and provides 2500 courses. Now given the student name lists of all the courses, you are supposed to output the registered course list for each student who comes for a query.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. For each case, the first line contains 2 positive integers: \u003cem\u003eN\u003c/em\u003e (≤40,000), the number of students who look for their course lists, and \u003cem\u003eK\u003c/em\u003e (≤2,500), the total number of courses. Then the student name lists are given for the courses (numbered from 1 to \u003cem\u003eK\u003c/em\u003e) in the following format: for each course \u003cem\u003ei\u003c/em\u003e, first the course index \u003cem\u003ei\u003c/em\u003e and the number of registered students N \u003c!-- raw HTML omitted --\u003ei\u003c!-- raw HTML omitted --\u003e (≤200) are given in a line. Then in the next line, N \u003c!-- raw HTML omitted --\u003ei\u003c!-- raw HTML omitted --\u003e student names are given. A student name consists of 3 capital English letters plus a one-digit number. Finally the last line contains the \u003cem\u003eN\u003c/em\u003e names of students who come for a query. All the names and numbers in a line are separated by a space.\u003c/p\u003e","title":"PAT甲级 1039 Course List for Student (25分)"},{"content":"Among all the factors of a positive integer N, there may exist several consecutive numbers. For example, 630 can be factored as 3×5×6×7, where 5, 6, and 7 are the three consecutive numbers. Now given any positive N, you are supposed to find the maximum number of consecutive factors, and list the smallest sequence of the consecutive factors.\nInput Specification: Each input file contains one test case, which gives the integer N (1\u0026lt;N\u0026lt;2^{31}).\nOutput Specification: For each test case, print in the first line the maximum number of consecutive factors. Then in the second line, print the smallest sequence of the consecutive factors in the format factor[1]*factor[2]*...*factor[k], where the factors are listed in increasing order, and 1 is NOT included.\nSample Input: 630 Sample Output: 3 5*6*7 注意点 N 不会被自己以为的大于 $\\sqrt{N}$ 的多个连续整数整除，因此只需要从 2 ～ $\\sqrt{N}$ 遍历连续整数的第一个。 如果遍历结束后 ansLen 依然为 0，说明不超过 $\\sqrt{N}$ 的整数中不存在能整除 N 的连续整数，因此答案就是 N 本身。此时输出特例，即连续个数为 1，因数为 N 本身。 需要用 long long，防止中间乘积超过 int 导致溢出。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cmath\u0026gt; int main() { long long n; scanf(\u0026#34;%lld\u0026#34;, \u0026amp;n); long long ansI, ansLen = 0, sqr = sqrt(1.0 * n); for (long long i = 2; i \u0026lt;= sqr; i++) { long long temp = 1; for (long long j = i; j \u0026lt;= n ; j++) { temp *= j; if (n % temp == 0) { if (j - i + 1 \u0026gt; ansLen) { ansLen = j - i + 1; ansI = i; } } else { break; } } } if (ansLen == 0) { printf(\u0026#34;1\\n%lld\u0026#34;, n); } else { printf(\u0026#34;%lld\\n\u0026#34;, ansLen); for (long long i = 0; i \u0026lt; ansLen; i++) { printf(\u0026#34;%lld\u0026#34;, ansI + i); if (i != ansLen - 1) { printf(\u0026#34;*\u0026#34;); } } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1096/","summary":"\u003cp\u003eAmong all the factors of a positive integer N, there may exist several consecutive numbers. For example, 630 can be factored as 3×5×6×7, where 5, 6, and 7 are the three consecutive numbers. Now given any positive N, you are supposed to find the maximum number of consecutive factors, and list the smallest sequence of the consecutive factors.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case, which gives the integer N (1\u0026lt;N\u0026lt;2^{31}).\u003c/p\u003e","title":"PAT甲级 1096 Consecutive Factors (20分)"},{"content":"The task of this problem is simple: insert a sequence of distinct positive integers into a hash table, and output the positions of the input numbers. The hash function is defined to be H(key)=key%TSize where TSize is the maximum size of the hash table. Quadratic probing (with positive increments only) is used to solve the collisions.\nNote that the table size is better to be prime. If the maximum size given by the user is not prime, you must re-define the table size to be the smallest prime number which is larger than the size given by the user.\nInput Specification: Each input file contains one test case. For each case, the first line contains two positive numbers: MSize (≤ 10^4 ) and N (≤MSize) which are the user-defined table size and the number of input numbers, respectively. Then N distinct positive integers are given in the next line. All the numbers in a line are separated by a space.\nOutput Specification: For each test case, print the corresponding positions (index starts from 0) of the input numbers in one line. All the numbers in a line are separated by a space, and there must be no extra space at the end of the line. In case it is impossible to insert the number, print \u0026ldquo;-\u0026rdquo; instead.\nSample Input: 4 4 10 6 4 15 Sample Output: 0 1 4 - 注意点 进行二次探测时，当 step 自增达到 TSize 时如果还没有找到可用位置，则表明这个元素无法被插入。 创建哈希表时数组大小应该尽量比 10^4 大一些，因为当寻找大于 MSize 的最小质数时可能超过 10^4。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cmath\u0026gt; const int maxn = 10010; bool isPrime(int n) { if (n \u0026lt;= 1) { return false; } else if (n == 2) { return true; } else { int q = (int) sqrt(1.0 * n); for (int i = 2; i \u0026lt;= q; i++) { if (n % i == 0) { return false; } } return true; } } int main() { int tSize, n, nums[maxn] = {0}, num; scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;tSize, \u0026amp;n); while (!isPrime(tSize)) { tSize++; } for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;num); int index = num % tSize; if (nums[index] == 0) { nums[index] = num; if (i != 0) { printf(\u0026#34; \u0026#34;); } printf(\u0026#34;%d\u0026#34;, index); } else { int j; for (j = 1; j \u0026lt;= tSize; j++) { index = (num + j * j) % tSize; if (nums[index] == 0) { nums[index] = num; printf(\u0026#34; %d\u0026#34;, index); break; } } if (j \u0026gt; tSize) { printf(\u0026#34; -\u0026#34;); } } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1078/","summary":"\u003cp\u003eThe task of this problem is simple: insert a sequence of distinct positive integers into a hash table, and output the positions of the input numbers. The hash function is defined to be H(key)=key%TSize where TSize is the maximum size of the hash table. Quadratic probing (with positive increments only) is used to solve the collisions.\u003c/p\u003e\n\u003cp\u003eNote that the table size is better to be prime. If the maximum size given by the user is not prime, you must re-define the table size to be the smallest prime number which is larger than the size given by the user.\u003c/p\u003e","title":"PAT甲级 1078 Hashing (25分)"},{"content":"Given N rational numbers in the form numerator/denominator, you are supposed to calculate their sum.\nInput Specification: Each input file contains one test case. Each case starts with a positive integer N (≤100), followed in the next line N rational numbers a1/b1 a2/b2 ... where all the numerators and denominators are in the range of long int. If there is a negative number, then the sign must appear in front of the numerator.\nOutput Specification: For each test case, output the sum in the simplest form integer numerator/denominator where integer is the integer part of the sum, numerator \u0026lt; denominator, and the numerator and the denominator have no common factor. You must output only the fractional part if the integer part is 0.\nSample Input 1: 5 2/5 4/15 1/30 -2/60 8/3 Sample Output 1: 3 1/3 Sample Input 2: 2 4/3 2/3 Sample Output 2: 2 Sample Input 3: 3 1/3 -1/6 1/8 Sample Output 3: 7/24 注意点 数据范围为 int，但是两个分母相乘时，可能超出 int，最大可以达到 long long，所以如果使用 int，就会溢出，得到“答案错误” 必须在每一步加法后都进行约分，如果等全部加完后才约分，则会溢出 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; struct Num { long long a, b; } temp, ans; long long gcd(long long a, long long b) { if (b == 0) { return a; } else { return gcd(b, a % b); } } void simplify(Num \u0026amp;n) { if (n.b \u0026lt; 0) { n.a = -n.a; n.b = -n.b; } if (n.a == 0) { n.b = 1; } else { int d = gcd(abs(n.a), abs(n.b)); n.a /= d; n.b /= d; } } Num add(Num \u0026amp;n1, Num \u0026amp;n2) { Num ret; ret.a = n1.a * n2.b + n2.a * n1.b; ret.b = n1.b * n2.b; simplify(ret); return ret; } int main() { int n; scanf(\u0026#34;%d %lld/%lld\u0026#34;, \u0026amp;n, \u0026amp;ans.a, \u0026amp;ans.b); simplify(ans); for (int i = 1; i \u0026lt; n; i++) { scanf(\u0026#34;%lld/%lld\u0026#34;, \u0026amp;temp.a, \u0026amp;temp.b); ans = add(ans, temp); } if (ans.b == 1) { printf(\u0026#34;%lld\u0026#34;, ans.a); } else if (ans.a \u0026gt; ans.b) { printf(\u0026#34;%lld %lld/%lld\u0026#34;, ans.a / ans.b, ans.a % ans.b, ans.b); } else { printf(\u0026#34;%lld/%lld\u0026#34;, ans.a, ans.b); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1081/","summary":"\u003cp\u003eGiven \u003cem\u003eN\u003c/em\u003e rational numbers in the form \u003ccode\u003enumerator/denominator\u003c/code\u003e, you are supposed to calculate their sum.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. Each case starts with a positive integer \u003cem\u003eN\u003c/em\u003e (≤100), followed in the next line \u003cem\u003eN\u003c/em\u003e rational numbers \u003ccode\u003ea1/b1 a2/b2 ...\u003c/code\u003e where all the numerators and denominators are in the range of \u003cstrong\u003elong int\u003c/strong\u003e. If there is a negative number, then the sign must appear in front of the numerator.\u003c/p\u003e","title":"PAT甲级 1081 Rational Sum (20分)"},{"content":"一个数组A中存有N（\u0026gt;0）个整数，在不允许使用另外数组的前提下，将每个整数循环向右移M（≥0）个位置，即将A中的数据由（A0 A1 ⋯A N−1 ）变换为（A N−M ⋯A N−1 A 0 A 1⋯A N−M−1 ）（最后M个数循环移至最前面的M个位置）。如果需要考虑程序移动数据的次数尽量少，要如何设计移动的方法？\n输入格式: 每个输入包含一个测试用例，第1行输入N（1≤N≤100）和M（≥0）；第2行输入N个整数，之间用空格分隔。\n输出格式: 在一行中输出循环右移M位以后的整数序列，之间用空格分隔，序列结尾不能有多余空格。\n输入样例: 6 2 1 2 3 4 5 6 输出样例: 5 6 1 2 3 4 思路 如何让移动的次数最少：将序列中一个元素先拿出至临时变量，然后将空出的位置用将要移动到这个位置的元素代替，再把新空出的位置用将要移动到这个新空出的位置的元素代替，以此类推，知道所有元素移动完毕。 注意点 有可能经过一轮循环之后 N-M 号位之后有多个位置已经得到了最终结果，这样当继续枚举起始位时就会产生重复，最后导致错误。例如 N = 8，M = 3，这种情况下只需要枚举一次起始位。为了解决这个问题，要计算得到 N 和 M 的最大公约数，计为 d，那么 d 就表示需要循环轮数。那么从 N - M 号位开始枚举起始位，直到 N - M + d - 1 位结束即可。 当 M 经过 M % N 修正后，若 M == 0，则直接输出数组即可，否则会产生错误，超时。 #include \u0026lt;cstdio\u0026gt; const int maxn = 100; int gcd(int a, int b) { if (b == 0) { return a; } else { return gcd(b, a % b); } } int main() { int n, m, nums[maxn]; scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;n, \u0026amp;m); m %= n; for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;nums[i]); } if (m != 0) { int d = gcd(n, m); for (int i = n - m; i \u0026lt;= n - m + d - 1; i++) { int temp = nums[i], curIndex = i; while ((curIndex - m + n) % n != i) { int preIndex = (curIndex - m + n) % n; nums[curIndex] = nums[preIndex]; curIndex = preIndex; } nums[curIndex] = temp; } } for (int i = 0; i \u0026lt; n; i++) { printf(\u0026#34;%d\u0026#34;, nums[i]); if (i != n - 1) { printf(\u0026#34; \u0026#34;); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/basic_level/b1008/","summary":"\u003cp\u003e一个数组\u003cem\u003eA\u003c/em\u003e中存有\u003cem\u003eN\u003c/em\u003e（\u0026gt;0）个整数，在不允许使用另外数组的前提下，将每个整数循环向右移\u003cem\u003eM\u003c/em\u003e（≥0）个位置，即将\u003cem\u003eA\u003c/em\u003e中的数据由（A\u003c!-- raw HTML omitted --\u003e0\u003c!-- raw HTML omitted --\u003e A\u003c!-- raw HTML omitted --\u003e1\u003c!-- raw HTML omitted --\u003e ⋯A \u003c!-- raw HTML omitted --\u003eN−1\u003c!-- raw HTML omitted --\u003e ）变换为（A \u003c!-- raw HTML omitted --\u003eN−M\u003c!-- raw HTML omitted --\u003e ⋯A \u003c!-- raw HTML omitted --\u003eN−1\u003c!-- raw HTML omitted --\u003e A \u003c!-- raw HTML omitted --\u003e0\u003c!-- raw HTML omitted --\u003e A \u003c!-- raw HTML omitted --\u003e1\u003c!-- raw HTML omitted --\u003e⋯A  \u003c!-- raw HTML omitted --\u003eN−M−1\u003c!-- raw HTML omitted --\u003e ）（最后\u003cem\u003eM\u003c/em\u003e个数循环移至最前面的\u003cem\u003eM\u003c/em\u003e个位置）。如果需要考虑程序移动数据的次数尽量少，要如何设计移动的方法？\u003c/p\u003e","title":"PAT乙级 1008 数组元素循环右移问题 (20分)"},{"content":"章节概要 完成影院模块业务开发 修改全局异常返回 学习 Dubbo 特性：结果缓存，连接和并发控制 Dubbo 结果缓存 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/result-cache.html\n用于加速热门数据的访问速度，Dubbo 提供声明式缓存，以减少用户加缓存的工作量。\n缓存类型 lru 基于最近最少使用原则删除多余缓存，保持最热的数据被缓存。 threadlocal 当前线程缓存，比如一个页面渲染，用到很多 portal，每个 portal 都要去查用户信息，通过线程缓存，可以减少这种多余访问。 配置 \u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; cache=\u0026#34;lru\u0026#34; /\u0026gt; 或：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;findBar\u0026#34; cache=\u0026#34;lru\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 了解 Dubbo 结果缓存与 Redis 缓存等的区别：\nDubbo 结果缓存是本地缓存，保存在当前 JVM 中，多台机器存储多份缓存。适合数据量小的数据，存储在本地占用资源少，而且速度较快。 Redis 缓存则是分布式缓存，多台机器共享缓存。 小数据量的可以放在 Dubbo 结果缓存中，需要计算和共享的缓存数据可以放在 Redis 中。 Dubbo 连接、并发控制 Dubbo 可以对连接、并发数量进行控制 超出部分以错误形式返回 Dubbo 连接控制 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/config-connections.html\n服务端连接控制 限制服务器端接受的连接不能超过 10 个：\n\u0026lt;dubbo:provider protocol=\u0026#34;dubbo\u0026#34; accepts=\u0026#34;10\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:protocol name=\u0026#34;dubbo\u0026#34; accepts=\u0026#34;10\u0026#34; /\u0026gt; 客户端连接控制 限制客户端服务使用连接不能超过 10 个（如果是长连接，比如 Dubbo 协议，connections 表示该服务对每个提供者建立的长连接数）：\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; connections=\u0026#34;10\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; connections=\u0026#34;10\u0026#34; /\u0026gt; 如果 dubbo:service 和 dubbo:reference 都配了 connections，dubbo:reference 优先。\n区别 服务端连接控制 服务端只能接受来自客户端的 10 个请求：\n客户端连接控制 服务端可以接受任意个请求，但是客户端只能接受 10 个请求。\n如果超出了限制，则会报和没有启动服务类似的异常：\nCaused by: java.lang.IllegalStateException: Failed to check the status of the service com.zjut.zjxjwxk.dubbo.ServiceAPI. No provider available for the service com.zjut.zjxjwxk.dubbo.ServiceAPI ... Dubbo 并发控制 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/concurrency-control.html\n服务端服务级别 限制 com.foo.BarService 的每个方法，服务器端并发执行（或占用线程池线程数）不能超过 10 个：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; executes=\u0026#34;10\u0026#34; /\u0026gt; 服务端方法级别 限制 com.foo.BarService 的 sayHello 方法，服务器端并发执行（或占用线程池线程数）不能超过 10 个：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;sayHello\u0026#34; executes=\u0026#34;10\u0026#34; /\u0026gt; \u0026lt;/dubbo:service\u0026gt; 客户端服务界别 限制 com.foo.BarService 的每个方法，每客户端并发执行（或占用连接的请求数）不能超过 10 个：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; actives=\u0026#34;10\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; actives=\u0026#34;10\u0026#34; /\u0026gt; 客户端方法级别 限制 com.foo.BarService 的 sayHello 方法，每客户端并发执行（或占用连接的请求数）不能超过 10 个：\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;sayHello\u0026#34; actives=\u0026#34;10\u0026#34; /\u0026gt; \u0026lt;/dubbo:service\u0026gt; 或\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;sayHello\u0026#34; actives=\u0026#34;10\u0026#34; /\u0026gt; \u0026lt;/dubbo:service\u0026gt; 如果 dubbo:service 和 dubbo:reference 都配了actives，dubbo:reference 优先\nLoad Balance 均衡 配置服务的客户端的 loadbalance 属性为 leastactive，此 Loadbalance 会调用并发数最小的 Provider（Consumer端并发数）。\n\u0026lt;dubbo:reference interface=\u0026#34;com.foo.BarService\u0026#34; loadbalance=\u0026#34;leastactive\u0026#34; /\u0026gt; 或\n\u0026lt;dubbo:service interface=\u0026#34;com.foo.BarService\u0026#34; loadbalance=\u0026#34;leastactive\u0026#34; /\u0026gt; ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/7.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E5%BD%B1%E9%99%A2%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e完成影院模块业务开发\u003c/li\u003e\n\u003cli\u003e修改全局异常返回\u003c/li\u003e\n\u003cli\u003e学习 Dubbo 特性：结果缓存，连接和并发控制\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"dubbo-结果缓存\"\u003eDubbo 结果缓存\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003e官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/result-cache.html\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e用于加速热门数据的访问速度，Dubbo 提供声明式缓存，以减少用户加缓存的工作量。\u003c/p\u003e\n\u003ch2 id=\"缓存类型\"\u003e缓存类型\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003elru\u003c/code\u003e 基于最近最少使用原则删除多余缓存，保持最热的数据被缓存。\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ethreadlocal\u003c/code\u003e 当前线程缓存，比如一个页面渲染，用到很多 portal，每个 portal 都要去查用户信息，通过线程缓存，可以减少这种多余访问。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"配置\"\u003e配置\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecache=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;lru\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:method\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;findBar\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecache=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;lru\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dubbo:reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e了解 Dubbo 结果缓存与 Redis 缓存等的区别：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDubbo 结果缓存是本地缓存，保存在当前 JVM 中，多台机器存储多份缓存。适合数据量小的数据，存储在本地占用资源少，而且速度较快。\u003c/li\u003e\n\u003cli\u003eRedis 缓存则是分布式缓存，多台机器共享缓存。\u003c/li\u003e\n\u003cli\u003e小数据量的可以放在 Dubbo 结果缓存中，需要计算和共享的缓存数据可以放在 Redis 中。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"dubbo-连接并发控制\"\u003eDubbo 连接、并发控制\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eDubbo 可以对连接、并发数量进行控制\u003c/li\u003e\n\u003cli\u003e超出部分以错误形式返回\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"dubbo-连接控制\"\u003eDubbo 连接控制\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/config-connections.html\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"服务端连接控制\"\u003e服务端连接控制\u003c/h3\u003e\n\u003cp\u003e限制服务器端接受的连接不能超过 10 个：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:provider\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eprotocol=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dubbo\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaccepts=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:protocol\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dubbo\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaccepts=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"客户端连接控制\"\u003e客户端连接控制\u003c/h3\u003e\n\u003cp\u003e限制客户端服务使用连接不能超过 10 个（如果是长连接，比如 Dubbo 协议，connections 表示该服务对每个提供者建立的长连接数）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:reference\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econnections=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dubbo:service\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003einterface=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;com.foo.BarService\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econnections=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果 dubbo:service 和 dubbo:reference 都配了 connections，dubbo:reference 优先。\u003c/p\u003e","title":"Dubbo微服务影院系列（7）：Dubbo服务开发（影院模块开发）"},{"content":"The task is simple: given any positive integer N, you are supposed to count the total number of 1\u0026rsquo;s in the decimal form of the integers from 1 to N. For example, given N being 12, there are five 1\u0026rsquo;s in 1, 10, 11, and 12.\nInput Specification: Each input file contains one test case which gives the positive N (≤230).\nOutput Specification: For each test case, print the number of 1\u0026rsquo;s in one line.\nSample Input: 12 Sample Output: 5 思路 从低位到高位考虑每一位为 1 的个数，设当前位的数为 i，该位左边的数为 leftNum，右边的数为 rightNum，e 从 1 开始每次遍历乘 10。通过数字举例，可以总结出这样的公式：\ni \u0026gt; 1 时，个数为 (leftNum + 1) * e i == 1 时，个数为 leftNum * e + rightNum + 1 i == 0 时，个数为 leftNum * e #include \u0026lt;cstdio\u0026gt; int main() { int n; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); int i, leftNum = n, rightNum, e = 1, ans = 0; while (leftNum != 0) { i = n / e % 10; leftNum /= 10; rightNum = n % e; if (i \u0026gt; 1) { ans += (leftNum + 1) * e; } else if (i == 1) { ans += leftNum * e + rightNum + 1; } else { ans += leftNum * e; } e *= 10; } printf(\u0026#34;%d\u0026#34;, ans); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1049/","summary":"\u003cp\u003eThe task is simple: given any positive integer \u003cem\u003eN\u003c/em\u003e, you are supposed to count the total number of 1\u0026rsquo;s in the decimal form of the integers from 1 to \u003cem\u003eN\u003c/em\u003e. For example, given \u003cem\u003eN\u003c/em\u003e being 12, there are five 1\u0026rsquo;s in 1, 10, 11, and 12.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case which gives the positive \u003cem\u003eN\u003c/em\u003e (≤230).\u003c/p\u003e\n\u003ch1 id=\"output-specification\"\u003eOutput Specification:\u003c/h1\u003e\n\u003cp\u003eFor each test case, print the number of 1\u0026rsquo;s in one line.\u003c/p\u003e","title":"PAT甲级 1049 Counting Ones (30分)"},{"content":"“答案正确”是自动判题系统给出的最令人欢喜的回复。本题属于 PAT 的“答案正确”大派送 —— 只要读入的字符串满足下列条件，系统就输出“答案正确”，否则输出“答案错误”。\n得到“答案正确”的条件是：\n字符串中必须仅有 P、 A、 T这三种字符，不可以包含其它字符； 任意形如 xPATx 的字符串都可以获得“答案正确”，其中 x 或者是空字符串，或者是仅由字母 A 组成的字符串； 如果 aPbTc 是正确的，那么 aPbATca 也是正确的，其中 a、 b、 c 均或者是空字符串，或者是仅由字母 A 组成的字符串。 现在就请你为 PAT 写一个自动裁判程序，判定哪些字符串是可以获得“答案正确”的。\n输入格式： 每个测试输入包含 1 个测试用例。第 1 行给出一个正整数 n (\u0026lt;10)，是需要检测的字符串个数。接下来每个字符串占一行，字符串长度不超过 100，且不包含空格。\n输出格式： 每个字符串的检测结果占一行，如果该字符串可以获得“答案正确”，则输出 YES，否则输出 NO。\n输入样例： 8 PAT PAAT AAPATAA AAPAATAAAA xPATx PT Whatever APAAATAA 输出样例： YES YES YES YES NO NO NO NO 思路 可以找到这样的规律：正确的字符串应该遵循 P 左侧的 A 个数乘 P 与 T 中间的 A 个数等于 T 右侧的 A 个数。且 P 和 T 的个数必须为1，中间 A 的个数不能为 0，除了 P，A，T 的其他的字符个数必须为 0。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; const int maxn = 101; int main() { int n, len; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); char str[maxn]; for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%s\u0026#34;, str); len = strlen(str); int PNum = 0, TNum = 0, otherNum = 0, PIndex, TIndex; for (int j = 0; j \u0026lt; len; j++) { if (str[j] == \u0026#39;P\u0026#39;) { PNum++; PIndex = j; } else if (str[j] == \u0026#39;T\u0026#39;) { TNum++; TIndex = j; } else if (str[j] != \u0026#39;A\u0026#39;) { otherNum++; } } if (PNum != 1 || TNum != 1 || otherNum != 0 || (TIndex - PIndex) \u0026lt;= 1) { printf(\u0026#34;NO\\n\u0026#34;); continue; } int leftA = PIndex, midA = TIndex - PIndex - 1, rightA = len - TIndex - 1; if (leftA * midA == rightA) { printf(\u0026#34;YES\\n\u0026#34;); } else { printf(\u0026#34;NO\\n\u0026#34;); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/basic_level/b1003/","summary":"\u003cp\u003e“\u003cstrong\u003e答案正确\u003c/strong\u003e”是自动判题系统给出的最令人欢喜的回复。本题属于 PAT 的“\u003cstrong\u003e答案正确\u003c/strong\u003e”大派送 —— 只要读入的字符串满足下列条件，系统就输出“\u003cstrong\u003e答案正确\u003c/strong\u003e”，否则输出“\u003cstrong\u003e答案错误\u003c/strong\u003e”。\u003c/p\u003e\n\u003cp\u003e得到“\u003cstrong\u003e答案正确\u003c/strong\u003e”的条件是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e字符串中必须仅有 \u003ccode\u003eP\u003c/code\u003e、 \u003ccode\u003eA\u003c/code\u003e、 \u003ccode\u003eT\u003c/code\u003e这三种字符，不可以包含其它字符；\u003c/li\u003e\n\u003cli\u003e任意形如 \u003ccode\u003exPATx\u003c/code\u003e 的字符串都可以获得“\u003cstrong\u003e答案正确\u003c/strong\u003e”，其中 \u003ccode\u003ex\u003c/code\u003e 或者是空字符串，或者是仅由字母 \u003ccode\u003eA\u003c/code\u003e 组成的字符串；\u003c/li\u003e\n\u003cli\u003e如果 \u003ccode\u003eaPbTc\u003c/code\u003e 是正确的，那么 \u003ccode\u003eaPbATca\u003c/code\u003e 也是正确的，其中 \u003ccode\u003ea\u003c/code\u003e、 \u003ccode\u003eb\u003c/code\u003e、 \u003ccode\u003ec\u003c/code\u003e 均或者是空字符串，或者是仅由字母 \u003ccode\u003eA\u003c/code\u003e 组成的字符串。\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e现在就请你为 PAT 写一个自动裁判程序，判定哪些字符串是可以获得“\u003cstrong\u003e答案正确\u003c/strong\u003e”的。\u003c/p\u003e\n\u003ch1 id=\"输入格式\"\u003e输入格式：\u003c/h1\u003e\n\u003cp\u003e每个测试输入包含 1 个测试用例。第 1 行给出一个正整数 \u003cem\u003en\u003c/em\u003e (\u0026lt;10)，是需要检测的字符串个数。接下来每个字符串占一行，字符串长度不超过 100，且不包含空格。\u003c/p\u003e\n\u003ch1 id=\"输出格式\"\u003e输出格式：\u003c/h1\u003e\n\u003cp\u003e每个字符串的检测结果占一行，如果该字符串可以获得“\u003cstrong\u003e答案正确\u003c/strong\u003e”，则输出 \u003ccode\u003eYES\u003c/code\u003e，否则输出 \u003ccode\u003eNO\u003c/code\u003e。\u003c/p\u003e\n\u003ch1 id=\"输入样例\"\u003e输入样例：\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-in\" data-lang=\"in\"\u003e8\nPAT\nPAAT\nAAPATAA\nAAPAATAAAA\nxPATx\nPT\nWhatever\nAPAAATAA\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"输出样例\"\u003e输出样例：\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-out\" data-lang=\"out\"\u003eYES\nYES\nYES\nYES\nNO\nNO\nNO\nNO\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"思路\"\u003e思路\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e可以找到这样的规律：正确的字符串应该遵循 P 左侧的 A 个数乘 P 与 T 中间的 A 个数等于 T 右侧的 A 个数。且 P 和 T 的个数必须为1，中间 A 的个数不能为 0，除了 P，A，T 的其他的字符个数必须为 0。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;cstdio\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;cstring\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e maxn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e101\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e n, len;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    scanf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003en);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e str[maxn];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e n; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        scanf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\u0026#34;\u003c/span\u003e, str);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        len \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e strlen(str);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e PNum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, TNum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, otherNum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, PIndex, TIndex;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e j \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; j \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len; j\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (str[j] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;P\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                PNum\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                PIndex \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e j;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (str[j] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;T\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                TNum\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                TIndex \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e j;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (str[j] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                otherNum\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (PNum \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e TNum \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e otherNum \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e (TIndex \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e PIndex) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;NO\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003econtinue\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e leftA \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e PIndex, midA \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e TIndex \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e PIndex \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, rightA \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e len \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e TIndex \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (leftA \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e midA \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e rightA) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;YES\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;NO\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"PAT乙级 1003 我要通过！ (20分)"},{"content":"Given a sequence of positive numbers, a segment is defined to be a consecutive subsequence. For example, given the sequence { 0.1, 0.2, 0.3, 0.4 }, we have 10 segments: (0.1) (0.1, 0.2) (0.1, 0.2, 0.3) (0.1, 0.2, 0.3, 0.4) (0.2) (0.2, 0.3) (0.2, 0.3, 0.4) (0.3) (0.3, 0.4) and (0.4).\nNow given a sequence, you are supposed to find the sum of all the numbers in all the segments. For the previous example, the sum of all the 10 segments is 0.1 + 0.3 + 0.6 + 1.0 + 0.2 + 0.5 + 0.9 + 0.3 + 0.7 + 0.4 = 5.0.\nInput Specification: Each input file contains one test case. For each case, the first line gives a positive integer N, the size of the sequence which is no more than 10^5. The next line contains N positive numbers in the sequence, each no more than 1.0, separated by a space.\nOutput Specification: For each test case, print in one line the sum of all the numbers in all the segments, accurate up to 2 decimal places.\nSample Input: 4 0.1 0.2 0.3 0.4 Sample Output: 5.00 思路 包含第 i 个数的片段，其首指针有 i 中选择：1, 2, 3, \u0026hellip; i，其尾指针有 n - i + 1 中选择：i, i + 1, \u0026hellip; n。所以包含第 i 个数的片段有 i * (n - i + 1) 种。将 i 从 1 到 n 遍历，将包含每个数的片段数相加即可。 #include \u0026lt;cstdio\u0026gt; const int maxn = 100000; int main() { int n; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); double temp, ans = 0; for (int i = 1; i \u0026lt;= n; i++) { scanf(\u0026#34;%lf\u0026#34;, \u0026amp;temp); ans += temp * i * (n - i + 1); } printf(\u0026#34;%.2f\u0026#34;, ans); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1104/","summary":"\u003cp\u003eGiven a sequence of positive numbers, a segment is defined to be a consecutive subsequence. For example, given the sequence { 0.1, 0.2, 0.3, 0.4 }, we have 10 segments: (0.1) (0.1, 0.2) (0.1, 0.2, 0.3) (0.1, 0.2, 0.3, 0.4) (0.2) (0.2, 0.3) (0.2, 0.3, 0.4) (0.3) (0.3, 0.4) and (0.4).\u003c/p\u003e\n\u003cp\u003eNow given a sequence, you are supposed to find the sum of all the numbers in all the segments. For the previous example, the sum of all the 10 segments is 0.1 + 0.3 + 0.6 + 1.0 + 0.2 + 0.5 + 0.9 + 0.3 + 0.7 + 0.4 = 5.0.\u003c/p\u003e","title":"PAT甲级 1104 Sum of Number Segments (20分)"},{"content":"There is a classical process named partition in the famous quick sort algorithm. In this process we typically choose one element as the pivot. Then the elements less than the pivot are moved to its left and those larger than the pivot to its right. Given N distinct positive integers after a run of partition, could you tell how many elements could be the selected pivot for this partition?\nFor example, given N=5 and the numbers 1, 3, 2, 4, and 5. We have:\n1 could be the pivot since there is no element to its left and all the elements to its right are larger than it; 3 must not be the pivot since although all the elements to its left are smaller, the number 2 to its right is less than it as well; 2 must not be the pivot since although all the elements to its right are larger, the number 3 to its left is larger than it as well; and for the similar reason, 4 and 5 could also be the pivot. Hence in total there are 3 pivot candidates.\nInput Specification: Each input file contains one test case. For each case, the first line gives a positive integer N (≤10^5). Then the next line contains N distinct positive integers no larger than 10^9. The numbers in a line are separated by spaces.\nOutput Specification: For each test case, output in the first line the number of pivot candidates. Then in the next line print these candidates in increasing order. There must be exactly 1 space between two adjacent numbers, and no extra space at the end of each line.\nSample Input: 5 1 3 2 4 5 Sample Output: 3 1 4 5 思路 定义两个数组 leftMax[maxn] 和 leftMax[maxn]，leftMax[maxn] 用于记录序列中每一位左边的最大值，leftMax[maxn] 用于记录序列中每一位右边的最小值。如果 nums[i] 大于左边的最大值 leftMax[i] 且小于右边的最小值 rightMin[i]，那么 nums[i] 一定可以作为主元。 其中，leftMax[0] 应设为0，这样就假设了 nums[0] 左边没有比它大的元素；rightMin[n - 1] 应设为最大值 1 \u0026laquo; 31 - 1，这样就假设了 nums[n - 1] 右边没有比它小的元素。这样在给这两个数组赋值的过程中，相当于把初始最大值设为了 nums[0] 即 0，把初始最小值设为了 nums[n - 1] 即 1 \u0026laquo; 31 - 1。同时在判断主元时方便了边界元素的判断， 注意点 直接暴力判断的做法会超时 当主元个数为0时，第二行虽然没有输出主元，但必须输出一个换行（否则会有一个点格式错误\u0026hellip;） #include \u0026lt;cstdio\u0026gt; #include \u0026lt;vector\u0026gt; using namespace std; const int maxn = 100000; int main() { int n, nums[maxn], leftMax[maxn], rightMin[maxn]; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); leftMax[0] = 0; rightMin[n - 1] = 1 \u0026lt;\u0026lt; 31 - 1; for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;nums[i]); if (i != n - 1) { if (nums[i] \u0026gt; leftMax[i]) { leftMax[i + 1] = nums[i]; } else { leftMax[i + 1] = leftMax[i]; } } } for (int i = n - 1; i \u0026gt;= 1; i--) { if (nums[i] \u0026lt; rightMin[i]) { rightMin[i - 1] = nums[i]; } else { rightMin[i - 1] = rightMin[i]; } } vector\u0026lt;int\u0026gt; ans; for (int i = 0; i \u0026lt; n; i++) { if (nums[i] \u0026gt; leftMax[i] \u0026amp;\u0026amp; nums[i] \u0026lt; rightMin[i]) { ans.push_back(nums[i]); } } printf(\u0026#34;%d\\n\u0026#34;, ans.size()); for (int i = 0; i \u0026lt; ans.size(); i++) { printf(\u0026#34;%d\u0026#34;, ans[i]); if (i != ans.size() - 1) { printf(\u0026#34; \u0026#34;); } } printf(\u0026#34;\\n\u0026#34;); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1101/","summary":"\u003cp\u003eThere is a classical process named \u003cstrong\u003epartition\u003c/strong\u003e in the famous quick sort algorithm. In this process we typically choose one element as the pivot. Then the elements less than the pivot are moved to its left and those larger than the pivot to its right. Given \u003cem\u003eN\u003c/em\u003e distinct positive integers after a run of partition, could you tell how many elements could be the selected pivot for this partition?\u003c/p\u003e\n\u003cp\u003eFor example, given \u003cem\u003eN\u003c/em\u003e=5 and the numbers 1, 3, 2, 4, and 5. We have:\u003c/p\u003e","title":"PAT甲级 1101 Quick Sort (25分)"},{"content":"Given a pair of positive integers, for example, 6 and 110, can this equation 6 = 110 be true? The answer is yes, if 6 is a decimal number and 110 is a binary number.\nNow for any pair of positive integers N1 and N2, your task is to find the radix of one number while that of the other is given.\nInput Specification: Each input file contains one test case. Each case occupies a line which contains 4 positive integers:\nN1 N2 tag radix Here N1 and N2 each has no more than 10 digits. A digit is less than its radix and is chosen from the set { 0-9, a-z } where 0-9 represent the decimal numbers 0-9, and a-z represent the decimal numbers 10-35. The last number radix is the radix of N1 if tag is 1, or of N2 if tag is 2.\nOutput Specification: For each test case, print in one line the radix of the other number so that the equation N1 = N2 is true. If the equation is impossible, print Impossible. If the solution is not unique, output the smallest possible radix.\nSample Input 1: 6 110 1 10 Sample Output 1: 2 Sample Input 2: 1 ab 1 2 Sample Output 2: Impossible 思路 二分：对一个确定的数字串来说，它的进制越大，该数字串转换为十进制的结果也就越大。 注意点 使用遍历进制的暴力法会超时，因使用二分法。 本题的变量尽量使用 long long 类型。另外，经测试得到，本题中 radix 的范围最大为 INT_MAX ，即2^{31}-1，因此必须在在计算过程中判断是否溢出。 N2 进制的下界为所有数位中最大的那个+1，上界为 N1 的十进制（num1）与下界（lower）的较大值+1（即 max(num1, lower) + 1）。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; char n1[11], n2[11], temp[11]; int tag; long long radix, num1, inf = (1LL \u0026lt;\u0026lt; 63) - 1; long long strToNum(char str[], long long radix, long long upper) { int len = strlen(str); long long num = 0; for (int i = 0; i \u0026lt; len; i++) { long long digit; if (str[i] \u0026gt;= \u0026#39;a\u0026#39; \u0026amp;\u0026amp; str[i] \u0026lt;= \u0026#39;z\u0026#39;) { digit = str[i] - \u0026#39;a\u0026#39; + 10; } else { digit = str[i] - \u0026#39;0\u0026#39;; } num = num * radix + digit; if (num \u0026lt; 0 || num \u0026gt; upper) { return -1; } } return num; } long long findLower(char str[]) { long long maxDigit = -1; int len = strlen(str); for (int i = 0; i \u0026lt; len; i++) { long long digit; if (str[i] \u0026gt;= \u0026#39;a\u0026#39; \u0026amp;\u0026amp; str[i] \u0026lt;= \u0026#39;z\u0026#39;) { digit = str[i] - \u0026#39;a\u0026#39; + 10; } else { digit = str[i] - \u0026#39;0\u0026#39;; } if (digit \u0026gt; maxDigit) { maxDigit = digit; } } return maxDigit + 1; } int binarySearch(long long left, long long right, char str[], long long upper) { long long mid, num2; while (left \u0026lt;= right) { mid = left + (right - left) / 2; long long num2 = strToNum(n2, mid, upper); if (num2 == num1) { return mid; } else if (num2 \u0026gt; num1 || num2 == -1) { right = mid - 1; } else { left = mid + 1; } } return -1; } int main() { scanf(\u0026#34;%s %s %d %d\u0026#34;, n1, n2, \u0026amp;tag, \u0026amp;radix); if (tag == 2) { strcpy(temp, n1); strcpy(n1, n2); strcpy(n2, temp); } long long lower = findLower(n2); num1 = strToNum(n1, radix, inf); long long radix2 = binarySearch(lower, max(num1, lower) + 1, n2, num1); if (radix2 == -1) { printf(\u0026#34;Impossible\u0026#34;); } else { printf(\u0026#34;%d\u0026#34;, radix2); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1010/","summary":"\u003cp\u003eGiven a pair of positive integers, for example, 6 and 110, can this equation 6 = 110 be true? The answer is \u003ccode\u003eyes\u003c/code\u003e, if 6 is a decimal number and 110 is a binary number.\u003c/p\u003e\n\u003cp\u003eNow for any pair of positive integers \u003cem\u003eN\u003c/em\u003e1 and \u003cem\u003eN\u003c/em\u003e2, your task is to find the radix of one number while that of the other is given.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. Each case occupies a line which contains 4 positive integers:\u003c/p\u003e","title":"PAT甲级 1010 Radix (25分)"},{"content":"Given a sequence of positive integers and another positive integer p. The sequence is said to be a perfect sequence if M≤m×p where M and m are the maximum and minimum numbers in the sequence, respectively.\nNow given a sequence and a parameter p, you are supposed to find from the sequence as many numbers as possible to form a perfect subsequence.\nInput Specification: Each input file contains one test case. For each case, the first line contains two positive integers N and p, where N (≤10^5) is the number of integers in the sequence, and p (≤ 10^9 ) is the parameter. In the second line there are N positive integers, each is no greater than 10^9.\nOutput Specification: For each test case, print in one line the maximum number of integers that can be chosen to form a perfect subsequence.\nSample Input: 10 8 2 3 20 4 5 1 6 7 8 9 Sample Output: 8 思路 能使选出的数个数最大的方案，一定是在该递增序列中选择连续的若干个数的方案 如果强行进行O(n^2)的二重循环遍历，那么根据题目的数据范围，肯定是会超时的。这里有两种方法解决这个问题：二分查找和 two pointers。 本人利用 upper_bound() 函数来二分寻找第一个大于 m * p 的数的位置，那么 M 的最大数的位置即为该位置 -1。 注意点 nums[i] * p 可能达到 10^{18}，可以使用 long long 来定义数组。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 100000; int main() { int n; long long p, nums[maxn]; scanf(\u0026#34;%d %lld\u0026#34;, \u0026amp;n, \u0026amp;p); for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%lld\u0026#34;, \u0026amp;nums[i]); } sort(nums, nums + n); int ans = 0; long long m = nums[0]; for (int i = 0; i \u0026lt; n; i++) { int j = upper_bound(nums + i + 1, nums + n, nums[i] * p) - nums - 1; if (j - i + 1 \u0026gt; ans) { ans = j - i + 1; } } printf(\u0026#34;%d\u0026#34;, ans); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1085/","summary":"\u003cp\u003eGiven a sequence of positive integers and another positive integer \u003cem\u003ep\u003c/em\u003e. The sequence is said to be a \u003cstrong\u003eperfect sequence\u003c/strong\u003e if \u003cem\u003eM\u003c/em\u003e≤\u003cem\u003em\u003c/em\u003e×\u003cem\u003ep\u003c/em\u003e where \u003cem\u003eM\u003c/em\u003e and \u003cem\u003em\u003c/em\u003e are the maximum and minimum numbers in the sequence, respectively.\u003c/p\u003e\n\u003cp\u003eNow given a sequence and a parameter \u003cem\u003ep\u003c/em\u003e, you are supposed to find from the sequence as many numbers as possible to form a perfect subsequence.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. For each case, the first line contains two positive integers \u003cem\u003eN\u003c/em\u003e and \u003cem\u003ep\u003c/em\u003e, where \u003cem\u003eN\u003c/em\u003e (≤10^5) is the number of integers in the sequence, and \u003cem\u003ep\u003c/em\u003e (≤ 10^9 ) is the parameter. In the second line there are \u003cem\u003eN\u003c/em\u003e positive integers, each is no greater than 10^9.\u003c/p\u003e","title":"PAT甲级 1085 Perfect Sequence (25分)"},{"content":"Given a collection of number segments, you are supposed to recover the smallest number from them. For example, given { 32, 321, 3214, 0229, 87 }, we can recover many numbers such like 32-321-3214-0229-87 or 0229-32-87-321-3214 with respect to different orders of combinations of these segments, and the smallest number is 0229-321-3214-32-87.\nInput Specification: Each input file contains one test case. Each case gives a positive integer N (≤10^4) followed by N number segments. Each segment contains a non-negative integer of no more than 8 digits. All the numbers in a line are separated by a space.\nOutput Specification: For each test case, print the smallest number in one line. Notice that the first digit must not be zero.\nSample Input: 5 32 321 3214 0229 87 Sample Output: 22932132143287 思路 贪心：对字符串 s1 与 s2，如果 s1 + s2 \u0026lt; s2 + s1，那么把 s1 放在 s2 的前面。 注意点 结果串的所有前导零需要去掉。由于每个字符串都是非负的整数（non-negative），是有可能为 0 的，所以如果去除前导零后串的长度变为0，则输出0。 #include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 10000; int cmp(string s1, string s2) { return s1 + s2 \u0026lt; s2 + s1; } int main() { int n; string str[maxn]; cin \u0026gt;\u0026gt; n; for (int i = 0; i \u0026lt; n; i++) { cin \u0026gt;\u0026gt; str[i]; } sort(str, str + n, cmp); string ans; for (int i = 0; i \u0026lt; n; i++) { ans += str[i]; } while (ans.size() != 0 \u0026amp;\u0026amp; ans[0] == \u0026#39;0\u0026#39;) { ans.erase(ans.begin()); } if (ans.size() == 0) { cout \u0026lt;\u0026lt; 0; } else { cout \u0026lt;\u0026lt; ans; } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1038/","summary":"\u003cp\u003eGiven a collection of number segments, you are supposed to recover the smallest number from them. For example, given { 32, 321, 3214, 0229, 87 }, we can recover many numbers such like 32-321-3214-0229-87 or 0229-32-87-321-3214 with respect to different orders of combinations of these segments, and the smallest number is 0229-321-3214-32-87.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. Each case gives a positive integer \u003cem\u003eN\u003c/em\u003e (≤10^4) followed by \u003cem\u003eN\u003c/em\u003e number segments. Each segment contains a non-negative integer of no more than 8 digits. All the numbers in a line are separated by a space.\u003c/p\u003e","title":"PAT甲级 1038 Recover the Smallest Number (30分)"},{"content":"Given any permutation of the numbers {0, 1, 2,\u0026hellip;, N−1}, it is easy to sort them in increasing order. But what if Swap(0, *) is the ONLY operation that is allowed to use? For example, to sort {4, 0, 2, 1, 3} we may apply the swap operations in the following way:\nSwap(0, 1) =\u0026gt; {4, 1, 2, 0, 3} Swap(0, 3) =\u0026gt; {4, 1, 2, 3, 0} Swap(0, 4) =\u0026gt; {0, 1, 2, 3, 4} Now you are asked to find the minimum number of swaps need to sort the given permutation of the first N nonnegative integers.\nInput Specification: Each input file contains one test case, which gives a positive N (≤10^5) followed by a permutation sequence of {0, 1, \u0026hellip;, N−1}. All the numbers in a line are separated by a space.\nOutput Specification: For each case, simply print in a line the minimum number of swaps need to sort the given permutation.\nSample Input: 10 3 5 7 2 6 4 9 0 8 1 Sample Output: 9 思路 如果在交换过程中出现数字0在0号位的情况，就随意选择一个还没有回到“本位”的数字，让其与数字0交换位置 注意点 在循环中寻找一个不在本位上的数时，如果每次都从头开始遍历序列中的数，则会有两组数据超时（因为复杂度是二次方级别的）。合适的做法是从整体上定义一个变量 k，用来保存目前序列中不在本位上的最小数（初试为1），当交换过程中出现0回归本位的情况时，总是从当前的 k 开始继续增大寻找不在本位上的数，这样能保证复杂度从整体上是线性级别（k 从 1 增长到 n） 该题用一个 index[] 数组表示下标值所在的位置即可，无需原始数组 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 100000; int main() { int n, index[maxn], num, k = 1, ans = 0, cnt = 0; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;num); index[num] = i; if (index[num] != num \u0026amp;\u0026amp; num != 0) { cnt++; } } while (cnt != 0) { if (index[0] == 0) { for (; k \u0026lt; n; k++) { if (index[k] != k) { break; } } swap(index[0], index[k]); } else { swap(index[0], index[index[0]]); cnt--; } ans++; } printf(\u0026#34;%d\u0026#34;, ans); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1067/","summary":"\u003cp\u003eGiven any permutation of the numbers {0, 1, 2,\u0026hellip;, \u003cem\u003eN\u003c/em\u003e−1}, it is easy to sort them in increasing order. But what if \u003ccode\u003eSwap(0, *)\u003c/code\u003e is the ONLY operation that is allowed to use? For example, to sort {4, 0, 2, 1, 3} we may apply the swap operations in the following way:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eSwap(0, 1) =\u0026gt; {4, 1, 2, 0, 3}\nSwap(0, 3) =\u0026gt; {4, 1, 2, 3, 0}\nSwap(0, 4) =\u0026gt; {0, 1, 2, 3, 4}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow you are asked to find the minimum number of swaps need to sort the given permutation of the first \u003cem\u003eN\u003c/em\u003e nonnegative integers.\u003c/p\u003e","title":"PAT甲级 1067 Sort with Swap(0, i) (25分)"},{"content":"旧键盘上坏了几个键，于是在敲一段文字的时候，对应的字符就不会出现。现在给出应该输入的一段文字、以及坏掉的那些键，打出的结果文字会是怎样？\n输入格式： 输入在 2 行中分别给出坏掉的那些键、以及应该输入的文字。其中对应英文字母的坏键以大写给出；每段文字是不超过 10^5 个字符的串。可用的字符包括字母 [a-z, A-Z]、数字 0-9、以及下划线 _（代表空格）、,、.、-、+（代表上档键）。题目保证第 2 行输入的文字串非空。\n注意：如果上档键坏掉了，那么大写的英文字母无法被打出。\n输出格式： 在一行中输出能够被打出的结果文字。如果没有一个字符能被打出，则输出空行。\n输入样例： 7+IE. 7_This_is_a_test. 输出样例： _hs_s_a_tst 注意点 读入失效键位的时候要注意，可能没有失效的键位，即第一行为空行的情况。这时候不能用 scanf 输入，而要用 cin.getline(str, maxn) 输入字符串。 #include \u0026lt;iostream\u0026gt; #include \u0026lt;cstring\u0026gt; using namespace std; const int maxn = 100001; int main() { int hash_table[256] = {0}; char wrong[257], input[maxn]; cin.getline(wrong, 257); int len = strlen(wrong); for (int i = 0; i \u0026lt; len; i++) { if (wrong[i] \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; wrong[i] \u0026lt;= \u0026#39;Z\u0026#39;) { wrong[i] = wrong[i] - \u0026#39;A\u0026#39; + \u0026#39;a\u0026#39;; } hash_table[wrong[i]] = 1; } scanf(\u0026#34;%s\u0026#34;, input); len = strlen(input); for (int i = 0; i \u0026lt; len; i++) { if (input[i] \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; input[i] \u0026lt;= \u0026#39;Z\u0026#39;) { int low = input[i] - \u0026#39;A\u0026#39; + \u0026#39;a\u0026#39;; if (hash_table[low] == 0 \u0026amp;\u0026amp; hash_table[\u0026#39;+\u0026#39;] == 0) { printf(\u0026#34;%c\u0026#34;, input[i]); } } else if (hash_table[input[i]] == 0) { printf(\u0026#34;%c\u0026#34;, input[i]); } } printf(\u0026#34;\\n\u0026#34;); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/basic_level/b1033/","summary":"\u003cp\u003e旧键盘上坏了几个键，于是在敲一段文字的时候，对应的字符就不会出现。现在给出应该输入的一段文字、以及坏掉的那些键，打出的结果文字会是怎样？\u003c/p\u003e\n\u003ch1 id=\"输入格式\"\u003e输入格式：\u003c/h1\u003e\n\u003cp\u003e输入在 2 行中分别给出坏掉的那些键、以及应该输入的文字。其中对应英文字母的坏键以大写给出；每段文字是不超过 10^5 个字符的串。可用的字符包括字母 [\u003ccode\u003ea\u003c/code\u003e-\u003ccode\u003ez\u003c/code\u003e, \u003ccode\u003eA\u003c/code\u003e-\u003ccode\u003eZ\u003c/code\u003e]、数字 \u003ccode\u003e0\u003c/code\u003e-\u003ccode\u003e9\u003c/code\u003e、以及下划线 \u003ccode\u003e_\u003c/code\u003e（代表空格）、\u003ccode\u003e,\u003c/code\u003e、\u003ccode\u003e.\u003c/code\u003e、\u003ccode\u003e-\u003c/code\u003e、\u003ccode\u003e+\u003c/code\u003e（代表上档键）。题目保证第 2 行输入的文字串非空。\u003c/p\u003e\n\u003cp\u003e注意：如果上档键坏掉了，那么大写的英文字母无法被打出。\u003c/p\u003e\n\u003ch1 id=\"输出格式\"\u003e输出格式：\u003c/h1\u003e\n\u003cp\u003e在一行中输出能够被打出的结果文字。如果没有一个字符能被打出，则输出空行。\u003c/p\u003e\n\u003ch1 id=\"输入样例\"\u003e输入样例：\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-in\" data-lang=\"in\"\u003e7+IE.\n7_This_is_a_test.\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"输出样例\"\u003e输出样例：\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-out\" data-lang=\"out\"\u003e_hs_s_a_tst\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"注意点\"\u003e注意点\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e读入失效键位的时候要注意，可能没有失效的键位，即第一行为空行的情况。这时候不能用 scanf 输入，而要用 cin.getline(str, maxn) 输入字符串。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;iostream\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;cstring\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enamespace\u003c/span\u003e std;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e maxn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100001\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e hash_table[\u003cspan style=\"color:#ae81ff\"\u003e256\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003echar\u003c/span\u003e wrong[\u003cspan style=\"color:#ae81ff\"\u003e257\u003c/span\u003e], input[maxn];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cin.getline(wrong, \u003cspan style=\"color:#ae81ff\"\u003e257\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e len \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e strlen(wrong);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (wrong[i] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e wrong[i] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Z\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            wrong[i] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e wrong[i] \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        hash_table[wrong[i]] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    scanf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%s\u0026#34;\u003c/span\u003e, input);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    len \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e strlen(input);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e len; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (input[i] \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e input[i] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Z\u0026#39;\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e low \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e input[i] \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (hash_table[low] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e hash_table[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;+\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%c\u0026#34;\u003c/span\u003e, input[i]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (hash_table[input[i]] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%c\u0026#34;\u003c/span\u003e, input[i]);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e\\n\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"PAT乙级 1033 旧键盘打字 (20分)"},{"content":"章节概要 掌握 API 网关服务聚合功能的实现 掌握 Mybatis-plus 自定义 SQL 实现 掌握 Dubbo 异步调用 服务聚合 服务聚合就是将多个服务调用封装 服务聚合可以简化前端调用方式 服务聚合提供更好的安全性、可扩展性 业务功能开发流程 根据接口文档思考功能列表 实现 API 接口和实体 服务提供者实现 影片模块创建 从 guns-user 拷贝一份重命名为 guns-film，修改相关配置\nAPI 网关功能聚合 优点 六个接口，一次请求，同一时刻节省了5次HTTP请求 同一个接口对外暴露，降低了前后端分离开发的难度和复杂度 缺点： 一次获取数据过多，容易出现问题 如 gateway 中的影片模块的获取首页信息接口，将 filmServiceApi 的多个方法所获得的对象聚合为 FilmIndexVO 对象返回给前端，将原本需要的多个接口聚合为一个 /film/getIndex 接口，避免了前端对不同接口的多次调用。\n@RequestMapping(value = \u0026#34;getIndex\u0026#34;, method = RequestMethod.GET) public ResponseVO getIndex() { FilmIndexVO filmIndexVO = new FilmIndexVO(); // 获取banner信息 filmIndexVO.setBanners(filmServiceApi.getBanners()); // 获取热映的影片 filmIndexVO.setHotFilms(filmServiceApi.getHotFilms(true, 99, 99, 99, 99, 1, 8)); // 获取即将上映的影片 filmIndexVO.setSoonFilms(filmServiceApi.getSoonFilms(true, 99, 99, 99, 99, 1, 8)); // 获取票房排行榜 filmIndexVO.setBoxRanking(filmServiceApi.getBoxRanking()); // 获取人气榜单 filmIndexVO.setExpectRanking(filmServiceApi.getExpectRanking()); // 获取排行前100影片 filmIndexVO.setTop100(filmServiceApi.getTop()); return ResponseVO.success(IMG_PRE, filmIndexVO); } Mybatis-plus 自定义 SQL 实现 在相应的 Mapper 接口中添加方法\npublic interface ActorTMapper extends BaseMapper\u0026lt;ActorT\u0026gt; { List\u0026lt;ActorVO\u0026gt; getActors(@Param(\u0026#34;filmId\u0026#34;) String filmId); } 在相应的 Mapper xml 配置文件中添加 select 语句\n\u0026lt;mapper namespace=\u0026#34;com.stylefeng.guns.rest.common.persistence.dao.ActorTMapper\u0026#34;\u0026gt; \u0026lt;!-- 通用查询映射结果 --\u0026gt; \u0026lt;resultMap id=\u0026#34;BaseResultMap\u0026#34; type=\u0026#34;com.stylefeng.guns.rest.common.persistence.model.ActorT\u0026#34;\u0026gt; \u0026lt;id column=\u0026#34;UUID\u0026#34; property=\u0026#34;uuid\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;actor_name\u0026#34; property=\u0026#34;actorName\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;actor_img\u0026#34; property=\u0026#34;actorImg\u0026#34; /\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;select id=\u0026#34;getActors\u0026#34; parameterType=\u0026#34;java.lang.String\u0026#34; resultType=\u0026#34;com.stylefeng.guns.api.film.vo.ActorVO\u0026#34;\u0026gt; SELECT actor_img AS imgAddress, actor_name AS directorName, role_name AS roleName FROM actor_t, film_actor_t WHERE actor_t.UUID = film_actor_t.actor_id AND film_actor_t.film_id = ${filmId} \u0026lt;/select\u0026gt; \u0026lt;/mapper\u0026gt; 这样，就能执行自定义 SQL 语句了，其实就是普通版 Mybatis 的正常使用而已\u0026hellip;\nDubbo 异步调用 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/async-call.html\n异步调用 异步调用利用 NIO 的非阻塞特性实现服务调用并行。\n使用RpcContext 配置（Spring） 服务端服务级别 \u0026lt;dubbo:service interface=\u0026#34;...\u0026#34; async=\u0026#34;true\u0026#34; /\u0026gt; 客户端服务级别 \u0026lt;dubbo:reference interface=\u0026#34;...\u0026#34; async=\u0026#34;true\u0026#34; /\u0026gt; 服务端方法级别 \u0026lt;dubbo:service interface=\u0026#34;...\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;...\u0026#34; async=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/dubbo:service\u0026gt; 客户端方法级别 \u0026lt;dubbo:reference interface=\u0026#34;...\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;...\u0026#34; async=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 配置（SpringBoot） SpringBoot 的配置放在注解中，但只有服务级别，并没有方法级别。\n服务端服务级别 @Service(interfaceClass = xxx.class, async = true) 客户端服务级别 @Reference(interfaceClass = xxx.class, async = true) 使用RpcContext 在 consumer.xml 中配置方法级别的异步调用：\n\u0026lt;dubbo:reference id=\u0026#34;asyncService\u0026#34; interface=\u0026#34;org.apache.dubbo.samples.governance.api.AsyncService\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;sayHello\u0026#34; async=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/dubbo:reference\u0026gt; 调用代码:\n// 此调用会立即返回null asyncService.sayHello(\u0026#34;world\u0026#34;); // 拿到调用的Future引用，当结果返回后，会被通知和设置到此Future CompletableFuture\u0026lt;String\u0026gt; helloFuture = RpcContext.getContext().getCompletableFuture(); // 为Future添加回调 helloFuture.whenComplete((retValue, exception) -\u0026gt; { if (exception == null) { System.out.println(retValue); } else { exception.printStackTrace(); } }); 或者，你也可以这样做异步调用:\nCompletableFuture\u0026lt;String\u0026gt; future = RpcContext.getContext().asyncCall( () -\u0026gt; { asyncService.sayHello(\u0026#34;oneway call request1\u0026#34;); } ); future.get(); 需要注意的是，这里 asyncService.sayHello(\u0026ldquo;world\u0026rdquo;) 返回的是 null，不能通过该返回值获取结果，所有 asyncService 接口的 sayHello() 方法调用都需要通过 future 来获取结果。\nSpringBoot中 由于 SpringBoot 没有方法级别的注解可以配置 async 参数，但如果加在服务级别，即客户端的 @Reference 或者服务端的 @Service 上，又会影响不需要使用异步调用的地方。\n所以，可以通过在 api 中再创建一个专门用于异步调用的接口来声明需要异步调用的方法。\npublic interface FilmAsyncServiceApi { FilmDescVO getFilmDesc(String filmId); ActorVO getDirectorInfo(String filmId); List\u0026lt;ActorVO\u0026gt; getActors(String filmId); } 同时，在服务端中再创建一个用于异步调用的实现类。\n@Component @Service(interfaceClass = FilmAsyncServiceApi.class) public class DefaultFilmAsyncServiceImpl implements FilmAsyncServiceApi { @Override public FilmDescVO getFilmDesc(String filmId) { ... } @Override public ActorVO getDirectorInfo(String filmId) { ... } @Override public List\u0026lt;ActorVO\u0026gt; getActors(String filmId) { ... } } 最后，在 API 网关的 Controller 中声明异步调用的接口，并使用 RpcContext 实现异步调用\n@RequestMapping(value = \u0026#34;films/{searchParam}\u0026#34;, method = RequestMethod.GET) public ResponseVO films(@PathVariable(\u0026#34;searchParam\u0026#34;) String searchParam, int searchType) throws ExecutionException, InterruptedException { filmAsyncServiceApi.getFilmDesc(filmId); Future\u0026lt;FilmDescVO\u0026gt; filmDescVOFuture = RpcContext.getContext().getFuture(); filmAsyncServiceApi.getDirectorInfo(filmId); Future\u0026lt;ActorVO\u0026gt; directorVOFuture = RpcContext.getContext().getFuture(); filmAsyncServiceApi.getActors(filmId); Future\u0026lt;List\u0026lt;ActorVO\u0026gt;\u0026gt; actorsFuture = RpcContext.getContext().getFuture(); /* 省略无关代码... */ actorRequestVO.setDirector(directorVOFuture.get()); actorRequestVO.setActors(actorsFuture.get()); infoRequestVO.setBiography(filmDescVOFuture.get().getBiography()); /* 省略无关代码... */ } 需要注意的是，SpringBoot 还需要在 Application 上添加 @EnableAsync 注解\n@SpringBootApplication(scanBasePackages = {\u0026#34;com.stylefeng.guns\u0026#34;}) @EnableDubboConfiguration @EnableAsync public class GatewayApplication { public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args); } } 总结 API 网关的服务聚合 Dubbo 特性：异步调用 Mybatis-plus 自定义 SQL 实现 ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/6.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E5%BD%B1%E7%89%87%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e掌握 API 网关服务聚合功能的实现\u003c/li\u003e\n\u003cli\u003e掌握 Mybatis-plus 自定义 SQL 实现\u003c/li\u003e\n\u003cli\u003e掌握 Dubbo 异步调用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"服务聚合\"\u003e服务聚合\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e服务聚合就是将多个服务调用封装\u003c/li\u003e\n\u003cli\u003e服务聚合可以简化前端调用方式\u003c/li\u003e\n\u003cli\u003e服务聚合提供更好的安全性、可扩展性\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"业务功能开发流程\"\u003e业务功能开发流程\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e根据接口文档思考功能列表\u003c/li\u003e\n\u003cli\u003e实现 API 接口和实体\u003c/li\u003e\n\u003cli\u003e服务提供者实现\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"影片模块创建\"\u003e影片模块创建\u003c/h1\u003e\n\u003cp\u003e从 guns-user 拷贝一份重命名为 guns-film，修改相关配置\u003c/p\u003e\n\u003ch1 id=\"api-网关功能聚合\"\u003eAPI 网关功能聚合\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e优点\n\u003col\u003e\n\u003cli\u003e六个接口，一次请求，同一时刻节省了5次HTTP请求\u003c/li\u003e\n\u003cli\u003e同一个接口对外暴露，降低了前后端分离开发的难度和复杂度\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e缺点：\n\u003col\u003e\n\u003cli\u003e一次获取数据过多，容易出现问题\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e如 gateway 中的影片模块的获取首页信息接口，将 filmServiceApi 的多个方法所获得的对象聚合为 FilmIndexVO 对象返回给前端，将原本需要的多个接口聚合为一个 /film/getIndex 接口，避免了前端对不同接口的多次调用。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@RequestMapping\u003c/span\u003e(value \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;getIndex\u0026#34;\u003c/span\u003e, method \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RequestMethod.\u003cspan style=\"color:#a6e22e\"\u003eGET\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e ResponseVO \u003cspan style=\"color:#a6e22e\"\u003egetIndex\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        FilmIndexVO filmIndexVO \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e FilmIndexVO();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取banner信息\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetBanners\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetBanners\u003c/span\u003e());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取热映的影片\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetHotFilms\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetHotFilms\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e, 99, 99, 99, 99, 1, 8));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取即将上映的影片\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetSoonFilms\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetSoonFilms\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e, 99, 99, 99, 99, 1, 8));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取票房排行榜\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetBoxRanking\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetBoxRanking\u003c/span\u003e());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取人气榜单\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetExpectRanking\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetExpectRanking\u003c/span\u003e());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e// 获取排行前100影片\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        filmIndexVO.\u003cspan style=\"color:#a6e22e\"\u003esetTop100\u003c/span\u003e(filmServiceApi.\u003cspan style=\"color:#a6e22e\"\u003egetTop\u003c/span\u003e());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e ResponseVO.\u003cspan style=\"color:#a6e22e\"\u003esuccess\u003c/span\u003e(IMG_PRE, filmIndexVO);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"mybatis-plus-自定义-sql-实现\"\u003eMybatis-plus 自定义 SQL 实现\u003c/h1\u003e\n\u003cp\u003e在相应的 Mapper 接口中添加方法\u003c/p\u003e","title":"Dubbo微服务影院系列（6）：Dubbo服务开发（影片模块开发）"},{"content":"With highways available, driving a car from Hangzhou to any other city is easy. But since the tank capacity of a car is limited, we have to find gas stations on the way from time to time. Different gas station may give different price. You are asked to carefully design the cheapest route to go.\nInput Specification: Each input file contains one test case. For each case, the first line contains 4 positive numbers: Cmax (≤ 100), the maximum capacity of the tank; D (≤30000), the distance between Hangzhou and the destination city; Davg (≤20), the average distance per unit gas that the car can run; and N (≤ 500), the total number of gas stations. Then N lines follow, each contains a pair of non-negative numbers: Pi, the unit gas price, and Di (≤D), the distance between this station and Hangzhou, for i=1,⋯,N. All the numbers in a line are separated by a space.\nOutput Specification: For each test case, print the cheapest price in a line, accurate up to 2 decimal places. It is assumed that the tank is empty at the beginning. If it is impossible to reach the destination, print The maximum travel distance = X where X is the maximum possible distance the car can run, accurate up to 2 decimal places.\nSample Input 1: 50 1300 12 8 6.00 1250 7.00 600 7.00 150 7.10 0 7.20 200 7.50 400 7.30 1000 6.85 300 Sample Output 1: 749.17 Sample Input 2: 50 1300 12 2 7.10 0 7.00 600 Sample Output 2: The maximum travel distance = 1200.00 思路 把终点视为单位油价为0，离起点距离为 destD 的加油站（以便在最后选择下一站时，能够直接选到终点） 贪心：寻找距离当前加油站最近的油价低于当前油价的加油站，加恰好能够到达该加油站的油，然后前往该加油站；如果找不到油价低于当前油价的加油站，则寻找油价最低的加油站，在当前加油站加满油，然后前往该加油站 注意点 在距离为0处必须有加油站，否则无法出发，一定无法到达终点 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 501; struct Station { double P; double D; } stations[maxn]; int cmp(Station s1, Station s2) { return s1.D \u0026lt; s2.D; } int main() { double capacity, destD, avgD, nowC = 0, nowD = 0, cost = 0; int n, nowIndex = 0; scanf(\u0026#34;%lf %lf %lf %d\u0026#34;, \u0026amp;capacity, \u0026amp;destD, \u0026amp;avgD, \u0026amp;n); for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%lf %lf\u0026#34;, \u0026amp;stations[i].P, \u0026amp;stations[i].D); } stations[n].P = 0; stations[n].D = destD; sort(stations, stations + n, cmp); if (stations[0].D != 0) { printf(\u0026#34;The maximum travel distance = 0.00\u0026#34;); } else { while (nowD \u0026lt; destD) { if (nowIndex == n - 1 \u0026amp;\u0026amp; (capacity * avgD \u0026lt; (destD - nowD)) || (nowIndex \u0026lt; n - 1) \u0026amp;\u0026amp; (capacity * avgD \u0026lt; (stations[nowIndex + 1].D - nowD))) { nowD += capacity * avgD; break; } double minP = stations[nowIndex].P, secondP = stations[nowIndex + 1].P; int minIndex = -1, secondIndex = nowIndex + 1; for (int i = nowIndex + 1; i \u0026lt;= n; i++) { if (capacity * avgD \u0026gt;= (stations[i].D - nowD)) { if (stations[i].P \u0026lt; minP) { minP = stations[i].P; minIndex = i; break; } else if (stations[i].P \u0026lt; secondP) { secondP = stations[i].P; secondIndex = i; } } else { break; } } if (minIndex != -1) { if (nowC * avgD \u0026lt; (stations[minIndex].D - nowD)) { cost += ((stations[minIndex].D - nowD) / avgD - nowC) * stations[nowIndex].P; nowC = 0; } else { nowC -= (stations[minIndex].D - nowD) / avgD; } nowD = stations[minIndex].D; nowIndex = minIndex; } else { cost += (capacity - nowC) * stations[nowIndex].P; nowC = capacity - (stations[secondIndex].D - nowD) / avgD; nowD = stations[secondIndex].D; nowIndex = secondIndex; } } if (nowD \u0026lt; destD) { printf(\u0026#34;The maximum travel distance = %.2f\u0026#34;, nowD); } else { printf(\u0026#34;%.2f\u0026#34;, cost); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1033/","summary":"\u003cp\u003eWith highways available, driving a car from Hangzhou to any other city is easy. But since the tank capacity of a car is limited, we have to find gas stations on the way from time to time. Different gas station may give different price. You are asked to carefully design the cheapest route to go.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eEach input file contains one test case. For each case, the first line contains 4 positive numbers: \u003cem\u003eCmax\u003c/em\u003e (≤ 100), the maximum capacity of the tank; \u003cem\u003eD\u003c/em\u003e (≤30000), the distance between Hangzhou and the destination city; \u003cem\u003eDavg\u003c/em\u003e (≤20), the average distance per unit gas that the car can run; and \u003cem\u003eN\u003c/em\u003e (≤ 500), the total number of gas stations. Then \u003cem\u003eN\u003c/em\u003e lines follow, each contains a pair of non-negative numbers: \u003cem\u003ePi\u003c/em\u003e, the unit gas price, and \u003cem\u003eDi\u003c/em\u003e (≤\u003cem\u003eD\u003c/em\u003e), the distance between this station and Hangzhou, for \u003cem\u003ei\u003c/em\u003e=1,⋯,\u003cem\u003eN\u003c/em\u003e. All the numbers in a line are separated by a space.\u003c/p\u003e","title":"PAT甲级 1033 To Fill or Not to Fill (25分)"},{"content":"Zhejiang University has 8 campuses and a lot of gates. From each gate we can collect the in/out times and the plate numbers of the cars crossing the gate. Now with all the information available, you are supposed to tell, at any specific time point, the number of cars parking on campus, and at the end of the day find the cars that have parked for the longest time period.\nInput Specification: Each input file contains one test case. Each case starts with two positive integers N (≤ {10^4}), the number of records, and K (≤ 8×10^4) the number of queries. Then N lines follow, each gives a record in the format:\nplate_number hh:mm:ss status where plate_number is a string of 7 English capital letters or 1-digit numbers; hh:mm:ss represents the time point in a day by hour:minute:second, with the earliest time being 00:00:00 and the latest 23:59:59; and status is either in or out.\nNote that all times will be within a single day. Each in record is paired with the chronologically next record for the same car provided it is an out record. Any in records that are not paired with an out record are ignored, as are out records not paired with an in record. It is guaranteed that at least one car is well paired in the input, and no car is both in and out at the same moment. Times are recorded using a 24-hour clock.\nThen K lines of queries follow, each gives a time point in the format hh:mm:ss. Note: the queries are given in ascending order of the times.\nOutput Specification: For each query, output in a line the total number of cars parking on campus. The last line of output is supposed to give the plate number of the car that has parked for the longest time period, and the corresponding time length. If such a car is not unique, then output all of their plate numbers in a line in alphabetical order, separated by a space.\nSample Input: 16 7 JH007BD 18:00:01 in ZD00001 11:30:08 out DB8888A 13:00:00 out ZA3Q625 23:59:50 out ZA133CH 10:23:00 in ZD00001 04:09:59 in JH007BD 05:09:59 in ZA3Q625 11:42:01 out JH007BD 05:10:33 in ZA3Q625 06:30:50 in JH007BD 12:23:42 out ZA3Q625 23:55:00 in JH007BD 12:24:23 out ZA133CH 17:11:22 out JH007BD 18:07:01 out DB8888A 06:30:50 in 05:10:00 06:30:50 11:00:00 12:23:42 14:00:00 18:00:00 23:59:00 Sample Output: 1 4 5 2 1 0 1 JH007BD ZD00001 07:20:09 思路 将时间统一转换为秒，方便比较；将 “in” 状态表示为1，“out” 状态表示为-1，方便停车数 cnt 的计算（即 cnt += status） 将记录的结构体数组，根据先 id，后 time 的顺序进行排序。然后从中找出合法的记录，加入 vector，顺便用 map\u0026lt;string, int\u0026gt; 存储各个车辆的总停车时长，并记录最大中停车时长 然后输入查询时间，每输入一个查询 id，就接着上次遍历这个 vector，一边遍历，一边计算当前停车数 cnt，直到当前时间大于查询时间，即可输出 cnt 最后，再遍历一遍 map，输出所有等于 maxLen 的车辆 id（map 已根据 id 的字母顺序自动排序） 注意点 最长停车时长（parked for the longest time period），指的是一辆车在一天中的总停车时长，而不是指某一次停车的时长 如果一辆车多次 in，应该取最后一个 in 记录；如果一辆车多次 out，应该取第一个 out 记录 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; #include \u0026lt;algorithm\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;map\u0026gt; using namespace std; const int maxn = 10000; struct Record { char id[8]; int time, status; } records[maxn]; vector\u0026lt;Record\u0026gt; vec; map\u0026lt;string, int\u0026gt; lenMap; int cmpByIdAndTime(Record r1, Record r2) { int strCmp = strcmp(r1.id, r2.id); if (strCmp != 0) { return strCmp \u0026lt; 0; } else { return r1.time \u0026lt; r2.time; } } int cmpByTime(Record r1, Record r2) { return r1.time \u0026lt; r2.time; } int main() { int n, k, hour, min, sec, time, cnt = 0, maxLen = -1, j = 0; scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;n, \u0026amp;k); char status[3]; for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%s %d:%d:%d %s\u0026#34;, records[i].id, \u0026amp;hour, \u0026amp;min, \u0026amp;sec, status); records[i].time = hour * 3600 + min * 60 + sec; if (strcmp(status, \u0026#34;in\u0026#34;) == 0) { records[i].status = 1; } else { records[i].status = -1; } } sort(records, records + n, cmpByIdAndTime); for (int i = 1; i \u0026lt; n; i++) { if (strcmp(records[i].id, records[i - 1].id) == 0 \u0026amp;\u0026amp; records[i - 1].status == 1 \u0026amp;\u0026amp; records[i].status == -1) { vec.push_back(records[i - 1]); vec.push_back(records[i]); lenMap[records[i].id] += records[i].time - records[i - 1].time; if (lenMap[records[i].id] \u0026gt; maxLen) { maxLen = lenMap[records[i].id]; } } } sort(vec.begin(), vec.end(), cmpByTime); for (int i = 0; i \u0026lt; k; i++) { scanf(\u0026#34;%d:%d:%d\u0026#34;, \u0026amp;hour, \u0026amp;min, \u0026amp;sec); time = hour * 60 * 60 + min * 60 + sec; while (j \u0026lt; vec.size() \u0026amp;\u0026amp; vec[j].time \u0026lt;= time) { cnt += vec[j].status; j++; } printf(\u0026#34;%d\\n\u0026#34;, cnt); } for (auto it : lenMap) { if (it.second == maxLen) { printf(\u0026#34;%s \u0026#34;, it.first.c_str()); } } printf(\u0026#34;%02d:%02d:%02d\u0026#34;, maxLen / 3600, maxLen % 3600 / 60, maxLen % 60); return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1095/","summary":"\u003cp\u003eZhejiang University has 8 campuses and a lot of gates. From each gate we can collect the in/out times and the plate numbers of the cars crossing the gate. Now with all the information available, you are supposed to tell, at any specific time point, the number of cars parking on campus, and at the end of the day find the cars that have parked for the longest time period.\u003c/p\u003e","title":"PAT甲级 1095 Cars on Campus (30分)"},{"content":"A long-distance telephone company charges its customers by the following rules:\nMaking a long-distance call costs a certain amount per minute, depending on the time of day when the call is made. When a customer starts connecting a long-distance call, the time will be recorded, and so will be the time when the customer hangs up the phone. Every calendar month, a bill is sent to the customer for each minute called (at a rate determined by the time of day). Your job is to prepare the bills for each month, given a set of phone call records.\nInput Specification: Each input file contains one test case. Each case has two parts: the rate structure, and the phone call records.\nThe rate structure consists of a line with 24 non-negative integers denoting the toll (cents/minute) from 00:00 - 01:00, the toll from 01:00 - 02:00, and so on for each hour in the day.\nThe next line contains a positive number N (≤1000), followed by N lines of records. Each phone call record consists of the name of the customer (string of up to 20 characters without space), the time and date (mm:dd:hh:mm), and the word on-line or off-line.\nFor each test case, all dates will be within a single month. Each on-line record is paired with the chronologically next record for the same customer provided it is an off-line record. Any on-line records that are not paired with an off-line record are ignored, as are off-line records not paired with an on-line record. It is guaranteed that at least one call is well paired in the input. You may assume that no two records for the same customer have the same time. Times are recorded using a 24-hour clock.\nOutput Specification: For each test case, you must print a phone bill for each customer.\nBills must be printed in alphabetical order of customers\u0026rsquo; names. For each customer, first print in a line the name of the customer and the month of the bill in the format shown by the sample. Then for each time period of a call, print in one line the beginning and ending time and date (dd:hh:mm), the lasting time (in minute) and the charge of the call. The calls must be listed in chronological order. Finally, print the total charge for the month in the format shown by the sample.\nSample Input: 10 10 10 10 10 10 20 20 20 15 15 15 15 15 15 15 20 30 20 15 15 10 10 10 10 CYLL 01:01:06:01 on-line CYLL 01:28:16:05 off-line CYJJ 01:01:07:00 off-line CYLL 01:01:08:03 off-line CYJJ 01:01:05:59 on-line aaa 01:01:01:03 on-line aaa 01:02:00:01 on-line CYLL 01:28:15:41 on-line aaa 01:05:02:24 on-line aaa 01:04:23:59 off-line Sample Output: CYJJ 01 01:05:59 01:07:00 61 $12.10 Total amount: $12.10 CYLL 01 01:06:01 01:08:03 122 $24.40 28:15:41 28:16:05 24 $3.85 Total amount: $28.25 aaa 01 02:00:01 04:23:59 4318 $638.80 Total amount: $638.80 思路 将通话记录，先根据姓名，再根据时间先后，进行排序。这样相同名字的记录就会排在一起，且其中的数据也是按照时间顺序的。 为了方便计算某一组通话的时长，可以把记录的时间都换算为相对于 00:00:00 的分钟数，则挂电话时间减去接电话时间，即为通话时长 为了方便计算某一组通话的费用，可以把挂电话相对于 00:00:00 的费用减去接电话相对于 00:00:00 的费用，即为该通话的费用 #include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;map\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 2000; int n, rate[25] = {0}; struct Record { string name; int month, day, hour, min, time, status; } records[maxn]; double getCostFromZero(Record \u0026amp;r) { double cost = 0; cost += (r.day - 1) * 60 * rate[24] + r.min * rate[r.hour]; for (int i = 0; i \u0026lt;= r.hour - 1; i++) { cost += rate[i] * 60; } return cost; } int cmp(Record r1, Record r2) { if (r1.name != r2.name) { return r1.name \u0026lt; r2.name; } else { return r1.time \u0026lt; r2.time; } } int main() { for (int i = 0; i \u0026lt; 24; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;rate[i]); rate[24] += rate[i]; } scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); string status; for (int i = 0; i \u0026lt; n; i++) { cin \u0026gt;\u0026gt; records[i].name; scanf(\u0026#34;%d:%d:%d:%d\u0026#34;, \u0026amp;records[i].month, \u0026amp;records[i].day, \u0026amp;records[i].hour, \u0026amp;records[i].min); records[i].time = records[i].day * 24 * 60 + records[i].hour * 60 + records[i].min; cin \u0026gt;\u0026gt; status; if (status == \u0026#34;on-line\u0026#34;) { records[i].status = 1; } else { records[i].status = 0; } } sort(records, records + n, cmp); map\u0026lt;string, vector\u0026lt;Record\u0026gt; \u0026gt; nameRecords; for (int i = 1; i \u0026lt; n; i++) { if (records[i].name == records[i - 1].name \u0026amp;\u0026amp; records[i - 1].status == 1 \u0026amp;\u0026amp; records[i].status == 0) { nameRecords[records[i].name].push_back(records[i - 1]); nameRecords[records[i].name].push_back(records[i]); } } for (auto it : nameRecords) { vector\u0026lt;Record\u0026gt; temp = it.second; printf(\u0026#34;%s %02d\\n\u0026#34;, it.first.c_str(), temp[0].month); double totalCost = 0; for (int i = 0; i \u0026lt; temp.size(); i += 2) { double cost = getCostFromZero(temp[i + 1]) - getCostFromZero(temp[i]); printf(\u0026#34;%02d:%02d:%02d %02d:%02d:%02d %d $%.2f\\n\u0026#34;, temp[i].day, temp[i].hour, temp[i].min, temp[i + 1].day, temp[i + 1].hour, temp[i + 1].min, temp[i + 1].time - temp[i].time, cost / 100); totalCost += cost; } printf(\u0026#34;Total amount: $%.2f\\n\u0026#34;, totalCost / 100); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1016/","summary":"\u003cp\u003eA long-distance telephone company charges its customers by the following rules:\u003c/p\u003e\n\u003cp\u003eMaking a long-distance call costs a certain amount per minute, depending on the time of day when the call is made. When a customer starts connecting a long-distance call, the time will be recorded, and so will be the time when the customer hangs up the phone. Every calendar month, a bill is sent to the customer for each minute called (at a rate determined by the time of day). Your job is to prepare the bills for each month, given a set of phone call records.\u003c/p\u003e","title":"PAT甲级 1016 Phone Bills (25分)"},{"content":"To evaluate the performance of our first year CS majored students, we consider their grades of three courses only: C - C Programming Language, M - Mathematics (Calculus or Linear Algrbra), and E - English. At the mean time, we encourage students by emphasizing on their best ranks \u0026ndash; that is, among the four ranks with respect to the three courses and the average grade, we print the best rank for each student.\nFor example, The grades of C, M, E and A - Average of 4 students are given as the following:\nStudentID C M E A 310101 98 85 88 90 310102 70 95 88 84 310103 82 87 94 88 310104 91 91 91 91 Then the best ranks for all the students are No.1 since the 1st one has done the best in C Programming Language, while the 2nd one in Mathematics, the 3rd one in English, and the last one in average.\nInput Specification: Each input file contains one test case. Each case starts with a line containing 2 numbers N and M (≤2000), which are the total number of students, and the number of students who would check their ranks, respectively. Then N lines follow, each contains a student ID which is a string of 6 digits, followed by the three integer grades (in the range of [0, 100]) of that student in the order of C, M and E. Then there are M lines, each containing a student ID.\nOutput Specification: For each of the M students, print in one line the best rank for him/her, and the symbol of the corresponding rank, separated by a space.\nThe priorities of the ranking methods are ordered as A \u0026gt; C \u0026gt; M \u0026gt; E. Hence if there are two or more ways for a student to obtain the same best rank, output the one with the highest priority.\nIf a student is not on the grading list, simply output N/A.\nSample Input: 5 6 310101 98 85 88 310102 70 95 88 310103 82 87 94 310104 91 91 91 310105 85 90 90 310101 310102 310103 310104 310105 999999 Sample Output: 1 C 1 M 1 E 1 A 3 A N/A 思路 本题主要在于数据的存取方式，先用 Stu 结构体数组来存储每个考生的 id 和用来存储其各科分数的数组，并对该结构体数组根据各科分数进行排序，每排序一次就将其排序结果写入排名数组 ranks，最后根据查询 id，输出最高排名信息即可 以结构体 Stu 存放 id 和 score[4] 数组，score[0] ~ score[3] 分别代表 A，C，M，E 由于 id 是 6 位的整数（6 digits），不妨设置 ranks [1000000] [4] 数组，其中 ranks [id] [0] ~ ranks [id] [4] 分别代表编号为 id 的考生的 A，C，M，E 分别的排名 注意点 由于优先级是 A \u0026gt; C \u0026gt; M \u0026gt; E，为了方便枚举，设置数组时，尽量把 A 放在 C、M、E 前面 本题 id 是整数（digits 即数字），不会是字符型 本题没有说明平均分是向下取整还是四舍五入（向下取整也能通过），但为了更方便，平均分也可以用总分来代替 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; const int maxn = 2000; struct Stu { int id; int score[4] = {0}; } stus[maxn]; int n, m, q, ranks[1000000][4] = {0}, index; char ch[4] = {\u0026#39;A\u0026#39;, \u0026#39;C\u0026#39;, \u0026#39;M\u0026#39;, \u0026#39;E\u0026#39;}; int cmp(Stu s1, Stu s2) { return s1.score[index] \u0026gt; s2.score[index]; } int main() { scanf(\u0026#34;%d %d\u0026#34;, \u0026amp;n, \u0026amp;m); for (int i = 0; i \u0026lt; n; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;stus[i].id); for (int j = 1; j \u0026lt;= 3; j++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;stus[i].score[j]); stus[i].score[0] += stus[i].score[j]; } } for (index = 0; index \u0026lt; 4; index++) { sort(stus, stus + n, cmp); ranks[stus[0].id][index] = 1; for (int i = 1; i \u0026lt; n; i++) { if (stus[i].score[index] == stus[i - 1].score[index]) { ranks[stus[i].id][index] = ranks[stus[i - 1].id][index]; } else { ranks[stus[i].id][index] = i + 1; } } } for (int i = 0; i \u0026lt; m; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;q); if (ranks[q][0] == 0) { printf(\u0026#34;N/A\\n\u0026#34;); } else { int minRank = 2000, minIndex; for (int j = 0; j \u0026lt; 4; j++) { if (ranks[q][j] \u0026lt; minRank) { minRank = ranks[q][j]; minIndex = j; } } printf(\u0026#34;%d %c\\n\u0026#34;, minRank, ch[minIndex]); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1012/","summary":"\u003cp\u003eTo evaluate the performance of our first year CS majored students, we consider their grades of three courses only: \u003ccode\u003eC\u003c/code\u003e - C Programming Language, \u003ccode\u003eM\u003c/code\u003e - Mathematics (Calculus or Linear Algrbra), and \u003ccode\u003eE\u003c/code\u003e - English. At the mean time, we encourage students by emphasizing on their best ranks \u0026ndash; that is, among the four ranks with respect to the three courses and the average grade, we print the best rank for each student.\u003c/p\u003e","title":"PAT甲级 1012 The Best Rank (25分)"},{"content":"Given an integer with no more than 9 digits, you are supposed to read it in the traditional Chinese way. Output Fu first if it is negative. For example, -123456789 is read as Fu yi Yi er Qian san Bai si Shi wu Wan liu Qian qi Bai ba Shi jiu. Note: zero (ling) must be handled correctly according to the Chinese tradition. For example, 100800 is yi Shi Wan ling ba Bai.\nInput Specification: Each input file contains one test case, which gives an integer with no more than 9 digits.\nOutput Specification: For each test case, print in a line the Chinese way of reading the number. The characters are separated by a space and there must be no extra space at the end of the line.\nSample Input 1: -123456789 Sample Output 1: Fu yi Yi er Qian san Bai si Shi wu Wan liu Qian qi Bai ba Shi jiu Sample Input 2: 100800 Sample Output 2: yi Shi Wan ling ba Bai 思路 将数字按字符串处理，设置下标 left 和 right 来处理数字的一个节（个节、万节、亿节）的输出，left 指向当前需要输出的位，right 指向与 left 同节的个位。\n注意点 边界数据 0 的输出应该为 “0“。可以在判断当前位是否是 0 时，加上不为首位这一条件（即若为首位的 0，照常输出）。当然也可以特殊判断输出。 如果万节所有位都为 0，则不能输出多余的万。 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; char num[10][5] = {\u0026#34;ling\u0026#34;, \u0026#34;yi\u0026#34;, \u0026#34;er\u0026#34;, \u0026#34;san\u0026#34;, \u0026#34;si\u0026#34;, \u0026#34;wu\u0026#34;, \u0026#34;liu\u0026#34;, \u0026#34;qi\u0026#34;, \u0026#34;ba\u0026#34;, \u0026#34;jiu\u0026#34;}; char wei[5][5] = {\u0026#34;Shi\u0026#34;, \u0026#34;Bai\u0026#34;, \u0026#34;Qian\u0026#34;, \u0026#34;Wan\u0026#34;, \u0026#34;Yi\u0026#34;}; int main() { char str[11]; scanf(\u0026#34;%s\u0026#34;, str); int len = strlen(str), left = 0, right = len - 1; if (str[0] == \u0026#39;-\u0026#39;) { printf(\u0026#34;Fu\u0026#34;); left++; } while (right - 4 \u0026gt;= left) { right -= 4; } while (left \u0026lt; len) { bool flag = false, isPrint = false; while (left \u0026lt;= right) { if (left \u0026gt; 0 \u0026amp;\u0026amp; str[left] == \u0026#39;0\u0026#39;) { flag = true; } else { if (flag == true) { printf(\u0026#34; ling\u0026#34;); flag = false; } if (left \u0026gt; 0) { printf(\u0026#34; \u0026#34;); } printf(\u0026#34;%s\u0026#34;, num[str[left] - \u0026#39;0\u0026#39;]); isPrint = true; if (left != right) { printf(\u0026#34; %s\u0026#34;, wei[right - left - 1]); } } left++; } if (isPrint == true \u0026amp;\u0026amp; right != len - 1) { printf(\u0026#34; %s\u0026#34;, wei[(len - 1 - right) / 4 + 2]); } right += 4; } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1082/","summary":"\u003cp\u003eGiven an integer with no more than 9 digits, you are supposed to read it in the traditional Chinese way. Output \u003ccode\u003eFu\u003c/code\u003e first if it is negative. For example, -123456789 is read as \u003ccode\u003eFu yi Yi er Qian san Bai si Shi wu Wan liu Qian qi Bai ba Shi jiu\u003c/code\u003e. Note: zero (\u003ccode\u003eling\u003c/code\u003e) must be handled correctly according to the Chinese tradition. For example, 100800 is \u003ccode\u003eyi Shi Wan ling ba Bai\u003c/code\u003e.\u003c/p\u003e","title":"PAT甲级 1082 Read Number in Chinese (25分)"},{"content":"Sherlock Holmes received a note with some strange strings: Let's date! 3485djDkxh4hhGE 2984akDfkkkkggEdsb s\u0026amp;hgsfdk d\u0026amp;Hyscvnm. It took him only a minute to figure out that those strange strings are actually referring to the coded time Thursday 14:04 \u0026ndash; since the first common capital English letter (case sensitive) shared by the first two strings is the 4th capital letter D, representing the 4th day in a week; the second common character is the 5th capital letter E, representing the 14th hour (hence the hours from 0 to 23 in a day are represented by the numbers from 0 to 9 and the capital letters from A to N, respectively); and the English letter shared by the last two strings is s at the 4th position, representing the 4th minute. Now given two pairs of strings, you are supposed to help Sherlock decode the dating time.\nInput Specification: Each input file contains one test case. Each case gives 4 non-empty strings of no more than 60 characters without white space in 4 lines.\nOutput Specification: For each test case, print the decoded time in one line, in the format DAY HH:MM, where DAY is a 3-character abbreviation for the days in a week \u0026ndash; that is, MON for Monday, TUE for Tuesday, WED for Wednesday, THU for Thursday, FRI for Friday, SAT for Saturday, and SUN for Sunday. It is guaranteed that the result is unique for each case.\nSample Input: 3485djDkxh4hhGE 2984akDfkkkkggEdsb s\u0026amp;hgsfdk d\u0026amp;Hyscvnm Sample Output: THU 14:04 注意点 三对相同的字符都需要在对应相同的位置上（在各自的字符串中所在的位置相同），这一点题目没有说清楚（我刚开始以为可以在不同位置 第 2 对相同的字符，其实是在第一对字符位置之后的下一对满足条件的字符，而不是从头扫描碰到的第 2 对，这一点题目也没有说清楚 前两对字符需要限定到具体范围，如 A～G 与 A～N，而不是 A～Z，否则会“答案错误” 总之，这题很模糊，能做对靠猜 #include \u0026lt;cstdio\u0026gt; #include \u0026lt;cstring\u0026gt; const int maxn = 61; int main() { char str[4][maxn]; char week[7][4] = {\u0026#34;MON\u0026#34;, \u0026#34;TUE\u0026#34;, \u0026#34;WED\u0026#34;, \u0026#34;THU\u0026#34;, \u0026#34;FRI\u0026#34;, \u0026#34;SAT\u0026#34;, \u0026#34;SUN\u0026#34;}; for (int i = 0; i \u0026lt; 4; i++) { scanf(\u0026#34;%s\u0026#34;, str[i]); } int i, j, len1 = strlen(str[0]), len2 = strlen(str[1]), len3 = strlen(str[2]), len4 = strlen(str[3]); for (i = 0; i \u0026lt; len1 \u0026amp;\u0026amp; i \u0026lt; len2; i++) { if (str[0][i] == str[1][i] \u0026amp;\u0026amp; str[0][i] \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; str[0][i] \u0026lt;= \u0026#39;G\u0026#39;) { printf(\u0026#34;%s \u0026#34;, week[str[0][i] - \u0026#39;A\u0026#39;]); break; } } for (i++; i \u0026lt; len1 \u0026amp;\u0026amp; i \u0026lt; len2; i++) { if (str[0][i] == str[1][i]) { if (str[0][i] \u0026gt;= \u0026#39;0\u0026#39; \u0026amp;\u0026amp; str[0][i] \u0026lt;= \u0026#39;9\u0026#39;) { printf(\u0026#34;%02d:\u0026#34;, str[0][i] - \u0026#39;0\u0026#39;); break; } else if (str[0][i] \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; str[0][i] \u0026lt;= \u0026#39;N\u0026#39;) { printf(\u0026#34;%02d:\u0026#34;, str[0][i] - \u0026#39;A\u0026#39; + 10); break; } } } for (int i = 0; i \u0026lt; len3 \u0026amp;\u0026amp; i \u0026lt; len4; i++) { if (str[2][i] == str[3][i] \u0026amp;\u0026amp; (str[2][i] \u0026gt;= \u0026#39;a\u0026#39; \u0026amp;\u0026amp; str[2][i] \u0026lt;= \u0026#39;z\u0026#39; || str[2][i] \u0026gt;= \u0026#39;A\u0026#39; \u0026amp;\u0026amp; str[2][i] \u0026lt;= \u0026#39;Z\u0026#39;)) { printf(\u0026#34;%02d\u0026#34;, i); break; } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1061/","summary":"\u003cp\u003eSherlock Holmes received a note with some strange strings: \u003ccode\u003eLet's date! 3485djDkxh4hhGE 2984akDfkkkkggEdsb s\u0026amp;hgsfdk d\u0026amp;Hyscvnm\u003c/code\u003e. It took him only a minute to figure out that those strange strings are actually referring to the coded time \u003ccode\u003eThursday 14:04\u003c/code\u003e \u0026ndash; since the first common capital English letter (case sensitive) shared by the first two strings is the 4th capital letter \u003ccode\u003eD\u003c/code\u003e, representing the 4th day in a week; the second common character is the 5th capital letter \u003ccode\u003eE\u003c/code\u003e, representing the 14th hour (hence the hours from 0 to 23 in a day are represented by the numbers from 0 to 9 and the capital letters from \u003ccode\u003eA\u003c/code\u003e to \u003ccode\u003eN\u003c/code\u003e, respectively); and the English letter shared by the last two strings is \u003ccode\u003es\u003c/code\u003e at the 4th position, representing the 4th minute. Now given two pairs of strings, you are supposed to help Sherlock decode the dating time.\u003c/p\u003e","title":"PAT甲级 1061 Dating (20分)"},{"content":"设计函数求一元多项式的导数。（注：x^n（n为整数）的一阶导数为nx^{n−1}。）\n输入格式: 以指数递降方式输入多项式非零项系数和指数（绝对值均为不超过 1000 的整数）。数字间以空格分隔。\n输出格式: 以与输入相同的格式输出导数多项式非零项的系数和指数。数字间以空格分隔，但结尾不能有多余空格。注意“零多项式”的指数和系数都是 0，但是表示为 0 0。\n输入样例: 3 4 -5 2 6 1 -2 0 输出样例: 12 3 -10 1 6 0 注意点 用 while……EOF 的格式来读入系数和指数（黑框中触发 EOF 要按 ctrl + Z，并回车） 经测试，该题的指数都是非负整数 求导必须从低次项枚举到高次项，否则结果可能为出错 在求导后，当前系数必须清空为0，否则当前无法被后面覆盖 如果求导之后没有任何非零项，需要输出 0 0 #include \u0026lt;cstdio\u0026gt; const int maxn = 1001; int main() { int n[maxn] = {0}, c, e, cnt = 0; while (scanf(\u0026#34;%d%d\u0026#34;, \u0026amp;c, \u0026amp;e) != EOF) { n[e] = c; } n[0] = 0; for (int i = 1; i \u0026lt; maxn; i++) { n[i - 1] = i * n[i]; n[i] = 0; if (n[i - 1] != 0) { cnt++; } } if (cnt == 0) { printf(\u0026#34;0 0\u0026#34;); } else { for (int i = maxn - 1; i \u0026gt;= 0; i--) { if (n[i] != 0) { printf(\u0026#34;%d %d\u0026#34;, n[i], i); cnt--; if (cnt != 0) { printf(\u0026#34; \u0026#34;); } else { break; } } } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/basic_level/b1010/","summary":"\u003cp\u003e设计函数求一元多项式的导数。（注：x^n（\u003cem\u003en\u003c/em\u003e为整数）的一阶导数为nx^{n−1}。）\u003c/p\u003e\n\u003ch1 id=\"输入格式\"\u003e输入格式:\u003c/h1\u003e\n\u003cp\u003e以指数递降方式输入多项式非零项系数和指数（绝对值均为不超过 1000 的整数）。数字间以空格分隔。\u003c/p\u003e\n\u003ch1 id=\"输出格式\"\u003e输出格式:\u003c/h1\u003e\n\u003cp\u003e以与输入相同的格式输出导数多项式非零项的系数和指数。数字间以空格分隔，但结尾不能有多余空格。注意“零多项式”的指数和系数都是 0，但是表示为 \u003ccode\u003e0 0\u003c/code\u003e。\u003c/p\u003e\n\u003ch1 id=\"输入样例\"\u003e输入样例:\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-in\" data-lang=\"in\"\u003e3 4 -5 2 6 1 -2 0\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"输出样例\"\u003e输出样例:\u003c/h1\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-out\" data-lang=\"out\"\u003e12 3 -10 1 6 0\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"注意点\"\u003e注意点\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e用 while……EOF 的格式来读入系数和指数（黑框中触发 EOF 要按 \u003ccode\u003ectrl + Z\u003c/code\u003e，并回车）\u003c/li\u003e\n\u003cli\u003e经测试，该题的指数都是非负整数\u003c/li\u003e\n\u003cli\u003e求导必须从低次项枚举到高次项，否则结果可能为出错\u003c/li\u003e\n\u003cli\u003e在求导后，当前系数必须清空为0，否则当前无法被后面覆盖\u003c/li\u003e\n\u003cli\u003e如果求导之后没有任何非零项，需要输出 \u003ccode\u003e0 0\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cpp\" data-lang=\"cpp\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#include\u003c/span\u003e \u003cspan style=\"color:#75715e\"\u003e\u0026lt;cstdio\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e maxn \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1001\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e n[maxn] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e}, c, e, cnt \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e (scanf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d%d\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ec, \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003ee) \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e EOF) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        n[e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e c;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    n[\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e maxn; i\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        n[i \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e n[i];\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        n[i] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (n[i \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            cnt\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (cnt \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0 0\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e maxn \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e; i \u003cspan style=\"color:#f92672\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; i\u003cspan style=\"color:#f92672\"\u003e--\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (n[i] \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;%d %d\u0026#34;\u003c/span\u003e, n[i], i);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                cnt\u003cspan style=\"color:#f92672\"\u003e--\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (cnt \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    printf(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    \u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"PAT乙级 1010 一元多项式求导 (25分)"},{"content":"Given three integers A, B and C in [−2^63,2^63], you are supposed to tell whether A+B\u0026gt;C.\nInput Specification: The first line of the input gives the positive number of test cases, T (≤10). Then T test cases follow, each consists of a single line containing three integers A, B and C, separated by single spaces.\nOutput Specification: For each test case, output in one line Case #X: true if A+B\u0026gt;C, or Case #X: false otherwise, where X is the case number (starting from 1).\nSample Input: 3 1 2 3 2 3 4 9223372036854775807 -9223372036854775808 0 Sample Output: Case #1: false Case #2: true Case #3: false 思路 当正溢出时，A + B 大小的范围区间为 [2^63, 2^64 - 2]，所以溢出后的区间为 [-2^63, -2]。所以，当 A \u0026gt; 0, B \u0026gt; 0, A + B \u0026lt; 0 时，为正溢出，输入 true。 当负溢出时，A + B 大小的范围区间为 [-2^64, -2^63 - 1]，所以溢出后的区间为 [0, 2^63 - 1]。所以，当 A \u0026lt; 0, B \u0026lt; 0, A + B \u0026gt;= 0 时为，为负溢出，输出 false。 在没有溢出的情况下，正常比较。 注意点 A + B 必须存放到 long long 型变量中才可与 C 进行比较，而不可以在 if 的条件中直接相加与 C 比较，否则会造成后两组数据错误。 #include \u0026lt;cstdio\u0026gt; int main() { int t; long long a, b, c; bool flag; scanf(\u0026#34;%d\u0026#34;, \u0026amp;t); for (int i = 1; i \u0026lt;= t; i++) { scanf(\u0026#34;%lld %lld %lld\u0026#34;, \u0026amp;a, \u0026amp;b, \u0026amp;c); long long res = a + b; if (a \u0026gt; 0 \u0026amp;\u0026amp; b \u0026gt; 0 \u0026amp;\u0026amp; res \u0026lt; 0) { flag = true; } else if (a \u0026lt; 0 \u0026amp;\u0026amp; b \u0026lt; 0 \u0026amp;\u0026amp; res \u0026gt;= 0) { flag = false; } else if (res \u0026gt; c) { flag = true; } else { flag = false; } printf(\u0026#34;Case #%d: %s\\n\u0026#34;, i, flag ? \u0026#34;true\u0026#34; : \u0026#34;false\u0026#34;); } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1065/","summary":"\u003cp\u003eGiven three integers \u003cem\u003eA\u003c/em\u003e, \u003cem\u003eB\u003c/em\u003e and \u003cem\u003eC\u003c/em\u003e in [−2^63,2^63], you are supposed to tell whether \u003cem\u003eA\u003c/em\u003e+\u003cem\u003eB\u003c/em\u003e\u0026gt;\u003cem\u003eC\u003c/em\u003e.\u003c/p\u003e\n\u003ch1 id=\"input-specification\"\u003eInput Specification:\u003c/h1\u003e\n\u003cp\u003eThe first line of the input gives the positive number of test cases, \u003cem\u003eT\u003c/em\u003e (≤10). Then \u003cem\u003eT\u003c/em\u003e test cases follow, each consists of a single line containing three integers \u003cem\u003eA\u003c/em\u003e, \u003cem\u003eB\u003c/em\u003e and \u003cem\u003eC\u003c/em\u003e, separated by single spaces.\u003c/p\u003e\n\u003ch1 id=\"output-specification\"\u003eOutput Specification:\u003c/h1\u003e\n\u003cp\u003eFor each test case, output in one line \u003ccode\u003eCase #X: true\u003c/code\u003e if \u003cem\u003eA\u003c/em\u003e+\u003cem\u003eB\u003c/em\u003e\u0026gt;\u003cem\u003eC\u003c/em\u003e, or \u003ccode\u003eCase #X: false\u003c/code\u003e otherwise, where \u003cem\u003eX\u003c/em\u003e is the case number (starting from 1).\u003c/p\u003e","title":"PAT甲级 1065 A+B and C (64bit) (20分)"},{"content":"章节概要 学会 API 网关权限验证和其他服务交互 学会开发 SpringBoot 的自定义配置 学会 Dubbo 负载均衡策略选择和使用 修改 Guns 中的 JWT 模块 增加忽略验证 URL 配置 修改返回内容匹配业务 增加 Threadlocal 的用户信息保存 业务功能开发 增加用户服务并提供接口 初步了解 API 网关与服务之间交互的过程 根据接口文档开发用户接口 创建用户表 DROP TABLE IF EXISTS user; CREATE TABLE user( UUID INT PRIMARY KEY AUTO_INCREMENT COMMENT \u0026#39;主键编号\u0026#39;, user_name VARCHAR(50) COMMENT \u0026#39;用户账号\u0026#39;, user_pwd VARCHAR(50) COMMENT \u0026#39;用户密码\u0026#39;, nick_name VARCHAR(50) COMMENT \u0026#39;用户昵称\u0026#39;, user_sex INT COMMENT \u0026#39;用户性别 0-男，1-女\u0026#39;, birthday VARCHAR(50) COMMENT \u0026#39;出生日期\u0026#39;, email VARCHAR(50) COMMENT \u0026#39;用户邮箱\u0026#39;, user_phone VARCHAR(50) COMMENT \u0026#39;用户手机号\u0026#39;, address VARCHAR(50) COMMENT \u0026#39;用户住址\u0026#39;, head_url VARCHAR(50) COMMENT \u0026#39;头像URL\u0026#39;, biography VARCHAR(200) COMMENT \u0026#39;个人介绍\u0026#39;, life_state INT COMMENT \u0026#39;生活状态 0-单身，1-热恋中，2-已婚，3-为人父母\u0026#39;, begin_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT \u0026#39;创建时间\u0026#39;, update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \u0026#39;修改时间\u0026#39; ) COMMENT \u0026#39;用户表\u0026#39; ENGINE = INNODB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = DYNAMIC; insert into user(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) values(\u0026#39;admin\u0026#39;,\u0026#39;0192023a7bbd73250516f069df18b500\u0026#39;,\u0026#39;管理员\u0026#39;,0,\u0026#39;2018-07-31\u0026#39;,\u0026#39;admin@gmail.com\u0026#39;,\u0026#39;13888888888\u0026#39;,\u0026#39;浙江省杭州市西湖区某路某号\u0026#39;,\u0026#39;cinema/img/head-img.jpg\u0026#39;,0,\u0026#39;我是苦逼的管理员\u0026#39;); insert into user(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) values(\u0026#39;test\u0026#39;,\u0026#39;5e2de6bd1c9b50f6e27d4e55da43b917\u0026#39;,\u0026#39;测试用户\u0026#39;,0,\u0026#39;2018-08-20\u0026#39;,\u0026#39;test@gmail.com\u0026#39;,\u0026#39;13866666666\u0026#39;,\u0026#39;测试地址\u0026#39;,\u0026#39;cinema/img/head-img.jpg\u0026#39;,1,\u0026#39;我是测试用户\u0026#39;); 用户服务与网关交互 在 guns 项目中复制一份 guns-gateway 模块并重命名为 guns-user（修改相应子模块和主模块的 pom.xml 等），并在 application.yml 中将其鉴权机制等关闭（网关才需要）\nrest: auth-open: false #jwt鉴权机制是否开启(true或者false) sign-open: false #签名机制是否开启(true或false) 端口设为8083\nserver: port: 8083 #项目端口 在 spring:dubbo: 下添加 Dubbo 协议和端口（UserApplication 需要向外部暴露接口，先向注册中心注册，然后通过 Dubbo 协议被远程调用）\nspring: application: name: cinema-user dubbo: server: true registry: zookeeper://localhost:2181 protocol: name: dubbo port: 20881 在 guns-user 中编写 UserAPI 的实现类，其中 UserAPI 接口是来自于 guns-api 的（在前一章已经做了业务 API 抽离），并通过 @Service 向外部暴露\n@Component @Service(interfaceClass = UserAPI.class) public class UserImpl implements UserAPI { @Override public boolean login(String username, String password) { System.out.println(\u0026#34;This is user service! \u0026#34; + username + \u0026#34;, \u0026#34; + password); return false; } } 然后，在 guns-gateway 中就可以远程调用 UserAPI 接口了\n@Reference(interfaceClass = UserAPI.class) private UserAPI userAPI; userAPI.login(username, password); 基于 SpringBoot 配置忽略列表 配置 guns-gateway 网关模块中的 application.yml，在 jwt 下添加 ignore-url 配置，用逗号分隔 url（注意不能有空格！），这些接口将不通过 jwt 验证过滤器\njwt: header: Authorization #http请求头所需要的字段 secret: mySecret #jwt秘钥 expiration: 604800 #7天 单位:秒 auth-path: auth #认证请求的路径 md5-key: randomKey #md5加密混淆key ignore-url: /user/,/film/ #忽略列表 在 JwtProperties 中添加一项成员变量，并添加 get、set 函数，这个类是配置类，@ConfigurationProperties(prefix = JwtProperties.JWT_PREFIX) 表示用于从配置文件 application.yml 中获取 jwt 开头的配置变量\n@Configuration @ConfigurationProperties(prefix = JwtProperties.JWT_PREFIX) public class JwtProperties { public static final String JWT_PREFIX = \u0026#34;jwt\u0026#34;; private String header = \u0026#34;Authorization\u0026#34;; private String secret = \u0026#34;defaultSecret\u0026#34;; private Long expiration = 604800L; private String authPath = \u0026#34;auth\u0026#34;; private String md5Key = \u0026#34;randomKey\u0026#34;; private String ignoreUrl = \u0026#34;\u0026#34;; 在 AuthFilter 的 doFilterInternal 方法中添加以下代码，用于忽略配置列表\n// 配置忽略列表 String ignoreUrl = jwtProperties.getIgnoreUrl(); String[] ignoreUrls = ignoreUrl.split(\u0026#34;,\u0026#34;); for (int i = 0; i \u0026lt; ignoreUrls.length; i++) { if (request.getServletPath().equals(ignoreUrls[i])) { chain.doFilter(request, response); return; } } 修改 JWT 申请的返回报文 在 guns-gateway 模块中的 modular.vo 下，创建 ResponseVO 类作为响应VO类，其中包含了三种状态 Status ：0-成功，1-业务失败，999-系统异常\npublic class ResponseVO\u0026lt;M\u0026gt; { /** * 返回状态 [0-成功，1-业务失败，999-系统异常] */ private Integer status; /** * 返回信息 */ private String msg; /** * 返回数据实体 */ private M data; private ResponseVO() {} public static\u0026lt;M\u0026gt; ResponseVO success(M m) { ResponseVO responseVO = new ResponseVO(); responseVO.setStatus(0); responseVO.setData(m); return responseVO; } public static ResponseVO serviceFail(String msg) { ResponseVO responseVO = new ResponseVO(); responseVO.setStatus(1); responseVO.setMsg(msg); return responseVO; } public static ResponseVO appFail(String msg) { ResponseVO responseVO = new ResponseVO(); responseVO.setStatus(999); responseVO.setMsg(msg); return responseVO; } 之后在 AuthController 中就可以用该类作为返回对象了\n@RequestMapping(value = \u0026#34;${jwt.auth-path}\u0026#34;) public ResponseVO createAuthenticationToken(AuthRequest authRequest) { boolean validate = true; // 去掉guns自身携带的用户名密码验证机制，使用自己的 int userId = userAPI.login(authRequest.getUserName(), authRequest.getPassword()); if (userId == 0) { validate = false; } if (validate) { // randomKey和token已经生成完毕 final String randomKey = jwtTokenUtil.getRandomKey(); final String token = jwtTokenUtil.generateToken(\u0026#34;\u0026#34; + userId, randomKey); // 返回值 return ResponseVO.success(new AuthResponse(token, randomKey)); } else { return ResponseVO.serviceFail(\u0026#34;用户名或密码错误\u0026#34;); } } 增加 Threadlocal 的用户信息保存 在 guns-gateway 中的 common 下创建 CurrentUser 类用于保存 userId（不直接保存 userInfoModel 是因为更省空间，避免用户量大时出现内存溢出），该 userId 存在 ThreadLocal 中和线程绑定，同一线程内共享\npublic class CurrentUser { /** * 线程绑定的存储空间 */ private static final ThreadLocal\u0026lt;String\u0026gt; threadLocal = new ThreadLocal\u0026lt;\u0026gt;(); public static void saveUserId(String userId) { threadLocal.set(userId); } public static String getCurrentUser() { return threadLocal.get(); } } 之后，在 AuthFilter 验证 token 时，就可以通过 token 获取 userID，并且将之存入 ThreadLocal，以便后续业务调用了\nString userId = jwtTokenUtil.getUsernameFromToken(authToken); if (userId == null) { return; } else { CurrentUser.saveUserId(userId); } 在用户后续访问时，就可以取出 userId，并从数据库或 redis 中获取用户信息了\n@Controller @RequestMapping(\u0026#34;/hello\u0026#34;) public class ExampleController { @RequestMapping(\u0026#34;\u0026#34;) public ResponseEntity hello() { System.out.println(CurrentUser.getCurrentUser()); // 这里将以userId为key，userInfo为value存在redis中，TTL为30分钟 // 或以userId为条件去数据库取出（和redis只有快慢的区别） return ResponseEntity.ok(\u0026#34;请求成功!\u0026#34;); } } 用户模块开发 业务功能开发流程 使用代码生成器生成数据项 在每个 guns 模块的 test 下，都有 enerator.EntityGenerator 这个用于实体生成的类，只需根据需要稍微修改一下方法的参数即可。在 guns-user 模块中生成即可得到：UserT, UserTMapper, UserTMapper.xml\n... // 生成代码的绝对目录 gc.setOutputDir(\u0026#34;/Users/zjxjwxk/Documents/GitHub/Cinema-Dubbo/guns-user/src/main/java\u0026#34;); ... // 作者信息 gc.setAuthor(\u0026#34;zjxjwxk\u0026#34;); ... // 数据库连接配置 dsc.setUsername(\u0026#34;root\u0026#34;); dsc.setPassword(\u0026#34;19981018\u0026#34;); dsc.setUrl(\u0026#34;jdbc:mysql://127.0.0.1:3306/guns_rest?autoReconnect=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=GMT%2B8\u0026#34;); ... // 数据库表前缀 strategy.setInclude(new String[]{\u0026#34;user_t\u0026#34;}); ... // 生成 Entity、Mapper、XML 的包的相对目录 pc.setEntity(\u0026#34;com.stylefeng.guns.rest.common.persistence.model\u0026#34;); pc.setMapper(\u0026#34;com.stylefeng.guns.rest.common.persistence.dao\u0026#34;); pc.setXml(\u0026#34;com.stylefeng.guns.rest.common.persistence.dao.mapping\u0026#34;); ... 此处生成的实体类属于 guns-user 模块，用于和数据库打交道。以下是 guns-gateway 模块和 guns-user 模块不同的三种 user 类，UserModel 和 UserInfoModel 属于 BO，而 MoocUserT （即UserT） 属于 DO。\n实现相应的接口功能 在 guns-user 模块的 UserServiceImpl 中实现 UserAPI （在 guns-api 中）的接口，如：\n@Component @Service(interfaceClass = UserAPI.class) public class UserServiceImpl implements UserAPI { @Autowired private UserTMapper userTMapper; @Override public boolean register(UserModel userModel) { ... } } 在 guns-gateway 模块的 UserController 中实现编写相应 url 和控制层代码，如：\n@RequestMapping(\u0026#34;/user/\u0026#34;) @RestController public class UserController { @Reference(interfaceClass = UserAPI.class) private UserAPI userAPI; @RequestMapping(name = \u0026#34;register\u0026#34;, method = RequestMethod.POST) public ResponseVO register(UserModel userModel) { ... } } Dubbo 特性 存在的问题 必须先启动服务提供者，否则会报错（如下）。如果有两个服务互相依赖，那么两个服务都无法启动成功。（Dubbo 启动检查） Caused by: java.lang.IllegalStateException: Failed to check the status of the service com.stylefeng.guns.api.user.UserAPI. No provider available for the service com.stylefeng.guns.api.user.UserAPI from the url zookeeper://localhost:2181/com.alibaba.dubbo.registry.RegistryService?application=cinema-gateway\u0026amp;dubbo=2.6.0\u0026amp;interface=com.stylefeng.guns.api.user.UserAPI\u0026amp;methods=updateUserInfo,checkUserName,getUserInfo,login,register\u0026amp;pid=10451\u0026amp;register.ip=192.168.6.102\u0026amp;side=consumer\u0026amp;timestamp=1584633672918 to the consumer 192.168.6.102 use dubbo version 2.6.0 如果我们将用户模块部署多台，消费者会如何访问？（Dubbo 负载均衡） spring: dubbo: 中的 protocol 属性是做什么的？（Dubbo 多协议支持） Dubbo 启动检查 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/preflight-check.html\n服务启动过程中验证服务提供者的可用性 验证过程出现问题，则阻止整个 Spring 容器初始化 服务启动检查可以尽可能早的发现服务问题 Dubbo 默认打开了启动检查，每个接口的 @Reference 注解都默认 check = true，如果确实想取消启动检查，只需在每个消费者所引用的接口的 @Reference 注解后手动设置 check = false 即可（但是并不推荐）。关闭启动检查后，无论所调用接口的服务有没有启动，都能够正常启动。但如果其调用没有启动的服务，将会报以下错误：\ncom.alibaba.dubbo.rpc.RpcException: No provider available from registry localhost:2181 for service com.stylefeng.guns.api.user.UserAPI on consumer 192.168.6.102 use dubbo version 2.6.0, may be providers disabled or not registered ? Dubbo 负载均衡 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/loadbalance.html\n在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 random 随机调用。\n负载均衡策略 策略名称 策略描述 Random 随机，按权重设置随机概率 RoundRobin 轮询，按公约后的权重设置轮询比率 LeastActive 最少活跃调用数，相同活跃数的随机，活跃数指调用前后计数差 ConsistentHash 一致性 Hash，相同参数的请求总是发到同一提供者 配置 服务端服务级别 \u0026lt;dubbo:service interface=\u0026#34;...\u0026#34; loadbalance=\u0026#34;roundrobin\u0026#34;/\u0026gt; 客户端服务级别 \u0026lt;dubbo:reference interface=\u0026#34;...\u0026#34; loadbalance=\u0026#34;roundrobin\u0026#34; /\u0026gt; 服务端方法级别 \u0026lt;dubbo:service interface=\u0026#34;...\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;...\u0026#34; loadbalance=\u0026#34;roundrobin\u0026#34;/\u0026gt; \u0026lt;/dubbo:service\u0026gt; 客户端方法级别 \u0026lt;dubbo:reference interface=\u0026#34;...\u0026#34;\u0026gt; \u0026lt;dubbo:method name=\u0026#34;...\u0026#34; loadbalance=\u0026#34;roundrobin\u0026#34;/\u0026gt; \u0026lt;/dubbo:reference\u0026gt; Dubbo 多协议支持 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/multi-protocols.html\n多协议支撑 Dubbo 支持多种协议 最常见的协议是 dubbo RMI、Hessian、HTTP、Redis、Memcached 等多种协议 协议对比 特性对比 dubbo RMI Hessian 连接数 单连接 多连接 多连接 连接方式 长连接 短连接 短连接 传输协议 TCP 传输 同步传输 同步传输 传输方式 NIO 异步传输 同步传输 同步传输 适用场景 1. 数据包较小2. 消费者个数多3. 常规方式 1. 数据包大小不一2. 消费者和提供者数量相差不大 1. 数据包大小不一2. 消费者和提供者数量相差不大 总结 API 网关与服务模块调用方式（API 网关相当于服务消费者，服务模块相当于服务提供者） Dubbo 特性：负载均衡、启动检查、Dubbo 协议 JWT 的业务应用 ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/5.dubbo%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e学会 API 网关权限验证和其他服务交互\u003c/li\u003e\n\u003cli\u003e学会开发 SpringBoot 的自定义配置\u003c/li\u003e\n\u003cli\u003e学会 Dubbo 负载均衡策略选择和使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"修改-guns-中的-jwt-模块\"\u003e修改 Guns 中的 JWT 模块\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e增加忽略验证 URL 配置\u003c/li\u003e\n\u003cli\u003e修改返回内容匹配业务\u003c/li\u003e\n\u003cli\u003e增加 Threadlocal 的用户信息保存\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"业务功能开发\"\u003e业务功能开发\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e增加用户服务并提供接口\u003c/li\u003e\n\u003cli\u003e初步了解 API 网关与服务之间交互的过程\u003c/li\u003e\n\u003cli\u003e根据接口文档开发用户接口\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"创建用户表\"\u003e创建用户表\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eDROP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTABLE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eIF\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eEXISTS\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eCREATE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTABLE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   UUID INT \u003cspan style=\"color:#66d9ef\"\u003ePRIMARY\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eKEY\u003c/span\u003e AUTO_INCREMENT \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;主键编号\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   user_name VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户账号\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   user_pwd VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户密码\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   nick_name VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户昵称\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   user_sex INT \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户性别 0-男，1-女\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   birthday VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;出生日期\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   email VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户邮箱\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   user_phone VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户手机号\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   address VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户住址\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   head_url VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;头像URL\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   biography VARCHAR(\u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;个人介绍\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   life_state INT \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;生活状态 0-单身，1-热恋中，2-已婚，3-为人父母\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   begin_time \u003cspan style=\"color:#66d9ef\"\u003eTIMESTAMP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eDEFAULT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCURRENT_TIMESTAMP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;创建时间\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e   update_time \u003cspan style=\"color:#66d9ef\"\u003eTIMESTAMP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eDEFAULT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCURRENT_TIMESTAMP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eON\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eUPDATE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCURRENT_TIMESTAMP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;修改时间\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e) \u003cspan style=\"color:#66d9ef\"\u003eCOMMENT\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;用户表\u0026#39;\u003c/span\u003e ENGINE \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e INNODB AUTO_INCREMENT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e CHARACTER \u003cspan style=\"color:#66d9ef\"\u003eSET\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e utf8 \u003cspan style=\"color:#66d9ef\"\u003eCOLLATE\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e utf8_general_ci ROW_FORMAT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eDYNAMIC\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) \u003cspan style=\"color:#66d9ef\"\u003evalues\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;admin\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;0192023a7bbd73250516f069df18b500\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;管理员\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2018-07-31\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;admin@gmail.com\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;13888888888\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;浙江省杭州市西湖区某路某号\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cinema/img/head-img.jpg\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;我是苦逼的管理员\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003einsert\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003einto\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) \u003cspan style=\"color:#66d9ef\"\u003evalues\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;5e2de6bd1c9b50f6e27d4e55da43b917\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;测试用户\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2018-08-20\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;test@gmail.com\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;13866666666\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;测试地址\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;cinema/img/head-img.jpg\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;我是测试用户\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"用户服务与网关交互\"\u003e用户服务与网关交互\u003c/h1\u003e\n\u003cp\u003e在 guns 项目中复制一份 guns-gateway 模块并重命名为 guns-user（修改相应子模块和主模块的 pom.xml 等），并在 application.yml 中将其鉴权机制等关闭（网关才需要）\u003c/p\u003e","title":"Dubbo微服务影院系列（5）：Dubbo基本特性（用户模块开发）"},{"content":"章节概要 构建基于 Guns + SpringBoot + Dubbo 的框架 学会抽离业务接口 学会 API 网关变形应用 API 网关介绍 API 网关有点类似于设计模式中的 Facade 模式 API 网关一般都是微服务系统中的门面 API 网关是微服务的重要组成部分 API 网关的常见作用 身份验证和安全 审查和检测 动态路由 压力测试 负载均衡（Dubbo 自带） 静态相应处理 Guns 环境构建 导入 guns 项目 创建 guns_rest 数据库 创建 user 表 -- ---------------------------- -- Table structure for user -- ---------------------------- DROP TABLE IF EXISTS `user`; CREATE TABLE `user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `userName` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL, PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic; -- ---------------------------- -- Records of user -- ---------------------------- INSERT INTO `user` VALUES (1, \u0026#39;admin\u0026#39;); SET FOREIGN_KEY_CHECKS = 1; 添加 log4j 依赖 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.17\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 修改 datasource 的 url 修改 application.yml 中 spring 的 datasource 的 url 为\nurl: jdbc:mysql://127.0.0.1:3306/guns_rest?autoReconnect=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;serverTimezone=GMT%2B8 验证环境 启动 GunsRestApplication，访问 url http://localhost/auth?userName=admin\u0026amp;password=admin，若返回如下 token 则环境搭建成功。\n{ \u0026#34;randomKey\u0026#34;: \u0026#34;zd8rb8\u0026#34;, \u0026#34;token\u0026#34;: \u0026#34;eyJhbGciOiJIUzUxMiJ9.eyJyYW5kb21LZXkiOiJ6ZDhyYjgiLCJzdWIiOiJhZG1pbiIsImV4cCI6MTU4NDM2MjkxOCwiaWF0IjoxNTgzNzU4MTE4fQ.mR7Elro8oK8T2Rx6FE02FWTvORJnUAcFfPka4-KbQYsSpoMQQl5iUgd-wd9wYIw_5wbXpn3TFoii72suPn0b4A\u0026#34; } API 网关模块构建测试 在 guns 项目中复制一份 guns-rest 模块并重命名为 guns-gateway，在主模块 pom.xml 中添加 guns-gateway\n\u0026lt;modules\u0026gt; \u0026lt;module\u0026gt;guns-admin\u0026lt;/module\u0026gt; \u0026lt;module\u0026gt;guns-core\u0026lt;/module\u0026gt; \u0026lt;module\u0026gt;guns-rest\u0026lt;/module\u0026gt; \u0026lt;module\u0026gt;guns-generator\u0026lt;/module\u0026gt; \u0026lt;module\u0026gt;guns-gateway\u0026lt;/module\u0026gt; \u0026lt;/modules\u0026gt; 修改其 pom.xml 中有关名称为 guns-gateway，并在 Project Structure 中将该模块重命名为 guns-gateway，同时删除原来 guns-rest 中多余的 Content Root（从 guns-gateway 加入的）\n这样 guns-gateway 就构建好了（测试同 guns-rest）。\nAPI 网关集成 Dubbo 在 guns-gateway 项目的 pom.xml 文件中添加 Dubbo 和 ZooKeeper 的依赖\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.spring.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dubbo-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.101tec\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zkclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.10\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 在 application.yml 中添加\nspring: application: name: cinema-gateway dubbo: server: true registry: zookeeper://localhost:2181 在 Application 类上添加注解 @EnableDubboConfiguration 在 Service 实现类上添加注解 @Component 和 @Service(interfaceClass = UserAPI.class)，其中 @Service 来自Dubbo 抽离业务 API 在 guns 项目中复制一份 guns-core 模块并重命名为 guns-api 修改其 pom.xml 中各名称后，删除其所有依赖 删除所有 java 下所有包，创建 api 包，其中可创建公用接口类 使用 Maven 的 install 指令将其放入库中 在主模块的 pom.xml 中添加依赖 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.stylefeng\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;guns-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${guns.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 在 guns-gateway 的 pom.xml 中添加依赖 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.stylefeng\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;guns-api\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 之后，就可以在 guns-gateway 模块中，引入 guns-api 中的接口来使用了。这样接口类只需要在 guns-api 中写一份就够了，避免了冗余，达到了抽离业务 API 的效果。\n","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/","summary":"\u003ch1 id=\"章节概要\"\u003e章节概要\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e构建基于 Guns + SpringBoot + Dubbo 的框架\u003c/li\u003e\n\u003cli\u003e学会抽离业务接口\u003c/li\u003e\n\u003cli\u003e学会 API 网关变形应用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"api-网关介绍\"\u003eAPI 网关介绍\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eAPI 网关有点类似于设计模式中的 Facade 模式\u003c/li\u003e\n\u003cli\u003eAPI 网关一般都是微服务系统中的门面\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAPI  网关是微服务的重要组成部分\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"API网关示意图\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/images/image-20200309195624129.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"api-网关的常见作用\"\u003eAPI 网关的常见作用\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e身份验证和安全\u003c/li\u003e\n\u003cli\u003e审查和检测\u003c/li\u003e\n\u003cli\u003e动态路由\u003c/li\u003e\n\u003cli\u003e压力测试\u003c/li\u003e\n\u003cli\u003e负载均衡（Dubbo 自带）\u003c/li\u003e\n\u003cli\u003e静态相应处理\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"API网关作用\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/images/image-20200309200432132.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"guns-环境构建\"\u003eGuns 环境构建\u003c/h1\u003e\n\u003ch2 id=\"导入-guns-项目\"\u003e导入 guns 项目\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"guns项目结构\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/images/image-20200309203515871.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"创建-guns_rest-数据库\"\u003e创建 guns_rest 数据库\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"guns_rest数据库\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/images/image-20200309203649262.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"创建-user-表\"\u003e创建 user 表\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- ----------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- Table structure for user\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- ----------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eDROP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTABLE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eIF\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eEXISTS\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eCREATE\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTABLE\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e  (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003eid\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e bigint(\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eNOT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNULL\u003c/span\u003e AUTO_INCREMENT,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003euserName\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e varchar(\u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e) CHARACTER \u003cspan style=\"color:#66d9ef\"\u003eSET\u003c/span\u003e utf8 \u003cspan style=\"color:#66d9ef\"\u003eCOLLATE\u003c/span\u003e utf8_general_ci \u003cspan style=\"color:#66d9ef\"\u003eDEFAULT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNULL\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ePRIMARY\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eKEY\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003eid\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eUSING\u003c/span\u003e BTREE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e) ENGINE \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e InnoDB AUTO_INCREMENT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e CHARACTER \u003cspan style=\"color:#66d9ef\"\u003eSET\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e utf8 \u003cspan style=\"color:#66d9ef\"\u003eCOLLATE\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e utf8_general_ci ROW_FORMAT \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eDynamic\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- ----------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- Records of user\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- ----------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eINSERT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eINTO\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003euser\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e`\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eVALUES\u003c/span\u003e (\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;admin\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eSET\u003c/span\u003e FOREIGN_KEY_CHECKS \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"添加-log4j-依赖\"\u003e添加 log4j 依赖\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003elog4j\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003elog4j\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e1.2.17\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"修改-datasource-的-url\"\u003e修改 datasource 的 url\u003c/h2\u003e\n\u003cp\u003e修改 application.yml 中 spring 的 datasource 的 url 为\u003c/p\u003e","title":"Dubbo微服务影院系列（4）：业务基础环境构建"},{"content":"基础环境搭建 基于Guns + SpringBoot + Dubbo构建影院平台 Spring + Dubbo SpringBoot + Dubbo 微服务基本概念 Provider：服务提供者 Consumer：服务调用者，调用 Provider 提供的服务实现 同一个服务可以即是 Provider，又是 Consumer 以下可以选用 Spring 或 SpringBoot\nSpring基础环境构建 项目结构 主模块（Spring-Dubbo-Demo） 在 pom.xml 中添加 dependencies\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.101tec\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zkclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.zookeeper\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zookeeper\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.4.9\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dubbo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.netty\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;netty-all\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.1.6.Final\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;commons-logging\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;commons-logging\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.javassist\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javassist\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.21.0-GA\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.17\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- spring相关jar --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-context\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-context-support\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-beans\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-aop\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-aspects\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-expression\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.3.3.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.12\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; 子模块（provider、consumer） 在 resources 中添加 applicationContext.xml（可更改后缀）\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xmlns:aop=\u0026#34;http://www.springframework.org/schema/aop\u0026#34; xmlns:tx=\u0026#34;http://www.springframework.org/schema/tx\u0026#34; xmlns:dubbo=\u0026#34;http://code.alibabatech.com/schema/dubbo\u0026#34; xsi:schemaLocation=\u0026#34; http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd \u0026#34; \u0026gt; \u0026lt;/beans\u0026gt; Spring的直连提供者 provider applicationContext-hello-provider.xml 配置\n\u0026lt;dubbo:application name=\u0026#34;hello-world-app\u0026#34; /\u0026gt; \u0026lt;dubbo:protocol name=\u0026#34;dubbo\u0026#34; port=\u0026#34;20880\u0026#34; /\u0026gt; \u0026lt;bean id=\u0026#34;quickStartService\u0026#34; class=\u0026#34;com.zjut.zjxjwxk.dubbo.quickstart.QuickStartServiceImpl\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; \u0026lt;dubbo:service registry=\u0026#34;N/A\u0026#34; interface=\u0026#34;com.zjut.zjxjwxk.dubbo.ServiceAPI\u0026#34; ref=\u0026#34;quickStartService\u0026#34; /\u0026gt; 启动 provider\npublic class ProviderClient { public static void main(String[] args) { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\u0026#34;applicationContext-hello-provider.xml\u0026#34;); context.start(); try { System.in.read(); } catch (IOException e) { e.printStackTrace(); } } } consumer consumer 的 applicationContext-hello-consumer.xml 配置\n\u0026lt;dubbo:application name=\u0026#34;consumer-of-hello-world-app\u0026#34; /\u0026gt; \u0026lt;dubbo:reference id=\u0026#34;consumerService\u0026#34; interface=\u0026#34;com.zjut.zjxjwxk.dubbo.ServiceAPI\u0026#34; url=\u0026#34;dubbo://localhost:20880\u0026#34; /\u0026gt; 启动 consumer 即可获取和调用 provider 提供的接口\npublic class ConsumerClient { public static void main(String[] args) { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\u0026#34;applicationContext-hello-consumer.xml\u0026#34;); context.start(); while (true) { Scanner scanner = new Scanner(System.in); String message = scanner.next(); // 获取接口 ServiceAPI serviceAPI = (ServiceAPI) context.getBean(\u0026#34;consumerService\u0026#34;); System.out.println(serviceAPI.sendMessage(message)); } } } SpringBoot基础环境构建 项目结构 主模块（SpringBoot-Dubbo-Demo） 子模块（consumer、provider） provider 配置 application.properties spring.application.name=dubbo-spring-boot-starter spring.dubbo.server=true spring.dubbo.registry=N/A consumer 配置 application.properties spring.application.name=dubbo-spring-boot-starter SpringBoot的直连提供者 给 provider 和 consumer 的 Application 都添加 @EnableDubboConfiguration 注解。\nprovider 给实现类添加 @Component 和 @Service 注解（来自dubbo的） @Service 指明实现接口的 Class @Component @Service(interfaceClass = ServiceAPI.class) public class QuickStartServiceImpl implements ServiceAPI { @Override public String sendMessage(String message) { return \u0026#34;quickstart-provider-message=\u0026#34; + message; } } consumer consumer 即可注入并调用接口 声明的接口添加 @Reference 注解并注明 url （dubbo默认在20880端口） @Component public class QuickStartConsumer { @Reference(url = \u0026#34;dubbo://localhost:20880\u0026#34;) ServiceAPI serviceAPI; public void sendMessage(String message) { System.out.println(serviceAPI.sendMessage(message)); } } 项目结构 注册中心概念 直连提供者 消费端知道服务提供者的地址，直接进行连接 该种方式一般只在测试环境中使用 直连提供者限制了分布式的易扩展性 Dubbo架构 节点 角色说明 Provider 暴露服务的服务提供方 Consumer 调用远程服务的服务消费方 Registry 服务注册与发现的注册中心，通常使用 ZooKeeper Monitor 统计服务的调用次数和调用时间的监控中心 Container 服务运行容器 ZooKeeper安装和启动 从 Apache ZooKeeper 官网下载 https://www.apache.org/dyn/closer.cgi/zookeeper 在 conf 目录下将 zoo-sample.cfg 改为 zoo.cfg 在 bin 目录下启动 zkServer.sh sh zkServer.sh start Spring集成注册中心 provider 在 applicationContext-hello-provider.xml 中添加注册中心配置\n\u0026lt;dubbo:registry address=\u0026#34;zookeeper://localhost:2181\u0026#34;/\u0026gt; 去除 service 中的 registry 属性\n\u0026lt;dubbo:service interface=\u0026#34;com.zjut.zjxjwxk.dubbo.ServiceAPI\u0026#34; ref=\u0026#34;quickStartService\u0026#34; /\u0026gt; \u0026lt;!--registry=\u0026#34;N/A\u0026#34;--\u0026gt; consumer 在 applicationContext-hello-consumer.xml 中添加注册中心配置\n\u0026lt;dubbo:registry address=\u0026#34;zookeeper://localhost:2181\u0026#34;/\u0026gt; 去除 reference 中的 url 属性（非直连，而是通过 zookeeper 注册中心）\n\u0026lt;dubbo:reference id=\u0026#34;consumerService\u0026#34; interface=\u0026#34;com.zjut.zjxjwxk.dubbo.ServiceAPI\u0026#34; /\u0026gt; \u0026lt;!--url=\u0026#34;dubbo://localhost:20880\u0026#34;--\u0026gt; SpringBoot集成注册中心 provider 在 pom.xml 中添加 ZooKeeper 依赖\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.101tec\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zkclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.10\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 在 application.properties 中添加注册中心\nspring.dubbo.registry=zookeeper://localhost:2181 consumer 在 pom.xml 中添加 ZooKeeper 依赖\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.101tec\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;zkclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.10\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 在 application.properties 中添加注册中心\nspring.dubbo.registry=zookeeper://localhost:2181 去掉 @Reference 括号中的 url （非直连，而是通过 zookeeper 注册中心）\n@Reference ServiceAPI serviceAPI; ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/3.%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","summary":"\u003ch1 id=\"基础环境搭建\"\u003e基础环境搭建\u003c/h1\u003e\n\u003ch2 id=\"基于guns--springboot--dubbo构建影院平台\"\u003e基于Guns + SpringBoot + Dubbo构建影院平台\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eSpring + Dubbo\u003c/li\u003e\n\u003cli\u003eSpringBoot + Dubbo\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"微服务基本概念\"\u003e微服务基本概念\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eProvider：服务提供者\u003c/li\u003e\n\u003cli\u003eConsumer：服务调用者，调用 Provider 提供的服务实现\u003c/li\u003e\n\u003cli\u003e同一个服务可以即是 Provider，又是 Consumer\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e以下可以选用 Spring 或 SpringBoot\u003c/p\u003e\n\u003ch2 id=\"spring基础环境构建\"\u003eSpring基础环境构建\u003c/h2\u003e\n\u003ch3 id=\"项目结构\"\u003e项目结构\u003c/h3\u003e\n\u003cp\u003e\u003cimg alt=\"Spring基础环境项目结构\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/3.%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/images/image-20200306232618900.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"主模块spring-dubbo-demo\"\u003e主模块（Spring-Dubbo-Demo）\u003c/h3\u003e\n\u003cp\u003e在 pom.xml 中添加 dependencies\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependencies\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003ecom.101tec\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003ezkclient\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e0.9\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.apache.zookeeper\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003ezookeeper\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e3.4.9\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;type\u0026gt;\u003c/span\u003epom\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/type\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003ecom.alibaba\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003edubbo\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e2.5.3\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eio.netty\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003enetty-all\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.1.6.Final\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003ecommons-logging\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003ecommons-logging\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e1.2\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.javassist\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003ejavassist\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e3.21.0-GA\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003elog4j\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003elog4j\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e1.2.17\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- spring相关jar --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-context\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-context-support\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-core\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-beans\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-aop\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-aspects\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003eorg.springframework\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003espring-expression\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.3.3.RELEASE\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;groupId\u0026gt;\u003c/span\u003ejunit\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/groupId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;artifactId\u0026gt;\u003c/span\u003ejunit\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/artifactId\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;version\u0026gt;\u003c/span\u003e4.12\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/version\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026lt;scope\u0026gt;\u003c/span\u003etest\u003cspan style=\"color:#f92672\"\u003e\u0026lt;/scope\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependency\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;/dependencies\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"子模块providerconsumer\"\u003e子模块（provider、consumer）\u003c/h3\u003e\n\u003cp\u003e在 resources 中添加 applicationContext.xml（可更改后缀）\u003c/p\u003e","title":"Dubbo微服务影院系列（3）：环境搭建"},{"content":"Suppose a bank has N windows open for service. There is a yellow line in front of the windows which devides the waiting area into two parts. The rules for the customers to wait in line are:\nThe space inside the yellow line in front of each window is enough to contain a line with M customers. Hence when all the N lines are full, all the customers after (and including) the (NM+1)st one will have to wait in a line behind the yellow line. Each customer will choose the shortest line to wait in when crossing the yellow line. If there are two or more lines with the same length, the customer will always choose the window with the smallest number. Customer[i] will take T[i] minutes to have his/her transaction processed. The first N customers are assumed to be served at 8:00am. Now given the processing time of each customer, you are supposed to tell the exact time at which a customer has his/her business done.\nFor example, suppose that a bank has 2 windows and each window may have 2 customers waiting inside the yellow line. There are 5 customers waiting with transactions taking 1, 2, 6, 4 and 3 minutes, respectively. At 08:00 in the morning, customer[1] is served at window[1] while customer[2] is served at window[2]. Customer[3] will wait in front of window[1] and customer[4] will wait in front of window[2]. Customer[5] will wait behind the yellow line.\nAt 08:01, customer[1] is done and customer[5] enters the line in front of window[1] since that line seems shorter now. Customer[2] will leave at 08:02, customer[4] at 08:06, customer[3] at 08:07, and finally customer[5] at 08:10.\nInput Specification: Each input file contains one test case. Each case starts with a line containing 4 positive integers: N (≤20, number of windows), M (≤10, the maximum capacity of each line inside the yellow line), K (≤1000, number of customers), and Q (≤1000, number of customer queries).\nThe next line contains K positive integers, which are the processing time of the K customers.\nThe last line contains Q positive integers, which represent the customers who are asking about the time they can have their transactions done. The customers are numbered from 1 to K.\nOutput Specification: For each of the Q customers, print in one line the time at which his/her transaction is finished, in the format HH:MM where HH is in [08, 17] and MM is in [00, 59]. Note that since the bank is closed everyday after 17:00, for those customers who cannot be served before 17:00, you must output Sorry instead.\nSample Input: 2 2 7 5 1 2 6 4 3 534 2 3 4 5 6 7 Sample Output: 08:07 08:06 08:10 17:00 Sorry 注意点 如果⼀个客户在17:00以及以后还没有开始服务（此处不是结束服务是开始服务）就不再服务输出sorry；如果这个服务已经开始了了，无论时间多长都要等他服务完毕。如果当成结束服务，则测试点2，4，5不能通过。\n#include \u0026lt;cstdio\u0026gt; #include \u0026lt;queue\u0026gt; using namespace std; const int maxk = 1001, maxn = 21, maxTime = 540; int n, m, k, q, t[maxk], ans[maxk] = {0}; int main() { scanf(\u0026#34;%d %d %d %d\u0026#34;, \u0026amp;n, \u0026amp;m, \u0026amp;k, \u0026amp;q); for (int i = 1; i \u0026lt;= k; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;t[i]); } queue\u0026lt;int\u0026gt; que[maxn]; int time = 0, index = 0, query; for (int i = 1; i \u0026lt;= m; i++) { for (int j = 1; j \u0026lt;= n; j++) { que[j].push(++index); if (index == k) { break; } } if (index == k) { break; } } while (time != maxTime - 1) { time++; for (int i = 1; i \u0026lt;= n; i++) { if (que[i].size() \u0026gt; 0) { int front = que[i].front(); if (t[front] \u0026gt; 0) { t[front]--; if (t[front] == 0) { que[i].pop(); ans[front] = time; if (index != k) { que[i].push(++index); } } } } } } // 额外处理到17:00还没有服务完的客户 for (int i = 1; i \u0026lt;= n; i++) { if (que[i].size() \u0026gt; 0) { int front = que[i].front(); ans[front] = time + t[front]; } } for (int i = 0; i \u0026lt; q; i++) { scanf(\u0026#34;%d\u0026#34;, \u0026amp;query); if (ans[query] != 0) { printf(\u0026#34;%02d:%02d\\n\u0026#34;, 8 + ans[query] / 60, ans[query] % 60); } else { printf(\u0026#34;Sorry\\n\u0026#34;); } } return 0; } ","permalink":"https://zjxjwxk.github.io/posts/pat/advanced_level/a1014/","summary":"\u003cp\u003eSuppose a bank has N windows open for service. There is a yellow line in front of the windows which devides the waiting area into two parts. The rules for the customers to wait in line are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe space inside the yellow line in front of each window is enough to contain a line with M customers. Hence when all the N lines are full, all the customers after (and including) the (NM+1)st one will have to wait in a line behind the yellow line.\u003c/li\u003e\n\u003cli\u003eEach customer will choose the shortest line to wait in when crossing the yellow line. If there are two or more lines with the same length, the customer will always choose the window with the smallest number.\u003c/li\u003e\n\u003cli\u003eCustomer[i] will take T[i] minutes to have his/her transaction processed.\u003c/li\u003e\n\u003cli\u003eThe first N customers are assumed to be served at 8:00am.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNow given the processing time of each customer, you are supposed to tell the exact time at which a customer has his/her business done.\u003c/p\u003e","title":"PAT甲级 1014 Waiting in Line (30分)"},{"content":"传统业务应用 传统应用带来的问题 单一业务开发和迭代困难 扩容困难 部署和回滚困难 微服务发展历程 面向服务开发 - SOA 微服务开发 微服务概述 微服务是一种将业务系统进一步拆分的架构风格 微服务强调每个单一业务都独立运行 每个单一服务都应该使用更轻量的机制保持通信 服务不强调环境，可以不同语言或数据源 微服务选择 Dubbo Spring Cloud Zero ICE ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/2.%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/","summary":"\u003ch1 id=\"传统业务应用\"\u003e传统业务应用\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"传统业务应用\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/2.%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/images/image-20200306231434458.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"传统应用带来的问题\"\u003e传统应用带来的问题\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e单一业务开发和迭代困难\u003c/li\u003e\n\u003cli\u003e扩容困难\u003c/li\u003e\n\u003cli\u003e部署和回滚困难\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"微服务发展历程\"\u003e微服务发展历程\u003c/h1\u003e\n\u003ch2 id=\"面向服务开发---soa\"\u003e面向服务开发 - SOA\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"SOA\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/2.%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/images/image-20200306231555431.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"微服务开发\"\u003e微服务开发\u003c/h2\u003e\n\u003ch1 id=\"微服务概述\"\u003e微服务概述\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e微服务是一种将业务系统进一步拆分的架构风格\u003c/li\u003e\n\u003cli\u003e微服务强调每个单一业务都独立运行\u003c/li\u003e\n\u003cli\u003e每个单一服务都应该使用更轻量的机制保持通信\u003c/li\u003e\n\u003cli\u003e服务不强调环境，可以不同语言或数据源\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"微服务选择\"\u003e微服务选择\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eDubbo\u003c/li\u003e\n\u003cli\u003eSpring Cloud\u003c/li\u003e\n\u003cli\u003eZero ICE\u003c/li\u003e\n\u003c/ul\u003e","title":"Dubbo微服务影院系列（2）：微服务入门"},{"content":"为什么使用Dubbo Dubbo 是基于 RPC 通信协议，速度更快 Dubbo 的多中心配置更灵活 ZooKeeper Redis Dubbo 可以按需集成其他组件，完成微服务生态环境构建 Hystrix Zipkin 包括阿里、小米、京东等多家互联网公司都有使用 学习目标 构建业务完整的商业化项目 掌握以 Dubbo 为底的各项微服务套件的应用 掌握基于 Dubbo 的微服务常见面试问题 业务结构图 核心功能 主要知识点 技术架构图 ","permalink":"https://zjxjwxk.github.io/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/","summary":"\u003ch1 id=\"为什么使用dubbo\"\u003e为什么使用Dubbo\u003c/h1\u003e\n\u003ch2 id=\"dubbo-是基于-rpc-通信协议速度更快\"\u003eDubbo 是基于 RPC 通信协议，速度更快\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"千万次调用\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/images/image-20200306225758803.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"dubbo-的多中心配置更灵活\"\u003eDubbo 的多中心配置更灵活\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eZooKeeper\u003c/li\u003e\n\u003cli\u003eRedis\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"dubbo-可以按需集成其他组件完成微服务生态环境构建\"\u003eDubbo 可以按需集成其他组件，完成微服务生态环境构建\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eHystrix\u003c/li\u003e\n\u003cli\u003eZipkin\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"包括阿里小米京东等多家互联网公司都有使用\"\u003e包括阿里、小米、京东等多家互联网公司都有使用\u003c/h2\u003e\n\u003ch1 id=\"学习目标\"\u003e学习目标\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e构建业务完整的商业化项目\u003c/li\u003e\n\u003cli\u003e掌握以 Dubbo 为底的各项微服务套件的应用\u003c/li\u003e\n\u003cli\u003e掌握基于 Dubbo 的微服务常见面试问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"业务结构图\"\u003e业务结构图\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"业务结构图\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/images/image-20200306230144862.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"核心功能\"\u003e核心功能\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"核心功能\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/images/image-20200306230227966.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"主要知识点\"\u003e主要知识点\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"主要知识点\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/images/image-20200306230255648.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"技术架构图\"\u003e技术架构图\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"技术架构图\" loading=\"lazy\" src=\"/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/1.%E8%AF%BE%E7%A8%8B%E5%AF%BC%E5%AD%A6/images/image-20200306230335981.png\"\u003e\u003c/p\u003e","title":"Dubbo微服务影院系列（1）：课程导学"},{"content":"What is GSE? GSE is a complex phenomenon that unites many different collaboration models and project organization models.\nReason for GSE? Reduce overheads, free up resources Improve efficiency Offload non-core functions Get access to specialized skills Get access to a specific market Differences between co-located team and global team According to What, When, Where to determine whether the supplier is suitable Alternative Different transfers Different transfers can result in Full relocation of a product to the receiving site Relocation of a component / task / phase which overall is developed jointly (18P) There are several ways or models to transfer GSE project globally. Please tell at least three models that you would apply in your GSE project, and give your comments about their advantages and disadvantages in applying them respectively. Customization model advantages: customization can satisfy customers according to their special requirements\ndisadvantages: customization will use more resource, such as, human resources, time and money.\nFollow-the-sun model advantages: It works for defect resolution and support\ndisadvantages: Not good for development\nModularized model advantage: This reduce the need for inter-site coordination and communication; good for decoupled and clear tasks.\ndisadvantage: Increase the cost of whole project.\nCritical factors that alleviate transfers Describe 6 reasons for applying Global Software Engineering(GSE) and 3 reasons for not good to do GSE. Good: Reduce development costs Leveraging time zone effectiveness Access to large skilled labor pool Closer proximity to market and customer Innovation and shared best practice Improved resource allocation Not good: Loss of knowledge within the product Temporary productivity decrease Temporal decrease in quality Causes of failure of global projects Many specific problems, but mainly because managers are unaware of these problems and fail to properly coordinate work in a distributed environment\n(16P) The course discussed quite lot about 3C in GSE, since they are important factors for successful project in GES The 3C are (6P) (1) C_____________ (2) C_________________ (3) C__________________ Please tell the main contents or activities that involved in each C (10P) Communication Cohesiveness, teamness, mutual trust Common background, language and culture Coordination Joint processes and tools Plan-driven standardized approach Control Process transparency and visibility Managers directly supervise team performance What is a project? A project is a temporary endeavour undertaken to create a unique product or service. Temporary means that every project has a definite beginning and a definite end. Unique means that the product or service is different in some distinguishing way from all similar products or services. (15P) Both development models of agile method and waterfall method can be applied in GSE project. Briefly describe the two methods (just some basic idea or steps without details) and why you would choose which method in your project development. The waterfall model is a sequential (non-iterative) design process, used in software development processes, in which progress is flowing steadily downwards (like a waterfall). Steps can be described in following picture:\nAgile method is a group of software development methods in which requirements and solutions evolve through collaboration between self-organizing, cross-functional teams. It promotes adaptive planning, evolutionary development, early delivery, continuous improvement, and encourages rapid and flexible response to change. Steps can be described in following picture:\nAdvantage of Agile Focus on the question of how to address key problems in software development: too long, too costly, poor quality Have the potential to improve communication and, as a result, reduce coordination and control overhead Small co-located teams, so it is easily for coordination. Scrum Agile method is a simple and effective way to have control over your development process, make sure things go according to plan The Difference: Agility vs. Waterfall (20P) Culture does matter in GSE, then what is culture (can be examples) (5P)? What are building blocks (elements) for a culture (5P)? And describe Hofstede’s 5 dimensions of culture (10P). What is culture? Culture is a set of shared experiences, understandings, and meanings among members of a group, an organization, a community, or a nation.\nCulture provides members with images of:\nthe basic concerns, principles, ethics bodies of manners Rituals(礼仪）, ideologies strategies, tactics of self-survival notions of good acts and bad various forms of folklore and legends What are building blocks (elements) for a culture? values, including preferences people use to make work related and communication related decisions in projects.\npractices, including cultural norms for adopting specific project management styles and organization structures.\nHofstede’s 5 dimensions of culture? Power distance - how a society handles inequalities; A higher degree of the Index indicates that hierarchy is clearly established and executed in society, without doubt or reason. A lower degree of the Index signifies that people question authority and attempt to distribute power. Individualism/collectivism - behavior towards the group; individualism has loose ties that often only relates an individual. Collectivism emphasizes on building skills and has tightly-integrated relations into group. Masculinity/femininity - behavior according to gender; besides distinction of gender, masculinity is defined as a preference in society for achievement, heroism, assertiveness and material rewards for success. Femininity represents a preference for cooperation, modesty, caring for the weak and quality of life. Uncertainty avoidance - the need for structure; a high degree in this index strictly follows laws, guidelines, behaviors and etc. a low degree in this index shows more acceptance of differing thoughts or ideas. Long term orientation(LTO\u0003) - value of long-standing traditions; a high degree in this index indicates the factors of family, elders, strong work ethic and high value. A low degree in this index emphasizes creativity, individualism, equality and selfactualization. The effect of culture in software development organizations (5P) You are a project leader for GSE project, and you know it is important to build up to the team work. What would you do to build up your team to trust each other? Provide at least 5 ways or kinds of activities to this team building. kick-off meetings regular traveling team-building activities cultural training regular video-conferences Phase in forming a team Forming: the team gets together and gets to know each other. It clarifies roles, figures out the tasks and objectives\nStorming: conflicts break out over roles, objectives, and task allocations. Different leaders, official or otherwise, are pursuing different goals\nNorming: the team begins to form norms, roles, and protocols for working together. Some team cohesion may begin.\nPerforming: the team begins to perform well, working together toward a common goal. Conflicts are handled constructively\n","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/outsourcing/","summary":"\u003ch1 id=\"what-is-gse\"\u003eWhat is GSE?\u003c/h1\u003e\n\u003cp\u003eGSE is a complex phenomenon that unites many different collaboration models and project organization models.\u003c/p\u003e\n\u003ch1 id=\"reason-for-gse\"\u003eReason for GSE?\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eReduce overheads, free up resources\u003c/li\u003e\n\u003cli\u003eImprove efficiency\u003c/li\u003e\n\u003cli\u003eOffload non-core functions\u003c/li\u003e\n\u003cli\u003eGet access to specialized skills\u003c/li\u003e\n\u003cli\u003eGet access to a specific market\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"differences-between-co-located-team-and-global-team\"\u003eDifferences between co-located team and global team\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"Differences between co-located team and global team\" loading=\"lazy\" src=\"/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/outsourcing/images/image-20190623152437638.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"according-to-what-when-where-to-determine-whether-the-supplier-is-suitable\"\u003eAccording to What, When, Where to determine whether the supplier is suitable\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"Each combination is unique\" loading=\"lazy\" src=\"/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/outsourcing/images/image-20190622103720847.png\"\u003e\u003c/p\u003e","title":"Outsourcing"},{"content":"多余的分页信息 Spring Data 的 Page 接口进行数据分页返回了很多很多垃圾信息：\n{ \u0026#34;status\u0026#34;: 0, \u0026#34;data\u0026#34;: { \u0026#34;content\u0026#34;: [ { \u0026#34;goodsId\u0026#34;: 1, \u0026#34;producerId\u0026#34;: 1, \u0026#34;categoryId\u0026#34;: 4, \u0026#34;name\u0026#34;: \u0026#34;耐克sb滑板鞋\u0026#34;, \u0026#34;price\u0026#34;: 500, \u0026#34;stock\u0026#34;: 500, \u0026#34;status\u0026#34;: \u0026#34;正常\u0026#34;, \u0026#34;createTime\u0026#34;: \u0026#34;2019-02-02T03:48:33.000+0000\u0026#34;, \u0026#34;updateTime\u0026#34;: null }, { \u0026#34;goodsId\u0026#34;: 2, \u0026#34;producerId\u0026#34;: 1, \u0026#34;categoryId\u0026#34;: 4, \u0026#34;name\u0026#34;: \u0026#34;阿迪达斯小白鞋\u0026#34;, \u0026#34;price\u0026#34;: 500, \u0026#34;stock\u0026#34;: 300, \u0026#34;status\u0026#34;: \u0026#34;正常\u0026#34;, \u0026#34;createTime\u0026#34;: \u0026#34;2019-02-02T03:48:59.000+0000\u0026#34;, \u0026#34;updateTime\u0026#34;: null } ], \u0026#34;pageable\u0026#34;: { \u0026#34;sort\u0026#34;: { \u0026#34;sorted\u0026#34;: false, \u0026#34;unsorted\u0026#34;: true, \u0026#34;empty\u0026#34;: true }, \u0026#34;offset\u0026#34;: 0, \u0026#34;pageSize\u0026#34;: 10, \u0026#34;pageNumber\u0026#34;: 0, \u0026#34;paged\u0026#34;: true, \u0026#34;unpaged\u0026#34;: false }, \u0026#34;last\u0026#34;: true, \u0026#34;totalPages\u0026#34;: 1, \u0026#34;totalElements\u0026#34;: 2, \u0026#34;size\u0026#34;: 10, \u0026#34;number\u0026#34;: 0, \u0026#34;numberOfElements\u0026#34;: 2, \u0026#34;sort\u0026#34;: { \u0026#34;sorted\u0026#34;: false, \u0026#34;unsorted\u0026#34;: true, \u0026#34;empty\u0026#34;: true }, \u0026#34;first\u0026#34;: true, \u0026#34;empty\u0026#34;: false } } 实际需要的分页信息 实际上我只需要下面这些分页信息：\n\u0026#34;totalPages\u0026#34;: 3, \u0026#34;totalElements\u0026#34;: 20, \u0026#34;pageNumber\u0026#34;: 2, \u0026#34;numberOfElements\u0026#34;: 7 创建 PageChunk 类进行封装 我的 GoodsRepository 接口为：\nPage\u0026lt;Goods\u0026gt; findByCategoryId(Integer categoryId, Pageable pageable); 我们看到返回了很多多余的，重复的数据。为了解决这个问题，创建一个Pagination DTO(PageChunk)来包装一下分页数据。这个类的作用很简单就是包含每一次分页的内容和分页元数据（总页数，搜索结果总数，当前页号， 当前页包含多少项）。\nimport lombok.Data; import java.util.List; /** * @author zjxjwxk */ @Data public class PageChunk\u0026lt;T\u0026gt; { private List\u0026lt;T\u0026gt; content; private int totalPages; private long totalElements; private int pageNumber; private int numberOfElements; } 同时，我根据业务需求对商品信息进行了DTO的包装，（只需要商品id，名称和价格即可）。\nimport lombok.Data; /** * @author zjxjwxk */ @Data public class GoodsDTO { private Integer goodsId; private String name; private Integer price; } 用 PageChunk 替代 Page 编写以下 getPageChunk 方法用于将 Page 对象转化为 PageChunk 对象，仅仅提取 Page 对象中所需要的Content 和一些分页信息，将 PageChunk 对象封装并返回。编写 getGoodsDTO 方法用于简化商品信息。\n@Service(\u0026#34;GoodsService\u0026#34;) public class GoodsServiceImpl implements GoodsService { private final GoodsRepository goodsRepository; @Autowired public GoodsServiceImpl(GoodsRepository goodsRepository) { this.goodsRepository = goodsRepository; } @Override public ServerResponse getList(String keyword, Integer categoryId, Integer pageNum, Integer pageSize, String orderBy) { PageRequest pageRequest = PageRequest.of(pageNum - 1, pageSize); Page\u0026lt;Goods\u0026gt; goodsPage = goodsRepository.findByCategoryId(categoryId, pageRequest); return ServerResponse.createBySuccess(getPageChunk(goodsPage)); } private PageChunk\u0026lt;GoodsDTO\u0026gt; getPageChunk(Page\u0026lt;Goods\u0026gt; goodsPage) { PageChunk\u0026lt;GoodsDTO\u0026gt; pageChunk = new PageChunk\u0026lt;\u0026gt;(); pageChunk.setContent(getGoodsDTO(goodsPage.getContent())); pageChunk.setTotalPages(goodsPage.getTotalPages()); pageChunk.setTotalElements(goodsPage.getTotalElements()); pageChunk.setPageNumber(goodsPage.getPageable().getPageNumber() + 1); pageChunk.setNumberOfElements(goodsPage.getNumberOfElements()); return pageChunk; } private List\u0026lt;GoodsDTO\u0026gt; getGoodsDTO(List\u0026lt;Goods\u0026gt; goodsList) { List\u0026lt;GoodsDTO\u0026gt; goodsDTOList = new ArrayList\u0026lt;\u0026gt;(); for (Goods goods : goodsList) { GoodsDTO goodsDTO = new GoodsDTO(); goodsDTO.setGoodsId(goods.getGoodsId()); goodsDTO.setName(goods.getName()); goodsDTO.setPrice(goods.getPrice()); goodsDTOList.add(goodsDTO); } return goodsDTOList; } } 为了返回 JSON 数据，我自定义了一个 ServerResponse 服务响应对象，它的作用是让我们返回的 JSON 有一个通用的格式\n简化后的结果 { \u0026#34;status\u0026#34;: 0, \u0026#34;data\u0026#34;: { \u0026#34;content\u0026#34;: [ { \u0026#34;goodsId\u0026#34;: 8, \u0026#34;name\u0026#34;: \u0026#34;Clarks 男 Tri Spark生活休闲鞋26135668\u0026#34;, \u0026#34;price\u0026#34;: 459 }, { \u0026#34;goodsId\u0026#34;: 9, \u0026#34;name\u0026#34;: \u0026#34;Adidas三叶草 男 休闲跑步鞋 STAN SMITH M20324\u0026#34;, \u0026#34;price\u0026#34;: 415 }, { \u0026#34;goodsId\u0026#34;: 10, \u0026#34;name\u0026#34;: \u0026#34;Skechers 斯凯奇 SKECHERS SPORT系列 男 绑带运动鞋 999732-NVOR\u0026#34;, \u0026#34;price\u0026#34;: 355 }, { \u0026#34;goodsId\u0026#34;: 11, \u0026#34;name\u0026#34;: \u0026#34;Saucony 圣康尼 RSP 男 休闲跑步鞋 KINETA RELAY S2524465\u0026#34;, \u0026#34;price\u0026#34;: 479 }, { \u0026#34;goodsId\u0026#34;: 12, \u0026#34;name\u0026#34;: \u0026#34;Mustang 男 帆布鞋休闲运动 4058-305（亚马逊进口直采,德国品牌）\u0026#34;, \u0026#34;price\u0026#34;: 324 }, { \u0026#34;goodsId\u0026#34;: 13, \u0026#34;name\u0026#34;: \u0026#34;Clarks 男 Tri Spark生活休闲鞋26135655\u0026#34;, \u0026#34;price\u0026#34;: 123425 }, { \u0026#34;goodsId\u0026#34;: 14, \u0026#34;name\u0026#34;: \u0026#34;New Balance 574系列 男 休闲跑步鞋 ML574EG-D\u0026#34;, \u0026#34;price\u0026#34;: 324 } ], \u0026#34;totalPages\u0026#34;: 3, \u0026#34;totalElements\u0026#34;: 20, \u0026#34;pageNumber\u0026#34;: 2, \u0026#34;numberOfElements\u0026#34;: 7 } } ","permalink":"https://zjxjwxk.github.io/posts/spring-boot/spring-boot-%E7%AE%80%E5%8C%96%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2page%E6%8E%A5%E5%8F%A3%E7%9A%84json%E5%93%8D%E5%BA%94/","summary":"\u003ch3 id=\"多余的分页信息\"\u003e多余的分页信息\u003c/h3\u003e\n\u003cp\u003eSpring Data 的 Page 接口进行数据分页返回了很多很多垃圾信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;status\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;content\u0026#34;\u003c/span\u003e: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;goodsId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;producerId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;categoryId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;耐克sb滑板鞋\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;price\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;stock\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;status\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;正常\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;createTime\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2019-02-02T03:48:33.000+0000\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;updateTime\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;goodsId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;producerId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;categoryId\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;阿迪达斯小白鞋\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;price\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;stock\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e300\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;status\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;正常\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;createTime\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2019-02-02T03:48:59.000+0000\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;updateTime\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        ],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;pageable\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;sort\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;sorted\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;unsorted\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#f92672\"\u003e\u0026#34;empty\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;offset\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;pageSize\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;pageNumber\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;paged\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;unpaged\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;last\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;totalPages\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;totalElements\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;size\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;number\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;numberOfElements\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;sort\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;sorted\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;unsorted\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e\u0026#34;empty\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;first\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e\u0026#34;empty\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"实际需要的分页信息\"\u003e实际需要的分页信息\u003c/h3\u003e\n\u003cp\u003e实际上我只需要下面这些分页信息：\u003c/p\u003e","title":"Spring Boot 简化分页查询Page接口的JSON响应"},{"content":"Spring Cloud Eureka 基于 Netflix Eureka 做了二次封装 两个组件组成： Eureka Server 注册中心 作为具有服务注册功能的服务器，是服务注册中心，系统中的其他微服务使用 Eureka Client 连接到Eureka Server ，并维持心跳连接以监控各个微服务是否正常运行。 Eureka Client 服务注册 用于简化与服务器的交互，作为轮询负载均衡器，并提供服务的故障切换支持。 启动 Eureka Server 1. 创建Spring项目 2. 填充项目信息 3. 选择项目类型为 Cloud Discovery 中的 Eureka Server 4. 完成创建 5. 添加注解 @EnableEurekaServer @SpringBootApplication @EnableEurekaServer public class EurekaApplication { public static void main(String[] args) { SpringApplication.run(EurekaApplication.class, args); } } 6. 配置 application.yml eureka: client: service-url: defaultZone: http://localhost:8761/eureka/ register-with-eureka: false spring: application: name: eureka server: port: 8761 7. 启动 Eureka Server 这样，一个简单的Eureka Server就启动完成了。\n","permalink":"https://zjxjwxk.github.io/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/","summary":"\u003ch1 id=\"spring-cloud-eureka\"\u003eSpring Cloud Eureka\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e基于 Netflix Eureka 做了二次封装\u003c/li\u003e\n\u003cli\u003e两个组件组成：\n\u003cul\u003e\n\u003cli\u003eEureka Server 注册中心\n\u003cul\u003e\n\u003cli\u003e作为具有服务注册功能的服务器，是服务注册中心，系统中的其他微服务使用 Eureka Client 连接到Eureka Server ，并维持心跳连接以监控各个微服务是否正常运行。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eEureka Client 服务注册\n\u003cul\u003e\n\u003cli\u003e用于简化与服务器的交互，作为轮询负载均衡器，并提供服务的故障切换支持。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"启动-eureka-server\"\u003e启动 Eureka Server\u003c/h1\u003e\n\u003ch2 id=\"1-创建spring项目\"\u003e1. 创建Spring项目\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"创建Spring项目\" loading=\"lazy\" src=\"/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/images/image-20190131155138441.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2-填充项目信息\"\u003e2. 填充项目信息\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"填充项目信息\" loading=\"lazy\" src=\"/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/images/image-20190131155241197.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3-选择项目类型为-cloud-discovery-中的-eureka-server\"\u003e3. 选择项目类型为 Cloud Discovery 中的 Eureka Server\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"选择Eureka Server\" loading=\"lazy\" src=\"/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/images/image-20190131155453826.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4-完成创建\"\u003e4. 完成创建\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"完成创建\" loading=\"lazy\" src=\"/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/images/image-20190131160337079.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"5-添加注解-enableeurekaserver\"\u003e5. 添加注解 @EnableEurekaServer\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@SpringBootApplication\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e@EnableEurekaServer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEurekaApplication\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estatic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e(String\u003cspan style=\"color:#f92672\"\u003e[]\u003c/span\u003e args) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        SpringApplication.\u003cspan style=\"color:#a6e22e\"\u003erun\u003c/span\u003e(EurekaApplication.\u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e, args);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"6-配置-applicationyml\"\u003e6. 配置 application.yml\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-yml\" data-lang=\"yml\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eeureka\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eclient\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eservice-url\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003edefaultZone\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003ehttp://localhost:8761/eureka/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003eregister-with-eureka\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003espring\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eapplication\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003ename\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003eeureka\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eserver\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003eport\u003c/span\u003e: \u003cspan style=\"color:#ae81ff\"\u003e8761\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"7-启动-eureka-server\"\u003e7. 启动 Eureka Server\u003c/h2\u003e\n\u003cp\u003e\u003cimg alt=\"Eureka Server信息\" loading=\"lazy\" src=\"/posts/spring-cloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/images/image-20190131172458551.png\"\u003e\u003c/p\u003e","title":"Spring Cloud Eureka"},{"content":"images 定义 The microservice architectural style is an approach to developing a single application running as a suite of small services, each running its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies.\n一系列微小的服务共同组成 跑在自己的进程里 每个服务为独立的业务开发 独立部署 分布式的管理 背景 随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。\n单一应用架构 当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。\n垂直应用架构 当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。\n分布式服务架构 当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。\n流动计算架构 当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。\n单体架构 优点 容易测试 容易部署 缺点 开发效率低 代码维护难 部署不灵活 稳定性不高 扩展性不够 分布式定义 旨在支持应用程序和服务的开发，可以利用物理架构，由多个自治的处理元素，不共享主内存，但通过网络发送消息合作。——Leslie Lamport\n简单的微服务 微服务架构的基础框架/组件 服务注册发现\n服务网关（Service Gateway）\n后端通用服务（也称中间层服务 Middle Tire Service）\n前端服务（也称边缘服务 Edge Service）\n聚合 对多个API调用进行聚合，从而减少客户端的请求数 裁剪 对返回不同的设备的内容进行裁剪（PC、移动端） 两大阵营 阿里系 Dubbo（服务化治理） Zookeeper（服务注册中心） Spring MVC or SpringBoot \u0026hellip; Spring Cloud Spring Cloud Netflix Eureka SpringBoot \u0026hellip; Spring Cloud 是什么 Spring Cloud 是一个开发工具集，含了多个子项目 利用Spring Boot的开发便利 主要是基于对Netflix开源组件的进一步封装 Spring Cloud 简化了分布式开发 掌握如何使用，更要理解分布式、架构的特点 ","permalink":"https://zjxjwxk.github.io/posts/spring-cloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/","summary":"\u003ch1 id=\"images\"\u003eimages\u003c/h1\u003e\n\u003ch2 id=\"定义\"\u003e定义\u003c/h2\u003e\n\u003cp\u003eThe microservice architectural style is an approach to developing a single application running as \u003cstrong\u003ea suite of small services\u003c/strong\u003e, each \u003cstrong\u003erunning its own process\u003c/strong\u003e and communicating with lightweight mechanisms, often an HTTP resource API. These services are \u003cstrong\u003ebuilt around business capabilities\u003c/strong\u003e and \u003cstrong\u003eindependently deployable\u003c/strong\u003e by fully automated deployment machinery. There is \u003cstrong\u003ea bare minimum of centralized management of these services\u003c/strong\u003e, which may be written in different programming languages and use different data storage technologies.\u003c/p\u003e","title":"微服务简介"},{"content":"运行jar包命令 java -jar application.jar 当前ssh窗口被锁定，可按CTRL + C打断程序运行，或直接关闭窗口让程序退出。\n那如何让窗口不被锁定？\n方法一 java -jar application.jar \u0026amp; \u0026amp;代表在后台运行。\n当前ssh窗口不被锁定，但是当窗口关闭时，程序中止运行。\n继续改进，如何让窗口关闭时，程序仍然运行？\n方法二 nohup java -jar application.jar \u0026amp; nohup 意思是不挂断运行命令,当账户退出或终端关闭时,程序仍然运行。\n那怎么不打印该程序输出的内容，而写入某个文件中呢？\n方法四 nohup java -jar application.jar \u0026gt;out.txt \u0026amp; 当用 nohup 命令执行作业时，缺省情况下该作业的所有输出被重定向到nohup.out的文件中，除非另外指定了输出文件，如 out.txt。\ncommand \u0026gt;out.txt是将command的输出重定向到out.txt文件，即输出内容不打印到屏幕上，而是输出到out.txt文件中。\n通过jobs命令查看后台运行任务 jobs 那么就会列出所有后台执行的作业，并且每个作业前面都有个编号。\n如果想将某个作业调回前台控制，只需要 fg + 编号即可。 fg 23 查看某端口占用的线程的pid netstat -nlp |grep :9181 ","permalink":"https://zjxjwxk.github.io/posts/linux/centos/centos-jar%E5%8C%85%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C/","summary":"\u003ch1 id=\"运行jar包命令\"\u003e运行jar包命令\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejava -jar application.jar\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e当前ssh窗口被锁定，可按CTRL + C打断程序运行，或直接关闭窗口让程序退出。\u003c/p\u003e\n\u003cp\u003e那如何让窗口不被锁定？\u003c/p\u003e\n\u003ch1 id=\"方法一\"\u003e方法一\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejava -jar application.jar \u0026amp;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u0026amp;代表在后台运行。\u003c/p\u003e\n\u003cp\u003e当前ssh窗口不被锁定，但是当窗口关闭时，程序中止运行。\u003c/p\u003e\n\u003cp\u003e继续改进，如何让窗口关闭时，程序仍然运行？\u003c/p\u003e\n\u003ch1 id=\"方法二\"\u003e方法二\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enohup java -jar application.jar \u0026amp;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003enohup 意思是不挂断运行命令,当账户退出或终端关闭时,程序仍然运行。\u003c/p\u003e\n\u003cp\u003e那怎么不打印该程序输出的内容，而写入某个文件中呢？\u003c/p\u003e\n\u003ch1 id=\"方法四\"\u003e方法四\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enohup java -jar application.jar \u0026gt;out.txt \u0026amp;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e当用 nohup 命令执行作业时，缺省情况下该作业的所有输出被重定向到nohup.out的文件中，除非另外指定了输出文件，如 out.txt。\u003c/p\u003e\n\u003cp\u003ecommand \u0026gt;out.txt是将command的输出重定向到out.txt文件，即输出内容不打印到屏幕上，而是输出到out.txt文件中。\u003c/p\u003e\n\u003ch3 id=\"通过jobs命令查看后台运行任务\"\u003e通过jobs命令查看后台运行任务\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejobs\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e那么就会列出所有后台执行的作业，并且每个作业前面都有个编号。\u003c/p\u003e\n\u003ch3 id=\"如果想将某个作业调回前台控制只需要-fg--编号即可\"\u003e如果想将某个作业调回前台控制，只需要 fg + 编号即可。\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003efg \u003cspan style=\"color:#ae81ff\"\u003e23\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"查看某端口占用的线程的pid\"\u003e查看某端口占用的线程的pid\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enetstat -nlp |grep :9181\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"CentOS jar包后台运行"},{"content":"General characteristics of a project A project is a temporary endeavour undertaken to create a unique product or service. It is specific, timely, usually multidisciplinary, and always conflict ridden. Projects are parts of overall programs and may be broken down into tasks, subtasks, and further if desired.\nVary in size Vary in type Have desired completion dates Requires various kinds of knowledge Requires domain knowledge Requires team work Requires responsibilities and authorities Do not exist in isolation General management vs. Project management General management Organizational management Portfolio management Program management Not time limited? No completion dates? No managerial hierarchy? Routine activities Annual budgeting Project management Project management is the application of knowledge, skills, tools, and techniques to project activities to meet the project requirements Five categories of activities Initiating Planning Executing Monitoring and Controlling Closing How does the world look like? Uncertainty Plans go awry Even the closest future is unpredictable Chance events occur frequently The life is a rough road We need to do trade-offs every day We constantly negotiate We need flexibility Risk management “Project management is risk management” Identify potential problems before they occur Put preventive actions in place before unrecoverable harm occurs Risks possible events that may affect the project negatively Problems events that have or will affect the project negatively Stages in risk management: Risk identification; project, product and business risks Risk analysis; probability and consequences, triggers Risk planning; how to address risks – eliminate, reduce, ignore Risk monitoring; controlling and updating the risks Decision matrix Gantt chart RACI matrix Usually derived from the WBS Clarify responsibilities R Responsible, who is responsible for actually doing the activity A Accountable, who is accountable for the completion of the task C Consult, who should be consulted I Informed, who must be informed\nNote that combinations may exist, e.g. AR, CI, AC\nExample Critical path A path from the projects start event to its finish event that, if delayed, will delay the completion date Brainstorming Sprint, Sprint backlog Sprint A fixed period of time, usually 2 or 3 weeks but can be more\nAlways use the same fixed period\nThe development team should have full authority during the sprint\nThe Sprint goal must be defined in advance\nThe team can change (the depth of) the functionality of the Sprint, as long as it meets its sprint goal\nProduct backlog Requirements gathering for the Product Backlog Identify the stakeholders and their goals Identify the different categories of stakeholders Ask the question: “Why do you need this?” What are the business objectives and goals? How do we measure goal accomplishment? The goals shall be SMART: Specific Measurable Acceptable Realistic Time-based Gather requirements for the Product Backlog Meet the stakeholders Understand the stakeholders needs Use the “Tree and Forest” analogy Identify the trees, branches and leaves Use a top down approach mixed with bottom-up? The leaves may be user stories Group the leaves into branches Group the branches into trees Verify the stories with the stakeholders The CUTFIT rules Validate the user stories Consistent no conflict between user stories Unambiguous one interpretation Testable test cases can be created Feasible possible to implement Independent independent of other user stories Traceable you can link the story to the project goals Do not write stories endlessly. You can stop when you cannot decompose anymore or when you can derive tasks with working effort of approximately one day Product Backlog Item (PBI), example Scrum board Some thoughts about the Backlog Scrum in action recommends items to be stories (branches) Frequently, in practice, it seems to be a mix of stories, features, functions, tasks, improvements and incidents If you choose stories, you should consider defining tasks (leaves) in the stories The tasks should be transferred to activities in the sprint planning Burndown charts \u0026amp; EVM method Earned Value Method - EVM Trend projection - EV Agile and Scrum tracking Release tracking Tracking story progress Release burndown chart Sprint tracking Tracking task progress Sprint burndown chart Burndown charts Displays the remaining effort for a given period of time Do have good value for the stakeholders and the team Visualization is a good thing to do Conversation starters Over time it will give you the average number of points for a sprint You will learn the teams velocity You need to have a clear definition of done (DoD) Sprint burndown chart Burndown charts X axis displays working days Y axis displays remaining effort Ideal effort is (may be) a good guideline Consists of real progress of effort Scrum team Why is Scrum effective? Systematic reduction of problems and risks A leaner software development cycle More adaptive process People´s motivation and pride are in focus Monitoring and Controlling Determine the current status of the project schedule Influencing the factors that create schedule changes Determining if the project schedule has changed Managing the actual changes as they occur Monitoring All parties, stakeholders and others, must have available the information required to exercise control over the project An effective information system is needed Automated and manual Collection, recording and reporting project information Activities and performance need to be monitored Controlling Uses monitored data and information to bring actual performance into agreement with the plan Do we have the right information? How shall we interpret the information? How to balance into decisions? Without control there would be confusion, scope risks and conflict among stakeholders Chaos could be the norm of the project Monitoring and Controlling are easily treated together Execute plan - Design the monitoring system Identify characteristics of scope, time and cost Identify the goals, the objectives Define the boundaries when do we need to take action? Thresholds. Monitor progress against the sub-goals (e.g. milestones, sprint goals) Define data gathering mechanisms Define communication plan Measure activities, but always measure against RESULTS Define the system before-hand, up front Obtain results Decide on the data format Frequency, e.g. occurrence of event Raw numbers, actual amount Subjective numeric ratings, estimates, ranking Indicators, indirect measures Verbal characterization, team spirit, soft issues, feelings Collect data Decide on how to collect the defined data. More easily and preferably automated. Analyse results Analyse BEFORE reporting Simple aggregation can be done Compare with the planned results Averages, summaries, medians, trends Examples Number of activities done/left Actual cost/remaining cost Number of bugs per unit Performance or velocity You should use data for discovering, and as input for decision making Identify variance and Analyse results Identify deviations from the plan Variances can lead to severe problems The goal is to identify variances as early as possible Use plots, bars, lines, dots, etc. for analyzing trends (more later) Compare the variances towards the planned (allowed) variances Variances Acceptable – continue to monitor Unacceptable – additional action is required Consult personnel Consult expertise Could it generate more problems? Any additional risks? Call for meeting, analyze in groups Identify root cause and consider options Do not immediately adopt the first identified solution Try to find the optimal solution Analyse side-effects to the different solutions Resources needed? Cost? Time? Need help/decisions from sponsor/stakeholders? Corrective action and implementation Decide on corrective actions Review options Define success measures if possible Make choices of actions Who decide? Implement How will it be implemented? By whom? When? Who is responsible? Analyse the results Analyse the results of the corrective actions Compare against the defined measurements If unacceptable result then go to root cause analysis (again) If acceptable close the problem and store into lessons learned Repository of Lessons Learned: Take care of your Best Practices Avoid the situation from re-occurring Reporting Different kinds of reports Status reports Progress reports Forecast report Time/Cost report Variance report Presentations Demos SWOT analysis Strengths and Weaknesses Internal factors Human factors Finances Organisational factors Physical resources Experiences and knowledge Opportunities and Threats Trends New research Funding Competitors Competence Channels (marketing) SWOT analysis Prioritize elements in the analysis Define possible activities Analyse if it is feasible Decide on further management and activities Close down strategic direction if found necessary Keep the SWOT-analysis continuously updated Focus on the prioritized elements Stakeholder Management Definition of the term stakeholder: An individual A group An organisation who may affect, be affected by, or perceive itself to be affected by a decision, activity, or outcome of a project. Project governance the alignment of the project stakeholders´ needs or objectives Stakeholder can be The sponsor, the one who provides the resources and support Customers and users persons or organisations that will approve and manage the project´s product, service or result. Sellers provides components or services necessary for the project Business partners provides special expertise, e.g. installation, training, support. Example Organizational groups internal groups affected by the project activities Functional managers human resource, financial, accounting, procurement, IT Other stakeholders government experts, subject matter experts, consultants, Project Cost estimation Budgeting the project Must (always) be approved by management Resources must be allocated based on the estimations Should be connected to the vision and goals Should be supporting to the portfolio and program management Upper management is always (?) relating the project success to its relation to the approved budget Budgeting the project, necessities Shall always be related to the stakeholder requirements You need to have an idea of which resources you have Correct data must be collected Timely reporting Strong focus on resource and cost predictions Confirm approval of changes Consider always changed cost predictions when decisions are taken Consider changed cost predictions when problems occur Estimate changed cost predictions if risks become problems Forecasting What resources will be needed? How much resources will be needed? When will they be needed? How much will the resources cost? The resource cost can be differentiated by Unit, role Individual, level of competence or salary Need to consider Unit (hours, days, weeks, money,…) Level of precision (round up or down) Level of accuracy (range) Links to backlog and stories Threshold (agreed variations, if any) Performance measurement (earned value or story points left) Cost estimation tools and techniques Expert judgment Analogous estimation Parametric estimation Top-Down estimating Bottom-Up estimating Three-Point estimating Group-decision techniques Wide-band Delphi technique User story \u0026amp; story points User story A story is a feature a bit of functionality with some characteristics (non-functional characteristics) Keep the stories simple and as short as possible A story is an agreement between the customer and the supplier It must provide some value to the customer Stories should be independent of each other Stories must be testable Examples As a power user, I can specify files or folders to backup based on file size, date created and date modified. As a user, I can indicate folders not to backup so that my backup drive isn\u0026rsquo;t filled up with things I don\u0026rsquo;t need saved. As a consumer, I want shopping cart functionality to easily purchase items online. Agile and Scrum Agile and Scrum Agile volatile, easy to move, easy to change Scrum start the game over again. Was originally launched as a contrast to plan-driven development The goal is: To produce software more effectively Embrace change Embrace change quickly! The change towards agile is not easy You need to have the organization with you See change as something positive You need to change your mind-set Scrum is a risk reduction mechanism a leaner software process a more adaptive software project management process A framework based on a team´s self-organization, motivation, ownership and pride. Scrum master Ensuring that Scrum values, practices and rules are used Represents the management and the team to each other Guide and coach the team towards achieving the goals Should protect the team towards outside disturbances Support in keeping track of progress Organize retrospectives to help the team and the organization to learn how to be more effective Enforces immediate decisions needed 7 qualities In-depth theoretical and practical knowledge about Scrum Great servant-leadership ability Strong organizational skills Great communication skills Excellent presentation skills Conflict resolution skills Great human development skills Product Owner Guards the product vision Ensure the fulfilment of goals Focus is on delivering business values and results The dependence of a good product owner is high The focus is to control the backlog by working with the stakeholders identified Gather requirements for the backlog Solely controls the backlog Collaborate with the team and the scrum master to do release planning Guide and support the team Keeps himself/herself updated with project progress Are available to the team, give the team feedback Is one person, not a team 7 qualities Know how to manage stakeholder´s expectations and sometimes their conflicting priorities Have a clear vision and knowledge of the product Know how to gather the requirements and turn them into a good product backlog Be available for the team Know how to be a good organizer Know how to communicate better than the average person Knows that it is all about servant leadership The Development Team, the Scrum team Self-managed and self-organized Estimate backlog items, stories Turns items, stories into tasks to work on in the Sprints Commits to the sprint goals Keeps track of progress Responsible for Sprint demos The team should solve their internal problems by themselves The team should be small, 7 +- 2 persons Minimize communication interfaces Teams should be cross-functional, including different capabilities Open work environments are to be preferred Agile Manifesto Individuals and interactions——over processes and tools Working software——over comprehensive documentation Customer collaboration——over contract negotiation Responding to change——over following a plan Daily Scrum meetings Where the team communicates Approximately 15 minutes, short meetings Stand-up meeting Focus on three things: What has been done since the previous meeting? What are we going to do? What risks and problems exists? Removing obstacles Making necessary decisions Leadership style, Situational leadership style Project Manager The person assigned by the performing organization to lead the team that is responsible for achieving the project objectives Interpersonal skills needed Leadership Team building Motivation Communication Influencing Decision making Political (company and business) awareness Cultural awareness Negotiation Trust building Conflict (healthy and unhealthy) management Coaching ","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/applied-software-project-management/","summary":"\u003ch1 id=\"general-characteristics-of-a-project\"\u003eGeneral characteristics of a project\u003c/h1\u003e\n\u003cp\u003eA project is a temporary endeavour undertaken to create a unique product or service. It is specific, timely, usually multidisciplinary, and always conflict ridden. Projects are parts of overall programs and may be broken down into tasks, subtasks, and further if desired.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVary in size\u003c/li\u003e\n\u003cli\u003eVary in type\u003c/li\u003e\n\u003cli\u003eHave desired completion dates\u003c/li\u003e\n\u003cli\u003eRequires various kinds of knowledge\u003c/li\u003e\n\u003cli\u003eRequires domain knowledge\u003c/li\u003e\n\u003cli\u003eRequires team work\u003c/li\u003e\n\u003cli\u003eRequires responsibilities and authorities\u003c/li\u003e\n\u003cli\u003eDo not exist in isolation\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"general-management-vs-project-management\"\u003eGeneral management vs. Project management\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eGeneral management\n\u003cul\u003e\n\u003cli\u003eOrganizational management\u003c/li\u003e\n\u003cli\u003ePortfolio management\u003c/li\u003e\n\u003cli\u003eProgram management\u003c/li\u003e\n\u003cli\u003eNot time limited?\u003c/li\u003e\n\u003cli\u003eNo completion dates?\u003c/li\u003e\n\u003cli\u003eNo managerial hierarchy?\u003c/li\u003e\n\u003cli\u003eRoutine activities\u003c/li\u003e\n\u003cli\u003eAnnual budgeting\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eProject management\n\u003cul\u003e\n\u003cli\u003eProject management is the application of knowledge, skills, tools, and techniques to project activities to meet the project requirements\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"five-categories-of-activities\"\u003eFive categories of activities\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eInitiating\u003c/li\u003e\n\u003cli\u003ePlanning\u003c/li\u003e\n\u003cli\u003eExecuting\u003c/li\u003e\n\u003cli\u003eMonitoring and Controlling\u003c/li\u003e\n\u003cli\u003eClosing\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"how-does-the-world-look-like\"\u003eHow does the world look like?\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eUncertainty\u003c/li\u003e\n\u003cli\u003ePlans go awry\u003c/li\u003e\n\u003cli\u003eEven the closest future is unpredictable\u003c/li\u003e\n\u003cli\u003eChance events occur frequently\u003c/li\u003e\n\u003cli\u003eThe life is a rough road\u003c/li\u003e\n\u003cli\u003eWe need to do trade-offs every day\u003c/li\u003e\n\u003cli\u003eWe constantly negotiate\u003c/li\u003e\n\u003cli\u003eWe need flexibility\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"risk-management\"\u003eRisk management\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e“Project management is risk management”\u003c/li\u003e\n\u003cli\u003eIdentify potential problems before they occur\u003c/li\u003e\n\u003cli\u003ePut preventive actions in place before unrecoverable harm occurs\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"risks\"\u003eRisks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003epossible events that may affect the project negatively\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"problems\"\u003eProblems\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eevents that have or will affect the project negatively\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"stages-in-risk-management\"\u003eStages in risk management:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eRisk identification; project, product and business risks\u003c/li\u003e\n\u003cli\u003eRisk analysis; probability and consequences, triggers\u003c/li\u003e\n\u003cli\u003eRisk planning; how to address risks – eliminate, reduce, ignore\u003c/li\u003e\n\u003cli\u003eRisk monitoring; controlling and updating the risks\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"Risk reporting Matrix\" loading=\"lazy\" src=\"/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/applied-software-project-management/images/1548175505399.png\"\u003e\u003c/p\u003e","title":"Applied Software Project Management"},{"content":"CH 1. What is software architecture? What is software architecture The software architecture of a system is the set of structures needed to reason about the system, which comprise software elements, relations among them, and properties of both.\nTo find out what users of the system think about the system. × To assist in marketing activities. × To make estimate for projects planning purposes. √ To use as input for dividing up the work into tasks. √ To analyze and predict characteristics of the implemented system. √ To present the future development of the product. × Categories of structures First, some structures partition systems into implementation units called modules. Other structures are dynamic, meaning that they focus on the way the elements interact with each other at runtime to carry out the system’s functions. we will call runtime structures component-and-connector (C\u0026amp;C) structures. A third kind of structure describes the mapping from software structures to the system’s organizational, developmental, installation, and execution environments. These mappings are called allocation structures. Three Kinds of Structures Module structures embody decisions as to how the system is to be structured as a set of code or data units that have to be constructed or procured.\nDecomposition structure. The units are modules that are related to each other by the is-a-submodule-of relation, showing how modules are decomposed into smaller modules recursively until the modules are small enough to be easily understood. Uses structure. The units are related by the uses relation, a specialized form of dependency. Layer structure. The modules in this structure are called layers. A layer is an abstract “virtual machine” that provides a cohesive set of services through a managed interface. Component-and-connector structures embody decisions as to how the system is to be structured as a set of elements that have runtime behavior (components) and interactions (connectors).\nService structure. The units here are services that interoperate with each other by service coordination mechanisms. Concurrency structure. This component-and-connector structure allows the architect to determine opportunities for parallelism and the locations where resource contention may occur. Allocation structures embody decisions as to how the system will relate to nonsoftware structures in its environment (such as CPUs, file systems, networks, development teams, etc.).\nDeployment structure. The deployment structure shows how software is assigned to hardware processing and communication elements. Implementation structure. This structure shows how software elements (usually modules) are mapped to the file structure(s) in the system’s development, integration, or configuration control environments. Work assignment structure. This structure assigns responsibility for implementing and integrating the modules to the teams who will carry it out. CH 4. Understanding Quality Attributes System requirements can be categorized as Functional requirements. These requirements state what the system must do, and how it must behave or react to run-time stimuli.\nQuality attribute requirements. These requirements annotate (qualify) functional requirements. Qualification might be how fast the function must be performed, how resilient it must be to erroneous input, how easy the function is to learn, etc.\nConstraints. A constraint is a design decision with zero degrees of freedom. That is, it\u0026rsquo;s a design decision that has already been made for you.\nQuality Attribute Requirements six parts Source of stimulus. This is some entity (a human, a computer system, or any other actuator) that generated the stimulus. Stimulus. The stimulus is a condition that requires a response when it arrives at a system. Environment. The stimulus occurs under certain conditions. The system may be in an overload condition or in normal operation, or some other relevant state. For many systems, “normal” operation can refer to one of a number of modes. For these kinds of systems, the environment should specify in which mode the system is executing. Artifact. Some artifact is stimulated. This may be a collection of systems, the whole system, or some piece or pieces of it. Response. The response is the activity undertaken as the result of the arrival of the stimulus. Response measure. When the response occurs, it should be measurable in some fashion so that the requirement can be tested. Guiding Quality Design Decisions Architecture design is a systematic approach to making design decisions. We categorize the design decisions that an architect needs to make as follows: Allocation of responsibilities Coordination model Data model Management of resources Mapping among architectural elements Binding time decisions Choice of technology Coordination model Software works by having elements interact with each other through designed mechanisms. These mechanisms are collectively referred to as a coordination model. Decisions about the coordination model include these: Identifying the elements of the system that must coordinate, or are prohibited from coordinating. Determining the properties of the coordination, such as timeliness, currency, completeness, correctness, and consistency. Choosing the communication mechanisms (between systems, between our system and external entities, between elements of our system) that realize those properties. Important properties of the communication mechanisms include stateful versus stateless, synchronous versus asynchronous, guaranteed versus nonguaranteed delivery, and performance-related properties such as throughput and latency. Example: Both asynchronous communication and synchronous communication can be used in the same system Asynchronous communication does not block the program thread until a response is ready Asynchronous communication guarantees when a response is returned Data model Every system must represent artifacts of system-wide interest—data—in some internal fashion. The collection of those representations and how to interpret them is referred to as the data model. Decisions about the data model include the following: Choosing the major data abstractions, their operations, and their properties. This includes determining how the data items are created, initialized, accessed, persisted, manipulated, translated, and destroyed. Compiling metadata needed for consistent interpretation of the data. Organizing the data. This includes determining whether the data is going to be kept in a relational database, a collection of objects, or both. If both, then the mapping between the two different locations of the data must be determined. Example: Choosing the major data abstractions, their operations, and their properties. Compiling metadata needed for consistent interpretation of the data. Organizing the data. Binding time decisions Binding time decisions introduce allowable ranges of variation. This variation can be bound at different times in the software life cycle by different entities— from design time by a developer to runtime by an end user. A binding time decision establishes the scope, the point in the life cycle, and the mechanism for achieving the variation. The decisions in the other six categories have an associated binding time decision. Examples of such binding time decisions include the following: For allocation of responsibilities, you can have build-time selection of modules via a parameterized makefile. For choice of coordination model, you can design runtime negotiation of protocols. For resource management, you can design a system to accept new peripheral devices plugged in at runtime, after which the system recognizes them and downloads and installs the right drivers automatically. For choice of technology, you can build an app store for a smartphone that automatically downloads the version of the app appropriate for the phone of the customer buying the app. Example: Setting the hostname of the server in a configuration file Using the user input to set the destination of a message Using inheritance in the code to execute the different subclass implementations depending on program state Quality attributes Availability Interoperability Modifiability Performance Security Testability Usability Development time qualities Modifiability Testability CH5. Availability Terms Fault A failure’s cause is called a fault. A fault can be either internal or external to the system under consideration. Intermediate states between the occurrence of a fault and the occurrence of a failure are called errors. Failure A failure is the deviation of the system from its specification, where the deviation is externally visible. Fault and failure Fault Internal or external deviation of correct function Failure When the system cannot provide its intended service Caused by faults that could not be handled/repaired Resilient Faults can be prevented, tolerated, removed, or forecast. In this way a system becomes “resilient” to faults. Degraded operation mode we are often concerned with the level of capability that remains when a failure has occurred—a degraded operating mode. MTBF mean time between failures MTTR mean time to repair Formula $$ MTBF\\over(MTBF+MTTR)\u0013 $$\nService Level Agreement, SLA The availability provided by a computer system or hosting service is frequently expressed as a service-level agreement. This SLA specifies the availability level that is guaranteed and, usually, the penalties that the computer system or hosting service will suffer if the SLA is violated. Tactic Detect Faults Heart-beat Heartbeat is a fault detection mechanism that employs a periodic message exchange between a system monitor and a process being monitored. Ping/Echo Ping/echo refers to an asynchronous request/response message pair exchanged between nodes, used to determine reachability and the round-trip delay through the associated network path. Heart-beat tactic vs. Ping/Echo- tactic The big difference between heartbeat and ping/echo is who holds the responsibility for initiating the health check—the monitor or the component itself. Recover from Faults Active Redundancy Active redundancy (hot spare). This refers to a configuration where all of the nodes (active or redundant spare) in a protection group receive and process identical inputs in parallel, allowing the redundant spare(s) to maintain synchronous state with the active node(s). Passive Redundancy Passive redundancy (warm spare). This refers to a configuration where only the active members of the protection group process input traffic; one of their duties is to provide the redundant spare(s) with periodic state updates. Spare Spare (cold spare). Cold sparing refers to a configuration where the redundant spares of a protection group remain out of service until a fail-over occurs, at which point a power-on-reset procedure is initiated on the redundant spare prior to its being placed in service. Rollback Rollback. This tactic permits the system to revert to a previous known good state, referred to as the “rollback line”—rolling back time—upon the detection of a failure. Fault tree Fault tree analysis is an analytical technique that specifies a state of the system that negatively impacts safety or reliability, and then analyzes the system’s context and operation to find all the ways that the undesired state could occur.\nCH7. Modifiability What is Modifiability？ Modifiability is about change and our interest in it is in the cost and risk of making change To plan for modifiability, an architect has to consider four questions: What can change? A change can occur to any aspect of a system: the functions that the system computes, the platform (the hardware, operating system, middleware), the environment in which the system operates (the systems with which it must interoperate, the protocols it uses to communicate with the rest of the world), the qualities the system exhibits (its performance, its reliability, and even its future modifications), and its capacity (number of users supported, number of simultaneous operations). What is the likelihood of the change? One cannot plan a system for all potential changes—the system would never be done, or if it was done it would be far too expensive and would likely suffer quality attribute problems in other dimensions. Although anything might change, the architect has to make the tough decisions about which changes are likely, and hence which changes are to be supported, and which are not. When is the change made and who makes it? Most commonly in the past, a change was made to source code. Changes can be made to the implementation (by modifying the source code), during compile (using compile-time switches), during build (by choice of libraries), during configuration setup (by a range of techniques, including parameter setting), or during execution (by parameter settings, plugins, etc.). A change can also be made by a developer, an end user, or a system administrator. What is the cost of the change? Making a system more modifiable involves two types of cost: The cost of introducing the mechanism(s) to make the system more modifiable The cost of making the modification using the mechanism(s) CH8. Performance Performance General Scenario Portion of Scenario Possible Values Source Internal or external to the system Stimulus Arrival of a periodic, sporadic, or stochastic event Artifact System or one or more components in the system Environment Operational mode: normal, emergency, peak load, overload Response Process events, change level of service Response Measure Latency, deadline, throughput, jitter, miss rate Tactics for Performance Control Resource Demand Manage sampling rate. If it is possible to reduce the sampling frequency at which a stream of environmental data is captured, then demand can be reduced, typically with some attendant loss of fidelity. Limit event response. Process events only up to a set maximum rate, thereby ensuring more predictable processing when the events are actually processed. Prioritize events. If not all events are equally important, you can impose a priority scheme that ranks events according to how important it is to service them. Manage Resources Increase resources. Faster processors, additional processors, additional memory, and faster networks all have the potential for reducing latency. Introduce concurrency. Concurrency can be introduced by processing different streams of events on different threads or by creating additional threads to process different sets of activities. Maintain multiple copies of computations. Reduce the contention that would occur if all computations took place on a single server. CH13. Patterns and Tactics What is a Pattern? An architectural pattern\nis a package of design decisions that is found repeatedly in practice, has known properties that permit reuse, and describes a class of architectures. Architectural Pattern A context. A recuSrring, common situation in the world that gives rise to a problem. A problem. The problem, appropriately generalized, that arises in the given context. A solution. A successful architectural resolution to the problem, appropriately abstracted. The solution for a pattern is determined and described by: A set of element types (for example, data repositories, processes, and objects) A set of interaction mechanisms or connectors (for example, method calls, events, or message bus) A topological layout of the components A set of semantic constraints covering topology, element behavior, and interaction mechanisms CH18. Architecture Document View consistency A view is consistent with its definition when: All elements that fulfills the selection criterion is in the view All relations that fulfills the selection criterion is in the view That all properties that fulfills the selection criterion is in the view THAT NO additional elements, relation or properties that does not meet the selection is in the view Elements All elements in the view must have a corresponding part in the view definition.\nRelation Only relations that meet the selection criteria must be in the view.\nProperties Properties must have values in the view.\nCriteria Selection criteria can exclude certain elements or relations from the view.\n4+1 view model Logical, Process, Development, Physical + Use Cases\n","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/software-architecture-and-quality/","summary":"\u003ch1 id=\"ch-1-what-is-software-architecture\"\u003eCH 1. What is software architecture?\u003c/h1\u003e\n\u003ch2 id=\"what-is-software-architecture\"\u003eWhat is software architecture\u003c/h2\u003e\n\u003cp\u003eThe software architecture of a system is the set of structures needed to reason about the system, which comprise software elements, relations among them, and properties of both.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eTo find out what users of the system think about the system. ×\u003c/li\u003e\n\u003cli\u003eTo assist in marketing activities. ×\u003c/li\u003e\n\u003cli\u003eTo make estimate for projects planning purposes. √\u003c/li\u003e\n\u003cli\u003eTo use as input for dividing up the work into tasks. √\u003c/li\u003e\n\u003cli\u003eTo analyze and predict characteristics of the implemented system. √\u003c/li\u003e\n\u003cli\u003eTo present the future development of the product. ×\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"categories-of-structures\"\u003eCategories of structures\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eFirst, some structures partition systems into implementation units called \u003cstrong\u003emodules\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003eOther structures are dynamic, meaning that they focus on the way the elements interact with each other at runtime to carry out the system’s functions. we will call runtime structures \u003cstrong\u003ecomponent-and-connector (C\u0026amp;C) structures\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003eA third kind of structure describes the mapping from software structures to the system’s organizational, developmental, installation, and execution environments. These mappings are called \u003cstrong\u003eallocation structures\u003c/strong\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"three-kinds-of-structures\"\u003eThree Kinds of Structures\u003c/h2\u003e\n\u003ch3 id=\"module-structures\"\u003e\u003cstrong\u003eModule structures\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eembody decisions as to how the system is to be structured as a set of code or data units that have to be constructed or procured.\u003c/p\u003e","title":"Software Architecture and Quality"},{"content":"Career decision making cycle Know the elements Communication, Analysis, Synthesis, Valuing, Execution\nKnow the definition Communication: Identifying the gap Analysis: Thinking about alternatives Synthesis: Creating likely alternatives Valuing: Prioritizing alternatives Execution: Taking action to narrow the gap\nBe able to elaborate the elements Communication: • Become aware of the gap • Discomfort, not so much fear of change • Seek assistance if needed • Emotions Analysis: • Clarify your knowledge • Clarify gap • Understand how you make decisions • Understand what influences you • What do you want? • What have you learned? • What are your values, interests and skills? • Do you want to take responsibility? • Self-awareness Synthesis: • Solve the gap • Avoid missing alternatives • Reduce to a manageable amount of options. • Brainstorm and reduce. Valuing: • Judge the benefit (and cost) • Rank • What´s the best choice? • Select an option Execution: • Convert decisions into action • Formulate a goal and a plan • Execute the plan • Plan, try, evaluate\nDescribe forces that affect our career The world is rapidly changing The economy goes up and down New companies emerges Some companies close down Unemployment goes up and down Organizational failures appears sometimes Career planning vs. workforce planning Career development What the individuals in the organization do in order to ensure their interests and future Workforce planning What the organization does in order to ensure growth and profit Activities to find employers Business/Industry Government Education Non-profit Private The elements of a job campaign, describe and elaborate Gain Experience Create Connections First Impressions Count Be Professional Be Prepared and Persistent Be Realistic, Open-minded and Flexible Elements and recommendations for writing a CV Elements Identification Career objective Education/Training Experience Other categories as appropriate References Recommendations Be brief Be consistent Be positive Be honest Be neat Know basic elements for good communication Treat others as you would like to be treated yourself\nThe typical team, as defined by Brown Designers Managers Subject Matter Experts Stakeholders The three values of the glue of a team Respect Humility Empathy Be able to distinguish between assignment and commitment Assignments Assignments should be commitments Pressure to deliver Requirements to perform The expected result The expected cost Within the expected time frame Normally, these three items are pushed to its limits Commitment Should be voluntarily Deadlines, delivery dates should be defined Should be specific, clearly defined Clearly motivated Admit problems and risks Practice commitment culture Mindset defined (Perception, Attitude, Disposition) Perception – How to interpret thing\nAttitude – How to react\nDisposition – Decide course of action, what to do\nDifferent mindsets Active listening Active listening Understanding Acknowledge Encourage Elaborate Hear others ideas See others ideas Types of listening Prepare – Get ready\nPause – Give time for speaking\nProbe – Let people elaborate\nParaphrase/re-phrase – Summarize\n– Repeat\n– Confirm\nThree obstacles to listening Short-circuiting Closed doors Embattled egos Browns definition of conflict Conflict is the way teams come to a shared understanding of each decision made in the process\nOrigins to conflicts • Differences in objectives • Different opinions • Different values • Argumentation and friction are unavoidable • Negotiations with the customer • Argumentation within the project organization • Different or changed priorities\nPositive consequences of conflicts Produces better ideas Forces people to search for new approaches Causes problems to surface Forces clarification Stimulates interest and creativity An opportunity for people to test capacities Shared understanding Obstacles to shared understanding Unclear goals Unclear process, directions Unknown constraints Personal disagreements Misconception Ego Disinterest Healthy and unhealthy conflicts Unhealthy conflict A mask for – Not understanding – Not knowing – Anxiety for the decision – Personal conflicts\nRoot causes to conflicts External Four types of tensions – Disconnectedness – Exclusion – Misdirection – Ambiguity\nInternal Method conflict – Different ways of interpreting the method – HOW things are to be done – Different criteria for success – Re-do things – Adapt and tailor the method – Could be hidden by an outcome conflict – Usually it is healthy, it progresses work\nOutcome conflict – “The content of a decision” – Product outcomes – how the product look like – Poor performance – how to work – How to structure (Plan) the project – Purpose conflict – Why is this done? – Lack of decisions, lack of clarity\nKnow the five principles of behaviour patterns There is no single right answer Patterns may introduce new approaches Not every pattern works in every situation Several patterns may give the same result Patterns that are experienced as comfortable may be your favourite patterns \u0013The four types of patterns to solve root causes of conflicts Empathize – Break down misunderstandings – shared understanding – Let a neutral person take notes Involve – To get more involvement – Story telling. Could use neutral persons Redirect – Find focus, narrow the scope, take baby steps Reframe – Use different words, find other approaches The definition of collaboration • Collaboration means “working together” according to the dictionary • In software projects it also includes “producing something”\nCollaboration vs. Groupthink Collaboration Working together Groupthink When you agree rather than come up with something better Collaboration should lead to groupthink\nAspects of collaboration Tools The tools have different focus Tools helps in sharing and collaboration Software tools for – Messages – Chats – Video\nMindset Perception – How to interpret thing\nAttitude – How to react\nDisposition – Decide course of action, what to do\nCulture • Open workspaces or closed rooms? • Dislike in some way of communicating • Against or for face-to-face communication • Organizational limitations and boundaries • Competition between people • Heading for a promotion?\nThe four virtues of collaboration Clarity and Definition Accountability and Ownership Awareness and Respect Openness and Honesty situations example interpretation pattern design ignorance “I don’t see why we even need to spend time on this.”我不知道为什么我们要浪费时间做这个 Designers sometimes find themselves defending the practice of design itself. reflect the position(考虑他的位置); anticipate agendas; communicate implications 讨论影响（如果..会..?） Distracted by internal competition内部矛盾 “The marketing team is setting up their own Web site.” Members of the project team lose focus on project objectives because they are distracted by a competitor Help me prioritize; Fame the conversition; Recount previous conversation Distracted by shiny objects（consequence of distraction） “Our site needs social sharing functions.” “Shiny objects” is one term for ideas or technologies or techniques that have captured the imagination of the public or the industry. make it real; hold a workshop; offer alternatives(做一些 mock-up来比较) Don’t know what we need “What do you think we should do?” Without a clear definition of the design problem, the project team may run in different directions. provide starting points; set reasonable expectations; make assumption; Efforts ignored “This stuff doesn’t really matter because we’re working on a separate track.” 利益相关者或其他成员选择忽视outputs, recommendations, and solutions provided by people assigned to those activities. convert failure to action; help me help you; blame a “bad cop” Excluded from planning “It’s a shame she’s not in the meeting. All these action items are for her.” In this situation, the people responsible for delivering and executing are not included in the planning process. acknowledge achievements; communicate implications; reduce the assignment False consensus “I think we all agree here.” 大家都认为已经达到共识了，但仔细想想其实没有 In this situation the team comes to some agreement (on direction or approach, for example) but doesn’t re ask for a story; communicate implications; help me make this better(说出有挑战的点) Inconsistent expectations “That’s not what I said!” From one conversation to the next, team members change their expectations. Blame a “bad cop”; make it real; set reasonable expectations Insufficient progress 项目进度很慢，和懒惰有关 “You’ve done how much?” assigned tasks remain incomplete, design problems remain unsolved, or feedback isn’t fully incorporated. Go back to basics; Reduce the assignment; set reasonable expectations Irrelevant (无关紧要的)comparisons “Have you seen this Web site?” someone contributes comparative examples with little or no practical relevance to the design problem consider micro/macro perspectives; help me prioritize指出哪里相关; communicate implications Lack of clear inputs “Mmm\u0026hellip; yeah\u0026hellip; we’re not going to have the budget to do user research.” Designers don’t have detailed inputs (requirements, starting points, etc.) to frame the problem and inform the solution. Make a plan; Make it real; Make assumptions Lack of context “There’s a lot going on behind the scenes here\u0026hellip;” Teams do not have insight into the organizational, business, or operational context surrounding a project. Pick one thing; Help me help you; List assumptions Lack of decision maker “So, what does the group think?” Design decisions drag out because no authority is capable of rendering executive decisions when necessary. anticipate agendas; hold a workshop; communicate implications Lack of stable strategy “So, things have changed since we last spoke\u0026hellip;” the project’s objectives, parameters, or constraints change regularly. make assumption一些原则; blame a “bad cop”制定deadline; treat it like a project Late-breaking requirements “Now that I think about it, we’re also going to need\u0026hellip;” the stakeholder who didn’t have time to participate in the process; the one thing that one guy forgot; a change to the business that has a ripple effect throughout all the company’s systems. Help me prioritize; make it real; make a plan Misinterpretation of tone “Your email was really snippy.” breeds hostility(敌意) or disrespect in the communications. Change the channel; reflect the position; come back later New perspectives “I know I’m coming in with this late, but\u0026hellip;” stakeholders offering new perspectives may not welcome their positions being hastily dismissed.(立场被驳回) assert your process; frame the conversation(和利益相关者建立谈话); offer alternatives（提供更多的选择） No plan “OK, so what do we do next?” In this situation, the project lacks a plan that defines desired outcomes, activities, schedule, and assignments. Blame a “bad cop”; draw pictures; offer alternatives No time to design “Just get some rough ideas down by tomorrow, OK?” Forces outside the design team establish an unreasonable schedule for producing design ideas assert your process(坚持自己，说完不成); help me help you; set reasonable expectations Not a team player 拒绝和别人合作 “I can take care of this.” Someone on the team refuses to engage with other members Ask for help; Go back to basic; communicate implications Overpreparation认为已经解决了问题 “I think we’ve got the solution already.” Product teams may create early mock-ups to frame the problem, which locks them into a particular way of thinking about the problem. Hold a workshop; ask questions; ask for a story Poorly composed feedback “That just doesn’t look right to me.” The team receives feedback that doesn’t clearly articulate the next steps, the desired improvements, or the issues with the current version. Frame the conversation; take baby steps(go through the design point by point); change the metaphor Poorly planned presentation or discussion “I hate to put you on the spot, but\u0026hellip;” Project stakeholders do not understand the design work because the design team hasn’t assembled a meaningful narrative set reasonable expectations; assert your process; ask questions Reluctant participation in design activities (一些人不积极参与design) “I’ll leave the drawing to my colleagues.” Some members of the team may not actively participate in creative games and brainstorming activities. provide starting points; assert your process; communicate implications Responses not timely “[This quote intentionally left blank.]” provide starting points; assert your process; communicate implications(和25pattern一样) Separated from key stakeholders “Let me take this to the VP, and I’ll let you know what she says.” Designers find themselves separated from the true client or customer through layers of bureaucracy. Hold a workshop; assert your process; take baby steps Tasks and goals not aligned “Everyone says we need to hold a daylong brainstorming session.” Designers sometimes engage in design activities with no real rationale. Such activities yield outcomes that likely don’t move the project forward, or do so inefficiently. set expectations; ask for the first step; make a plan Uncoordinated collaboration “So, which one of us is doing this?”(分配任务) Some project teams have no plan, no overall direction of where they’re going long-term and the activities required to get there. Take responsibility; provide starting points; enumerate issues Unfounded design direction（毫无根据的设计方向） “Hey, I did some mock-ups!” Someone outside the design team prepares screen designs, concepts, or other artifacts attempting to establish a creative direction. When a non-designer shows up with design artifacts, the team may feel tension because it implies lack of performance from the designers. Ask questions; take responsibility; acknowledge achievements Unreasonable constraints “I want the design to look the same on every Web browser.” Designers thrive on constraints: boundaries help designers understand what constitutes a good solution for the challenge. Some projects, however, are bounded by constraints that are arbitrary. consider micro/macro perspectives; help me prioritize; make it real Wrong scope “What do you mean I wasn’t supposed to work on that?” A designer works on the wrong thing. Take responsibility; acknowledge achievements; Go back to basics pattern Acknowledge achievements（involve “Wow, you guys did a great job on this. I can see the effort you put in. Can you walk me through to make sure I understand everything?” Engaging with someone about his or her work, and potentially balancing achievements with opportunities for improvement. Anticipate agendas（empathize “I know there are a few things that are especially important to you, so I wanted to address them right away.” Imagine what’s important to other members of the team or project stakeholders before engaging in a discussion with them. Entering a conversation with people expected to be competitive or confrontational, to demonstrate that you have their best interest in mind. ask for a story（reframe Ask someone to describe their ideas or thoughts or needs in the form of a story. Someone struggles to articulate their needs in the abstract, and you want to help them make it more concrete. ask for help（involve Directly ask someone to help you with your task. You need help. You’re preoccupied with proving yourself instead of solving the design problem. ask for the first step(Reframe) Ask someone what their first step will be in attempting to achieve an objective. Someone struggles to articulate their process for performing a task, by getting them to focus only on a small slice. ask questions(Reframe,Involve) Instead of jumping to conclusions, ask questions to make sure both you and the other people understand what’s going on. All. The. Time. No other skill is as essential to designers as being able to ask good questions. Except, perhaps, listening to the answers. assert your process(redirect) Remind participants of the schedule and the process on which it is based, providing lots of detail about activities, outcomes, and goals. Someone introduces factors that may compromise or derail the process, like late-breaking requirements. Blame a “bad cop”(reframe) Use another team member (not present) as a scapegoat. By putting a human face on the situation, people might work harder to find a compromise, or might forgive ignorance. Facing unreasonable constraints or being put on the spot for a question you can’t answer immediately. Call their bluff(揭发底牌) reframe Take a challenge to its inevitable conclusion and hold everyone involved accountable for meeting the challenge. Help other team members understand the impact of their request. Presented with unreasonable requests that aim to put pressure on the design team without any meaningful outcome. Capture lessons learned（involve，redirect） Make a list of issues, obstacles, and difficulties that came out of a prior project or situation or challenge. The project team hasn’t taken a moment to reflect on their previous work and how they could have done it better. change the channel（email，voice，etc）（reframe Find a different “channel” in which to communicate. Sometimes this means moving from email to voice, or in person to email, or instant messenger to video chat. Sometimes this means taking a conversation out of a public venue. The medium of communications is impacting participants’ ability to express themselves clearly. Change the metaphor（reframe） Use a different concept to explore or explain a complex idea. Participants become fixated on the metaphor and not the problem being solved, or when participants need a new way of looking at the same old problem. Channel your colleagues’ best qualities（redirect ，想想一个能处理好这件事的人。考虑他们将如何表现,并试图将其融入到情况。 Confronting a situation that is causing you particular anxiety or frustration. Sometimes, pretending to be a different person allows us to tap into not only their capabilities, but also their strength. come back later（Empathize, Redirect Postpone(延期) taking action until participants can consider the situation more deliberately. The situation has gotten out of hand, such that the participants aren’t providing reasonable and appropriate contributions Communicate implications（reframe “If we don’t get feedback until next week, we’ll have to shift our delivery milestones. Without feedback, I’m worried that we’ll have more work later in the project dealing with late-breaking requirements.” State, in the simplest terms possible, the consequences of a decision Participants make decisions without realizing the negative consequences for the process or project outcome. Consider micro/macro perspectives（redirect Look at the situation from two different angles, broad versus narrow or high versus low. Adopting a new perspective can help expose new issues and solutions. Participants become so focused on one perspective that they lose sight of the project or task objectives Consider your work/their work（reframe Offer encouragement and deflate the anxiety of critique by reminding colleagues that stakeholders and other team members are just doing their jobs. Confrontations have escalated to the extent that participants are having trouble hearing each other’s concerns Convert failure to action（redirect Take outcomes that seem to be dead ends and use those as starting points for subsequent tasks. Confronted by people who approach failure with a gloom and doom attitude, thinking that nothing is recoverable from such outcomes draw pictures（reframe Use visual aids, spontaneous sketches, whiteboards, diagrams, or other visualizations to organize thoughts. Encourage participants to draw or embellish others’ drawings. Participants are having trouble making sense of each other’s statements Frame the conversation（Involve, Redirect） Establish a structure for conversations, with clearly articulated topics and goals. To the extent feasible, identify items outside the scope of the discussion to avoid getting off track. Participants struggle to keep conversations focused or the agenda becomes dominated by a few players that distract from objectives. Go back to basics(redirect, involve) Rely on tried-and-true project management tools and techniques to keep project teams aligned and on track. Project teams begin to spin out of control because they take project management basics for granted Help me help you (empathize) “I know how important this design project is to your work here. I’d like to make sure you can be successful and meet the milestones of the larger project. What I can I do to help you meet those goals?” Position the team’s work and the team’s role relative to another’s goals. 展示团队的目标是如何与个人目标相一致的。 A stakeholder or participant signals that they see themselves as competitive with or opposed to the rest of the team. Help me make this better（involve） 让expert去帮助improve the design 参与者不愿意或不能提供建设性的反馈。 Help me prioritize （redirect） Ask participants to prioritize issues, requirements, feedback, or whatever else may be driving subsequent activities.（找重点） Presented with a list of issues that will impact the team’s ability to execute their plan or to complete tasks within the project’s constraints.（有好多问题要解决） Hold a workshop（involve） 组织一个meeting，可以让利益相关者来Structure a meeting as a collection of participatory activities combined with presentations, as if team members were attending a training workshop. By making the activity more participatory, teams can engage all stakeholders. Working with a team of people who need structure to actively contribute to a project. List assumptions（reframe） List the educated guesses the team made to allow them to move forward with the project. Assumptions may be related to any context: product, performance, plan, or purpose The list of assumptions may be used to justify decisions or as a tool to validate assumptions.团队里一些人没有什么看法，依赖于别人的看法。 make a plan （refame Identify a goal, a set of activities to reach that goal, and a set of milestones leading up to the goal. With multiple goals, be sure to prioritize. 面对大量的工作，没有明确的下一步如何取得进展 make assumptions （redirect） 不要让未知的信息阻碍了项目目标的实现。对丢失的信息进行有根据的猜测。一定要分享这些假设与项目团队提供设计决策的基本原理。 您已经准备好开始设计过程，但是无法弥补在理解上的差距 make it real （redirect） Take steps to embody abstract ideas 参与者在不考虑可行性的情况下抛出想法和反馈。 Offer alternatives（involve 提供两三个想法，让参与者对比和比较 提出了一个模糊的问题，将没有明确的标准来评估一个解决方案。 Offer a sneak peek(提供一个先睹为快)（invole 我们明天要讲三个概念，我先说一下你们明天会看到的。 Show or describe upcoming work in brief to set expectations about what will be seen or what participants will need to comment on. Presenting ideas or approaches that will challenge some underlying assumptions, as a way to build the right mindset in key participants. Pick one thing （redirect） Select one item from a list to focus on. 有很多issue困扰着 Pick your battles（empathize） 避免对抗，以后再说 Choose the right time to engage in active conflict. Facing a potentially major conflict that, compared to confrontations likely to emerge later, will have little impact on the final outcome. Prioritize the portfolio（优先考虑投资组合）redirect 虽然不喜欢这个project，但能提高职业目标 一个项目或任务的线程已经变得如此妥协，以至于很难在其中找到个人意义或满足感 Provide starting points（empathize） 给人们举一些例子来说明你所期望的工作水平 要给新人分配任务，团队，确立方向和期望值 Recount previous conversation（reframe 总结之前的对话，为当前的对话奠定基础 当和记忆里不好的人一起工作时，先确定她们agree之前的对话要点。（避免他们经常在会议中改变自己的想法） Reduce the assignment（redirect redirect 把手头任务的一小部分用来控制范围 有一个很大的项目，一小块的分配允许人们关注一个可控的设计问题和调整他们的预期。 Reflect the position（e） 重复别人说的话来确保自己听到的是正确的，也可以体现respect 当参与者觉得他们可能不理解对方的立场时 Seek small victories（redirect） Drive toward a win, no matter how small, to demonstrate success or establish a foundation of success. 努力争取胜利，无论多么小 Set reasonable expectations（redirect） Provide a clear account of how long tasks will take. 被问到项目的截止时间和范围，何时交付项目 Show the goal（Empathize, Involve, Redirect 让利益相关者尽可能生动地描述项目或任务的期望结果，确保他们知道他们要什么。Ask stakeholders to describe as vividly as possible the desired outcome of a project or task. This isn’t so much to describe the final design as it is to make sure they know what they’re getting. 项目已经花了很多时间，但还是不清楚stakeholders到底要什么 show your work（invole 揭示设计关键点，提供了基础和设计决策的理由 当给stakeholders看你的design idea时 take baby staps（redirect，involve introduce引进小小的改变 给项目，一种文化来影响大的charge 团队或组织的习惯根深蒂固,新的思维方式难以实现。 take responsibility（Empathize 诚实坦率地面对错误。主动帮忙收拾残局 Be honest and forthright with errors. Offer to help clean up the mess. Facing an error that has an impact on other team members or the success of the project. treat it like a project（reframe） 有一个问题很难达成一致， create a plan 去解决 建立目标、活动、依赖关系、角色和其他结构，以推动冲突的解决方案Establish a goal, activities, dependencies, roles, and other structure to drive toward a solution for a conflict Facing a conflict with so many moving parts that resolution requires careful planning. behavior how virtue interpretation ask questions that yield specific answers Clarity and Definition Structure questions to encourage increasingly direct and detailed responses. Yes/no questions are OK, so long as they validate a specific decision or direction. Centralize decision making 集中决策 At the beginning of the project, ask who owns final decisions about design. Lean on the decision maker to validate direction and approach Accountability and Ownership Clarify expectations regarding ability and delivery 在收到任务后，确保你明白任务的交付时间和任务 Accountability and Ownership 项目参与者应该让对方诚实地、公开地了解他们的工作地点 Communicate progress 日常保持小火苗！Establish a rhythm for communicating updates to project leads. Use a simple template for email or other electronic messages to communicate updates. Accountability and Ownership Don’t hog opportunities不要占用机会？？？ 在要说话之前，保持15分钟沉默，让别人先说 Awareness and Respect 让每个参与者都参与进来。 Embrace constructive criticism接受建设性的建议 先考虑一下这是他们的工作，也不算他们的错。在他们打击之前，先预测一下Anticipate critiques before they happen to soften the blow. Accountability and Ownership Embrace risk 明白风险，可能的消极后果 Accountability and Ownership Employ采用 tools that yield meaningful outcomes 判断工具是否能让项目继续Question the value of every activity or deliverable, and seek to understand how it will move the project forward and how it will lead to the next step Clarity and Definition make a contribution Encourage disruptive communications 采用多种沟通渠道，为团队成员提供各种相互交流的方式。 Clarity and Definition Engage in dialogue Show up to meetings with lots of questions prepared, whether you’re responsible for presenting concepts or not. Clarity and Definition 鼓励对话来阐述项目的概念、设计要求等。 Engage multiple senses to communicate 调用多种感官来交流 计划会议不只是说什么，而是要展示什么。有一个文档相机准备显示屏幕上快速草图或投射在墙上。注意图片所示的节奏,特别是,人们会花最多的时间看看照片 Clarity and Definition Use both speaking and pictures to engage team members. Establish role definitions If you’re not in charge of defining roles, ask for each participant’s responsibilities Clarity and Definition 确保团队中的每个人都知道他或她的职责是什么。Take the time to ensure they understand whether they own particular activities, or are just contributors. Give others room to learn from mistakes Offer to help colleagues reflect on their failures. Awareness and Respect Have a communications plan 使用模板为常见的电子邮件格式。建立一些规则用不同的交流方式。Identify who can respond to inquiries from different stakeholders Clarity and Definition 为团队成员之间的交流创建标准。 Have a project plan ensure you can answer who, what, where, when, why, and how questions about the project.确保你能回答谁，什么，什么，何时，为什么，以及如何对这个项目的问题 Clarity and Definition Create a project schedule with milestones and resource assignments. Clearly state how much time each team member should spend on each activity. Have decision-making mechanisms有决策机制 为设计或项目计划制定目标或原则以指导决策。指定具体的人负责,负责具体的决策。Establish goals or principles for the design or project plan to guide decisions. Designate specific people responsible and accountable for specific decisions. Clarity and Definition Have objectives for every discussion If you’re organizing the meeting, send an agenda, a list of topics, or even a one-sentence objective beforehand. If you’re not organizing the meeting, ask the organizer for the agenda or objectives. If it’s an ad hoc meeting, take a moment to validate expectations with other participants. Clarity and Definition know beforehand what you expect to come out of it. Keep meetings focused and short Conclude a meeting when it’s over, not when the clock says it’s over. Show up with an agenda and objectives so you know when it’s over. Awareness and Respect Golden Rule: Assume other people’s time is as valuable as yours. 假设别人的时间和你的一样宝贵 Know when you’re “spinning” 知道你遇到瓶颈的时候 在任务或任务上花一小段时间(大约10% - 20%的时间)，然后评估进度。如果开始适应,坚持下去。如果没有明确的方向，可以向同事寻求帮助。 Accountability and Ownership 意识到你的努力没有成效。旋转的行为将是一个问题解决,没有做出任何实质性的进展。有些人坚持啃一个问题,消耗时间和金钱,因为他们需要证明自己。 Offer direct critiques Avoid generalizations like “It’s not good.”避免笼统地说“这不好”。 Awareness and Respect Play to strengths 发挥优势 Reflect on abilities and skills to identify strengths反思能力和技能，以确定优势 Accountability and Ownership 确保项目中的角色和责任与团队成员的个人能力、技能和性格相一致。 Provide a rationale for decisions为决策提供依据 Enumerate key decisions and identify the primary rationale for driving them.列举关键决策并确定驱动它们的基本原理。 Accountability and Ownership 确保所有的决定——关于产品，关于计划，关于项目——都有合理的理由 Recognize contributions承认贡献 Accountability and Ownership if someone inspired a particular direction or lent an insight, give them a shout-out. Reduce competition In competitions, there is always a loser. Losers no longer feel as invested in the project. When people feel like they will make a meaningful contribution, regardless of their role, they will do better work and support each other in the pursuit of the project’s goals Accountability and Ownership 从设计过程中消除对彼此不利的设计过程。鼓励人们一起工作,而不是竞选。 Reflect on your performance Awareness and Respect 花点时间考虑一下你在一个项目或任务上的表现。识别领域你可以表现的更好,发挥你的长处。确定下次你会做不同的事情，然后吸取教训，下次再用。 Respect the calendar Awareness and Respect Set availability expectations Awareness and Respect Set performance expectations Awareness and Respect Clearly communicate ability to complete tasks and assignments. Traits Adaptability Adherence to style Assumption threshold 假设阈值 Creative triggers Defining the challenge Desired cadence 期望的节拍 Workload， client culture Dogmatism 教条主义 Format for feedback Giving and getting recognition Knee-jerk reaction 很快的反应 要么不思考马上赞同，要么马上反对 Level of abstraction 喜欢做抽象的事情 Perception of control Preferred environment Preferred perspective Project load Structure of design reviews Transparency 透明度 ","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/team-collaboration-and-career-development/","summary":"\u003ch1 id=\"career-decision-making-cycle\"\u003eCareer decision making cycle\u003c/h1\u003e\n\u003cp\u003e\u003cimg alt=\"Career decision making cycle\" loading=\"lazy\" src=\"/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/team-collaboration-and-career-development/images/1547727641728.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"know-the-elements\"\u003eKnow the elements\u003c/h2\u003e\n\u003cp\u003eCommunication, Analysis, Synthesis, Valuing, Execution\u003c/p\u003e\n\u003ch2 id=\"know-the-definition\"\u003eKnow the definition\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eCommunication\u003c/strong\u003e: Identifying the gap\n\u003cstrong\u003eAnalysis\u003c/strong\u003e: Thinking about alternatives\n\u003cstrong\u003eSynthesis\u003c/strong\u003e: Creating likely alternatives\n\u003cstrong\u003eValuing\u003c/strong\u003e: Prioritizing alternatives\n\u003cstrong\u003eExecution\u003c/strong\u003e: Taking action to narrow the gap\u003c/p\u003e\n\u003ch2 id=\"be-able-to-elaborate-the-elements\"\u003eBe able to elaborate the elements\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eCommunication\u003c/strong\u003e:\n• Become aware of the gap\n• Discomfort, not so much fear of change\n• Seek assistance if needed\n• Emotions\n\u003cstrong\u003eAnalysis\u003c/strong\u003e:\n• Clarify your knowledge\n• Clarify gap\n• Understand how you make decisions\n• Understand what influences you\n• What do you want?\n• What have you learned?\n• What are your values, interests and skills?\n• Do you want to take responsibility?\n• Self-awareness\n\u003cstrong\u003eSynthesis\u003c/strong\u003e:\n• Solve the gap\n• Avoid missing alternatives\n• Reduce to a manageable amount of options.\n• Brainstorm and reduce.\n\u003cstrong\u003eValuing\u003c/strong\u003e:\n• Judge the benefit (and cost)\n• Rank\n• What´s the best choice?\n• Select an option\n\u003cstrong\u003eExecution\u003c/strong\u003e:\n• Convert decisions into action\n• Formulate a goal and a plan\n• Execute the plan\n• Plan, try, evaluate\u003c/p\u003e","title":"Team Collaboration and Career Development"},{"content":"During the lectures we defined three different areas important for every individual: Values, Interests and Skills. These should be described regarding your internal focus in a resume. a. Describe, explain, these three areas, including at least two examples from each area. (15)\nValues are what is important for you, what you really care about, and which give you a sense of purpose. Example: High Income, Helping others. Interests are what is fun for you, what enjoys you, and those work activities which hold your attention and fire your enthusiasm. Example: Technical, Scientific. Skills are things you can do well, things you have learned, special talent and special abilities. Example: Technical skills, Leadership. b. What is a GAP? Give at least one example of a possible GAP relating to your own experiences, one example from each area. (6) A GAP is where you are and where you want to be. The GAP for me: I hope that I can enter a big company like Alibaba to work as a Java developer. The GAP for me is that my understanding of the Java virtual machine is not deep enough, I don\u0026rsquo;t have enough knowledge of multithreading, don\u0026rsquo;t know enough about the principle and implementation of the database, and don\u0026rsquo;t know much about the distributed architecture. 2. Name the 5 elements of the Career Development Cycle. Draw the model of the cycle. Describe shortly, 1-2 sentences, every action in the cycle. (12) Communication, Analysis, Synthesis, Valuing, Execution Communication: Become aware of the gap and feel discomfort about the gap. Seek assistance if needed. Analysis: Clarify your knowledge, what do you want, what are your values, interests and skills and so on. Synthesis: Solve the gap, avoid missing alternatives and reduce to a manageable amount of options. Valuing: Judge the benefit (and cost) and rank them to find the best choice. Select an option. Execution: Convert decisions into action, formulate a goal and a plan, and execute the plan. Communication: Review the state and think has the gap been closed. It is an on-going process. 3. Brown talks about four general role categories of people in teams. Name these roles and describe them shortly? (12) Designers: People responsible for generating and documenting ideas about how the product works, looks, or behaves. Managers: People responsible for ensuring the project team delivers on its obligations, creates plans to do so, and successfully executes against those plans. Subject Matter Experts: People responsible for contributing information to the design process. Stakeholders: People ultimately accountable for the success of the project. 4. Consider the following questions among individuals where we have different characteristics. Select three of them. Describe how people (individuals), can have different characteristics. Describe pros and cons, and possible consequences to a characteristic. Comments if the characteristics you choose are good characteristics or not. a. Can I interrupt you? b. Do you attend agreed meetings? c. Are you late to meetings? d. Are you focusing on details or the big-picture? e. Which tasks do you prefer to commit to? f. How quickly do you respond to e-mail? g. Do you treat others how you would like to be treated yourself? h. Can she/he say no? Can you say no? i. Does she/he usually say no/yes? (12)\n5. Describe at least 4 positive consequences to conflicts. (8) Produces better ideas Forces people to search for new approaches Causes problems to surface Forces clarification 6. Brown draws a triangle for the model of conflict. Specify this triangle and describe the elements and how they are connected. (9) Situations: The different ways conflict manifests itself\nPatterns: The behaviors team members can use to deal with conflict\nTraits: The inherent characteristics that shape our behaviors and perceptions\nSituations \u0026lt; \u0026gt; Patterns Designers can use patterns (specific behaviors) to untangle situations Situations can also affect the outcome of patterns Patterns \u0026lt; \u0026gt; Traits A designer’s traits influences which pattern she chooses for a particular situation By using a particular pattern successfully, a designer may take that to reinforce part of her personality Traits \u0026lt; \u0026gt; Situations Traits can make certain situations worse by reinforcing the misunderstanding between people Some situations may amplify a designer’s trait 7. Brown lists three areas important for self-awareness. Describe these areas and give one example from each area for improving it. (9) To understand your limitations, your boundaries, strengths\nLimitations: Boundaries: By understanding their limitations, designers can be honest and open about their capabilities, their ability to contribute to a project, and their level of comfort in asking for help. Strengths: ","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/team-collaboration-and-career-development-for-exam/","summary":"\u003ch3 id=\"during-the-lectures-we-defined-three-different-areas-important-for-every-individual-values-interests-and-skills-these-should-be-described-regarding-your-internal-focus-in-a-resume\"\u003eDuring the lectures we defined three different areas important for every individual: Values, Interests and Skills. These should be described regarding your internal focus in a resume.\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003ea. Describe, explain, these three areas, including at least two examples from each area. (15)\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eValues\u003c/strong\u003e are what is important for you, what you really care about, and which give you a sense of purpose. \u003cstrong\u003eExample\u003c/strong\u003e: High Income, Helping others.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eInterests\u003c/strong\u003e are what is fun for you, what enjoys you, and those work activities which hold your attention and fire your enthusiasm. \u003cstrong\u003eExample\u003c/strong\u003e: Technical, Scientific.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSkills\u003c/strong\u003e are things you can do well, things you have learned, special talent and special abilities. \u003cstrong\u003eExample\u003c/strong\u003e: Technical skills, Leadership.\n\u003cstrong\u003eb. What is a GAP? Give at least one example of a possible GAP relating to your own experiences, one example from each area. (6)\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eA GAP is where you are and where you want to be.\u003c/li\u003e\n\u003cli\u003eThe GAP for me: I hope that I can enter a big company like Alibaba to work as a Java developer. The GAP for me is that my understanding of the Java virtual machine is not deep enough, I don\u0026rsquo;t have enough knowledge of multithreading, don\u0026rsquo;t know enough about the principle and implementation of the database, and don\u0026rsquo;t know much about the distributed architecture.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"2-name-the-5-elements-of-the-career-development-cycle-draw-the-model-of-the-cycle-describe-shortly-1-2-sentences-every-action-in-the-cycle-12\"\u003e2. Name the 5 elements of the Career Development Cycle. Draw the model of the cycle. Describe shortly, 1-2 sentences, every action in the cycle. (12)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCommunication, Analysis, Synthesis, Valuing, Execution\n\u003cimg loading=\"lazy\" src=\"/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/team-collaboration-and-career-development-for-exam/images/1547730517318.png\"\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCommunication\u003c/strong\u003e: Become aware of the gap and feel discomfort about the gap. Seek assistance if needed.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAnalysis\u003c/strong\u003e: Clarify your knowledge, what do you want, what are your values, interests and skills and so on.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSynthesis\u003c/strong\u003e: Solve the gap, avoid missing alternatives and reduce to a manageable amount of options.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eValuing\u003c/strong\u003e: Judge the benefit (and cost) and rank them to find the best choice. Select an option.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExecution\u003c/strong\u003e: Convert decisions into action, formulate a goal and a plan, and execute the plan.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCommunication\u003c/strong\u003e: Review the state and think has the gap been closed. It is an on-going process.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"3-brown-talks-about-four-general-role-categories-of-people-in-teams-name-these-roles-and-describe-them-shortly-12\"\u003e3. Brown talks about four general role categories of people in teams. Name these roles and describe them shortly? (12)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eDesigners\u003c/strong\u003e: People responsible for generating and documenting ideas about how the product works, looks, or behaves.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eManagers\u003c/strong\u003e: People responsible for ensuring the project team delivers on its obligations, creates plans to do so, and successfully executes against those plans.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSubject Matter Experts\u003c/strong\u003e: People responsible for contributing information to the design process.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eStakeholders\u003c/strong\u003e: People ultimately accountable for the success of the project.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"4-consider-the-following-questions-among-individuals-where-we-have-different-characteristics-select-three-of-them-describe-how-people-individuals-can-have-different-characteristics-describe-pros-and-cons-and-possible-consequences-to-a-characteristic-comments-if-the-characteristics-you-choose-are-good-characteristics-or-not\"\u003e4. Consider the following questions among individuals where we have different characteristics. Select three of them. Describe how people (individuals), can have different characteristics. Describe pros and cons, and possible consequences to a characteristic. Comments if the characteristics you choose are good characteristics or not.\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003ea. Can I interrupt you?\u003c/strong\u003e\n\u003cstrong\u003eb. Do you attend agreed meetings?\u003c/strong\u003e\n\u003cstrong\u003ec. Are you late to meetings?\u003c/strong\u003e\n\u003cstrong\u003ed. Are you focusing on details or the big-picture?\u003c/strong\u003e\n\u003cstrong\u003ee. Which tasks do you prefer to commit to?\u003c/strong\u003e\n\u003cstrong\u003ef. How quickly do you respond to e-mail?\u003c/strong\u003e\n\u003cstrong\u003eg. Do you treat others how you would like to be treated yourself?\u003c/strong\u003e\n\u003cstrong\u003eh. Can she/he say no? Can you say no?\u003c/strong\u003e\n\u003cstrong\u003ei. Does she/he usually say no/yes?\u003c/strong\u003e\n\u003cstrong\u003e(12)\u003c/strong\u003e\u003c/p\u003e","title":"Team Collaboration and Career Development for Exam"},{"content":"This question tests your knowledge on algorithms and algorithm construction: (a) A function that is defined in terms of itself is called a recursive function. Describe the purpose of a base case in a recursive function.(3p)\nA base case is an (input) value for which the function can be calculated without recursion.\nThere needs to be at least one base case, which can be solved without recursion.\nFor the cases that are solved using recursion, the recursive calls must progress towards a base case.\n(b) Mergesort is based on the principles of divide-and-conquer. Briefly describe what the mergesort algorithm does in the divide step and in the conquer step. (4p)\nDivide step: Divide the array into two parts to convert the problem of sorting the entire array into sub-problems (to sort the left and right arrays separately) until the size of the array is 1.\nConquer step: Repeatedly merging sorted lists into sorted lists of larger size until the initial list is sorted.\n(c) A constructive heuristic is a method that iteratively “builds up” a solution. It starts with nothing and adds (fixes) the value of exactly one variable (solution component) in each of the iterations. The algorithm ends when all variables have been assigned a value. Describe what is a greedy constructive heuristic. (3p)\nEach variable fixing is chosen as the variable that (locally) improves the objective most. Of course, variable fixings are chosen without breaking feasibility.\nThis question test your knowledge on graphs and trees. (a) What does a “worst case” binary tree look like? (5p)\nIn the worst case, if the binary search tree has n nodes, it can have O(n) height, when the unbalanced tree looks like a linked list.\nThe worst case occurs when inserting an sorted list into the tree in order.\n(b) Describe what is a topological ordering. (4p)\nA topological ordering of a directed non-cyclic graph is an ordering of the vertices such that if there is an edge (u, v) between u and v, then u comes before v in the ordering.\n(c) Illustrate and explain using an example why there can be no topological ordering of a graph that contains a cycle. (6p)\nConsider the cycle v5 -\u0026gt; v6 -\u0026gt; v8 -\u0026gt; v5:\n(v5, v6) 属于 E =\u0026gt; v5 needs to come before v6 in the topological order. (v6, v8) 属于 E =\u0026gt; v6 needs to come before v8 in the topological order =\u0026gt; v5 before v8 in the topological order. (v8, v5) 属于 E =\u0026gt; v8 needs to come before v5 in the topological order, which is not possible as we previously concluded the opposite. This question concerns complexity analysis. (a) Briefly describe the complexity class P. (3p)\nAll problems that can be solved using a polynomial bound algorithm belongs to the same complexity class (complexity class P).\n(b) Describe what is a basic operation of an algorithm. (3p)\nA basic operation can be seen as an operation that is fundamental for the performance of a particular algorithm.\nThe performance of the algorithm is in principle proportional to the number of basic operations.\n(c) Describe the concepts of worst-case and average-case complexity of an algorithm. (6p)\nThe worst-case complexity W(n) of an algorithm is the maximum number of basic operations performed for any input of size n.\nThe average-case complexity A(n) of an algorithm is the average number of basic operations performed by the algorithm, where each input I occurs with some probability p(I).\n(d) What does it mean to say that a data structure has an amortized bound of O(n) per operation? (3p).\nThis means that regardless of which sequence of n operations, the worst-case average cost per operation is O(n).\nYour task for this question is to insert a node with value 5 into the following splay tree. You are required to show what the tree looks like after inserting the new node and after each of the (3) splay operations.\nHint: you will have to perform all three types of splay operations. (20p)\nYour task is to apply dynamic programming in order to solve a knapsack problem instance with 4 items: Item 1: Value: p1 = 8 - Weight: w1 = 2 Item 2: Value: p2 = 6 - Weight: w2 = 1 Item 3: Value: p3 = 7 - Weight: w3 = 2 Item 4: Value: p4 = 5 - Weight: w4 = 1 The knapsack (bag) has a weight capacity of 4 (W = 4). You should graphically illustrate your solution. (20p)\n","permalink":"https://zjxjwxk.github.io/posts/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/the-design-and-analysis-of-algorithms/","summary":"\u003ch1 id=\"this-question-tests-your-knowledge-on-algorithms-and-algorithm-construction\"\u003eThis question tests your knowledge on algorithms and algorithm construction:\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003e(a) A function that is defined in terms of itself is called a recursive function. Describe the purpose of a base case in a recursive function.(3p)\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eA base case is an (input) value for which the function can be calculated without recursion.\u003c/p\u003e\n\u003cp\u003eThere needs to be at least one base case, which can be solved without recursion.\u003c/p\u003e\n\u003cp\u003eFor the cases that are solved using recursion, the recursive calls must progress towards a base case.\u003c/p\u003e","title":"The Design and Analysis of Algorithms for Exam"},{"content":"CentOS 7 Tomcat开机自启动配置 配置开机运行 Tomcat增加启动参数 Tomcat需要增加一个pid文件，在 $CATALINA_HOME/bin 目录下面，增加 setenv.sh 配置，catalina.sh启动的时候会调用，同时配置Java内存参数。添加如下命令： [root@vps bin]# vim setenv.sh\n#Tomcat startup pid #set Java runtime environment variable export JAVA_HOME=/usr/java/jdk1.8.0_191-amd64 export PATH=$PATH:$JAVA_HOME/bin export CATALINA_HOME=/developer/apache-tomcat-7.0.91 export CATALINA_BASE=/developer/apache-tomcat-7.0.91 #add Tomcat pid CATALINA_PID=\u0026#34;$CATALINA_BASE/tomcat.pid\u0026#34; #add Java opts JAVA_OPTS=\u0026#34;-server -XX:PermSize=256M -XX:MaxPermSize=1024m -Xms512M -Xmx1024M -XX:MaxNewSize=256m\u0026#34; 注意: 配置开机运行时,需要再次添加 JAVA_HOME\n增加 tomcat.service 在/usr/lib/systemd/system目录下增加tomcat.service，目录必须是绝对目录，添加如下命令： [root@vps bin]# vim /usr/lib/systemd/system/tomcat.service\n# conf service desc ,set do this after network started [Unit] Description=tomcat After=syslog.target network.target remote-fs.target nss-lookup.target # conf service pid, start,stop and restart [Service] Type=forking PIDFile=/developer/apache-tomcat-7.0.91/tomcat.pid ExecStart=/developer/apache-tomcat-7.0.91/bin/startup.sh ExecStop=/bin/kill -s QUIT $MAINPID ExecReload=/bin/kill -s HUP $MAINPID PrivateTmp=true # conf user [Install] WantedBy=multi-user.target [unit]: 配置了服务的描述，规定了在network启动之后执行，\n[service]: 配置服务的pid，服务的启动，停止，重启\n[install]: 配置了使用用户\n使用tomcat.service centos7使用systemctl替换了service命令，如需设置其他服务，替换此处的tomcat即可，如:systemctl start vsftp.service\n启动服务 systemctl start tomcat.service 停止服务 systemctl stop tomcat.service 重启服务 systemctl restart tomcat.service 增加开机启动 systemctl enable tomcat.service 删除开机启动 systemctl disable tomcat.service 因为配置pid，在启动的时候会在Tomcat的根目录下生产tomcat.pid文件,服务停止后删除。 同时Tomcat在启动时，执行start不会启动两个Tomcat，保证始终只有一个Tomcat服务在运行。多个Tomcat可以配置在多个目录下，互不影响。\n查看效果 重启服务器后,通过wget访问，终端输出如下所示，配置tomcat开机自启动成功！\n[root@vps ~]# wget 35.234.8.23:8080 --2019-01-12 16:02:41-- http://35.234.8.23:8080/ Connecting to 35.234.8.23:8080... connected. HTTP request sent, awaiting response... 200 OK Length: 909 [text/html] Saving to: ‘index.html’ 100%[===========================================================\u0026gt;] 909 --.-K/s in 0s 2019-01-12 16:02:41 (157 MB/s) - ‘index.html’ saved [909/909] 同时,客户端浏览器也能成功访问。\n","permalink":"https://zjxjwxk.github.io/posts/linux/centos/centos-7-tomcat%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE/","summary":"\u003ch1 id=\"centos-7-tomcat开机自启动配置\"\u003eCentOS 7 Tomcat开机自启动配置\u003c/h1\u003e\n\u003ch2 id=\"配置开机运行\"\u003e配置开机运行\u003c/h2\u003e\n\u003ch3 id=\"tomcat增加启动参数\"\u003eTomcat增加启动参数\u003c/h3\u003e\n\u003cp\u003eTomcat需要增加一个pid文件，在 \u003ccode\u003e$CATALINA_HOME/bin\u003c/code\u003e 目录下面，增加 \u003ccode\u003esetenv.sh\u003c/code\u003e 配置，\u003ccode\u003ecatalina.sh\u003c/code\u003e启动的时候会调用，同时配置Java内存参数。添加如下命令：\n\u003ccode\u003e[root@vps bin]# vim setenv.sh\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Tomcat startup pid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#set Java runtime environment variable \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport JAVA_HOME\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/usr/java/jdk1.8.0_191-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport PATH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e$PATH:$JAVA_HOME/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport CATALINA_HOME\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/developer/apache-tomcat-7.0.91\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport CATALINA_BASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/developer/apache-tomcat-7.0.91\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#add Tomcat pid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCATALINA_PID\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$CATALINA_BASE\u003cspan style=\"color:#e6db74\"\u003e/tomcat.pid\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#add Java opts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJAVA_OPTS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;-server -XX:PermSize=256M -XX:MaxPermSize=1024m -Xms512M -Xmx1024M -XX:MaxNewSize=256m\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e注意:\u003c/strong\u003e 配置开机运行时,需要再次添加 JAVA_HOME\u003c/p\u003e\n\u003ch3 id=\"增加-tomcatservice\"\u003e增加 tomcat.service\u003c/h3\u003e\n\u003cp\u003e在/usr/lib/systemd/system目录下增加tomcat.service，目录必须是绝对目录，添加如下命令：\n\u003ccode\u003e[root@vps bin]# vim /usr/lib/systemd/system/tomcat.service\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# conf service desc ,set do this after network started\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eUnit\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDescription\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etomcat \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAfter\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esyslog.target network.target remote-fs.target nss-lookup.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# conf service pid, start,stop and restart\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eService\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eType\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eforking\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePIDFile\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/developer/apache-tomcat-7.0.91/tomcat.pid\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStart\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/developer/apache-tomcat-7.0.91/bin/startup.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecStop\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/bin/kill -s QUIT $MAINPID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eExecReload\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e/bin/kill -s HUP $MAINPID\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePrivateTmp\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003etrue\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# conf user \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eInstall\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWantedBy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003emulti-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cem\u003e[unit]:\u003c/em\u003e 配置了服务的描述，规定了在network启动之后执行，\u003c/p\u003e","title":"CentOS 7 Tomcat开机自启动配置"},{"content":"Servlet总结 在Java Web程序中，Servlet主要负责接收用户请求HttpServletRequest,在doGet(),doPost()中做相应的处理，并将回应HttpServletResponse反馈给用户。Servlet可以设置初始化参数，供Servlet内部使用。一个Servlet类只会有一个实例，在它初始化时调用init()方法，销毁时调用destroy()方法。Servlet需要在web.xml中配置（MyEclipse中创建Servlet会自动配置），一个Servlet可以设置多个URL访问。Servlet不是线程安全，因此要谨慎使用类变量。\n阐述Servlet和CGI的区别? CGI的不足之处: 1，需要为每个请求启动一个操作CGI程序的系统进程。如果请求频繁，这将会带来很大的开销。\n2，需要为每个请求加载和运行一个CGI程序，这将带来很大的开销\n3，需要重复编写处理网络协议的代码以及编码，这些工作都是非常耗时的。\nServlet的优点: 1，只需要启动一个操作系统进程以及加载一个JVM，大大降低了系统的开销\n2，如果多个请求需要做同样处理的时候，这时候只需要加载一个类，这也大大降低了开销\n3，所有动态加载的类可以实现对网络协议以及请求解码的共享，大大降低了工作量。\n4，Servlet能直接和Web服务器交互，而普通的CGI程序不能。Servlet还能在各个程序之间共享数据，使数据库连接池之类的功能很容易实现。\n补充：Sun Microsystems公司在1996年发布Servlet技术就是为了和CGI进行竞争，Servlet是一个特殊的Java程序，一个基于Java的Web应用通常包含一个或多个Servlet类。Servlet不能够自行创建并执行，它是在Servlet容器中运行的，容器将用户的请求传递给Servlet程序，并将Servlet的响应回传给用户。通常一个Servlet会关联一个或多个JSP页面。以前CGI经常因为性能开销上的问题被诟病，然而Fast CGI早就已经解决了CGI效率上的问题，所以面试的时候大可不必信口开河的诟病CGI，事实上有很多你熟悉的网站都使用了CGI技术。\n参考：《javaweb整合开发王者归来》P7\nServlet接口中有哪些方法及Servlet生命周期探秘 Servlet接口定义了5个方法，其中前三个方法与Servlet生命周期相关：\nvoid init(ServletConfig config) throws ServletException void service(ServletRequest req, ServletResponse resp) throws ServletException, java.io.IOException void destory() java.lang.String getServletInfo() ServletConfig getServletConfig() 生命周期： Web容器加载Servlet并将其实例化后，Servlet生命周期开始，容器运行其init()方法进行Servlet的初始化；请求到达时调用Servlet的service()方法，service()方法会根据需要调用与请求对应的doGet或doPost等方法；当服务器关闭或项目被卸载时服务器会将Servlet实例销毁，此时会调用Servlet的destroy()方法。init方法和destory方法只会执行一次，service方法客户端每次请求Servlet都会执行。Servlet中有时会用到一些需要初始化与销毁的资源，因此可以把初始化资源的代码放入init方法中，销毁资源的代码放入destroy方法中，这样就不需要每次处理客户端的请求都要初始化与销毁资源。\n参考：《javaweb整合开发王者归来》P81\nget和post请求的区别 网上也有文章说：get和post请求实际上是没有区别，大家可以自行查询相关文章！我下面给出的只是一种常见的答案。\n①get请求用来从服务器上获得资源，而post是用来向服务器提交数据；\n②get将表单中数据按照name=value的形式，添加到action 所指向的URL 后面，并且两者使用\u0026quot;?\u0026ldquo;连接，而各个变量之间使用\u0026rdquo;\u0026amp;\u0026ldquo;连接；post是将表单中的数据放在HTTP协议的请求头或消息体中，传递到action所指向URL；\n③get传输的数据要受到URL长度限制（1024字节即256个字符）；而post可以传输大量的数据，上传文件通常要使用post方式；\n④使用get时参数会显示在地址栏上，如果这些数据不是敏感数据，那么可以使用get；对于敏感数据还是应用使用post；\n⑤get使用MIME类型application/x-www-form-urlencoded的URL编码（也叫百分号编码）文本的格式传递参数，保证被传送的参数由遵循规范的文本组成，例如一个空格的编码是\u0026rdquo;%20\u0026quot;。\n补充：GET方式提交表单的典型应用是搜索引擎。GET方式就是被设计为查询用的。\n还有另外一种回答。推荐大家看一下：\nhttps://www.zhihu.com/question/28586791 https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==\u0026amp;mid=100000054\u0026amp;idx=1\u0026amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd 什么情况下调用doGet()和doPost() Form标签里的method的属性为get时调用doGet()，为post时调用doPost()。\n转发(Forward)和重定向(Redirect)的区别 转发是服务器行为，重定向是客户端行为。\n转发（Forword） 通过RequestDispatcher对象的forward（HttpServletRequest request,HttpServletResponse response）方法实现的。RequestDispatcher可以通过HttpServletRequest 的getRequestDispatcher()方法获得。例如下面的代码就是跳转到login_success.jsp页面。\nrequest.getRequestDispatcher(\u0026#34;login_success.jsp\u0026#34;).forward(request, response); 重定向（Redirect） 是利用服务器返回的状态吗来实现的。客户端浏览器请求服务器的时候，服务器会返回一个状态码。服务器通过HttpServletRequestResponse的setStatus(int status)方法设置状态码。如果服务器返回301或者302，则浏览器会到新的网址重新请求该资源。\n从地址栏显示来说 forward是服务器请求资源,服务器直接访问目标地址的URL,把那个URL的响应内容读取过来,然后把这些内容再发给浏览器.浏览器根本不知道服务器发送的内容从哪里来的,所以它的地址栏还是原来的地址. redirect是服务端根据逻辑,发送一个状态码,告诉浏览器重新去请求那个地址.所以地址栏显示的是新的URL.\n从数据共享来说 forward:转发页面和转发到的页面可以共享request里面的数据. redirect:不能共享数据.\n从运用地方来说 forward:一般用于用户登陆的时候,根据角色转发到相应的模块. redirect:一般用于用户注销登陆时返回主页面和跳转到其它的网站等\n从效率来说 forward:高. redirect:低.\n自动刷新(Refresh) 自动刷新不仅可以实现一段时间之后自动跳转到另一个页面，还可以实现一段时间之后自动刷新本页面。Servlet中通过HttpServletResponse对象设置Header属性实现自动刷新例如：\nResponse.setHeader(\u0026#34;Refresh\u0026#34;,\u0026#34;5;URL=http://localhost:8080/servlet/example.htm\u0026#34;); 其中5为时间，单位为秒。URL指定就是要跳转的页面（如果设置自己的路径，就会实现每过一秒自动刷新本页面一次）\nServlet与线程安全 Servlet不是线程安全的，多线程并发的读写会导致数据不同步的问题。 解决的办法是尽量不要定义name属性，而是要把name变量分别定义在doGet()和doPost()方法内。虽然使用synchronized(name){}语句块可以解决问题，但是会造成线程的等待，不是很科学的办法。 注意：多线程的并发的读写Servlet类属性会导致数据不同步。但是如果只是并发地读取属性而不写入，则不存在数据不同步的问题。因此Servlet里的只读属性最好定义为final类型的。\n参考：《javaweb整合开发王者归来》P92\nJSP和Servlet是什么关系 其实这个问题在上面已经阐述过了，Servlet是一个特殊的Java程序，它运行于服务器的JVM中，能够依靠服务器的支持向浏览器提供显示内容。JSP本质上是Servlet的一种简易形式，JSP会被服务器处理成一个类似于Servlet的Java程序，可以简化页面内容的生成。Servlet和JSP最主要的不同点在于，Servlet的应用逻辑是在Java文件中，并且完全从表示层中的HTML分离开来。而JSP的情况是Java和HTML可以组合成一个扩展名为.jsp的文件。有人说，Servlet就是在Java中写HTML，而JSP就是在HTML中写Java代码，当然这个说法是很片面且不够准确的。JSP侧重于视图，Servlet更侧重于控制逻辑，在MVC架构模式中，JSP适合充当视图（view）而Servlet适合充当控制器（controller）。\nJSP工作原理 JSP是一种Servlet，但是与HttpServlet的工作方式不太一样。HttpServlet是先由源代码编译为class文件后部署到服务器下，为先编译后部署。而JSP则是先部署后编译。JSP会在客户端第一次请求JSP文件时被编译为HttpJspPage类（接口Servlet的一个子类）。该类会被服务器临时存放在服务器工作目录里面。下面通过实例给大家介绍。 工程JspLoginDemo下有一个名为login.jsp的Jsp文件，把工程第一次部署到服务器上后访问这个Jsp文件，我们发现这个目录下多了下图这两个东东。 .class文件便是JSP对应的Servlet。编译完毕后再运行class文件来响应客户端请求。以后客户端访问login.jsp的时候，Tomcat将不再重新编译JSP文件，而是直接调用class文件来响应客户端请求。\n由于JSP只会在客户端第一次请求的时候被编译 ，因此第一次请求JSP时会感觉比较慢，之后就会感觉快很多。如果把服务器保存的class文件删除，服务器也会重新编译JSP。\n开发Web程序时经常需要修改JSP。Tomcat能够自动检测到JSP程序的改动。如果检测到JSP源代码发生了改动。Tomcat会在下次客户端请求JSP时重新编译JSP，而不需要重启Tomcat。这种自动检测功能是默认开启的，检测改动会消耗少量的时间，在部署Web应用的时候可以在web.xml中将它关掉。\n参考：《javaweb整合开发王者归来》P97\nJSP有哪些内置对象、作用分别是什么 JSP内置对象 - CSDN博客\nJSP有9个内置对象：\nrequest：封装客户端的请求，其中包含来自GET或POST请求的参数； response：封装服务器对客户端的响应； pageContext：通过该对象可以获取其他对象； session：封装用户会话的对象； application：封装服务器运行环境的对象； out：输出服务器响应的输出流对象； config：Web应用的配置对象； page：JSP页面本身（相当于Java程序中的this）； exception：封装页面抛出异常的对象。 Request对象的主要方法有哪些 setAttribute(String name,Object)：设置名字为name的request 的参数值 getAttribute(String name)：返回由name指定的属性值 getAttributeNames()：返回request 对象所有属性的名字集合，结果是一个枚举的实例 getCookies()：返回客户端的所有 Cookie 对象，结果是一个Cookie 数组 getCharacterEncoding() ：返回请求中的字符编码方式 = getContentLength() ：返回请求的 Body的长度 getHeader(String name) ：获得HTTP协议定义的文件头信息 getHeaders(String name) ：返回指定名字的request Header 的所有值，结果是一个枚举的实例 getHeaderNames() ：返回所以request Header 的名字，结果是一个枚举的实例 getInputStream() ：返回请求的输入流，用于获得请求中的数据 getMethod() ：获得客户端向服务器端传送数据的方法 getParameter(String name) ：获得客户端传送给服务器端的有 name指定的参数值 getParameterNames() ：获得客户端传送给服务器端的所有参数的名字，结果是一个枚举的实例 getParameterValues(String name)：获得有name指定的参数的所有值 getProtocol()：获取客户端向服务器端传送数据所依据的协议名称 getQueryString() ：获得查询字符串 getRequestURI() ：获取发出请求字符串的客户端地址 getRemoteAddr()：获取客户端的 IP 地址 getRemoteHost() ：获取客户端的名字 getSession([Boolean create]) ：返回和请求相关 Session getServerName() ：获取服务器的名字 getServletPath()：获取客户端所请求的脚本文件的路径 getServerPort()：获取服务器的端口号 removeAttribute(String name)：删除请求中的一个属性 request.getAttribute()和 request.getParameter()有何区别 从获取方向来看：\ngetParameter()是获取 POST/GET 传递的参数值；\ngetAttribute()是获取对象容器中的数据值；\n从用途来看：\ngetParameter用于客户端重定向时，即点击了链接或提交按扭时传值用，即用于在用表单或url重定向传值时接收数据用。\ngetAttribute用于服务器端重定向时，即在 sevlet 中使用了 forward 函数,或 struts 中使用了 mapping.findForward。 getAttribute 只能收到程序用 setAttribute 传过来的值。\n另外，可以用 setAttribute,getAttribute 发送接收对象.而 getParameter 显然只能传字符串。 setAttribute 是应用服务器把这个对象放在该页面所对应的一块内存中去，当你的页面服务器重定向到另一个页面时，应用服务器会把这块内存拷贝另一个页面所对应的内存中。这样getAttribute就能取得你所设下的值，当然这种方法可以传对象。session也一样，只是对象在内存中的生命周期不一样而已。getParameter只是应用服务器在分析你送上来的 request页面的文本时，取得你设在表单或 url 重定向时的值。\n总结：\ngetParameter 返回的是String,用于读取提交的表单中的值;（获取之后会根据实际需要转换为自己需要的相应类型，比如整型，日期类型啊等等）\ngetAttribute 返回的是Object，需进行转换,可用setAttribute 设置成任意对象，使用很灵活，可随时用\ninclude指令include的行为的区别 include指令： JSP可以通过include指令来包含其他文件。被包含的文件可以是JSP文件、HTML文件或文本文件。包含的文件就好像是该JSP文件的一部分，会被同时编译执行。 语法格式如下： \u0026lt;%@ include file=\u0026ldquo;文件相对 url 地址\u0026rdquo; %\u0026gt;\ninclude动作： jsp:include动作元素用来包含静态和动态的文件。该动作把指定文件插入正在生成的页面。语法格式如下： \u0026lt;jsp:include page=\u0026ldquo;相对 URL 地址\u0026rdquo; flush=\u0026ldquo;true\u0026rdquo; /\u0026gt;\nJSP九大内置对象，七大动作，三大指令 JSP九大内置对象，七大动作，三大指令总结\n讲解JSP中的四种作用域 JSP中的四种作用域包括page、request、session和application，具体来说：\npage代表与一个页面相关的对象和属性。 request代表与Web客户机发出的一个请求相关的对象和属性。一个请求可能跨越多个页面，涉及多个Web组件；需要在页面显示的临时数据可以置于此作用域。 session代表与某个用户与服务器建立的一次会话相关的对象和属性。跟某个用户相关的数据应该放在用户自己的session中。 application代表与整个Web应用程序相关的对象和属性，它实质上是跨越整个Web应用程序，包括多个页面、请求和会话的一个全局作用域。 如何实现JSP或Servlet的单线程模式 对于JSP页面，可以通过page指令进行设置。 \u0026lt;%@page isThreadSafe=”false”%\u0026gt;\n对于Servlet，可以让自定义的Servlet实现SingleThreadModel标识接口。\n说明：如果将JSP或Servlet设置成单线程工作模式，会导致每个请求创建一个Servlet实例，这种实践将导致严重的性能问题（服务器的内存压力很大，还会导致频繁的垃圾回收），所以通常情况下并不会这么做。\n实现会话跟踪的技术有哪些 使用Cookie 向客户端发送Cookie\nCookie c =new Cookie(\u0026#34;name\u0026#34;,\u0026#34;value\u0026#34;); //创建Cookie c.setMaxAge(60*60*24); //设置最大时效，此处设置的最大时效为一天 response.addCookie(c); //把Cookie放入到HTTP响应中 从客户端读取Cookie\nString name =\u0026#34;name\u0026#34;; Cookie[]cookies =request.getCookies(); if(cookies !=null){ for(int i= 0;i\u0026lt;cookies.length;i++){ Cookie cookie =cookies[i]; if(name.equals(cookis.getName())) //something is here. //you can get the value cookie.getValue(); } } 优点: 数据可以持久保存，不需要服务器资源，简单，基于文本的Key-Value\n缺点: 大小受到限制，用户可以禁用Cookie功能，由于保存在本地，有一定的安全风险。\nURL 重写 在URL中添加用户会话的信息作为请求的参数，或者将唯一的会话ID添加到URL结尾以标识一个会话。\n优点： 在Cookie被禁用的时候依然可以使用\n缺点： 必须对网站的URL进行编码，所有页面必须动态生成，不能用预先记录下来的URL进行访问。\n3.隐藏的表单域\n\u0026lt;input type=\u0026#34;hidden\u0026#34; name =\u0026#34;session\u0026#34; value=\u0026#34;...\u0026#34;/\u0026gt; 优点： Cookie被禁时可以使用\n缺点： 所有页面必须是表单提交之后的结果。\nHttpSession 在所有会话跟踪技术中，HttpSession对象是最强大也是功能最多的。当一个用户第一次访问某个网站时会自动创建 HttpSession，每个用户可以访问他自己的HttpSession。可以通过HttpServletRequest对象的getSession方 法获得HttpSession，通过HttpSession的setAttribute方法可以将一个值放在HttpSession中，通过调用 HttpSession对象的getAttribute方法，同时传入属性名就可以获取保存在HttpSession中的对象。与上面三种方式不同的 是，HttpSession放在服务器的内存中，因此不要将过大的对象放在里面，即使目前的Servlet容器可以在内存将满时将HttpSession 中的对象移到其他存储设备中，但是这样势必影响性能。添加到HttpSession中的值可以是任意Java对象，这个对象最好实现了 Serializable接口，这样Servlet容器在必要的时候可以将其序列化到文件中，否则在序列化时就会出现异常。\nCookie和Session的的区别 由于HTTP协议是无状态的协议，所以服务端需要记录用户的状态时，就需要用某种机制来识具体的用户，这个机制就是Session.典型的场景比如购物车，当你点击下单按钮时，由于HTTP协议无状态，所以并不知道是哪个用户操作的，所以服务端要为特定的用户创建了特定的Session，用用于标识这个用户，并且跟踪用户，这样才知道购物车里面有几本书。这个Session是保存在服务端的，有一个唯一标识。在服务端保存Session的方法很多，内存、数据库、文件都有。集群的时候也要考虑Session的转移，在大型的网站，一般会有专门的Session服务器集群，用来保存用户会话，这个时候 Session 信息都是放在内存的，使用一些缓存服务比如Memcached之类的来放 Session。 思考一下服务端如何识别特定的客户？这个时候Cookie就登场了。每次HTTP请求的时候，客户端都会发送相应的Cookie信息到服务端。实际上大多数的应用都是用 Cookie 来实现Session跟踪的，第一次创建Session的时候，服务端会在HTTP协议中告诉客户端，需要在 Cookie 里面记录一个Session ID，以后每次请求把这个会话ID发送到服务器，我就知道你是谁了。有人问，如果客户端的浏览器禁用了 Cookie 怎么办？一般这种情况下，会使用一种叫做URL重写的技术来进行会话跟踪，即每次HTTP交互，URL后面都会被附加上一个诸如 sid=xxxxx 这样的参数，服务端据此来识别用户。 Cookie其实还可以用在一些方便用户的场景下，设想你某次登陆过一个网站，下次登录的时候不想再次输入账号了，怎么办？这个信息可以写到Cookie里面，访问网站的时候，网站页面的脚本可以读取这个信息，就自动帮你把用户名给填了，能够方便一下用户。这也是Cookie名称的由来，给用户的一点甜头。所以，总结一下：Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。 参考：\nhttps://www.zhihu.com/question/19786827/answer/28752144\n《javaweb整合开发王者归来》P158 Cookie和Session的比较\n","permalink":"https://zjxjwxk.github.io/posts/java/j2ee/","summary":"\u003ch2 id=\"servlet总结\"\u003eServlet总结\u003c/h2\u003e\n\u003cp\u003e在Java Web程序中，\u003cstrong\u003eServlet\u003c/strong\u003e主要负责接收用户请求\u003cstrong\u003eHttpServletRequest\u003c/strong\u003e,在\u003cstrong\u003edoGet()\u003c/strong\u003e,\u003cstrong\u003edoPost()中做相应的处理，并将回应HttpServletResponse\u003c/strong\u003e反馈给用户。Servlet可以设置初始化参数，供Servlet内部使用。一个Servlet类只会有一个实例，在它初始化时调用\u003cstrong\u003einit()方法\u003c/strong\u003e，销毁时调用\u003cstrong\u003edestroy()方法\u003c/strong\u003e。\u003cstrong\u003eServlet需要在web.xml中配置\u003c/strong\u003e（MyEclipse中创建Servlet会自动配置），\u003cstrong\u003e一个Servlet可以设置多个URL访问\u003c/strong\u003e。\u003cstrong\u003eServlet不是线程安全\u003c/strong\u003e，因此要谨慎使用类变量。\u003c/p\u003e\n\u003ch2 id=\"阐述servlet和cgi的区别\"\u003e阐述Servlet和CGI的区别?\u003c/h2\u003e\n\u003ch3 id=\"cgi的不足之处\"\u003eCGI的不足之处:\u003c/h3\u003e\n\u003cp\u003e1，需要为每个请求启动一个操作CGI程序的系统进程。如果请求频繁，这将会带来很大的开销。\u003c/p\u003e\n\u003cp\u003e2，需要为每个请求加载和运行一个CGI程序，这将带来很大的开销\u003c/p\u003e\n\u003cp\u003e3，需要重复编写处理网络协议的代码以及编码，这些工作都是非常耗时的。\u003c/p\u003e\n\u003ch3 id=\"servlet的优点\"\u003eServlet的优点:\u003c/h3\u003e\n\u003cp\u003e1，只需要启动一个操作系统进程以及加载一个JVM，大大降低了系统的开销\u003c/p\u003e\n\u003cp\u003e2，如果多个请求需要做同样处理的时候，这时候只需要加载一个类，这也大大降低了开销\u003c/p\u003e\n\u003cp\u003e3，所有动态加载的类可以实现对网络协议以及请求解码的共享，大大降低了工作量。\u003c/p\u003e\n\u003cp\u003e4，Servlet能直接和Web服务器交互，而普通的CGI程序不能。Servlet还能在各个程序之间共享数据，使数据库连接池之类的功能很容易实现。\u003c/p\u003e\n\u003cp\u003e补充：Sun Microsystems公司在1996年发布Servlet技术就是为了和CGI进行竞争，Servlet是一个特殊的Java程序，一个基于Java的Web应用通常包含一个或多个Servlet类。Servlet不能够自行创建并执行，它是在Servlet容器中运行的，容器将用户的请求传递给Servlet程序，并将Servlet的响应回传给用户。通常一个Servlet会关联一个或多个JSP页面。以前CGI经常因为性能开销上的问题被诟病，然而Fast CGI早就已经解决了CGI效率上的问题，所以面试的时候大可不必信口开河的诟病CGI，事实上有很多你熟悉的网站都使用了CGI技术。\u003c/p\u003e\n\u003cp\u003e参考：《javaweb整合开发王者归来》P7\u003c/p\u003e\n\u003ch2 id=\"servlet接口中有哪些方法及servlet生命周期探秘\"\u003eServlet接口中有哪些方法及Servlet生命周期探秘\u003c/h2\u003e\n\u003cp\u003eServlet接口定义了5个方法，其中\u003cstrong\u003e前三个方法与Servlet生命周期相关\u003c/strong\u003e：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003evoid init(ServletConfig config) throws ServletException\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003evoid service(ServletRequest req, ServletResponse resp) throws ServletException, java.io.IOException\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003evoid destory()\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003ejava.lang.String getServletInfo()\u003c/li\u003e\n\u003cli\u003eServletConfig getServletConfig()\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e生命周期：\u003c/strong\u003e \u003cstrong\u003eWeb容器加载Servlet并将其实例化后，Servlet生命周期开始\u003c/strong\u003e，容器运行其\u003cstrong\u003einit()方法\u003c/strong\u003e进行Servlet的初始化；请求到达时调用Servlet的\u003cstrong\u003eservice()方法\u003c/strong\u003e，service()方法会根据需要调用与请求对应的\u003cstrong\u003edoGet或doPost\u003c/strong\u003e等方法；当服务器关闭或项目被卸载时服务器会将Servlet实例销毁，此时会调用Servlet的\u003cstrong\u003edestroy()方法\u003c/strong\u003e。\u003cstrong\u003einit方法和destory方法只会执行一次，service方法客户端每次请求Servlet都会执行\u003c/strong\u003e。Servlet中有时会用到一些需要初始化与销毁的资源，因此可以把初始化资源的代码放入init方法中，销毁资源的代码放入destroy方法中，这样就不需要每次处理客户端的请求都要初始化与销毁资源。\u003c/p\u003e\n\u003cp\u003e参考：《javaweb整合开发王者归来》P81\u003c/p\u003e\n\u003ch2 id=\"get和post请求的区别\"\u003eget和post请求的区别\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e网上也有文章说：get和post请求实际上是没有区别，大家可以自行查询相关文章！我下面给出的只是一种常见的答案。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e①get请求用来从服务器上获得资源，而post是用来向服务器提交数据；\u003c/p\u003e\n\u003cp\u003e②get将表单中数据按照name=value的形式，添加到action 所指向的URL 后面，并且两者使用\u0026quot;?\u0026ldquo;连接，而各个变量之间使用\u0026rdquo;\u0026amp;\u0026ldquo;连接；post是将表单中的数据放在HTTP协议的请求头或消息体中，传递到action所指向URL；\u003c/p\u003e\n\u003cp\u003e③get传输的数据要受到URL长度限制（1024字节即256个字符）；而post可以传输大量的数据，上传文件通常要使用post方式；\u003c/p\u003e\n\u003cp\u003e④使用get时参数会显示在地址栏上，如果这些数据不是敏感数据，那么可以使用get；对于敏感数据还是应用使用post；\u003c/p\u003e\n\u003cp\u003e⑤get使用MIME类型application/x-www-form-urlencoded的URL编码（也叫百分号编码）文本的格式传递参数，保证被传送的参数由遵循规范的文本组成，例如一个空格的编码是\u0026rdquo;%20\u0026quot;。\u003c/p\u003e\n\u003cp\u003e补充：GET方式提交表单的典型应用是搜索引擎。GET方式就是被设计为查询用的。\u003c/p\u003e\n\u003cp\u003e还有另外一种回答。推荐大家看一下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.zhihu.com/question/28586791\"\u003ehttps://www.zhihu.com/question/28586791\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==\u0026amp;mid=100000054\u0026amp;idx=1\u0026amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd\"\u003ehttps://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==\u0026amp;mid=100000054\u0026amp;idx=1\u0026amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"什么情况下调用doget和dopost\"\u003e什么情况下调用doGet()和doPost()\u003c/h2\u003e\n\u003cp\u003eForm标签里的method的属性为get时调用doGet()，为post时调用doPost()。\u003c/p\u003e\n\u003ch2 id=\"转发forward和重定向redirect的区别\"\u003e转发(Forward)和重定向(Redirect)的区别\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e转发是服务器行为，重定向是客户端行为。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e转发（Forword）\u003c/strong\u003e 通过RequestDispatcher对象的forward（HttpServletRequest request,HttpServletResponse response）方法实现的。RequestDispatcher可以通过HttpServletRequest 的getRequestDispatcher()方法获得。例如下面的代码就是跳转到login_success.jsp页面。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e     request.getRequestDispatcher(\u0026#34;login_success.jsp\u0026#34;).forward(request, response);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e重定向（Redirect）\u003c/strong\u003e 是利用服务器返回的状态吗来实现的。客户端浏览器请求服务器的时候，服务器会返回一个状态码。服务器通过HttpServletRequestResponse的setStatus(int status)方法设置状态码。如果服务器返回301或者302，则浏览器会到新的网址重新请求该资源。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e从地址栏显示来说\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eforward是服务器请求资源,服务器直接访问目标地址的URL,把那个URL的响应内容读取过来,然后把这些内容再发给浏览器.浏览器根本不知道服务器发送的内容从哪里来的,所以它的地址栏还是原来的地址. redirect是服务端根据逻辑,发送一个状态码,告诉浏览器重新去请求那个地址.所以地址栏显示的是新的URL.\u003c/p\u003e","title":"J2EE基础知识"},{"content":"1. 面向对象和面向过程的区别 面向过程 优点： 性能比面向对象高，因为类调用时需要实例化，开销比较大，比较消耗资源;比如单片机、嵌入式开发、Linux/Unix等一般采用面向过程开发，性能是最重要的因素。\n缺点： 没有面向对象易维护、易复用、易扩展\n面向对象 优点： 易维护、易复用、易扩展，由于面向对象有封装、继承、多态性的特性，可以设计出低耦合的系统，使系统更加灵活、更加易于维护\n缺点： 性能比面向过程低\n2. Java 语言有哪些特点 简单易学； 面向对象（封装，继承，多态）； 平台无关性（ Java 虚拟机实现平台无关性）； 可靠性； 安全性； 支持多线程（ C++ 语言没有内置的多线程机制，因此必须调用操作系统的多线程功能来进行多线程程序设计，而 Java 语言却提供了多线程支持）； 支持网络编程并且很方便（ Java 语言诞生本身就是为简化网络编程设计的，因此 Java 语言不仅支持网络编程而且很方便）； 编译与解释并存； 3. 什么是 JDK 什么是 JRE 什么是 JVM 三者之间的联系与区别 这几个是Java中很基本很基本的东西，但是我相信一定还有很多人搞不清楚！为什么呢？因为我们大多数时候在使用现成的编译工具以及环境的时候，并没有去考虑这些东西。\nJDK: JDK（Java Development Kit）顾名思义它是给开发者提供的开发工具箱,是给程序开发者用的。它除了包括完整的JRE（Java Runtime Environment），Java运行环境，还包含了其他供开发者使用的工具包。\nJRE: 普通用户而只需要安装 JRE（Java Runtime Environment）来运行 Java 程序。而程序开发者必须安装JDK来编译、调试程序。\nJVM： 当我们运行一个程序时，JVM 负责将字节码转换为特定机器代码，JVM 提供了内存管理/垃圾回收和安全机制等。这种独立于硬件和操作系统，正是 java 程序可以一次编写多处执行的原因。\n区别与联系：\nJDK 用于开发，JRE 用于运行java程序 ； JDK 和 JRE 中都包含 JVM ； JVM 是 java 编程语言的核心并且具有平台独立性。 4. 什么是字节码 采用字节码的最大好处是什么 先看下 java 中的编译器和解释器： Java 中引入了虚拟机的概念，即在机器和编译程序之间加入了一层抽象的虚拟的机器。这台虚拟的机器在任何平台上都提供给编译程序一个的共同的接口。\n编译程序只需要面向虚拟机，生成虚拟机能够理解的代码，然后由解释器来将虚拟机代码转换为特定系统的机器码执行。在 Java 中，这种供虚拟机理解的代码叫做字节码（即扩展名为 .class 的文件），它不面向任何特定的处理器，只面向虚拟机。\n每一种平台的解释器是不同的，但是实现的虚拟机是相同的。Java 源程序经过编译器编译后变成字节码，字节码由虚拟机解释执行，虚拟机将每一条要执行的字节码送给解释器，解释器将其翻译成特定机器上的机器码，然后在特定的机器上运行。这也就是解释了 Java 的编译与解释并存的特点。\nJava 源代码\u0026mdash;-\u0026gt;编译器\u0026mdash;-\u0026gt;jvm 可执行的 Java 字节码(即虚拟指令)\u0026mdash;-\u0026gt;jvm\u0026mdash;-\u0026gt;jvm 中解释器\u0026mdash;\u0026ndash;\u0026gt;机器可执行的二进制机器码\u0026mdash;-\u0026gt;程序运行。\n采用字节码的好处：　Java 语言通过字节码的方式，在一定程度上解决了传统解释型语言执行效率低的问题，同时又保留了解释型语言可移植的特点。所以 Java 程序运行时比较高效，而且，由于字节码并不专对一种特定的机器，因此，Java程序无须重新编译便可在多种不同的计算机上运行。\n解释型语言：解释型语言，是在运行的时候将程序翻译成机器语言。解释型语言的程序不需要在运行前编译，在运行程序的时候才翻译，专门的解释器负责在每个语句执行的时候解释程序代码。这样解释型语言每执行一次就要翻译一次，效率比较低。——百度百科\n5. Java和C++的区别 我知道很多人没学过 C++，但是面试官就是没事喜欢拿咱们 Java 和 C++ 比呀！没办法！！！就算没学过C++，也要记下来！\n都是面向对象的语言，都支持封装、继承和多态 Java 不提供指针来直接访问内存，程序内存更加安全 Java 的类是单继承的，C++ 支持多重继承；虽然 Java 的类不可以多继承，但是接口可以多继承。 Java 有自动内存管理机制，不需要程序员手动释放无用内存 6. 什么是 Java 程序的主类 应用程序和小程序的主类有何不同 一个程序中可以有多个类，但只能有一个类是主类。在 Java 应用程序中，这个主类是指包含 main（）方法的类。而在 Java 小程序中，这个主类是一个继承自系统类 JApplet 或 Applet 的子类。应用程序的主类不一定要求是 public 类，但小程序的主类要求必须是 public 类。主类是 Java 程序执行的入口点。\n7. Java 应用程序与小程序之间有那些差别 简单说应用程序是从主线程启动(也就是 main() 方法)。applet 小程序没有main方法，主要是嵌在浏览器页面上运行(调用init()线程或者run()来启动)，嵌入浏览器这点跟 flash 的小游戏类似。\n8. 字符型常量和字符串常量的区别 形式上: 字符常量是单引号引起的一个字符 字符串常量是双引号引起的若干个字符 含义上: 字符常量相当于一个整形值( ASCII 值),可以参加表达式运算 字符串常量代表一个地址值(该字符串在内存中存放位置) 占内存大小 字符常量只占2个字节 字符串常量占若干个字节(至少一个字符结束标志) (注意： char在Java中占两个字节) 9. 构造器 Constructor 是否可被 override 在讲继承的时候我们就知道父类的私有属性和构造方法并不能被继承，所以 Constructor 也就不能被 override（重写）,但是可以 overload（重载）,所以你可以看到一个类中有多个构造函数的情况。\n10. 重载和重写的区别 重载： 发生在同一个类中，方法名必须相同，参数类型不同、个数不同、顺序不同，方法返回值和访问修饰符可以不同，发生在编译时。 重写： 发生在父子类中，方法名、参数列表必须相同，返回值范围小于等于父类，抛出的异常范围小于等于父类，访问修饰符范围大于等于父类；如果父类方法访问修饰符为 private 则子类就不能重写该方法。\n11. Java 面向对象编程三大特性:封装、继承、多态 封装 封装把一个对象的属性私有化，同时提供一些可以被外界访问的属性的方法，如果属性不想被外界访问，我们大可不必提供方法给外界访问。但是如果一个类没有提供给外界访问的方法，那么这个类也没有什么意义了。\n继承 继承是使用已存在的类的定义作为基础建立新类的技术，新类的定义可以增加新的数据或新的功能，也可以用父类的功能，但不能选择性地继承父类。通过使用继承我们能够非常方便地复用以前的代码。\n关于继承如下 3 点请记住：\n子类拥有父类非 private 的属性和方法。 子类可以拥有自己属性和方法，即子类可以对父类进行扩展。 子类可以用自己的方式实现父类的方法。（以后介绍）。 多态 所谓多态就是指程序中定义的引用变量所指向的具体类型和通过该引用变量发出的方法调用在编程时并不确定，而是在程序运行期间才确定，即一个引用变量倒底会指向哪个类的实例对象，该引用变量发出的方法调用到底是哪个类中实现的方法，必须在由程序运行期间才能决定。\n在Java中有两种形式可以实现多态：继承（多个子类对同一方法的重写）和接口（实现接口并覆盖接口中同一方法）。\n12. String 和 StringBuffer、StringBuilder 的区别是什么 String 为什么是不可变的 可变性 简单的来说：String 类中使用 final 关键字字符数组保存字符串，private　final　char　value[]，所以 String 对象是不可变的。而StringBuilder 与 StringBuffer 都继承自 AbstractStringBuilder 类，在 AbstractStringBuilder 中也是使用字符数组保存字符串char[]value 但是没有用 final 关键字修饰，所以这两种对象都是可变的。\nStringBuilder 与 StringBuffer 的构造方法都是调用父类构造方法也就是 AbstractStringBuilder 实现的，大家可以自行查阅源码。\nAbstractStringBuilder.java\nabstract class AbstractStringBuilder implements Appendable, CharSequence { char[] value; int count; AbstractStringBuilder() { } AbstractStringBuilder(int capacity) { value = new char[capacity]; } 线程安全性\nString 中的对象是不可变的，也就可以理解为常量，线程安全。AbstractStringBuilder 是 StringBuilder 与 StringBuffer 的公共父类，定义了一些字符串的基本操作，如 expandCapacity、append、insert、indexOf 等公共方法。StringBuffer 对方法加了同步锁或者对调用的方法加了同步锁，所以是线程安全的。StringBuilder 并没有对方法进行加同步锁，所以是非线程安全的。 性能\n每次对 String 类型进行改变的时候，都会生成一个新的 String 对象，然后将指针指向新的 String 对象。StringBuffer 每次都会对 StringBuffer 对象本身进行操作，而不是生成新的对象并改变对象引用。相同情况下使用 StirngBuilder 相比使用 StringBuffer 仅能获得 10%~15% 左右的性能提升，但却要冒多线程不安全的风险。\n对于三者使用的总结：\n操作少量的数据 = String 单线程操作字符串缓冲区下操作大量数据 = StringBuilder 多线程操作字符串缓冲区下操作大量数据 = StringBuffer 13. 自动装箱与拆箱 装箱：将基本类型用它们对应的引用类型包装起来；\n拆箱：将包装类型转换为基本数据类型；\n14. 在一个静态方法内调用一个非静态成员为什么是非法的 由于静态方法可以不通过对象进行调用，因此在静态方法里，不能调用其他非静态变量，也不可以访问非静态变量成员。\n15. 在 Java 中定义一个不做事且没有参数的构造方法的作用 Java 程序在执行子类的构造方法之前，如果没有用 super() 来调用父类特定的构造方法，则会调用父类中“没有参数的构造方法”。因此，如果父类中只定义了有参数的构造方法，而在子类的构造方法中又没有用 super() 来调用父类中特定的构造方法，则编译时将发生错误，因为 Java 程序在父类中找不到没有参数的构造方法可供执行。解决办法是在父类里加上一个不做事且没有参数的构造方法。 16. import java和javax有什么区别 刚开始的时候 JavaAPI 所必需的包是 java 开头的包，javax 当时只是扩展 API 包来说使用。然而随着时间的推移，javax 逐渐的扩展成为 Java API 的组成部分。但是，将扩展从 javax 包移动到 java 包将是太麻烦了，最终会破坏一堆现有的代码。因此，最终决定 javax 包将成为标准API的一部分。\n所以，实际上java和javax没有区别。这都是一个名字。\n17. 接口和抽象类的区别是什么 接口的方法默认是 public，所有方法在接口中不能有实现(Java 8 开始接口方法可以有默认实现），抽象类可以有非抽象的方法 接口中的实例变量默认是 final 类型的，而抽象类中则不一定 一个类可以实现多个接口，但最多只能实现一个抽象类 一个类实现接口的话要实现接口的所有方法，而抽象类不一定 接口不能用 new 实例化，但可以声明，但是必须引用一个实现该接口的对象 从设计层面来说，抽象是对类的抽象，是一种模板设计，接口是行为的抽象，是一种行为的规范。 18. 成员变量与局部变量的区别有那些 从语法形式上，看成员变量是属于类的，而局部变量是在方法中定义的变量或是方法的参数；成员变量可以被 public,private,static 等修饰符所修饰，而局部变量不能被访问控制修饰符及 static 所修饰；但是，成员变量和局部变量都能被 final 所修饰； 从变量在内存中的存储方式来看，成员变量是对象的一部分，而对象存在于堆内存，局部变量存在于栈内存 从变量在内存中的生存时间上看，成员变量是对象的一部分，它随着对象的创建而存在，而局部变量随着方法的调用而自动消失。 成员变量如果没有被赋初值，则会自动以类型的默认值而赋值（一种情况例外被 final 修饰的成员变量也必须显示地赋值）；而局部变量则不会自动赋值。 19. 创建一个对象用什么运算符？对象实体与对象引用有何不同？ new运算符，new创建对象实例（对象实例在堆内存中），对象引用指向对象实例（对象引用存放在栈内存中）。一个对象引用可以指向0个或1个对象（一根绳子可以不系气球，也可以系一个气球）;一个对象可以有n个引用指向它（可以用n条绳子系住一个气球）。\n20. 什么是方法的返回值？返回值在类的方法里的作用是什么？ 方法的返回值是指我们获取到的某个方法体中的代码执行后产生的结果！（前提是该方法可能产生结果）。返回值的作用:接收出结果，使得它可以用于其他的操作！\n21. 一个类的构造方法的作用是什么 若一个类没有声明构造方法，该程序能正确执行吗 为什么 主要作用是完成对类对象的初始化工作。可以执行。因为一个类即使没有声明构造方法也会有默认的不带参数的构造方法。\n22. 构造方法有哪些特性 名字与类名相同； 没有返回值，但不能用void声明构造函数； 生成类的对象时自动执行，无需调用。 23. 静态方法和实例方法有何不同 在外部调用静态方法时，可以使用\u0026quot;类名.方法名\u0026quot;的方式，也可以使用\u0026quot;对象名.方法名\u0026quot;的方式。而实例方法只有后面这种方式。也就是说，调用静态方法可以无需创建对象。 静态方法在访问本类的成员时，只允许访问静态成员（即静态成员变量和静态方法），而不允许访问实例成员变量和实例方法；实例方法则无此限制. 24. 对象的相等与指向他们的引用相等，两者有什么不同？ 对象的相等，比的是内存中存放的内容是否相等。而引用相等，比较的是他们指向的内存地址是否相等。\n25. 在调用子类构造方法之前会先调用父类没有参数的构造方法，其目的是？ 帮助子类做初始化工作。\n26. == 与 equals(重要) == : 它的作用是判断两个对象的地址是不是相等。即，判断两个对象是不是同一个对象。(基本数据类型==比较的是值，引用数据类型==比较的是内存地址)\nequals() : 它的作用也是判断两个对象是否相等。但它一般有两种使用情况：\n情况1：类没有覆盖 equals() 方法。则通过 equals() 比较该类的两个对象时，等价于通过“==”比较这两个对象。 情况2：类覆盖了 equals() 方法。一般，我们都覆盖 equals() 方法来两个对象的内容相等；若它们的内容相等，则返回 true (即，认为这两个对象相等)。 举个例子：\npublic class test1 { public static void main(String[] args) { String a = new String(\u0026#34;ab\u0026#34;); // a 为一个引用 String b = new String(\u0026#34;ab\u0026#34;); // b为另一个引用,对象的内容一样 String aa = \u0026#34;ab\u0026#34;; // 放在常量池中 String bb = \u0026#34;ab\u0026#34;; // 从常量池中查找 if (aa == bb) // true System.out.println(\u0026#34;aa==bb\u0026#34;); if (a == b) // false，非同一对象 System.out.println(\u0026#34;a==b\u0026#34;); if (a.equals(b)) // true System.out.println(\u0026#34;aEQb\u0026#34;); if (42 == 42.0) { // true System.out.println(\u0026#34;true\u0026#34;); } } } 说明：\nString 中的 equals 方法是被重写过的，因为 object 的 equals 方法是比较的对象的内存地址，而 String 的 equals 方法比较的是对象的值。 当创建 String 类型的对象时，虚拟机会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用。如果没有就在常量池中重新创建一个 String 对象。 27. hashCode 与 equals（重要） 面试官可能会问你：“你重写过 hashcode 和 equals 么，为什么重写equals时必须重写hashCode方法？”\nhashCode（）介绍 hashCode() 的作用是获取哈希码，也称为散列码；它实际上是返回一个int整数。这个哈希码的作用是确定该对象在哈希表中的索引位置。hashCode() 定义在JDK的Object.java中，这就意味着Java中的任何类都包含有hashCode() 函数。\n散列表存储的是键值对(key-value)，它的特点是：能根据“键”快速的检索出对应的“值”。这其中就利用到了散列码！（可以快速找到所需要的对象）\n为什么要有 hashCode 我们以“HashSet 如何检查重复”为例子来说明为什么要有 hashCode：\n当你把对象加入 HashSet 时，HashSet 会先计算对象的 hashcode 值来判断对象加入的位置，同时也会与其他已经加入的对象的 hashcode 值作比较，如果没有相符的hashcode，HashSet会假设对象没有重复出现。但是如果发现有相同 hashcode 值的对象，这时会调用 equals（）方法来检查 hashcode 相等的对象是否真的相同。如果两者相同，HashSet 就不会让其加入操作成功。如果不同的话，就会重新散列到其他位置。（摘自我的Java启蒙书《Head fist java》第二版）。这样我们就大大减少了 equals 的次数，相应就大大提高了执行速度。\nhashCode（）与equals（）的相关规定 如果两个对象相等，则hashcode一定也是相同的 两个对象相等,对两个对象分别调用equals方法都返回true 两个对象有相同的hashcode值，它们也不一定是相等的 因此，equals 方法被覆盖过，则 hashCode 方法也必须被覆盖 hashCode() 的默认行为是对堆上的对象产生独特值。如果没有重写 hashCode()，则该 class 的两个对象无论如何都不会相等（即使这两个对象指向相同的数据） 28. 为什么Java中只有值传递 为什么Java中只有值传递？\n29. 简述线程，程序、进程的基本概念。以及他们之间关系是什么 线程与进程相似，但线程是一个比进程更小的执行单位。一个进程在其执行的过程中可以产生多个线程。与进程不同的是同类的多个线程共享同一块内存空间和一组系统资源，所以系统在产生一个线程，或是在各个线程之间作切换工作时，负担要比进程小得多，也正因为如此，线程也被称为轻量级进程。\n程序是含有指令和数据的文件，被存储在磁盘或其他的数据存储设备中，也就是说程序是静态的代码。\n进程是程序的一次执行过程，是系统运行程序的基本单位，因此进程是动态的。系统运行一个程序即是一个进程从创建，运行到消亡的过程。简单来说，一个进程就是一个执行中的程序，它在计算机中一个指令接着一个指令地执行着，同时，每个进程还占有某些系统资源如CPU时间，内存空间，文件，文件，输入输出设备的使用权等等。换句话说，当程序在执行时，将会被操作系统载入内存中。 线程是进程划分成的更小的运行单位。线程和进程最大的不同在于基本上各进程是独立的，而各线程则不一定，因为同一进程中的线程极有可能会相互影响。从另一角度来说，进程属于操作系统的范畴，主要是同一段时间内，可以同时执行一个以上的程序，而线程则是在同一程序内几乎同时执行一个以上的程序段。\n30. 线程有哪些基本状态？这些状态是如何定义的? 新建(new)：新创建了一个线程对象。 可运行(runnable)：线程对象创建后，其他线程(比如main线程）调用了该对象的start()方法。该状态的线程位于可运行线程池中，等待被线程调度选中，获 取cpu的使用权。 运行(running)：可运行状态(runnable)的线程获得了cpu时间片（timeslice），执行程序代码。 阻塞(block)：阻塞状态是指线程因为某种原因放弃了cpu使用权，也即让出了cpu timeslice，暂时停止运行。直到线程进入可运行(runnable)状态，才有 机会再次获得cpu timeslice转到运行(running)状态。阻塞的情况分三种： (一). 等待阻塞：运行(running)的线程执行o.wait()方法，JVM会把该线程放 入等待队列(waitting queue)中。 (二). 同步阻塞：运行(running)的线程在获取对象的同步锁时，若该同步锁 被别的线程占用，则JVM会把该线程放入锁池(lock pool)中。 (三). 其他阻塞: 运行(running)的线程执行Thread.sleep(long ms)或t.join()方法，或者发出了I/O请求时，JVM会把该线程置为阻塞状态。当sleep()状态超时join()等待线程终止或者超时、或者I/O处理完毕时，线程重新转入可运行(runnable)状态。 死亡(dead)：线程run()、main()方法执行结束，或者因异常退出了run()方法，则该线程结束生命周期。死亡的线程不可再次复生。 备注： 可以用早起坐地铁来比喻这个过程：\n还没起床：sleeping\n起床收拾好了，随时可以坐地铁出发：Runnable\n等地铁来：Waiting\n地铁来了，但要排队上地铁：I/O阻塞\n上了地铁，发现暂时没座位：synchronized阻塞\n地铁上找到座位：Running\n到达目的地：Dead\n31 关于 final 关键字的一些总结 final关键字主要用在三个地方：变量、方法、类。\n对于一个final变量，如果是基本数据类型的变量，则其数值一旦在初始化之后便不能更改；如果是引用类型的变量，则在对其初始化之后便不能再让其指向另一个对象。 当用final修饰一个类时，表明这个类不能被继承。final类中的所有成员方法都会被隐式地指定为final方法。 使用final方法的原因有两个。第一个原因是把方法锁定，以防任何继承类修改它的含义；第二个原因是效率。在早期的Java实现版本中，会将final方法转为内嵌调用。但是如果方法过于庞大，可能看不到内嵌调用带来的任何性能提升（现在的Java版本已经不需要使用final方法进行这些优化了）。类中所有的private方法都隐式地指定为final。 32 Java 中的异常处理 Java异常类层次结构图 在 Java 中，所有的异常都有一个共同的祖先java.lang包中的 Throwable类。Throwable： 有两个重要的子类：Exception（异常） 和 Error（错误） ，二者都是 Java 异常处理的重要子类，各自都包含大量子类。\nError（错误）:是程序无法处理的错误，表示运行应用程序中较严重问题。大多数错误与代码编写者执行的操作无关，而表示代码运行时 JVM（Java 虚拟机）出现的问题。例如，Java虚拟机运行错误（Virtual MachineError），当 JVM 不再有继续执行操作所需的内存资源时，将出现 OutOfMemoryError。这些异常发生时，Java虚拟机（JVM）一般会选择线程终止。\n这些错误表示故障发生于虚拟机自身、或者发生在虚拟机试图执行应用时，如Java虚拟机运行错误（Virtual MachineError）、类定义错误（NoClassDefFoundError）等。这些错误是不可查的，因为它们在应用程序的控制和处理能力之 外，而且绝大多数是程序运行时不允许出现的状况。对于设计合理的应用程序来说，即使确实发生了错误，本质上也不应该试图去处理它所引起的异常状况。在 Java中，错误通过Error的子类描述。\nException（异常）:是程序本身可以处理的异常。Exception 类有一个重要的子类 RuntimeException。RuntimeException 异常由Java虚拟机抛出。NullPointerException（要访问的变量没有引用任何对象时，抛出该异常）、ArithmeticException（算术运算异常，一个整数除以0时，抛出该异常）和 ArrayIndexOutOfBoundsException （下标越界异常）。\n注意：异常和错误的区别：异常能被程序本身可以处理，错误是无法处理。\nThrowable类常用方法 public string getMessage():返回异常发生时的详细信息 public string toString():返回异常发生时的简要描述 public string getLocalizedMessage():返回异常对象的本地化信息。使用Throwable的子类覆盖这个方法，可以声称本地化信息。如果子类没有覆盖该方法，则该方法返回的信息与getMessage（）返回的结果相同 public void printStackTrace():在控制台上打印Throwable对象封装的异常信息 异常处理总结 try 块：用于捕获异常。其后可接零个或多个catch块，如果没有catch块，则必须跟一个finally块。 catch 块：用于处理try捕获到的异常。 finally 块：无论是否捕获或处理异常，finally块里的语句都会被执行。当在try块或catch块中遇到return语句时，finally语句块将在方法返回之前被执行。 在以下4种特殊情况下，finally块不会被执行：\n在finally语句块中发生了异常。 在前面的代码中用了System.exit()退出程序。 程序所在的线程死亡。 关闭CPU。 33 Java序列话中如果有些字段不想进行序列化 怎么办 对于不想进行序列化的变量，使用transient关键字修饰。\ntransient关键字的作用是：阻止实例中那些用此关键字修饰的的变量序列化；当对象被反序列化时，被transient修饰的变量值不会被持久化和恢复。transient只能修饰变量，不能修饰类和方法。\n34 获取用键盘输入常用的的两种方法 方法1：通过 Scanner\nScanner input = new Scanner(System.in); String s = input.nextLine(); input.close(); 方法2：通过 BufferedReader\nBufferedReader input = new BufferedReader(new InputStreamReader(System.in)); String s = input.readLine(); Java基础学习书籍推荐 《Head First Java.第二版》： 可以说是我的 Java 启蒙书籍了，特别适合新手读当然也适合我们用来温故Java知识点。\n《Java核心技术卷1+卷2》： 很棒的两本书，建议有点 Java 基础之后再读，介绍的还是比较深入的，非常推荐。\n《Java编程思想(第4版)》： 这本书要常读，初学者可以快速概览，中等程序员可以深入看看 Java，老鸟还可以用之回顾 Java 的体系。这本书之所以厉害，因为它在无形中整合了设计模式，这本书之所以难读，也恰恰在于他对设计模式的整合是无形的。\n","permalink":"https://zjxjwxk.github.io/posts/java/java%E6%A0%B8%E5%BF%83/","summary":"\u003ch2 id=\"1-面向对象和面向过程的区别\"\u003e1. 面向对象和面向过程的区别\u003c/h2\u003e\n\u003ch3 id=\"面向过程\"\u003e面向过程\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e优点：\u003c/strong\u003e 性能比面向对象高，因为类调用时需要实例化，开销比较大，比较消耗资源;比如单片机、嵌入式开发、Linux/Unix等一般采用面向过程开发，性能是最重要的因素。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e缺点：\u003c/strong\u003e 没有面向对象易维护、易复用、易扩展\u003c/p\u003e\n\u003ch3 id=\"面向对象\"\u003e面向对象\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e优点：\u003c/strong\u003e 易维护、易复用、易扩展，由于面向对象有封装、继承、多态性的特性，可以设计出低耦合的系统，使系统更加灵活、更加易于维护\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e缺点：\u003c/strong\u003e 性能比面向过程低\u003c/p\u003e\n\u003ch2 id=\"2-java-语言有哪些特点\"\u003e2. Java 语言有哪些特点\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e简单易学；\u003c/li\u003e\n\u003cli\u003e面向对象（封装，继承，多态）；\u003c/li\u003e\n\u003cli\u003e平台无关性（ Java 虚拟机实现平台无关性）；\u003c/li\u003e\n\u003cli\u003e可靠性；\u003c/li\u003e\n\u003cli\u003e安全性；\u003c/li\u003e\n\u003cli\u003e支持多线程（ C++ 语言没有内置的多线程机制，因此必须调用操作系统的多线程功能来进行多线程程序设计，而 Java 语言却提供了多线程支持）；\u003c/li\u003e\n\u003cli\u003e支持网络编程并且很方便（ Java 语言诞生本身就是为简化网络编程设计的，因此 Java 语言不仅支持网络编程而且很方便）；\u003c/li\u003e\n\u003cli\u003e编译与解释并存；\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"3-什么是-jdk-什么是-jre-什么是-jvm-三者之间的联系与区别\"\u003e3. 什么是 JDK 什么是 JRE 什么是 JVM 三者之间的联系与区别\u003c/h2\u003e\n\u003cp\u003e这几个是Java中很基本很基本的东西，但是我相信一定还有很多人搞不清楚！为什么呢？因为我们大多数时候在使用现成的编译工具以及环境的时候，并没有去考虑这些东西。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJDK:\u003c/strong\u003e JDK（Java Development Kit）顾名思义它是给开发者提供的开发工具箱,是给程序开发者用的。它除了包括完整的JRE（Java Runtime Environment），Java运行环境，还包含了其他供开发者使用的工具包。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJRE:\u003c/strong\u003e 普通用户而只需要安装 JRE（Java Runtime Environment）来运行 Java 程序。而程序开发者必须安装JDK来编译、调试程序。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJVM：\u003c/strong\u003e 当我们运行一个程序时，JVM 负责将字节码转换为特定机器代码，JVM 提供了内存管理/垃圾回收和安全机制等。这种独立于硬件和操作系统，正是 java 程序可以一次编写多处执行的原因。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e区别与联系：\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eJDK 用于开发，JRE 用于运行java程序 ；\u003c/li\u003e\n\u003cli\u003eJDK 和 JRE 中都包含 JVM ；\u003c/li\u003e\n\u003cli\u003eJVM 是 java 编程语言的核心并且具有平台独立性。\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"4-什么是字节码-采用字节码的最大好处是什么\"\u003e4. 什么是字节码 采用字节码的最大好处是什么\u003c/h2\u003e\n\u003ch3 id=\"先看下-java-中的编译器和解释器\"\u003e先看下 java 中的编译器和解释器： 　　\u003c/h3\u003e\n\u003cp\u003eJava 中引入了虚拟机的概念，即在机器和编译程序之间加入了一层抽象的虚拟的机器。这台虚拟的机器在任何平台上都提供给编译程序一个的共同的接口。\u003c/p\u003e","title":"Java基础知识"}]