<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Meet Kafka | Xinkang&#39;s Blog</title>
<meta name="keywords" content="MQ, Kafka">
<meta name="description" content="Kafka Architecture

Kafka Message

Deploy Kafka
Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:
---
version: &#39;3&#39;
services:
  zookeeper-1:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-1
    container_name: zookeeper-1
    volumes:
      - ./zookeeper-1_data:/var/lib/zookeeper/data
      - ./zookeeper-1_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181

  zookeeper-2:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-2
    container_name: zookeeper-2
    volumes:
      - ./zookeeper-2_data:/var/lib/zookeeper/data
      - ./zookeeper-2_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181

  zookeeper-3:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-3
    container_name: zookeeper-3
    volumes:
      - ./zookeeper-3_data:/var/lib/zookeeper/data
      - ./zookeeper-3_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181


  broker-1:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-1
    container_name: broker-1
    volumes:
      - ./broker-1-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
    ports:
      - 9092:9092
      - 29092:29092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true

  broker-2:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-2
    container_name: broker-2
    volumes:
      - ./broker-2-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
    ports:
      - 9093:9093
      - 29093:29093
    environment:
      KAFKA_BROKER_ID: 2
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true

  broker-3:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-3
    container_name: broker-3
    volumes:
      - ./broker-3-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
      - broker-2
    ports:
      - 9094:9094
      - 29094:29094
    environment:
      KAFKA_BROKER_ID: 3
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true


  rest-proxy:
    image: confluentinc/cp-kafka-rest:7.4.1
    ports:
      - &#34;8082:8082&#34;
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
      - broker-2
      - broker-3
    hostname: rest-proxy
    container_name: rest-proxy
    environment:
      KAFKA_REST_HOST_NAME: rest-proxy
      KAFKA_REST_BOOTSTRAP_SERVERS: &#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;
      KAFKA_REST_LISTENERS: &#34;http://0.0.0.0:8082&#34;
Pull all images and run all composed containers:">
<meta name="author" content="">
<link rel="canonical" href="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://zjxjwxk.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://zjxjwxk.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zjxjwxk.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://zjxjwxk.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://zjxjwxk.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/">
  <meta property="og:site_name" content="Xinkang&#39;s Blog">
  <meta property="og:title" content="Meet Kafka">
  <meta property="og:description" content="Kafka Architecture Kafka Message Deploy Kafka Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:
--- version: &#39;3&#39; services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - &#34;8082:8082&#34; depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: &#39;broker-1:29092,broker-2:29093,broker-3:29094&#39; KAFKA_REST_LISTENERS: &#34;http://0.0.0.0:8082&#34; Pull all images and run all composed containers:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-16T01:47:59+08:00">
    <meta property="article:modified_time" content="2024-11-16T01:47:59+08:00">
    <meta property="article:tag" content="MQ">
    <meta property="article:tag" content="Kafka">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Meet Kafka">
<meta name="twitter:description" content="Kafka Architecture

Kafka Message

Deploy Kafka
Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:
---
version: &#39;3&#39;
services:
  zookeeper-1:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-1
    container_name: zookeeper-1
    volumes:
      - ./zookeeper-1_data:/var/lib/zookeeper/data
      - ./zookeeper-1_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181

  zookeeper-2:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-2
    container_name: zookeeper-2
    volumes:
      - ./zookeeper-2_data:/var/lib/zookeeper/data
      - ./zookeeper-2_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181

  zookeeper-3:
    image: confluentinc/cp-zookeeper:7.4.1
    hostname: zookeeper-3
    container_name: zookeeper-3
    volumes:
      - ./zookeeper-3_data:/var/lib/zookeeper/data
      - ./zookeeper-3_log:/var/lib/zookeeper/log
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181


  broker-1:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-1
    container_name: broker-1
    volumes:
      - ./broker-1-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
    ports:
      - 9092:9092
      - 29092:29092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true

  broker-2:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-2
    container_name: broker-2
    volumes:
      - ./broker-2-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
    ports:
      - 9093:9093
      - 29093:29093
    environment:
      KAFKA_BROKER_ID: 2
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true

  broker-3:
    image: confluentinc/cp-kafka:7.4.1
    hostname: broker-3
    container_name: broker-3
    volumes:
      - ./broker-3-data:/var/lib/kafka/data
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
      - broker-2
    ports:
      - 9094:9094
      - 29094:29094
    environment:
      KAFKA_BROKER_ID: 3
      KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181
      KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_SNAPSHOT_TRUST_EMPTY: true


  rest-proxy:
    image: confluentinc/cp-kafka-rest:7.4.1
    ports:
      - &#34;8082:8082&#34;
    depends_on:
      - zookeeper-1
      - zookeeper-2
      - zookeeper-3
      - broker-1
      - broker-2
      - broker-3
    hostname: rest-proxy
    container_name: rest-proxy
    environment:
      KAFKA_REST_HOST_NAME: rest-proxy
      KAFKA_REST_BOOTSTRAP_SERVERS: &#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;
      KAFKA_REST_LISTENERS: &#34;http://0.0.0.0:8082&#34;
Pull all images and run all composed containers:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://zjxjwxk.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Meet Kafka",
      "item": "https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Meet Kafka",
  "name": "Meet Kafka",
  "description": "Kafka Architecture Kafka Message Deploy Kafka Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:\n--- version: \u0026#39;3\u0026#39; services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \u0026#34;8082:8082\u0026#34; depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: \u0026#39;broker-1:29092,broker-2:29093,broker-3:29094\u0026#39; KAFKA_REST_LISTENERS: \u0026#34;http://0.0.0.0:8082\u0026#34; Pull all images and run all composed containers:\n",
  "keywords": [
    "MQ", "Kafka"
  ],
  "articleBody": "Kafka Architecture Kafka Message Deploy Kafka Create a docker-compose file docker-compose.yaml containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:\n--- version: '3' services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \"8082:8082\" depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' KAFKA_REST_LISTENERS: \"http://0.0.0.0:8082\" Pull all images and run all composed containers:\ndocker compose up -d When all containers run like this:\n[+] Running 8/8 ⠿ Network demo1_default Created 0.1s ⠿ Container zookeeper-1 Started 2.6s ⠿ Container zookeeper-2 Started 2.5s ⠿ Container zookeeper-3 Started 2.6s ⠿ Container broker-1 Started 3.6s ⠿ Container broker-2 Started 4.4s ⠿ Container broker-3 Started 5.2s ⠿ Container rest-proxy Started 5.7s We can check the docker logs:\ndocker logs broker-1 We can also check all service statuses:\ndocker compose ps It should show that all services are up:\nNAME IMAGE COMMAND SERVICE CREATED STATUS PORTS broker-1 confluentinc/cp-kafka:7.4.1 \"/etc/confluent/dock…\" broker-1 3 minutes ago Up 3 minutes 0.0.0.0:9092-\u003e9092/tcp, 0.0.0.0:29092-\u003e29092/tcp broker-2 confluentinc/cp-kafka:7.4.1 \"/etc/confluent/dock…\" broker-2 3 minutes ago Up 3 minutes 0.0.0.0:9093-\u003e9093/tcp, 9092/tcp, 0.0.0.0:29093-\u003e29093/tcp broker-3 confluentinc/cp-kafka:7.4.1 \"/etc/confluent/dock…\" broker-3 3 minutes ago Up 3 minutes 0.0.0.0:9094-\u003e9094/tcp, 9092/tcp, 0.0.0.0:29094-\u003e29094/tcp rest-proxy confluentinc/cp-kafka-rest:7.4.1 \"/etc/confluent/dock…\" rest-proxy 3 minutes ago Up 3 minutes 0.0.0.0:8082-\u003e8082/tcp zookeeper-1 confluentinc/cp-zookeeper:7.4.1 \"/etc/confluent/dock…\" zookeeper-1 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp zookeeper-2 confluentinc/cp-zookeeper:7.4.1 \"/etc/confluent/dock…\" zookeeper-2 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp zookeeper-3 confluentinc/cp-zookeeper:7.4.1 \"/etc/confluent/dock…\" zookeeper-3 3 minutes ago Up 3 minutes 2181/tcp, 2888/tcp, 3888/tcp We can also call the REST APIs provided by the Kafka REST Proxy. For example, display alive brokers:\ncurl localhost:8082/brokers It should show that there are three living brokers:\n{\"brokers\":[1,2,3]}% Kafka Ecosystem Packaging Versions:\nConfluent Cloud Cloudera Strimzi offers the Helm charts to deploy Kafka to Kubernetes Logging Plugins:\nSyslog Fluentd Logstash Filebeat DBs:\nJDBC connector to cover RDBMS Dos. Debezium also offers a connector that includes no-SQL Dos. Presto connector that allows us to query Kafka using Presto queries. Interaction with Kafka via the CLI Run Kafka Containers Run composed containers (if not):\ndocker compose up -d Add Kafka PATH Download Kafka from the official website https://kafka.apache.org/downloads:\nAdd Kafka to your PATH. (I use zsh, so it’s configured in the ~/.zshrc for me)\nexport KAFKA_HOME=/Users/zjxjwxk/Library/kafka_2.13-3.9.0 export PATH=$PATH:$KAFKA_HOME/bin Then run this command (if you are using a Linux-like OS):\nsource ~/.zshrc Send Messages Send messages by running Kafka Producer:\n❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic \u003eHello [2024-11-16 15:41:58,970] WARN [Producer clientId=console-producer] The metadata response from the cluster reported a recoverable issue with correlation id 7 : {first_topic=LEADER_NOT_AVAILABLE} (org.apache.kafka.clients.NetworkClient) \u003eKafka \u003eI'm Xinkang \u003e Receive Messages Receive messages by running Kafka Consumer:\n❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic first_topic --from-beginning Hello Kafka I'm Xinkang Display topics by Kafka REST Proxy:\n❯ curl localhost:8082/topics [\"first_topic\"]% Topics Kafka Producers send messages to topics of Kafka Brokers:\nRetention Can Be Set To:\nDays: This means only keeping messages of up to N days and then deleting them. Bytes: This means only keeping messages until the topic has more than X bytes and then delete. None: This means storing all messages from the beginning of time. Kafka Consumers consume messages from topics of Kafka Brokers:\nPartitions A topic can be split into partitions and distributed within brokers in the cluster:\nThe partitioner uses the key to distribute the messages to the correct partition:\nConsumer Read Scenarios Consumer Offset: From the Beginning\nConsumer Offset: From the End\nConsumer Offset: Already Have Been Here\nSummary:\nTopics can be partitioned. The partitioner uses the message key to redirect messages to partitions. Consumers read them from partitions and have an offset. Therefore, more partitions enable more consumers, therefore more scalability. Topic Replication Each topic has a number called the replication factor, which replicates each partition of that topic:\nEach partition is on a different broker, therefore a single topic is scaled.\nInteraction with Kafka via the REST Proxy Run Kafka Containers Run composed containers (if not):\ndocker compose up -d Import Postman Collection Use this Open API yaml for Kafka REST Proxy: https://github.com/axel-sirota/getting-started-kafka/blob/main/rest_proxy.yaml, which provides RESTful interfaces to a Kafka cluster.\nWe can import this yaml to the Postman as a collection:\nThen, add an environment for variables like baseUrl and use the environment.\nCreate Topic Create a topic myorders with 1 replication and 3 partisions:\nkafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 3 --topic myorders The created topic can be displayed by calling {{baseUrl}}/topics/:topicName via the Postman. The path variable :topicName should be myorders. The response will be like:\n{ \"name\": \"myorders\", ... \"partitions\": [ { \"partition\": 0, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true } ] }, { \"partition\": 1, \"leader\": 2, \"replicas\": [ { \"broker\": 2, \"leader\": true, \"in_sync\": true } ] }, { \"partition\": 2, \"leader\": 3, \"replicas\": [ { \"broker\": 3, \"leader\": true, \"in_sync\": true } ] } ] } This is a pretty fragile scenario because if any broker goes down, there is no replica.\nIncrease Replication Prepare a json file increase-replication.json for reassigning partitions of topic myorders:\n{\"version\":1, \"partitions\":[ {\"topic\":\"myorders\",\"partition\":0,\"replicas\":[1,2]}, {\"topic\":\"myorders\",\"partition\":1,\"replicas\":[1,2]}, {\"topic\":\"myorders\",\"partition\":2,\"replicas\":[2]} ] } Reassign partitions with the json file:\nkafka-reassign-partitions.sh --bootstrap-server localhost:9092 --reassignment-json-file increase_replication.json --execute Then we can see the replication of partition 0 and 1 are increased and a leader is elected for each replica.\n{ \"name\": \"myorders\", ... \"partitions\": [ { \"partition\": 0, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true }, { \"broker\": 2, \"leader\": false, \"in_sync\": true } ] }, { \"partition\": 1, \"leader\": 2, \"replicas\": [ { \"broker\": 1, \"leader\": false, \"in_sync\": true }, { \"broker\": 2, \"leader\": true, \"in_sync\": true } ] }, { \"partition\": 2, \"leader\": 2, \"replicas\": [ { \"broker\": 2, \"leader\": true, \"in_sync\": true } ] } ] } Stop a Broker Stop the broker 2 to test the system resilience.\ndocker stop broker-2 We can see that for partition 0 and 1, the broker 2 is not in_sync. And for partition 2, the leader is -1, which means there is no leader and cannot take any new message.\n{ \"name\": \"myorders\", ... \"partitions\": [ { \"partition\": 0, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true }, { \"broker\": 2, \"leader\": false, \"in_sync\": false } ] }, { \"partition\": 1, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true }, { \"broker\": 2, \"leader\": false, \"in_sync\": false } ] }, { \"partition\": 2, \"leader\": -1, \"replicas\": [ { \"broker\": 2, \"leader\": false, \"in_sync\": true } ] } ] } Try to send messages to the topic myorders by running Kafka Producer:\n❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic myorders \u003eHello \u003eagain \u003efrom \u003eWxk And try to receive messages from topic myorders:\nkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning We will find there is no response returned. The topic will be offline if one partition doesn’t have any replica online.\nIf we restart the stopped broker, Kafka willl self heal:\ndocker compose up -d We can see that for partition 0 and 1, the broker 2 is in_syncagain. And for partition 2, theleader` 2 is elected again.\n{ \"name\": \"myorders\", ... \"partitions\": [ { \"partition\": 0, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true }, { \"broker\": 2, \"leader\": false, \"in_sync\": true } ] }, { \"partition\": 1, \"leader\": 1, \"replicas\": [ { \"broker\": 1, \"leader\": true, \"in_sync\": true }, { \"broker\": 2, \"leader\": false, \"in_sync\": true } ] }, { \"partition\": 2, \"leader\": 2, \"replicas\": [ { \"broker\": 2, \"leader\": true, \"in_sync\": true } ] } ] } Then we can receive messages successfully:\n❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning Hello again from Wxk ",
  "wordCount" : "1432",
  "inLanguage": "en",
  "datePublished": "2024-11-16T01:47:59+08:00",
  "dateModified": "2024-11-16T01:47:59+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xinkang's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://zjxjwxk.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zjxjwxk.github.io/" accesskey="h" title="Xinkang&#39;s Blog (Alt + H)">Xinkang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zjxjwxk.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Meet Kafka
    </h1>
    <div class="post-meta"><span title='2024-11-16 01:47:59 +0800 CST'>November 16, 2024</span>

</div>
  </header> 
  <div class="post-content"><h2 id="kafka-architecture">Kafka Architecture<a hidden class="anchor" aria-hidden="true" href="#kafka-architecture">#</a></h2>
<p><img alt="image-20241116015015788" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116015015788.png"></p>
<h2 id="kafka-message">Kafka Message<a hidden class="anchor" aria-hidden="true" href="#kafka-message">#</a></h2>
<p><img alt="image-20241116015252987" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116015252987.png"></p>
<h2 id="deploy-kafka">Deploy Kafka<a hidden class="anchor" aria-hidden="true" href="#deploy-kafka">#</a></h2>
<p>Create a docker-compose file <code>docker-compose.yaml</code> containing 3 Zookeepers, 3 Kafka Brokers, and 1 Kafka REST Proxy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-1-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9092</span>:<span style="color:#ae81ff">9092</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29092</span>:<span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9092,INTERNAL://broker-1:29092</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-2-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9093</span>:<span style="color:#ae81ff">9093</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29093</span>:<span style="color:#ae81ff">29093</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9093,INTERNAL://broker-2:29093</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-3-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9094</span>:<span style="color:#ae81ff">9094</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29094</span>:<span style="color:#ae81ff">29094</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9094,INTERNAL://broker-3:29094</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rest-proxy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka-rest:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8082:8082&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_HOST_NAME</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_LISTENERS</span>: <span style="color:#e6db74">&#34;http://0.0.0.0:8082&#34;</span>
</span></span></code></pre></div><p>Pull all images and run all composed containers:</p>
<pre tabindex="0"><code>docker compose up -d
</code></pre><p>When all containers run like this:</p>
<pre tabindex="0"><code>[+] Running 8/8
 ⠿ Network demo1_default  Created                                                                  0.1s
 ⠿ Container zookeeper-1  Started                                                                  2.6s
 ⠿ Container zookeeper-2  Started                                                                  2.5s
 ⠿ Container zookeeper-3  Started                                                                  2.6s
 ⠿ Container broker-1     Started                                                                  3.6s
 ⠿ Container broker-2     Started                                                                  4.4s
 ⠿ Container broker-3     Started                                                                  5.2s
 ⠿ Container rest-proxy   Started                                                                  5.7s
</code></pre><p>We can check the docker logs:</p>
<pre tabindex="0"><code>docker logs broker-1
</code></pre><p>We can also check all service statuses:</p>
<pre tabindex="0"><code>docker compose ps
</code></pre><p>It should show that all services are up:</p>
<pre tabindex="0"><code>NAME                IMAGE                              COMMAND                  SERVICE             CREATED             STATUS              PORTS
broker-1            confluentinc/cp-kafka:7.4.1        &#34;/etc/confluent/dock…&#34;   broker-1            3 minutes ago       Up 3 minutes        0.0.0.0:9092-&gt;9092/tcp, 0.0.0.0:29092-&gt;29092/tcp
broker-2            confluentinc/cp-kafka:7.4.1        &#34;/etc/confluent/dock…&#34;   broker-2            3 minutes ago       Up 3 minutes        0.0.0.0:9093-&gt;9093/tcp, 9092/tcp, 0.0.0.0:29093-&gt;29093/tcp
broker-3            confluentinc/cp-kafka:7.4.1        &#34;/etc/confluent/dock…&#34;   broker-3            3 minutes ago       Up 3 minutes        0.0.0.0:9094-&gt;9094/tcp, 9092/tcp, 0.0.0.0:29094-&gt;29094/tcp
rest-proxy          confluentinc/cp-kafka-rest:7.4.1   &#34;/etc/confluent/dock…&#34;   rest-proxy          3 minutes ago       Up 3 minutes        0.0.0.0:8082-&gt;8082/tcp
zookeeper-1         confluentinc/cp-zookeeper:7.4.1    &#34;/etc/confluent/dock…&#34;   zookeeper-1         3 minutes ago       Up 3 minutes        2181/tcp, 2888/tcp, 3888/tcp
zookeeper-2         confluentinc/cp-zookeeper:7.4.1    &#34;/etc/confluent/dock…&#34;   zookeeper-2         3 minutes ago       Up 3 minutes        2181/tcp, 2888/tcp, 3888/tcp
zookeeper-3         confluentinc/cp-zookeeper:7.4.1    &#34;/etc/confluent/dock…&#34;   zookeeper-3         3 minutes ago       Up 3 minutes        2181/tcp, 2888/tcp, 3888/tcp
</code></pre><p>We can also call the REST APIs provided by the Kafka REST Proxy. For example, display alive brokers:</p>
<pre tabindex="0"><code>curl localhost:8082/brokers
</code></pre><p>It should show that there are three living brokers:</p>
<pre tabindex="0"><code>{&#34;brokers&#34;:[1,2,3]}%
</code></pre><h2 id="kafka-ecosystem">Kafka Ecosystem<a hidden class="anchor" aria-hidden="true" href="#kafka-ecosystem">#</a></h2>
<p>Packaging Versions:</p>
<ul>
<li>Confluent Cloud</li>
<li>Cloudera</li>
<li>Strimzi offers the Helm charts to deploy Kafka to Kubernetes</li>
</ul>
<p>Logging Plugins:</p>
<ul>
<li>Syslog</li>
<li>Fluentd</li>
<li>Logstash</li>
<li>Filebeat</li>
</ul>
<p>DBs:</p>
<ul>
<li>JDBC connector to cover RDBMS Dos.</li>
<li>Debezium also offers a connector that includes no-SQL Dos.</li>
<li>Presto connector that allows us to query Kafka using Presto queries.</li>
</ul>
<h2 id="interaction-with-kafka-via-the-cli">Interaction with Kafka via the CLI<a hidden class="anchor" aria-hidden="true" href="#interaction-with-kafka-via-the-cli">#</a></h2>
<h3 id="run-kafka-containers">Run Kafka Containers<a hidden class="anchor" aria-hidden="true" href="#run-kafka-containers">#</a></h3>
<p>Run composed containers (if not):</p>
<pre tabindex="0"><code>docker compose up -d
</code></pre><h3 id="add-kafka-path">Add Kafka PATH<a hidden class="anchor" aria-hidden="true" href="#add-kafka-path">#</a></h3>
<p>Download Kafka from the official website <a href="https://kafka.apache.org/downloads">https://kafka.apache.org/downloads</a>:</p>
<p><img alt="image-20241116121042313" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116121042313.png"></p>
<p>Add Kafka to your PATH. (I use zsh, so it&rsquo;s configured in the ~/.zshrc for me)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export KAFKA_HOME<span style="color:#f92672">=</span>/Users/zjxjwxk/Library/kafka_2.13-3.9.0
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span>$PATH:$KAFKA_HOME/bin
</span></span></code></pre></div><p>Then run this command (if you are using a Linux-like OS):</p>
<pre tabindex="0"><code>source ~/.zshrc
</code></pre><h3 id="send-messages">Send Messages<a hidden class="anchor" aria-hidden="true" href="#send-messages">#</a></h3>
<p>Send messages by running Kafka Producer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic
</span></span><span style="display:flex;"><span>&gt;Hello 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>2024-11-16 15:41:58,970<span style="color:#f92672">]</span> WARN <span style="color:#f92672">[</span>Producer clientId<span style="color:#f92672">=</span>console-producer<span style="color:#f92672">]</span> The metadata response from the cluster reported a recoverable issue with correlation id <span style="color:#ae81ff">7</span> : <span style="color:#f92672">{</span>first_topic<span style="color:#f92672">=</span>LEADER_NOT_AVAILABLE<span style="color:#f92672">}</span> <span style="color:#f92672">(</span>org.apache.kafka.clients.NetworkClient<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;Kafka
</span></span><span style="display:flex;"><span>&gt;I<span style="color:#960050;background-color:#1e0010">&#39;</span>m Xinkang
</span></span><span style="display:flex;"><span>&gt;
</span></span></code></pre></div><h3 id="receive-messages">Receive Messages<a hidden class="anchor" aria-hidden="true" href="#receive-messages">#</a></h3>
<p>Receive messages by running Kafka Consumer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic first_topic --from-beginning
</span></span><span style="display:flex;"><span>Hello
</span></span><span style="display:flex;"><span>Kafka
</span></span><span style="display:flex;"><span>I<span style="color:#960050;background-color:#1e0010">&#39;</span>m Xinkang
</span></span></code></pre></div><p>Display topics by Kafka REST Proxy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ curl localhost:8082/topics
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;first_topic&#34;</span><span style="color:#f92672">]</span>%
</span></span></code></pre></div><h2 id="topics">Topics<a hidden class="anchor" aria-hidden="true" href="#topics">#</a></h2>
<p>Kafka Producers send messages to topics of Kafka Brokers:</p>
<p><img alt="image-20241116154842184" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116154842184.png"></p>
<p>Retention Can Be Set To:</p>
<ul>
<li><strong>Days</strong>: This means only keeping messages of up to N days and then deleting them.</li>
<li><strong>Bytes</strong>: This means only keeping messages until the topic has more than X bytes and then delete.</li>
<li><strong>None</strong>: This means storing all messages from the beginning of time.</li>
</ul>
<p>Kafka Consumers consume messages from topics of Kafka Brokers:</p>
<p><img alt="image-20241116155151513" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116155151513.png"></p>
<h2 id="partitions">Partitions<a hidden class="anchor" aria-hidden="true" href="#partitions">#</a></h2>
<p>A topic can be split into partitions and distributed within brokers in the cluster:</p>
<p><img alt="image-20241116155833666" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116155833666.png"></p>
<p>The partitioner uses the key to distribute the messages to the correct partition:</p>
<p><img alt="image-20241116160358276" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116160358276.png"></p>
<h2 id="consumer-read-scenarios">Consumer Read Scenarios<a hidden class="anchor" aria-hidden="true" href="#consumer-read-scenarios">#</a></h2>
<p>Consumer Offset: From the Beginning</p>
<p><img alt="image-20241116160724404" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116160724404.png"></p>
<p>Consumer Offset: From the End</p>
<p><img alt="image-20241116160818845" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116160818845.png"></p>
<p>Consumer Offset: Already Have Been Here</p>
<p><img alt="image-20241116160936536" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116160936536.png"></p>
<p>Summary:</p>
<ul>
<li>Topics can be partitioned.</li>
<li>The partitioner uses the message key to redirect messages to partitions.</li>
<li>Consumers read them from partitions and have an offset.</li>
<li>Therefore, more partitions enable more consumers, therefore more scalability.</li>
</ul>
<h2 id="topic-replication">Topic Replication<a hidden class="anchor" aria-hidden="true" href="#topic-replication">#</a></h2>
<p>Each topic has a number called the replication factor, which replicates each partition of that topic:</p>
<p><img alt="image-20241116161303122" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116161303122.png"></p>
<p>Each partition is on a different broker, therefore a single topic is scaled.</p>
<h2 id="interaction-with-kafka-via-the-rest-proxy">Interaction with Kafka via the REST Proxy<a hidden class="anchor" aria-hidden="true" href="#interaction-with-kafka-via-the-rest-proxy">#</a></h2>
<h3 id="run-kafka-containers-1">Run Kafka Containers<a hidden class="anchor" aria-hidden="true" href="#run-kafka-containers-1">#</a></h3>
<p>Run composed containers (if not):</p>
<pre tabindex="0"><code>docker compose up -d
</code></pre><h3 id="import-postman-collection">Import Postman Collection<a hidden class="anchor" aria-hidden="true" href="#import-postman-collection">#</a></h3>
<p>Use this Open API yaml for Kafka REST Proxy: <a href="https://github.com/axel-sirota/getting-started-kafka/blob/main/rest_proxy.yaml">https://github.com/axel-sirota/getting-started-kafka/blob/main/rest_proxy.yaml</a>, which provides RESTful interfaces to a Kafka cluster.</p>
<p>We can import this yaml to the Postman as a collection:</p>
<p><img alt="image-20241116163349790" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116163349790.png"></p>
<p>Then, add an environment for variables like baseUrl and use the environment.</p>
<p><img alt="image-20241116163516358" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/2.-meet-kafka/images/image-20241116163516358.png"></p>
<h3 id="create-topic">Create Topic<a hidden class="anchor" aria-hidden="true" href="#create-topic">#</a></h3>
<p>Create a topic <code>myorders</code> with 1 replication and 3 partisions:</p>
<pre tabindex="0"><code>kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 3 --topic myorders
</code></pre><p>The created topic can be displayed by calling <code>{{baseUrl}}/topics/:topicName</code> via the Postman. The path variable <code>:topicName</code> should be <code>myorders</code>. The response will be like:</p>
<pre tabindex="0"><code>{
    &#34;name&#34;: &#34;myorders&#34;,
    ...
    &#34;partitions&#34;: [
        {
            &#34;partition&#34;: 0,
            &#34;leader&#34;: 1,
            &#34;replicas&#34;: [
                {
                    &#34;broker&#34;: 1,
                    &#34;leader&#34;: true,
                    &#34;in_sync&#34;: true
                }
            ]
        },
        {
            &#34;partition&#34;: 1,
            &#34;leader&#34;: 2,
            &#34;replicas&#34;: [
                {
                    &#34;broker&#34;: 2,
                    &#34;leader&#34;: true,
                    &#34;in_sync&#34;: true
                }
            ]
        },
        {
            &#34;partition&#34;: 2,
            &#34;leader&#34;: 3,
            &#34;replicas&#34;: [
                {
                    &#34;broker&#34;: 3,
                    &#34;leader&#34;: true,
                    &#34;in_sync&#34;: true
                }
            ]
        }
    ]
}
</code></pre><p>This is a pretty fragile scenario because if any broker goes down, there is no replica.</p>
<h3 id="increase-replication">Increase Replication<a hidden class="anchor" aria-hidden="true" href="#increase-replication">#</a></h3>
<p>Prepare a json file <code>increase-replication.json</code> for reassigning partitions of topic <code>myorders</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;version&#34;</span>:<span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;partitions&#34;</span>:[
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;myorders&#34;</span>,<span style="color:#f92672">&#34;partition&#34;</span>:<span style="color:#ae81ff">0</span>,<span style="color:#f92672">&#34;replicas&#34;</span>:[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>]},
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;myorders&#34;</span>,<span style="color:#f92672">&#34;partition&#34;</span>:<span style="color:#ae81ff">1</span>,<span style="color:#f92672">&#34;replicas&#34;</span>:[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>]},
</span></span><span style="display:flex;"><span>    {<span style="color:#f92672">&#34;topic&#34;</span>:<span style="color:#e6db74">&#34;myorders&#34;</span>,<span style="color:#f92672">&#34;partition&#34;</span>:<span style="color:#ae81ff">2</span>,<span style="color:#f92672">&#34;replicas&#34;</span>:[<span style="color:#ae81ff">2</span>]}
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Reassign partitions with the json file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-reassign-partitions.sh --bootstrap-server localhost:9092 --reassignment-json-file increase_replication.json --execute
</span></span></code></pre></div><p>Then we can see the replication of partition 0 and 1 are increased and a leader is elected for each replica.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;myorders&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;partitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="stop-a-broker">Stop a Broker<a hidden class="anchor" aria-hidden="true" href="#stop-a-broker">#</a></h3>
<p>Stop the broker 2 to test the system resilience.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker stop broker-2
</span></span></code></pre></div><p>We can see that for partition 0 and 1, the broker 2 is not <code>in_sync</code>. And for partition 2, the <code>leader</code> is -1, which means there is no leader and cannot take any new message.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;myorders&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;partitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">-1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Try to send messages to the topic <code>myorders</code> by running Kafka Producer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ kafka-console-producer.sh --bootstrap-server localhost:9092 --topic myorders
</span></span><span style="display:flex;"><span>&gt;Hello 
</span></span><span style="display:flex;"><span>&gt;again
</span></span><span style="display:flex;"><span>&gt;from
</span></span><span style="display:flex;"><span>&gt;Wxk
</span></span></code></pre></div><p>And try to receive messages from topic <code>myorders</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning
</span></span></code></pre></div><p>We will find there is no response returned. The topic will be offline if one partition doesn&rsquo;t have any replica online.</p>
<p>If we restart the stopped broker, Kafka willl self heal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><p>We can see that for partition 0 and 1, the broker 2 is in_sync<code>again. And for partition 2, the</code>leader` 2 is elected again.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;myorders&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;partitions&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;partition&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;replicas&#34;</span>: [
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;broker&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;leader&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;in_sync&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then we can receive messages successfully:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic myorders --from-beginning
</span></span><span style="display:flex;"><span>Hello
</span></span><span style="display:flex;"><span>again
</span></span><span style="display:flex;"><span>from
</span></span><span style="display:flex;"><span>Wxk
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://zjxjwxk.github.io/tags/mq/">MQ</a></li>
      <li><a href="https://zjxjwxk.github.io/tags/kafka/">Kafka</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://zjxjwxk.github.io/">Xinkang&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
