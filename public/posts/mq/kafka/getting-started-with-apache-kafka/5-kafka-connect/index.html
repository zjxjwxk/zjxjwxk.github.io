<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Kafka Connect | Xinkang&#39;s Blog</title>
<meta name="keywords" content="MQ, Kafka">
<meta name="description" content="ETL with Apache Kafka

One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.
But with the help of the correct plugins it can have some ETL capabilities.
Connectors

Source Connectors: Transfer data from a Source to Kafka.
Sink Connectors: Transfer data from Kafka to a Sink.

You can search through all of the connectors at thre registry: https://www.confluent.io/product/connectors.
Standalone vs. Distributed
">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9CMXGMMTKX"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9CMXGMMTKX');
        }
      </script><meta property="og:url" content="http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/">
  <meta property="og:site_name" content="Xinkang&#39;s Blog">
  <meta property="og:title" content="Kafka Connect">
  <meta property="og:description" content="ETL with Apache Kafka One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.
But with the help of the correct plugins it can have some ETL capabilities.
Connectors Source Connectors: Transfer data from a Source to Kafka. Sink Connectors: Transfer data from Kafka to a Sink. You can search through all of the connectors at thre registry: https://www.confluent.io/product/connectors.
Standalone vs. Distributed ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-23T16:44:00+08:00">
    <meta property="article:modified_time" content="2024-11-23T16:44:00+08:00">
    <meta property="article:tag" content="MQ">
    <meta property="article:tag" content="Kafka">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kafka Connect">
<meta name="twitter:description" content="ETL with Apache Kafka

One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.
But with the help of the correct plugins it can have some ETL capabilities.
Connectors

Source Connectors: Transfer data from a Source to Kafka.
Sink Connectors: Transfer data from Kafka to a Sink.

You can search through all of the connectors at thre registry: https://www.confluent.io/product/connectors.
Standalone vs. Distributed
">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Kafka Connect",
      "item": "http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kafka Connect",
  "name": "Kafka Connect",
  "description": "ETL with Apache Kafka One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.\nBut with the help of the correct plugins it can have some ETL capabilities.\nConnectors Source Connectors: Transfer data from a Source to Kafka. Sink Connectors: Transfer data from Kafka to a Sink. You can search through all of the connectors at thre registry: https://www.confluent.io/product/connectors.\nStandalone vs. Distributed ",
  "keywords": [
    "MQ", "Kafka"
  ],
  "articleBody": "ETL with Apache Kafka One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.\nBut with the help of the correct plugins it can have some ETL capabilities.\nConnectors Source Connectors: Transfer data from a Source to Kafka. Sink Connectors: Transfer data from Kafka to a Sink. You can search through all of the connectors at thre registry: https://www.confluent.io/product/connectors.\nStandalone vs. Distributed Standalone The connector configurations will be files. The worker will be just one script that we run.\nDistributed We will have more worker instances. The configurations instead of files will be offset and information in topics inside of Kafka. Kafka Connect in distributed mode offers a RESTful API to deploy a configuration.\nTasks Rebalancing If worker 3 fails, the tasks will be moved to a living worker.\nWhen worker 3 is alive again, the tasks rebalance again to the original worker.\nDemo: Using the File Connector in a Standalone Mode Create a docker-compose file docker-compose.yaml containing three Zookeepers, three Kafka Brokers, a Kafka REST Proxy, and a Schema Registry:\n--- version: '3' services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \"8082:8082\" depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' KAFKA_REST_LISTENERS: \"http://0.0.0.0:8082\" schema-registry: image: confluentinc/cp-schema-registry:7.4.1 hostname: schema-registry container_name: schema-registry depends_on: - rest-proxy ports: - \"8081:8081\" environment: SCHEMA_REGISTRY_HOST_NAME: schema-registry SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' Run composed containers:\ndocker compose up -d Create Topic Create a topic connect-log with partitions 4:\nkafka-topics.sh --create --bootstrap-server localhost:9092 --partitions 4 --topic connect-log Create a Worker Properties File Create a worker.properties file at the root of the project. You should change the plugin.path with your absolute path of Kafka libs. Then, set the schema.registry.url to your schema-registryurl, which is configured in thedocker-compose.yaml`.\n#worker.properties bootstrap.servers=http://localhost:9092,http://localhost:9093,http://localhost:9094 # The converters specify the format of data in Kafka and how to translate it into Connect data. Every Connect user will # need to configure these based on the format they want their data in when loaded from or stored into Kafka key.converter=org.apache.kafka.connect.storage.StringConverter value.converter=org.apache.kafka.connect.storage.StringConverter # The internal converter used for offsets and config data is configurable and must be specified, but most users will # always want to use the built-in default. Offset and config data is never visible outside of Copcyat in this format. internal.key.converter=org.apache.kafka.connect.json.JsonConverter internal.value.converter=org.apache.kafka.connect.json.JsonConverter internal.key.converter.schemas.enable=true internal.value.converter.schemas.enable=true offset.storage.file.filename=/tmp/connect.offsets # Flush much faster than normal, which is useful for testing/debugging offset.flush.interval.ms=5000 # Reload metadata faster too so consumer picks up new topics consumer.metadata.max.age.ms=10000 plugin.path=/Users/zjxjwxk/Library/kafka_2.13-3.9.0/libs schema.registry.url=http://localhost:8081 rest.port=8083 group.id=1 config.storage.topic=kafka_connect_configs cleanup.policy=compact offset.storage.topic=kafka_connect_offsets status.storage.topic=kafka_connect_statuses Create a Sink Properties File Create a filesink.properties file at the root of the project. We can set the number of tasks by tasks.max, set the path of the file by file, and set the topic we are listening to.\n#my-file-sink.properties config file name=local-file-sink connector.class=FileStreamSink tasks.max=1 file=./file-log.txt topics=connectlog Start the Kafka Connect in Standalone Mode Start a worker with a standalone instance. Set the parameters for the worker property file and the filesink property file.\nconnect-standalone.sh worker.properties filesink.properties Run a Kafka Producer Create a Java file to run the Kafka Producer sending messages to the topic connectlog:\npackage com.globomantics; import org.apache.kafka.clients.producer.KafkaProducer; import org.apache.kafka.clients.producer.ProducerConfig; import org.apache.kafka.clients.producer.ProducerRecord; import org.apache.kafka.common.serialization.DoubleSerializer; import org.apache.kafka.common.serialization.IntegerSerializer; import org.apache.kafka.common.serialization.StringSerializer; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.util.Properties; public class LogProducer { private static final Logger log = LoggerFactory.getLogger(LogProducer.class); private static final String TOPIC = \"connectlog\"; public static void main(String[] args) throws InterruptedException { Properties props = new Properties(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"http://localhost:9092,http://localhost:9093,http://localhost:9094\"); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, DoubleSerializer.class.getName()); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); KafkaProducer\u003cDouble, String\u003e producer = new KafkaProducer\u003c\u003e(props); for (int i = 0; i \u003c 25000; i++) { double key = Math.floor(Math.random()*(50)); String value = \"Some logging info from Kafka with key\" + key; ProducerRecord\u003cDouble, String\u003e producerRecord = new ProducerRecord\u003c\u003e(TOPIC, key, value); log.info(\"Sending message \" + value + \" to Kafka\"); producer.send(producerRecord, (metadata, e) -\u003e { if (metadata != null) { System.out.println(producerRecord.key()); System.out.println(producerRecord.value()); System.out.println(metadata.toString()); } }); Thread.sleep(1000); } producer.flush(); producer.close(); log.info(\"Successfully produced messages to \" + TOPIC + \" topic\"); } } Check the Log File We can check the log file which is configured in the Sink Properties File:\n❯ cat file-log.txt Some logging info from Kafka with key29.0 Some logging info from Kafka with key49.0 Some logging info from Kafka with key26.0 Some logging info from Kafka with key12.0 Some logging info from Kafka with key12.0 Some logging info from Kafka with key1.0 Some logging info from Kafka with key16.0 Schema Evolution and Enforcement Schema Registry is a service provided by confluent that stores and enforces the schema on each topic in Kafka.\nApache Avro Apache Avro is the language over which the schemas are defined.\nSerialization is defined by schema. Schemas are JSON-based. Codegen is available at the command line. Codegen is available with Maven, Gradle, and SBT plugins. Supports the following languages: C, C++, Java, Perl, Python, Ruby, and PHP. Three Modes Generic Mode: Where you use Avro just to validate it is a valid schema, but don’t do codegen. Specific Mode: Where we use an avsc file and the codeine capabilities to generate the code we need. Reflection Mode: The inver of the previous mode, creates an avsc file based on a class. Primitive Types Avro Type Java Type null null double double float float int int long long bool bool string Unicode CharSequnce bytes Sequence of 8-bit unsigned bytes Complex Types { \"namespace\": \"com.xyzcorp\", \"type\": \"record\", \"doc\": \"An music album\", \"name\": \"Album\", \"fields\": [ { \"name\": \"name\", \"type\": \"string\" }, { \"name\": \"yearReleased\", \"type\": [ \"int\", \"null\" ] } ] } Overview Sample Code Producer What makes schema registry work is the Serializer. You must add schema.registry.url and specify the location of the registry.\nProperties properties = new Properties(); properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"http://localhost:9092\"); properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, io.confluent.kafka.serializers.KafkaAvroSerializer.class.getName()); properties.put(\"schema.registry.url\", \"http://localhost:8081\"); The ProducerRecord’s value is accepting an actual Java Object. We can send the object just like any other type.\nAlbum album = new Album(\"Purple Rain\", \"Prince\", 1984, Arrays.asList(\"Purple Rain\", \"Let's go crazy\")); ProducerRecord\u003cString, Album\u003e producerRecord = new ProducerRecord\u003c\u003e(\"music_albums\", \"Prince\", album); producer.send(producerRecord); Consumer What makes schema registry work is the Deserializer. You must add schema.registry.url and specify the location of the registry. You must add specific.avro.reader and specify that you used specific avro mode.\nProperties properties = new Properties(); properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\"); properties.put(ConsumerConfig.GROUP_ID_CONFIG, \"my_group\"); properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, io.confluent.kafka.serializers.KafkaAvroDeserializer.class); properties.setProperty(\"schema.registry.url\", \"http://localhost:8081\"); properties.setProperty(\"specific.avro.reader\", \"true\"); Receiving a Custom Object from Kafka:\nwhile (true) { ConsumerRecords\u003cString, Album\u003e records = consumer.poll(Duration.of(500, ChronoUnit.MILLIS)); for (ConsumerRecord\u003cString, Album\u003e record: records) { Album a = record.value(); System.out.format(\"value: %s\\n\", a.getTitle()); System.out.format(\"value: %s\\n\", a.getArtist()); } } Demo: Using the MongoDB Connector with Distributed Kafka Connect to Query a Topic Install Confluent Hub Client Use Brew if you are using Mac:\nbrew tap confluentinc/homebrew-confluent-hub-client brew install --cask confluent-hub-client Install Kafka Connect Avro Converter Install the Kafka Connect Avro Converter using the Confluent Hub we just installed:\nconfluent-hub install confluentinc/kafka-connect-avro-converter:7.5.0 --component-dir ~/Library/kafka_2.13-3.9.0/libs --worker-configs worker.properties Install Kafka MongoDB Connector confluent-hub install mongodb/kafka-connect-mongodb:1.11.0 --component-dir ~/Library/kafka_2.13-3.9.0/libs --worker-configs worker.properties Downloading Some Missing Jars Download and put some missing jars into the Kafka libs, including the failureaccess-1.0.1.jar and guava-32.1.2-jre.jar.\ncp failureaccess-1.0.1.jar ~/Library/kafka_2.13-3.9.0/libs cp guava-32.1.2-jre.jar ~/Library/kafka_2.13-3.9.0/libs Run Docker Containers Create a docker-compose.yaml file containing three Zookeepers, three Kafka Brokers, a Rest Proxy, a Schema Registry, and a MongoDB.\n--- version: '3' services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \"8082:8082\" depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' KAFKA_REST_LISTENERS: \"http://0.0.0.0:8082\" schema-registry: image: confluentinc/cp-schema-registry:7.4.1 hostname: schema-registry container_name: schema-registry depends_on: - rest-proxy ports: - \"8081:8081\" environment: SCHEMA_REGISTRY_HOST_NAME: schema-registry SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' mongo: image: mongo hostname: mongo container_name: mongo ports: - 27017:27017 Run the composed containers:\ndocker compose up -d Create a Kafka Topic Create a Kafka Topic with 4 partitions:\nkafka-topics.sh --create --bootstrap-server localhost:9092 --partitions 4 --topic connect-distributed Generate Model with Avsc File Create an avsc file, which represents the Album record:\n{ \"fields\": [ { \"name\": \"name\", \"type\": \"string\" }, { \"name\": \"year\", \"type\": \"int\" } ], \"name\": \"Album\", \"namespace\": \"com.globomantics.model\", \"type\": \"record\" } Generate the model class by running the Maven plugin:\nmvn generate-sources Then, the package that is configured at the namespace in the avsc file will be created, and the Album class will be genereated in the package like this:\n/** * Autogenerated by Avro * * DO NOT EDIT DIRECTLY */ package com.globomantics.model; import org.apache.avro.generic.GenericArray; import org.apache.avro.specific.SpecificData; import org.apache.avro.util.Utf8; import org.apache.avro.message.BinaryMessageEncoder; import org.apache.avro.message.BinaryMessageDecoder; import org.apache.avro.message.SchemaStore; @org.apache.avro.specific.AvroGenerated public class Album extends org.apache.avro.specific.SpecificRecordBase implements org.apache.avro.specific.SpecificRecord { ... } Create Other Topics We need to create some other necessary topics to apply the distributed mode, which are configured in the worker.properties file: kafka_connect_configs, kafka_connect_offsets, and kafka_connect_statuses.\nconfig.storage.topic=kafka_connect_configs cleanup.policy=compact offset.storage.topic=kafka_connect_offsets status.storage.topic=kafka_connect_statuses Create these topics:\nkafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_statuses --config cleanup.policy=compact kafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_offsets --config cleanup.policy=compact kafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_configs --config cleanup.policy=compact Start the Kafka Connect in Distributed Mode connect-distributed.sh worker.properties If we see the logs like the following, then Kafka Connect is started in distributed mode:\n... [2024-12-21 21:02:37,819] INFO [Worker clientId=connect-192.168.10.106:8083, groupId=1] Finished starting connectors and tasks (org.apache.kafka.connect.runtime.distributed.DistributedHerder:2008) [2024-12-21 21:02:37,984] INFO [Worker clientId=connect-192.168.10.106:8083, groupId=1] Session key updated (org.apache.kafka.connect.runtime.distributed.DistributedHerder:2510) Deploy Connectors The Kafka Connect in distributed mode offers some RESTful APIs. We can send an HTTP post request to the localhost://8083 to create a connector with request body like:\n{ \"name\": \"mongo-sink\", \"config\" : { \"connector.class\": \"com.mongodb.kafka.connect.MongoSinkConnector\", \"connection.uri\": \"mongodb://localhost:27017\", \"database\": \"quickstart\", \"collection\": \"topicData\", \"topics\": \"connect-distributed\" } } And we can get created connectors by the GET method:\nThen, we can append the name of the connector to the url to get the details of a specific connector:\nSend a Message Create a Java class using Kafka Producer to send a messages with an Album model as value:\npackage com.globomantics; import com.globomantics.model.Album; import io.confluent.kafka.serializers.KafkaAvroSerializer; import io.confluent.kafka.serializers.KafkaAvroSerializerConfig; import org.apache.kafka.clients.producer.KafkaProducer; import org.apache.kafka.clients.producer.ProducerConfig; import org.apache.kafka.clients.producer.ProducerRecord; import org.apache.kafka.common.serialization.DoubleSerializer; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.util.Properties; public class AlbumSender { private static final Logger log = LoggerFactory.getLogger(AlbumSender.class); private static final String TOPIC = \"connect-distributed\"; public static void main(String[] args) { Properties props = new Properties(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"http://localhost:9092,http://localhost:9093,http://localhost:9094\"); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, DoubleSerializer.class.getName()); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer.class.getName()); props.put(KafkaAvroSerializerConfig.SCHEMA_REGISTRY_URL_CONFIG, \"http://localhost:8081\"); Album album = Album.newBuilder() .setName(\"Use Your Illusion\") .setYear(1991).build(); KafkaProducer\u003cDouble, Album\u003e producer = new KafkaProducer\u003c\u003e(props); double key = Math.floor(Math.random()*(50)); ProducerRecord\u003cDouble, Album\u003e producerRecord = new ProducerRecord\u003c\u003e(TOPIC, key, album); log.info(\"Sending message \" + album + \" to Kafka\"); producer.send(producerRecord, (metadata, e) -\u003e { if (metadata != null) { System.out.println(producerRecord.key()); System.out.println(producerRecord.value()); System.out.println(metadata.toString()); } }); producer.flush(); producer.close(); log.info(\"Successfully produced messages to \" + TOPIC + \" topic\"); } } Check MongoDB After running the sender class, we need to connect to the MongoDB to check that the massage is here.\n# mongosh localhost:27017 Current Mongosh Log ID: 6766c45295db57d019e94969 Connecting to: mongodb://localhost:27017/?directConnection=true\u0026serverSelectionTimeoutMS=2000\u0026appName=mongosh+2.3.4 Using MongoDB: 8.0.4 Using Mongosh: 2.3.4 For mongosh info see: https://www.mongodb.com/docs/mongodb-shell/ ... test\u003e show dbs admin 40.00 KiB config 60.00 KiB local 40.00 KiB quickstart 40.00 KiB test\u003e use quickstart switched to db quickstart quickstart\u003e db.topicData.find() [ { _id: ObjectId('6766c377e0b35c19402f4c3d'), name: 'Use Your Illusion', year: 1991 } ] Takeaways Kafka Connect can come in two variants: Standalone and Distributed. Kafka connects via worker processes where connectors get deployed as a number of tasks. One can leverage the schema registry and AVRO to send classes through Kafka messages with much more metadata. Thanks to the Kafka Connect that even sends those objects to another system. ",
  "wordCount" : "2206",
  "inLanguage": "en",
  "datePublished": "2024-11-23T16:44:00+08:00",
  "dateModified": "2024-11-23T16:44:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xinkang's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xinkang&#39;s Blog (Alt + H)">Xinkang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Kafka Connect
    </h1>
    <div class="post-meta"><span title='2024-11-23 16:44:00 +0800 CST'>November 23, 2024</span>&nbsp;·&nbsp;11 min&nbsp;|&nbsp;<a href="https://github.com/zjxjwxk/zjxjwxk.github.io/tree/main/content/posts/MQ/Kafka/Getting%20Started%20with%20Apache%20Kafka/5-Kafka%20Connect/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#etl-with-apache-kafka" aria-label="ETL with Apache Kafka">ETL with Apache Kafka</a></li>
                <li>
                    <a href="#connectors" aria-label="Connectors">Connectors</a></li>
                <li>
                    <a href="#standalone-vs-distributed" aria-label="Standalone vs. Distributed">Standalone vs. Distributed</a><ul>
                        
                <li>
                    <a href="#standalone" aria-label="Standalone">Standalone</a></li>
                <li>
                    <a href="#distributed" aria-label="Distributed">Distributed</a></li></ul>
                </li>
                <li>
                    <a href="#tasks-rebalancing" aria-label="Tasks Rebalancing">Tasks Rebalancing</a></li>
                <li>
                    <a href="#demo-using-the-file-connector-in-a-standalone-mode" aria-label="Demo: Using the File Connector in a Standalone Mode">Demo: Using the File Connector in a Standalone Mode</a><ul>
                        
                <li>
                    <a href="#create-topic" aria-label="Create Topic">Create Topic</a></li>
                <li>
                    <a href="#create-a-worker-properties-file" aria-label="Create a Worker Properties File">Create a Worker Properties File</a></li>
                <li>
                    <a href="#create-a-sink-properties-file" aria-label="Create a Sink Properties File">Create a Sink Properties File</a></li>
                <li>
                    <a href="#start-the-kafka-connect-in-standalone-mode" aria-label="Start the Kafka Connect in Standalone Mode">Start the Kafka Connect in Standalone Mode</a></li>
                <li>
                    <a href="#run-a-kafka-producer" aria-label="Run a Kafka Producer">Run a Kafka Producer</a></li>
                <li>
                    <a href="#check-the-log-file" aria-label="Check the Log File">Check the Log File</a></li></ul>
                </li>
                <li>
                    <a href="#schema-evolution-and-enforcement" aria-label="Schema Evolution and Enforcement">Schema Evolution and Enforcement</a><ul>
                        
                <li>
                    <a href="#apache-avro" aria-label="Apache Avro">Apache Avro</a></li>
                <li>
                    <a href="#three-modes" aria-label="Three Modes">Three Modes</a></li>
                <li>
                    <a href="#primitive-types" aria-label="Primitive Types">Primitive Types</a></li>
                <li>
                    <a href="#complex-types" aria-label="Complex Types">Complex Types</a></li>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a></li>
                <li>
                    <a href="#sample-code" aria-label="Sample Code">Sample Code</a><ul>
                        
                <li>
                    <a href="#producer" aria-label="Producer">Producer</a></li>
                <li>
                    <a href="#consumer" aria-label="Consumer">Consumer</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#demo-using-the-mongodb-connector-with-distributed-kafka-connect-to-query-a-topic" aria-label="Demo: Using the MongoDB Connector with Distributed Kafka Connect to Query a Topic">Demo: Using the MongoDB Connector with Distributed Kafka Connect to Query a Topic</a><ul>
                        
                <li>
                    <a href="#install-confluent-hub-client" aria-label="Install Confluent Hub Client">Install Confluent Hub Client</a></li>
                <li>
                    <a href="#install-kafka-connect-avro-converter" aria-label="Install Kafka Connect Avro Converter">Install Kafka Connect Avro Converter</a></li>
                <li>
                    <a href="#install-kafka-mongodb-connector" aria-label="Install Kafka MongoDB Connector">Install Kafka MongoDB Connector</a></li>
                <li>
                    <a href="#downloading-some-missing-jars" aria-label="Downloading Some Missing Jars">Downloading Some Missing Jars</a></li>
                <li>
                    <a href="#run-docker-containers" aria-label="Run Docker Containers">Run Docker Containers</a></li>
                <li>
                    <a href="#create-a-kafka-topic" aria-label="Create a Kafka Topic">Create a Kafka Topic</a></li>
                <li>
                    <a href="#generate-model-with-avsc-file" aria-label="Generate Model with Avsc File">Generate Model with Avsc File</a></li>
                <li>
                    <a href="#create-other-topics" aria-label="Create Other Topics">Create Other Topics</a></li>
                <li>
                    <a href="#start-the-kafka-connect-in-distributed-mode" aria-label="Start the Kafka Connect in Distributed Mode">Start the Kafka Connect in Distributed Mode</a></li>
                <li>
                    <a href="#deploy-connectors" aria-label="Deploy Connectors">Deploy Connectors</a></li>
                <li>
                    <a href="#send-a-message" aria-label="Send a Message">Send a Message</a></li>
                <li>
                    <a href="#check-mongodb" aria-label="Check MongoDB">Check MongoDB</a></li></ul>
                </li>
                <li>
                    <a href="#takeaways" aria-label="Takeaways">Takeaways</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="etl-with-apache-kafka">ETL with Apache Kafka<a hidden class="anchor" aria-hidden="true" href="#etl-with-apache-kafka">#</a></h2>
<p><img alt="image-20241123173425604" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123173425604.png"></p>
<p>One important statement is that Kafka Connect is not an ETL(Extract, Load, Transform) solution itself, it only connects.</p>
<p>But with the help of the correct plugins it can have some ETL capabilities.</p>
<h2 id="connectors">Connectors<a hidden class="anchor" aria-hidden="true" href="#connectors">#</a></h2>
<ul>
<li><strong>Source Connectors</strong>: Transfer data from a Source to Kafka.</li>
<li><strong>Sink Connectors</strong>: Transfer data from Kafka to a Sink.</li>
</ul>
<p>You can search through all of the connectors at thre registry: <a href="https://www.confluent.io/product/connectors">https://www.confluent.io/product/connectors</a>.</p>
<h2 id="standalone-vs-distributed">Standalone vs. Distributed<a hidden class="anchor" aria-hidden="true" href="#standalone-vs-distributed">#</a></h2>
<p><img alt="image-20241123182435451" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123182435451.png"></p>
<h3 id="standalone">Standalone<a hidden class="anchor" aria-hidden="true" href="#standalone">#</a></h3>
<p>The connector configurations will be files. The worker will be just one script that we run.</p>
<p><img alt="image-20241123182925170" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123182925170.png"></p>
<h3 id="distributed">Distributed<a hidden class="anchor" aria-hidden="true" href="#distributed">#</a></h3>
<p>We will have more worker instances. The configurations instead of files will be offset and information in topics inside of Kafka. Kafka Connect in distributed mode offers a RESTful API to deploy a configuration.</p>
<p><img alt="image-20241123183230462" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123183230462.png"></p>
<h2 id="tasks-rebalancing">Tasks Rebalancing<a hidden class="anchor" aria-hidden="true" href="#tasks-rebalancing">#</a></h2>
<p><img alt="image-20241123190122479" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123190122479.png"></p>
<p>If worker 3 fails, the tasks will be moved to a living worker.</p>
<p><img alt="image-20241123190220984" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123190220984.png"></p>
<p>When worker 3 is alive again, the tasks rebalance again to the original worker.</p>
<p><img alt="image-20241123190122479" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241123190122479.png"></p>
<h2 id="demo-using-the-file-connector-in-a-standalone-mode">Demo: Using the File Connector in a Standalone Mode<a hidden class="anchor" aria-hidden="true" href="#demo-using-the-file-connector-in-a-standalone-mode">#</a></h2>
<p>Create a docker-compose file <code>docker-compose.yaml</code> containing three Zookeepers, three Kafka Brokers, a Kafka REST Proxy, and a Schema Registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-1-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9092</span>:<span style="color:#ae81ff">9092</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29092</span>:<span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9092,INTERNAL://broker-1:29092</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-2-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9093</span>:<span style="color:#ae81ff">9093</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29093</span>:<span style="color:#ae81ff">29093</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9093,INTERNAL://broker-2:29093</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-3-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9094</span>:<span style="color:#ae81ff">9094</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29094</span>:<span style="color:#ae81ff">29094</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9094,INTERNAL://broker-3:29094</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rest-proxy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka-rest:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8082:8082&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_HOST_NAME</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_LISTENERS</span>: <span style="color:#e6db74">&#34;http://0.0.0.0:8082&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schema-registry</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-schema-registry:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8081:8081&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_HOST_NAME</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span></code></pre></div><p>Run composed containers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><h3 id="create-topic">Create Topic<a hidden class="anchor" aria-hidden="true" href="#create-topic">#</a></h3>
<p>Create a topic <code>connect-log</code> with partitions 4:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --partitions <span style="color:#ae81ff">4</span> --topic connect-log
</span></span></code></pre></div><h3 id="create-a-worker-properties-file">Create a Worker Properties File<a hidden class="anchor" aria-hidden="true" href="#create-a-worker-properties-file">#</a></h3>
<p>Create a <code>worker.properties</code> file at the root of the project. You should change the <code>plugin.path</code> with your absolute path of Kafka libs. Then, set the <code>schema.registry.url</code> to your schema-registry<code>url, which is configured in the</code>docker-compose.yaml`.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e">#worker.properties</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bootstrap.servers</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://localhost:9092,http://localhost:9093,http://localhost:9094</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The converters specify the format of data in Kafka and how to translate it into Connect data. Every Connect user will</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># need to configure these based on the format they want their data in when loaded from or stored into Kafka</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">key.converter</span><span style="color:#f92672">=</span><span style="color:#e6db74">org.apache.kafka.connect.storage.StringConverter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">value.converter</span><span style="color:#f92672">=</span><span style="color:#e6db74">org.apache.kafka.connect.storage.StringConverter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The internal converter used for offsets and config data is configurable and must be specified, but most users will</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># always want to use the built-in default. Offset and config data is never visible outside of Copcyat in this format.</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">internal.key.converter</span><span style="color:#f92672">=</span><span style="color:#e6db74">org.apache.kafka.connect.json.JsonConverter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">internal.value.converter</span><span style="color:#f92672">=</span><span style="color:#e6db74">org.apache.kafka.connect.json.JsonConverter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">internal.key.converter.schemas.enable</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">internal.value.converter.schemas.enable</span><span style="color:#f92672">=</span><span style="color:#e6db74">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">offset.storage.file.filename</span><span style="color:#f92672">=</span><span style="color:#e6db74">/tmp/connect.offsets</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Flush much faster than normal, which is useful for testing/debugging</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">offset.flush.interval.ms</span><span style="color:#f92672">=</span><span style="color:#e6db74">5000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reload metadata faster too so consumer picks up new topics</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">consumer.metadata.max.age.ms</span><span style="color:#f92672">=</span><span style="color:#e6db74">10000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plugin.path</span><span style="color:#f92672">=</span><span style="color:#e6db74">/Users/zjxjwxk/Library/kafka_2.13-3.9.0/libs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">schema.registry.url</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://localhost:8081</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rest.port</span><span style="color:#f92672">=</span><span style="color:#e6db74">8083</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">group.id</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">config.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_configs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cleanup.policy</span><span style="color:#f92672">=</span><span style="color:#e6db74">compact</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">offset.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_offsets</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">status.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_statuses</span>
</span></span></code></pre></div><h3 id="create-a-sink-properties-file">Create a Sink Properties File<a hidden class="anchor" aria-hidden="true" href="#create-a-sink-properties-file">#</a></h3>
<p>Create a <code>filesink.properties</code> file at the root of the project. We can set the number of tasks by <code>tasks.max</code>, set the path of the file by <code>file</code>, and set the topic we are listening to.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e">#my-file-sink.properties config file</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">local-file-sink</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">connector.class</span><span style="color:#f92672">=</span><span style="color:#e6db74">FileStreamSink</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tasks.max</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">file</span><span style="color:#f92672">=</span><span style="color:#e6db74">./file-log.txt</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">topics</span><span style="color:#f92672">=</span><span style="color:#e6db74">connectlog</span>
</span></span></code></pre></div><h3 id="start-the-kafka-connect-in-standalone-mode">Start the Kafka Connect in Standalone Mode<a hidden class="anchor" aria-hidden="true" href="#start-the-kafka-connect-in-standalone-mode">#</a></h3>
<p>Start a worker with a standalone instance. Set the parameters for the worker property file and the filesink property file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>connect-standalone.sh worker.properties filesink.properties
</span></span></code></pre></div><h3 id="run-a-kafka-producer">Run a Kafka Producer<a hidden class="anchor" aria-hidden="true" href="#run-a-kafka-producer">#</a></h3>
<p>Create a Java file to run the Kafka Producer sending messages to the topic <code>connectlog</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.globomantics;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.KafkaProducer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.ProducerConfig;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.ProducerRecord;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.DoubleSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.IntegerSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.StringSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.Logger;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.LoggerFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogProducer</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger log <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(LogProducer.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TOPIC <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;connectlog&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Properties props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;http://localhost:9092,http://localhost:9093,http://localhost:9094&#34;</span>);
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, DoubleSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>		KafkaProducer<span style="color:#f92672">&lt;</span>Double, String<span style="color:#f92672">&gt;</span> producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;&gt;</span>(props);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 25000; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">double</span> key <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>()<span style="color:#f92672">*</span>(50));
</span></span><span style="display:flex;"><span>			String value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Some logging info from Kafka with key&#34;</span> <span style="color:#f92672">+</span> key;
</span></span><span style="display:flex;"><span>			ProducerRecord<span style="color:#f92672">&lt;</span>Double, String<span style="color:#f92672">&gt;</span> producerRecord <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(TOPIC, key, value);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Sending message &#34;</span> <span style="color:#f92672">+</span> value <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; to Kafka&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			producer.<span style="color:#a6e22e">send</span>(producerRecord, (metadata, e) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> (metadata <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>					System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(producerRecord.<span style="color:#a6e22e">key</span>());
</span></span><span style="display:flex;"><span>					System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(producerRecord.<span style="color:#a6e22e">value</span>());
</span></span><span style="display:flex;"><span>					System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(metadata.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>			Thread.<span style="color:#a6e22e">sleep</span>(1000);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		producer.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>		producer.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Successfully produced messages to &#34;</span> <span style="color:#f92672">+</span> TOPIC <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; topic&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="check-the-log-file">Check the Log File<a hidden class="anchor" aria-hidden="true" href="#check-the-log-file">#</a></h3>
<p>We can check the log file which is configured in the Sink Properties File:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ cat file-log.txt
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key29.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key49.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key26.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key12.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key12.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key1.0
</span></span><span style="display:flex;"><span>Some logging info from Kafka with key16.0
</span></span></code></pre></div><h2 id="schema-evolution-and-enforcement">Schema Evolution and Enforcement<a hidden class="anchor" aria-hidden="true" href="#schema-evolution-and-enforcement">#</a></h2>
<p>Schema Registry is a service provided by confluent that stores and enforces the schema on each topic in Kafka.</p>
<p><img alt="image-20241221154151524" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241221154151524.png"></p>
<h3 id="apache-avro">Apache Avro<a hidden class="anchor" aria-hidden="true" href="#apache-avro">#</a></h3>
<p>Apache Avro is the language over which the schemas are defined.</p>
<ul>
<li>Serialization is defined by schema.</li>
<li>Schemas are JSON-based.</li>
<li>Codegen is available at the command line.</li>
<li>Codegen is available with Maven, Gradle, and SBT plugins.</li>
<li>Supports the following languages: C, C++, Java, Perl, Python, Ruby, and PHP.</li>
</ul>
<h3 id="three-modes">Three Modes<a hidden class="anchor" aria-hidden="true" href="#three-modes">#</a></h3>
<ol>
<li>Generic Mode: Where you use Avro just to validate it is a valid schema, but don&rsquo;t do codegen.</li>
<li>Specific Mode: Where we use an avsc file and the codeine capabilities to generate the code we need.</li>
<li>Reflection Mode: The inver of the previous mode, creates an avsc file based on a class.</li>
</ol>
<h3 id="primitive-types">Primitive Types<a hidden class="anchor" aria-hidden="true" href="#primitive-types">#</a></h3>
<table>
  <thead>
      <tr>
          <th>Avro Type</th>
          <th>Java Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>null</td>
          <td>null</td>
      </tr>
      <tr>
          <td>double</td>
          <td>double</td>
      </tr>
      <tr>
          <td>float</td>
          <td>float</td>
      </tr>
      <tr>
          <td>int</td>
          <td>int</td>
      </tr>
      <tr>
          <td>long</td>
          <td>long</td>
      </tr>
      <tr>
          <td>bool</td>
          <td>bool</td>
      </tr>
      <tr>
          <td>string</td>
          <td>Unicode CharSequnce</td>
      </tr>
      <tr>
          <td>bytes</td>
          <td>Sequence of 8-bit unsigned bytes</td>
      </tr>
  </tbody>
</table>
<h3 id="complex-types">Complex Types<a hidden class="anchor" aria-hidden="true" href="#complex-types">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;namespace&#34;</span>: <span style="color:#e6db74">&#34;com.xyzcorp&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;record&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;doc&#34;</span>: <span style="color:#e6db74">&#34;An music album&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Album&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;yearReleased&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;type&#34;</span>: [
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;null&#34;</span>
</span></span><span style="display:flex;"><span>			]
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h3>
<p><img alt="image-20241221155903901" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241221155903901.png"></p>
<h3 id="sample-code">Sample Code<a hidden class="anchor" aria-hidden="true" href="#sample-code">#</a></h3>
<h4 id="producer">Producer<a hidden class="anchor" aria-hidden="true" href="#producer">#</a></h4>
<p>What makes schema registry work is the Serializer. You must add <code>schema.registry.url</code> and specify the location of the registry.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;http://localhost:9092&#34;</span>);
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, io.<span style="color:#a6e22e">confluent</span>.<span style="color:#a6e22e">kafka</span>.<span style="color:#a6e22e">serializers</span>.<span style="color:#a6e22e">KafkaAvroSerializer</span>.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#34;schema.registry.url&#34;</span>, <span style="color:#e6db74">&#34;http://localhost:8081&#34;</span>);
</span></span></code></pre></div><p>The ProducerRecord&rsquo;s value is accepting an actual Java Object. We can send the object just like any other type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Album album <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Album(<span style="color:#e6db74">&#34;Purple Rain&#34;</span>, <span style="color:#e6db74">&#34;Prince&#34;</span>, 1984, Arrays.<span style="color:#a6e22e">asList</span>(<span style="color:#e6db74">&#34;Purple Rain&#34;</span>, <span style="color:#e6db74">&#34;Let&#39;s go crazy&#34;</span>));
</span></span><span style="display:flex;"><span>ProducerRecord<span style="color:#f92672">&lt;</span>String, Album<span style="color:#f92672">&gt;</span> producerRecord <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;music_albums&#34;</span>, <span style="color:#e6db74">&#34;Prince&#34;</span>, album);
</span></span><span style="display:flex;"><span>producer.<span style="color:#a6e22e">send</span>(producerRecord);
</span></span></code></pre></div><h4 id="consumer">Consumer<a hidden class="anchor" aria-hidden="true" href="#consumer">#</a></h4>
<p>What makes schema registry work is the Deserializer. You must add <code>schema.registry.url</code> and specify the location of the registry. You must add <code>specific.avro.reader</code> and specify that you used specific avro mode.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;localhost:9092&#34;</span>);
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">GROUP_ID_CONFIG</span>, <span style="color:#e6db74">&#34;my_group&#34;</span>);
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">VALUE_DESERIALIZER_CLASS_CONFIG</span>, io.<span style="color:#a6e22e">confluent</span>.<span style="color:#a6e22e">kafka</span>.<span style="color:#a6e22e">serializers</span>.<span style="color:#a6e22e">KafkaAvroDeserializer</span>.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">setProperty</span>(<span style="color:#e6db74">&#34;schema.registry.url&#34;</span>, <span style="color:#e6db74">&#34;http://localhost:8081&#34;</span>);
</span></span><span style="display:flex;"><span>properties.<span style="color:#a6e22e">setProperty</span>(<span style="color:#e6db74">&#34;specific.avro.reader&#34;</span>, <span style="color:#e6db74">&#34;true&#34;</span>);
</span></span></code></pre></div><p>Receiving a Custom Object from Kafka:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>	ConsumerRecords<span style="color:#f92672">&lt;</span>String, Album<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">of</span>(500, ChronoUnit.<span style="color:#a6e22e">MILLIS</span>));
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (ConsumerRecord<span style="color:#f92672">&lt;</span>String, Album<span style="color:#f92672">&gt;</span> record: records) {
</span></span><span style="display:flex;"><span>		Album a <span style="color:#f92672">=</span> record.<span style="color:#a6e22e">value</span>();
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;value: %s\n&#34;</span>, a.<span style="color:#a6e22e">getTitle</span>());
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;value: %s\n&#34;</span>, a.<span style="color:#a6e22e">getArtist</span>());
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="demo-using-the-mongodb-connector-with-distributed-kafka-connect-to-query-a-topic">Demo: Using the MongoDB Connector with Distributed Kafka Connect to Query a Topic<a hidden class="anchor" aria-hidden="true" href="#demo-using-the-mongodb-connector-with-distributed-kafka-connect-to-query-a-topic">#</a></h2>
<h3 id="install-confluent-hub-client">Install Confluent Hub Client<a hidden class="anchor" aria-hidden="true" href="#install-confluent-hub-client">#</a></h3>
<p>Use Brew if you are using Mac:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew tap confluentinc/homebrew-confluent-hub-client
</span></span><span style="display:flex;"><span>brew install --cask confluent-hub-client
</span></span></code></pre></div><h3 id="install-kafka-connect-avro-converter">Install Kafka Connect Avro Converter<a hidden class="anchor" aria-hidden="true" href="#install-kafka-connect-avro-converter">#</a></h3>
<p>Install the Kafka Connect Avro Converter using the Confluent Hub we just installed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>confluent-hub install confluentinc/kafka-connect-avro-converter:7.5.0 --component-dir ~/Library/kafka_2.13-3.9.0/libs --worker-configs worker.properties
</span></span></code></pre></div><h3 id="install-kafka-mongodb-connector">Install Kafka MongoDB Connector<a hidden class="anchor" aria-hidden="true" href="#install-kafka-mongodb-connector">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>confluent-hub install mongodb/kafka-connect-mongodb:1.11.0 --component-dir ~/Library/kafka_2.13-3.9.0/libs --worker-configs worker.properties
</span></span></code></pre></div><h3 id="downloading-some-missing-jars">Downloading Some Missing Jars<a hidden class="anchor" aria-hidden="true" href="#downloading-some-missing-jars">#</a></h3>
<p>Download and put some missing jars into the Kafka libs, including the <code>failureaccess-1.0.1.jar</code> and <code>guava-32.1.2-jre.jar</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cp failureaccess-1.0.1.jar  ~/Library/kafka_2.13-3.9.0/libs
</span></span><span style="display:flex;"><span>cp guava-32.1.2-jre.jar ~/Library/kafka_2.13-3.9.0/libs
</span></span></code></pre></div><h3 id="run-docker-containers">Run Docker Containers<a hidden class="anchor" aria-hidden="true" href="#run-docker-containers">#</a></h3>
<p>Create a <code>docker-compose.yaml</code> file containing three Zookeepers, three Kafka Brokers, a Rest Proxy, a Schema Registry, and a MongoDB.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-1-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9092</span>:<span style="color:#ae81ff">9092</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29092</span>:<span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9092,INTERNAL://broker-1:29092</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-2-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9093</span>:<span style="color:#ae81ff">9093</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29093</span>:<span style="color:#ae81ff">29093</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9093,INTERNAL://broker-2:29093</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-3-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9094</span>:<span style="color:#ae81ff">9094</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29094</span>:<span style="color:#ae81ff">29094</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9094,INTERNAL://broker-3:29094</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rest-proxy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka-rest:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8082:8082&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_HOST_NAME</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_LISTENERS</span>: <span style="color:#e6db74">&#34;http://0.0.0.0:8082&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schema-registry</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-schema-registry:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8081:8081&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_HOST_NAME</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mongo</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mongo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">mongo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">mongo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">27017</span>:<span style="color:#ae81ff">27017</span>
</span></span></code></pre></div><p>Run the composed containers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><h3 id="create-a-kafka-topic">Create a Kafka Topic<a hidden class="anchor" aria-hidden="true" href="#create-a-kafka-topic">#</a></h3>
<p>Create a Kafka Topic with 4 partitions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --partitions <span style="color:#ae81ff">4</span> --topic connect-distributed
</span></span></code></pre></div><h3 id="generate-model-with-avsc-file">Generate Model with Avsc File<a hidden class="anchor" aria-hidden="true" href="#generate-model-with-avsc-file">#</a></h3>
<p>Create an avsc file, which represents the Album record:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;year&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;int&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Album&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;namespace&#34;</span>: <span style="color:#e6db74">&#34;com.globomantics.model&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;record&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Generate the model class by running the Maven plugin:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn generate-sources
</span></span></code></pre></div><p>Then, the package that is configured at the <code>namespace</code> in the avsc file will be created, and the Album class will be genereated in the package like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Autogenerated by Avro
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * DO NOT EDIT DIRECTLY
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> com.globomantics.model;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.generic.GenericArray;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.specific.SpecificData;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.util.Utf8;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.message.BinaryMessageEncoder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.message.BinaryMessageDecoder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.avro.message.SchemaStore;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@org.apache.avro.specific.AvroGenerated</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Album</span> <span style="color:#66d9ef">extends</span> org.<span style="color:#a6e22e">apache</span>.<span style="color:#a6e22e">avro</span>.<span style="color:#a6e22e">specific</span>.<span style="color:#a6e22e">SpecificRecordBase</span> <span style="color:#66d9ef">implements</span> org.<span style="color:#a6e22e">apache</span>.<span style="color:#a6e22e">avro</span>.<span style="color:#a6e22e">specific</span>.<span style="color:#a6e22e">SpecificRecord</span> {
</span></span><span style="display:flex;"><span>	...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="create-other-topics">Create Other Topics<a hidden class="anchor" aria-hidden="true" href="#create-other-topics">#</a></h3>
<p>We need to create some other necessary topics to apply the distributed mode, which are configured in the <code>worker.properties</code> file: <code>kafka_connect_configs</code>, <code>kafka_connect_offsets</code>, and <code>kafka_connect_statuses</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">config.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_configs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cleanup.policy</span><span style="color:#f92672">=</span><span style="color:#e6db74">compact</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">offset.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_offsets</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">status.storage.topic</span><span style="color:#f92672">=</span><span style="color:#e6db74">kafka_connect_statuses</span>
</span></span></code></pre></div><p>Create these topics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_statuses --config cleanup.policy<span style="color:#f92672">=</span>compact
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_offsets --config cleanup.policy<span style="color:#f92672">=</span>compact
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --topic kafka_connect_configs --config cleanup.policy<span style="color:#f92672">=</span>compact
</span></span></code></pre></div><h3 id="start-the-kafka-connect-in-distributed-mode">Start the Kafka Connect in Distributed Mode<a hidden class="anchor" aria-hidden="true" href="#start-the-kafka-connect-in-distributed-mode">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>connect-distributed.sh worker.properties
</span></span></code></pre></div><p>If we see the logs like the following, then Kafka Connect is started in distributed mode:</p>
<pre tabindex="0"><code>...
[2024-12-21 21:02:37,819] INFO [Worker clientId=connect-192.168.10.106:8083, groupId=1] Finished starting connectors and tasks (org.apache.kafka.connect.runtime.distributed.DistributedHerder:2008)
[2024-12-21 21:02:37,984] INFO [Worker clientId=connect-192.168.10.106:8083, groupId=1] Session key updated (org.apache.kafka.connect.runtime.distributed.DistributedHerder:2510)
</code></pre><h3 id="deploy-connectors">Deploy Connectors<a hidden class="anchor" aria-hidden="true" href="#deploy-connectors">#</a></h3>
<p>The Kafka Connect in distributed mode offers some RESTful APIs. We can send an HTTP post request to the <code>localhost://8083</code> to create a connector with request body like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;mongo-sink&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;config&#34;</span> : {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connector.class&#34;</span>: <span style="color:#e6db74">&#34;com.mongodb.kafka.connect.MongoSinkConnector&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connection.uri&#34;</span>: <span style="color:#e6db74">&#34;mongodb://localhost:27017&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;database&#34;</span>: <span style="color:#e6db74">&#34;quickstart&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;collection&#34;</span>: <span style="color:#e6db74">&#34;topicData&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;topics&#34;</span>: <span style="color:#e6db74">&#34;connect-distributed&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img alt="image-20241221211834910" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241221211834910.png"></p>
<p>And we can get created connectors by the GET method:</p>
<p><img alt="image-20241221212010743" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241221212010743.png"></p>
<p>Then, we can append the name of the connector to the url to get the details of a specific connector:</p>
<p><img alt="image-20241221212217783" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/5-kafka-connect/images/image-20241221212217783.png"></p>
<h3 id="send-a-message">Send a Message<a hidden class="anchor" aria-hidden="true" href="#send-a-message">#</a></h3>
<p>Create a Java class using Kafka Producer to send a messages with an Album model as value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.globomantics;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.globomantics.model.Album;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> io.confluent.kafka.serializers.KafkaAvroSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> io.confluent.kafka.serializers.KafkaAvroSerializerConfig;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.KafkaProducer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.ProducerConfig;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.ProducerRecord;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.DoubleSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.Logger;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.LoggerFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AlbumSender</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger log <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(AlbumSender.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TOPIC <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;connect-distributed&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Properties props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;http://localhost:9092,http://localhost:9093,http://localhost:9094&#34;</span>);
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, DoubleSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, KafkaAvroSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>		props.<span style="color:#a6e22e">put</span>(KafkaAvroSerializerConfig.<span style="color:#a6e22e">SCHEMA_REGISTRY_URL_CONFIG</span>, <span style="color:#e6db74">&#34;http://localhost:8081&#34;</span>);
</span></span><span style="display:flex;"><span>		Album album <span style="color:#f92672">=</span> Album.<span style="color:#a6e22e">newBuilder</span>()
</span></span><span style="display:flex;"><span>				.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;Use Your Illusion&#34;</span>)
</span></span><span style="display:flex;"><span>				.<span style="color:#a6e22e">setYear</span>(1991).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>		KafkaProducer<span style="color:#f92672">&lt;</span>Double, Album<span style="color:#f92672">&gt;</span> producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;&gt;</span>(props);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">double</span> key <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>()<span style="color:#f92672">*</span>(50));
</span></span><span style="display:flex;"><span>		ProducerRecord<span style="color:#f92672">&lt;</span>Double, Album<span style="color:#f92672">&gt;</span> producerRecord <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(TOPIC, key, album);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Sending message &#34;</span> <span style="color:#f92672">+</span> album <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; to Kafka&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		producer.<span style="color:#a6e22e">send</span>(producerRecord, (metadata, e) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (metadata <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(producerRecord.<span style="color:#a6e22e">key</span>());
</span></span><span style="display:flex;"><span>				System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(producerRecord.<span style="color:#a6e22e">value</span>());
</span></span><span style="display:flex;"><span>				System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(metadata.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>		producer.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>		producer.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Successfully produced messages to &#34;</span> <span style="color:#f92672">+</span> TOPIC <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; topic&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="check-mongodb">Check MongoDB<a hidden class="anchor" aria-hidden="true" href="#check-mongodb">#</a></h3>
<p>After running the sender class, we need to connect to the MongoDB to check that the massage is here.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mongosh localhost:27017</span>
</span></span><span style="display:flex;"><span>Current Mongosh Log ID: 6766c45295db57d019e94969
</span></span><span style="display:flex;"><span>Connecting to:          mongodb://localhost:27017/?directConnection<span style="color:#f92672">=</span>true&amp;serverSelectionTimeoutMS<span style="color:#f92672">=</span>2000&amp;appName<span style="color:#f92672">=</span>mongosh+2.3.4
</span></span><span style="display:flex;"><span>Using MongoDB:          8.0.4
</span></span><span style="display:flex;"><span>Using Mongosh:          2.3.4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For mongosh info see: https://www.mongodb.com/docs/mongodb-shell/
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test&gt; show dbs
</span></span><span style="display:flex;"><span>admin       40.00 KiB
</span></span><span style="display:flex;"><span>config      60.00 KiB
</span></span><span style="display:flex;"><span>local       40.00 KiB
</span></span><span style="display:flex;"><span>quickstart  40.00 KiB
</span></span><span style="display:flex;"><span>test&gt; use quickstart
</span></span><span style="display:flex;"><span>switched to db quickstart
</span></span><span style="display:flex;"><span>quickstart&gt; db.topicData.find<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    _id: ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;6766c377e0b35c19402f4c3d&#39;</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>    name: <span style="color:#e6db74">&#39;Use Your Illusion&#39;</span>,
</span></span><span style="display:flex;"><span>    year: <span style="color:#ae81ff">1991</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><h2 id="takeaways">Takeaways<a hidden class="anchor" aria-hidden="true" href="#takeaways">#</a></h2>
<ul>
<li>Kafka Connect can come in two variants: Standalone and Distributed.</li>
<li>Kafka connects via worker processes where connectors get deployed as a number of tasks.</li>
<li>One can leverage the schema registry and AVRO to send classes through Kafka messages with much more metadata.</li>
<li>Thanks to the Kafka Connect that even sends those objects to another system.</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/mq/">MQ</a></li>
      <li><a href="http://localhost:1313/tags/kafka/">Kafka</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/6-kafka-stream/">
    <span class="title">« Prev</span>
    <br>
    <span>Kafka Stream</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/mq/kafka/getting-started-with-apache-kafka/4-kafka-conumers/">
    <span class="title">Next »</span>
    <br>
    <span>Kafka Consumer</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on x"
            href="https://x.com/intent/tweet/?text=Kafka%20Connect&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f&amp;hashtags=MQ%2cKafka">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f&amp;title=Kafka%20Connect&amp;summary=Kafka%20Connect&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f&title=Kafka%20Connect">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on whatsapp"
            href="https://api.whatsapp.com/send?text=Kafka%20Connect%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on telegram"
            href="https://telegram.me/share/url?text=Kafka%20Connect&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Connect on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Kafka%20Connect&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f5-kafka-connect%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "xinkangwu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Xinkang&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
