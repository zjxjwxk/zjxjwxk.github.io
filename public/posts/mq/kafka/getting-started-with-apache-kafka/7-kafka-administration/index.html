<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Kafka Administration | Xinkang&#39;s Blog</title>
<meta name="keywords" content="MQ, Kafka">
<meta name="description" content="TrustStore and KeyStore in Kafka
We need to have a secure deployment and encrypted communication on each of these four types of arrows.

Nowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):

CA (Certificate Authority): The CA can sign other entities certificates.
Client: The client put certificates in the Trust Store and doesn&rsquo;t hold keys.
Server: The server puts certificates, public keys, and private keys in the Key Store.

">
<meta name="author" content="">
<link rel="canonical" href="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://zjxjwxk.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://zjxjwxk.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zjxjwxk.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://zjxjwxk.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://zjxjwxk.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9CMXGMMTKX"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9CMXGMMTKX');
        }
      </script><meta property="og:url" content="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/">
  <meta property="og:site_name" content="Xinkang&#39;s Blog">
  <meta property="og:title" content="Kafka Administration">
  <meta property="og:description" content="TrustStore and KeyStore in Kafka We need to have a secure deployment and encrypted communication on each of these four types of arrows.
Nowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):
CA (Certificate Authority): The CA can sign other entities certificates. Client: The client put certificates in the Trust Store and doesn’t hold keys. Server: The server puts certificates, public keys, and private keys in the Key Store. ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-16T13:29:00+08:00">
    <meta property="article:modified_time" content="2025-03-16T13:29:00+08:00">
    <meta property="article:tag" content="MQ">
    <meta property="article:tag" content="Kafka">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kafka Administration">
<meta name="twitter:description" content="TrustStore and KeyStore in Kafka
We need to have a secure deployment and encrypted communication on each of these four types of arrows.

Nowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):

CA (Certificate Authority): The CA can sign other entities certificates.
Client: The client put certificates in the Trust Store and doesn&rsquo;t hold keys.
Server: The server puts certificates, public keys, and private keys in the Key Store.

">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://zjxjwxk.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Kafka Administration",
      "item": "https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kafka Administration",
  "name": "Kafka Administration",
  "description": "TrustStore and KeyStore in Kafka We need to have a secure deployment and encrypted communication on each of these four types of arrows.\nNowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):\nCA (Certificate Authority): The CA can sign other entities certificates. Client: The client put certificates in the Trust Store and doesn\u0026rsquo;t hold keys. Server: The server puts certificates, public keys, and private keys in the Key Store. ",
  "keywords": [
    "MQ", "Kafka"
  ],
  "articleBody": "TrustStore and KeyStore in Kafka We need to have a secure deployment and encrypted communication on each of these four types of arrows.\nNowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):\nCA (Certificate Authority): The CA can sign other entities certificates. Client: The client put certificates in the Trust Store and doesn’t hold keys. Server: The server puts certificates, public keys, and private keys in the Key Store. Let’s analyze these five entities in Kafka: the CA, Zookeeper, Brokers, Producers, and Consumers. Who needs a key store, and who needs a trust store, or both?\nThe CA: CA is the source of trust, it doesn’t need a keystore to verify against someone and just needs a trust store. Zookeepers: They are clients between themselves, so they need a trust store. But they are servers to the brokers, so they also need a key store with a CA certificate and both private and public keys for the brokers. Therefore, they need both. Brokers: They are similar to the zookeepers. They are clients between themselves and servers to producers and consumers. Therefore, they need both. Producers: They are just clients, so they just need a trust store. Consumers: They are just clients, so they just need a trust store. Demo: Creating the KeyStores and TrustStores Run Docker Containers Create a docker-compose file, including three zookeepers, three Kafka brokers, a Rest Proxy, and a Schema Registry.\n--- version: '3' services: zookeeper-1: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-1 container_name: zookeeper-1 volumes: - ./zookeeper-1_data:/var/lib/zookeeper/data - ./zookeeper-1_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 1 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-2: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-2 container_name: zookeeper-2 volumes: - ./zookeeper-2_data:/var/lib/zookeeper/data - ./zookeeper-2_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 zookeeper-3: image: confluentinc/cp-zookeeper:7.4.1 hostname: zookeeper-3 container_name: zookeeper-3 volumes: - ./zookeeper-3_data:/var/lib/zookeeper/data - ./zookeeper-3_log:/var/lib/zookeeper/log environment: ZOOKEEPER_CLIENT_PORT: 2181 ZOOKEEPER_TICK_TIME: 2000 ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181 broker-1: image: confluentinc/cp-kafka:7.4.1 hostname: broker-1 container_name: broker-1 volumes: - ./broker-1-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 ports: - 9092:9092 - 29092:29092 environment: KAFKA_BROKER_ID: 1 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9092,INTERNAL://broker-1:29092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-2: image: confluentinc/cp-kafka:7.4.1 hostname: broker-2 container_name: broker-2 volumes: - ./broker-2-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 ports: - 9093:9093 - 29093:29093 environment: KAFKA_BROKER_ID: 2 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9093,INTERNAL://broker-2:29093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true broker-3: image: confluentinc/cp-kafka:7.4.1 hostname: broker-3 container_name: broker-3 volumes: - ./broker-3-data:/var/lib/kafka/data depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 ports: - 9094:9094 - 29094:29094 environment: KAFKA_BROKER_ID: 3 KAFKA_ZOOKEEPER_CONNECT: zookeeper-1:2181 KAFKA_ADVERTISED_LISTENERS: HOST://localhost:9094,INTERNAL://broker-3:29094 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: HOST:PLAINTEXT,INTERNAL:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL KAFKA_SNAPSHOT_TRUST_EMPTY: true rest-proxy: image: confluentinc/cp-kafka-rest:7.4.1 ports: - \"8082:8082\" depends_on: - zookeeper-1 - zookeeper-2 - zookeeper-3 - broker-1 - broker-2 - broker-3 hostname: rest-proxy container_name: rest-proxy environment: KAFKA_REST_HOST_NAME: rest-proxy KAFKA_REST_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' KAFKA_REST_LISTENERS: \"http://0.0.0.0:8082\" schema-registry: image: confluentinc/cp-schema-registry:7.4.1 hostname: schema-registry container_name: schema-registry depends_on: - rest-proxy ports: - \"8081:8081\" environment: SCHEMA_REGISTRY_HOST_NAME: schema-registry SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: 'broker-1:29092,broker-2:29093,broker-3:29094' Run composed containers:\ndocker compose up -d Create a Topic Create a myorders topic that has four partitions.\nkafka-topics.sh --create --bootstrap-server localhost:9092 --partitions 4 --topic myorders Generate the Certificate Authority Create a shell script file generate-called.sh like the following:\nVALIDITY_DAYS=36500 CA_KEY_FILE=\"ca-key\" CA_CERT_FILE=\"ca-cert\" openssl req -new -x509 -keyout $CA_KEY_FILE -out $CA_CERT_FILE -days $VALIDITY_DAYS #### Example Values #### # Passphrase: password # Country Name: US # State or Province: UT # City: Utah # Organization Name: zjxjwxk # Organizational Unit Name: zjxjwxk # Common Name: zjxjwxk.github.io # Email: zjxjwxk@gmail.com Run the script and input all information it needs:\n❯ ./generate-ca.sh ......+......+..+......+.........+.+......+...............+++++++++++++++++++++++++++++++++++++++*.+....+.........+++++++++++++++++++++++++++++++++++++++*..+.........+......++++++ ....+.....+...+++++++++++++++++++++++++++++++++++++++*...+...+++++++++++++++++++++++++++++++++++++++*.........+...+....+............+........+.....................+......+.+...+.....+.......+...+.................+.........+...............+.+...+..+.........+...+.+...................................+.+.....+....+..++++++ Enter PEM pass phrase: Verifying - Enter PEM pass phrase: ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:US State or Province Name (full name) [Some-State]:UT Locality Name (eg, city) []:Utah Organization Name (eg, company) [Internet Widgits Pty Ltd]:zjxjwxk Organizational Unit Name (eg, section) []:zjxjwxk Common Name (e.g. server FQDN or YOUR name) []:zjxjwxk.github.io Email Address []:zjxjwxk@gmail.com Generate the KeyStores Create a shell script file generate-keystore.sh like the following:\nCOMMON_NAME=$1 ORGANIZATIONAL_UNIT=\"zjxjwxk\" ORGANIZATION=\"zjxjwxk\" CITY=\"Utah\" STATE=\"UT\" COUNTRY=\"US\" CA_ALIAS=\"ca-root\" CA_CERT_FILE=\"ca-cert\" VALIDITY_DAYS=36500 # Generate Keystore with Private Key keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -validity $VALIDITY_DAYS -genkey -keyalg RSA -dname \"CN=$COMMON_NAME, OU=$ORGANIZATIONAL_UNIT, O=$ORGANIZATION, L=$CITY, ST=$STATE, C=$COUNTRY\" # Generate Certificate Signing Request (CSR) using the newly created KeyStore keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -certreq -file $COMMON_NAME.csr # Sign the CSR using the custom CA openssl x509 -req -CA ca-cert -CAkey ca-key -in $COMMON_NAME.csr -out $COMMON_NAME.signed -days $VALIDITY_DAYS -CAcreateserial # Import ROOT CA certificate into Keystore keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $CA_ALIAS -importcert -file $CA_CERT_FILE # Import newly signed certificate into Keystore keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -importcert -file $COMMON_NAME.signed # Clean-up rm $COMMON_NAME.csr rm $COMMON_NAME.signed rm ca-cert.srl Create the keystore folder in the same path and then run the script with a parameter, which will be the name using the key store (run this script 6 times for three brokers and three zookeepers), and then input the passphrase when needed:\n❯ ./generate-keystore.sh broker-1 输入密钥库口令: 再次输入新口令: 输入 的密钥口令 (如果和密钥库口令相同, 按回车): Warning: JKS 密钥库使用专用格式。建议使用 \"keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12\" 迁移到行业标准格式 PKCS12。 输入密钥库口令: Warning: JKS 密钥库使用专用格式。建议使用 \"keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12\" 迁移到行业标准格式 PKCS12。 Certificate request self-signature ok subject=C=US, ST=UT, L=Utah, O=zjxjwxk, OU=zjxjwxk, CN=broker-1 Enter pass phrase for ca-key: 输入密钥库口令: 所有者: EMAILADDRESS=zjxjwxk@gmail.com, CN=zjxjwxk.github.io, OU=zjxjwxk, O=zjxjwxk, L=Utah, ST=UT, C=US 发布者: EMAILADDRESS=zjxjwxk@gmail.com, CN=zjxjwxk.github.io, OU=zjxjwxk, O=zjxjwxk, L=Utah, ST=UT, C=US 序列号: 7f8120f61b9782eadb2fd5097a6e58e116ba5351 有效期为 Sun Mar 16 15:13:13 CST 2025 至 Tue Feb 20 15:13:13 CST 2125 证书指纹: MD5: AE:1E:A0:89:D6:FC:FF:6C:73:83:A8:8E:72:EC:5C:14 SHA1: 27:BD:36:3A:64:92:08:BF:C5:93:EA:50:EC:B6:39:53:08:30:C9:96 SHA256: 7A:1A:E0:6D:91:C1:5E:FE:D1:6A:81:27:13:3E:08:5C:6A:D7:AF:A0:14:B4:C1:43:AA:65:85:AF:DC:B8:04:ED 签名算法名称: SHA256withRSA 主体公共密钥算法: 2048 位 RSA 密钥 版本: 3 扩展: #1: ObjectId: 2.5.29.35 Criticality=false AuthorityKeyIdentifier [ KeyIdentifier [ 0000: 85 57 ED 32 DF F0 D2 E5 4B E9 DF 4E 77 5E 3B CA .W.2....K..Nw^;. 0010: 03 91 17 70 ...p ] ] #2: ObjectId: 2.5.29.19 Criticality=true BasicConstraints:[ CA:true PathLen:2147483647 ] #3: ObjectId: 2.5.29.14 Criticality=false SubjectKeyIdentifier [ KeyIdentifier [ 0000: 85 57 ED 32 DF F0 D2 E5 4B E9 DF 4E 77 5E 3B CA .W.2....K..Nw^;. 0010: 03 91 17 70 ...p ] ] 是否信任此证书? [否]: y 证书已添加到密钥库中 Warning: JKS 密钥库使用专用格式。建议使用 \"keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12\" 迁移到行业标准格式 PKCS12。 输入密钥库口令: 证书回复已安装在密钥库中 Warning: JKS 密钥库使用专用格式。建议使用 \"keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12\" 迁移到行业标准格式 PKCS12。 Create the Truststores Create a shell script file generate-truststore.sh like the following:\nINSTANCE=$1 CA_ALIAS=\"ca-root\" CA_CERT_FILE=\"ca-cert\" #### Generate Truststore and import ROOT CA certificate #### keytool -keystore truststore/$INSTANCE.truststore.jks -import -alias $CA_ALIAS -file $CA_CERT_FILE Create the truststroe folder in the same path and then run the script with a parameter, which will be the name using the trust store (run this script 6 times for three brokers and three zookeepers), and then input the passphrase when needed:\n❯ ./generate-truststore.sh broker-1 输入密钥库口令: 再次输入新口令: 所有者: EMAILADDRESS=zjxjwxk@gmail.com, CN=zjxjwxk.github.io, OU=zjxjwxk, O=zjxjwxk, L=Utah, ST=UT, C=US 发布者: EMAILADDRESS=zjxjwxk@gmail.com, CN=zjxjwxk.github.io, OU=zjxjwxk, O=zjxjwxk, L=Utah, ST=UT, C=US 序列号: 7f8120f61b9782eadb2fd5097a6e58e116ba5351 有效期为 Sun Mar 16 15:13:13 CST 2025 至 Tue Feb 20 15:13:13 CST 2125 证书指纹: MD5: AE:1E:A0:89:D6:FC:FF:6C:73:83:A8:8E:72:EC:5C:14 SHA1: 27:BD:36:3A:64:92:08:BF:C5:93:EA:50:EC:B6:39:53:08:30:C9:96 SHA256: 7A:1A:E0:6D:91:C1:5E:FE:D1:6A:81:27:13:3E:08:5C:6A:D7:AF:A0:14:B4:C1:43:AA:65:85:AF:DC:B8:04:ED 签名算法名称: SHA256withRSA 主体公共密钥算法: 2048 位 RSA 密钥 版本: 3 扩展: #1: ObjectId: 2.5.29.35 Criticality=false AuthorityKeyIdentifier [ KeyIdentifier [ 0000: 85 57 ED 32 DF F0 D2 E5 4B E9 DF 4E 77 5E 3B CA .W.2....K..Nw^;. 0010: 03 91 17 70 ...p ] ] #2: ObjectId: 2.5.29.19 Criticality=true BasicConstraints:[ CA:true PathLen:2147483647 ] #3: ObjectId: 2.5.29.14 Criticality=false SubjectKeyIdentifier [ KeyIdentifier [ 0000: 85 57 ED 32 DF F0 D2 E5 4B E9 DF 4E 77 5E 3B CA .W.2....K..Nw^;. 0010: 03 91 17 70 ...p ] ] 是否信任此证书? [否]: y 证书已添加到密钥库中 Finally, the generated key stores and trust stores should look like this:\nEncrypt Zookeeper Encrypting Zookeeper can be done in two ways: Online Fashion and Offline Fashion.\nThe configuration we need to add to each Zookeeper in the docker-compose file:\nzookeeper-1: ... volumes: ... - ./security/keystore/zookeeper-1.keystore.jks:/security/zookeeper-1.keystore.jks - ./security/truststore/zookeeper-1.truststore.jks:/security/zookeeper-1.truststore.jks environment: ... ZOO_CFG_EXTRA: \"sslQuorum=true portUnification=false serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory ssl.quorum.hostnameVerification=false ssl.quorum.keyStore.location=/security/zookeeper-1.keystore.jks ssl.quorum.keyStore.password=password ssl.quorum.trustStore.location=/security/zookeeper-1.truststore.jks ssl.quorum.trustStore.password=password secureClientPort=2281 ssl.hostnameVerification=false ssl.keyStore.location=/security/zookeeper-1.keystore.jks ssl.keyStore.password=password ssl.trustStore.location=/security/zookeeper-1.truststore.jks ssl.trustStore.password=password\" The configuration we need to add to each broker in the docker-compose file:\nbroker-1: ... volumes: ... - ./security/keystore/broker-1.keystore.jks:/kafka/security/broker-1.keystore.jks - ./security/truststore/broker-1.truststore.jks:/kafka/security/broker-1.truststore.jks environment: ... KAFKA_ZOOKEEPER_SSL_CLIENT_ENABLE: \"true\" KAFKA_ZOOKEEPER_CLIENT_CNXN_SOCKET: org.apache.zookeeper.ClientCnxnSocketNetty KAFKA_ZOOKEEPER_SSL_KEYSTORE_LOCATION: /kafka/security/broker-1.keystore.jks KAFKA_ZOOKEEPER_SSL_KEYSTORE_PASSWORD: password KAFKA_ZOOKEEPER_SSL_TRUSTSTORE_LOCATION: /kafka/security/broker-1.truststore.jks KAFKA_ZOOKEEPER_SSL_TRUSTSTORE_PASSWORD: password Encrypt Producers and Consumers Configuration Four supported protocols are PLAINTEXT, SSL, SASL_PLAINTEXT, and SASL_SSL. (SASL involves authentication).\nDeclaring a listener is quite simple as well, in the environment we need to set:\nbroker-1: ... environment: ... KAFKA_LISTENERS: PLAINTEXT://broker-1:9091 KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://broker-1:9091 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT If we want to use SSL, we need to change those to:\nbroker-1: ... environment: ... KAFKA_LISTENERS: SSL://broker-1:9192 KAFKA_ADVERTISED_LISTENERS: SSL://broker-1:9192 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: SSL:SSL KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL KAFKA_SSL_CLIENT_AUTH: none Set the TrustStores and KeyStores:\nbroker-1: ... environment: ... KAFKA_SSL_KEYSTORE_LOCATION: /kafka/security/broker-1.keystore.jks KAFKA_SSL_KEYSTORE_PASSWORD: password KAFKA_SSL_KEY_PASSWORD: passowrd KAFKA_SSL_TRUSTSTORE_LOCATION: /kafka/security/broker-1.truststore.jks KAFKA_SSL_TRUSTSTORE_PASSWORD: password Consumer and Producer using SSL in Java The difference between a consumer using SSL and a consumer using plaintext is that:\nChange the ports of each broker configured to the ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG to the ports using SSL.\nprops.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"broker-1:9191,broker-2:9192,broker-3:9193\"); Set the CommonClientConfigs.SECURITY_PROTOCOL_CONFIG to SSL.\nprops.put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG, \"SSL\"); Set the trust store key and the password.\nprops.put(SslConfigs.SSL_TRUSTSTORE_LOCATION_CONFIG, \"/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/consumer.truststore.jks\"); // Replace with the absolute path on your machine props.put(SslConfigs.SSL_TRUSTSTORE_PASSWORD_CONFIG, \"password\"); The consumer using SSL should be like:\nimport org.apache.kafka.clients.CommonClientConfigs; import org.apache.kafka.clients.consumer.ConsumerConfig; import org.apache.kafka.clients.consumer.ConsumerRecords; import org.apache.kafka.clients.consumer.KafkaConsumer; import org.apache.kafka.common.config.SslConfigs; import org.apache.kafka.common.serialization.StringDeserializer; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.time.Duration; import java.util.Collections; import java.util.Properties; import java.util.concurrent.ExecutionException; public class BasicSSLConsumer { private static final Logger log = LoggerFactory.getLogger(BasicSSLConsumer.class); public static void main(String[] args) throws ExecutionException, InterruptedException { Properties props = new Properties(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"broker-1:9191,broker-2:9192,broker-3:9193\"); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); props.put(ConsumerConfig.GROUP_ID_CONFIG, \"basic.consumer\"); props.put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG, \"SSL\"); props.put(SslConfigs.SSL_TRUSTSTORE_LOCATION_CONFIG, \"/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/consumer.truststore.jks\"); // Replace with the absolute path on your machine props.put(SslConfigs.SSL_TRUSTSTORE_PASSWORD_CONFIG, \"password\"); KafkaConsumer\u003cString, String\u003e consumer = new KafkaConsumer\u003c\u003e(props); Thread haltedHook = new Thread(consumer::close); Runtime.getRuntime().addShutdownHook(haltedHook); consumer.subscribe(Collections.singletonList(\"basic-topic\")); while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofMillis(100)); records.forEach(record -\u003e log.info(\"Consumed message: \" + record.key() + \":\" + record.value())); } } } The producer is similar:\nimport org.apache.kafka.clients.CommonClientConfigs; import org.apache.kafka.clients.producer.*; import org.apache.kafka.common.config.SslConfigs; import org.apache.kafka.common.serialization.StringSerializer; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.util.Properties; import java.util.UUID; import java.util.concurrent.ExecutionException; public class BasicSSLProducer { private static final Logger log = LoggerFactory.getLogger(BasicSSLProducer.class); public static void main(String[] args) throws ExecutionException, InterruptedException { Properties props = new Properties(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"broker-1:9191,broker-2:9192,broker-3:9193\"); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); props.put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG, \"SSL\"); props.put(SslConfigs.SSL_TRUSTSTORE_LOCATION_CONFIG, \"/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/producer.truststore.jks\"); // Replace with the absolute path on your machine props.put(SslConfigs.SSL_TRUSTSTORE_PASSWORD_CONFIG, \"password\"); KafkaProducer\u003cString, String\u003e producer = new KafkaProducer\u003c\u003e(props); Thread haltedHook = new Thread(producer::close); Runtime.getRuntime().addShutdownHook(haltedHook); long i = 0; while(true) { String key = String.valueOf(i); String value = UUID.randomUUID().toString(); ProducerRecord\u003cString, String\u003e producerRecord = new ProducerRecord\u003c\u003e(\"basic-topic\", key, value); producer.send(producerRecord); log.info(\"Message sent: \" + key + \":\" + value); i++; Thread.sleep(20); } } } Monitoring Kafka: Scaling Cluster Level If there are some problems with the cluster level, usually means a high load. Add a broker 4 and turn on the balancer. Then the load will be balanced between brokers.\nconfluent.balancer.enable=true Broker Level If there are some problems with the broker level. We can just restart the broker.\nTopic Level The only problem that load balancer from confluent doesn’t detect is the topic level. To detect that, the command to run is:\n❯ kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group 1 GROUP TOPIC PARTITION CURRENT-OFFSET LOG-END-OFFSET LAG CONSUMER-ID HOST CLIENT-ID 1 myorders 1 0 0 0 console-consumer-8a295fc9-0d1f-4712-9c60-8e5ce13c7155 /172.30.0.1 console-consumer 1 myorders 0 0 0 0 console-consumer-8a295fc9-0d1f-4712-9c60-8e5ce13c7155 /172.30.0.1 console-consumer% If a topic’s LAG is high, the consumer is not catching up, which means we need more partitions.\nIncreasing the number of partitions of a topic is not easy. The best way is:\nCreate another topic with more partitions. Then create a Kafka Streams application that will read from the original topic and write to the output topic. When that steam application is done, then there is no lag. Migrate producers and consumers to the new topic. Takeaway We need to secure all communications channels in Kafka by encrypting them with TLS. We created TrustStroes for all entities and KeyStores for Brokers and Zookeepers. To scale out Kafka, most of the problems are solved by the Confluent tool, SBC (Self-Balancing Clusters). ",
  "wordCount" : "1994",
  "inLanguage": "en",
  "datePublished": "2025-03-16T13:29:00+08:00",
  "dateModified": "2025-03-16T13:29:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xinkang's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://zjxjwxk.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zjxjwxk.github.io/" accesskey="h" title="Xinkang&#39;s Blog (Alt + H)">Xinkang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zjxjwxk.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://zjxjwxk.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://zjxjwxk.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://zjxjwxk.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Kafka Administration
    </h1>
    <div class="post-meta"><span title='2025-03-16 13:29:00 +0800 CST'>March 16, 2025</span>&nbsp;·&nbsp;10 min&nbsp;|&nbsp;<a href="https://github.com/zjxjwxk/zjxjwxk.github.io/tree/main/content/posts/MQ/Kafka/Getting%20Started%20with%20Apache%20Kafka/7-Kafka%20Administration/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#truststore-and-keystore-in-kafka" aria-label="TrustStore and KeyStore in Kafka">TrustStore and KeyStore in Kafka</a></li>
                <li>
                    <a href="#demo-creating-the-keystores-and-truststores" aria-label="Demo: Creating the KeyStores and TrustStores">Demo: Creating the KeyStores and TrustStores</a><ul>
                        
                <li>
                    <a href="#run-docker-containers" aria-label="Run Docker Containers">Run Docker Containers</a></li>
                <li>
                    <a href="#create-a-topic" aria-label="Create a Topic">Create a Topic</a></li>
                <li>
                    <a href="#generate-the-certificate-authority" aria-label="Generate the Certificate Authority">Generate the Certificate Authority</a></li>
                <li>
                    <a href="#generate-the-keystores" aria-label="Generate the KeyStores">Generate the KeyStores</a></li>
                <li>
                    <a href="#create-the-truststores" aria-label="Create the Truststores">Create the Truststores</a></li></ul>
                </li>
                <li>
                    <a href="#encrypt-zookeeper" aria-label="Encrypt Zookeeper">Encrypt Zookeeper</a></li>
                <li>
                    <a href="#encrypt-producers-and-consumers" aria-label="Encrypt Producers and Consumers">Encrypt Producers and Consumers</a><ul>
                        
                <li>
                    <a href="#configuration" aria-label="Configuration">Configuration</a></li>
                <li>
                    <a href="#consumer-and-producer-using-ssl-in-java" aria-label="Consumer and Producer using SSL in Java">Consumer and Producer using SSL in Java</a></li></ul>
                </li>
                <li>
                    <a href="#monitoring-kafka-scaling" aria-label="Monitoring Kafka: Scaling">Monitoring Kafka: Scaling</a><ul>
                        
                <li>
                    <a href="#cluster-level" aria-label="Cluster Level">Cluster Level</a></li>
                <li>
                    <a href="#broker-level" aria-label="Broker Level">Broker Level</a></li>
                <li>
                    <a href="#topic-level" aria-label="Topic Level">Topic Level</a></li></ul>
                </li>
                <li>
                    <a href="#takeaway" aria-label="Takeaway">Takeaway</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="truststore-and-keystore-in-kafka">TrustStore and KeyStore in Kafka<a hidden class="anchor" aria-hidden="true" href="#truststore-and-keystore-in-kafka">#</a></h2>
<p>We need to have a secure deployment and encrypted communication on each of these four types of arrows.</p>
<p><img alt="image-20250316135513552" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250316135513552.png"></p>
<p>Nowadays, the TLS is mostly used to secure a connection via a CA (Certificate Authority):</p>
<ul>
<li>CA (Certificate Authority): The CA can sign other entities certificates.</li>
<li>Client: The client put certificates in the Trust Store and doesn&rsquo;t hold keys.</li>
<li>Server: The server puts certificates, public keys, and private keys in the Key Store.</li>
</ul>
<p><img alt="image-20250316140335677" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250316140335677.png"></p>
<p>Let&rsquo;s analyze these five entities in Kafka: the CA, Zookeeper, Brokers, Producers, and Consumers. Who needs a key store, and who needs a trust store, or both?</p>
<ul>
<li>The CA: CA is the source of trust, it doesn&rsquo;t need a keystore to verify against someone and just needs a trust store.</li>
<li>Zookeepers: They are clients between themselves, so they need a trust store. But they are servers to the brokers, so they also need a key store with a CA certificate and both private and public keys for the brokers. Therefore, they need both.</li>
<li>Brokers: They are similar to the zookeepers. They are clients between themselves and servers to producers and consumers. Therefore, they need both.</li>
<li>Producers: They are just clients, so they just need a trust store.</li>
<li>Consumers: They are just clients, so they just need a trust store.</li>
</ul>
<p><img alt="image-20250316142709262" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250316142709262.png"></p>
<h2 id="demo-creating-the-keystores-and-truststores">Demo: Creating the KeyStores and TrustStores<a hidden class="anchor" aria-hidden="true" href="#demo-creating-the-keystores-and-truststores">#</a></h2>
<h3 id="run-docker-containers">Run Docker Containers<a hidden class="anchor" aria-hidden="true" href="#run-docker-containers">#</a></h3>
<p>Create a docker-compose file, including three zookeepers, three Kafka brokers, a Rest Proxy, and a Schema Registry.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-1_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-2_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">zookeeper-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-zookeeper:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_data:/var/lib/zookeeper/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./zookeeper-3_log:/var/lib/zookeeper/log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_CLIENT_PORT</span>: <span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOOKEEPER_TICK_TIME</span>: <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_MY_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ZOO_SERVERS</span>: <span style="color:#ae81ff">server.1=zookeeper-1:2888:3888;2181 server.2=zookeeper-2:2888:3888;2181 server.3=zookeeper-3:2888:3888;2181</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-1-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9092</span>:<span style="color:#ae81ff">9092</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29092</span>:<span style="color:#ae81ff">29092</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9092,INTERNAL://broker-1:29092</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-2-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9093</span>:<span style="color:#ae81ff">9093</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29093</span>:<span style="color:#ae81ff">29093</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9093,INTERNAL://broker-2:29093</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">broker-3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./broker-3-data:/var/lib/kafka/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9094</span>:<span style="color:#ae81ff">9094</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">29094</span>:<span style="color:#ae81ff">29094</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_BROKER_ID</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ZOOKEEPER_CONNECT</span>: <span style="color:#ae81ff">zookeeper-1:2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">HOST://localhost:9094,INTERNAL://broker-3:29094</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">HOST:PLAINTEXT,INTERNAL:PLAINTEXT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="color:#ae81ff">INTERNAL</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_SNAPSHOT_TRUST_EMPTY</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rest-proxy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-kafka-rest:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8082:8082&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">zookeeper-3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-2</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">broker-3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_HOST_NAME</span>: <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">KAFKA_REST_LISTENERS</span>: <span style="color:#e6db74">&#34;http://0.0.0.0:8082&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schema-registry</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">confluentinc/cp-schema-registry:7.4.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rest-proxy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8081:8081&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_HOST_NAME</span>: <span style="color:#ae81ff">schema-registry</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</span>: <span style="color:#e6db74">&#39;broker-1:29092,broker-2:29093,broker-3:29094&#39;</span>
</span></span></code></pre></div><p>Run composed containers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><h3 id="create-a-topic">Create a Topic<a hidden class="anchor" aria-hidden="true" href="#create-a-topic">#</a></h3>
<p>Create a <code>myorders</code> topic that has four partitions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kafka-topics.sh --create --bootstrap-server localhost:9092 --partitions <span style="color:#ae81ff">4</span> --topic myorders
</span></span></code></pre></div><h3 id="generate-the-certificate-authority">Generate the Certificate Authority<a hidden class="anchor" aria-hidden="true" href="#generate-the-certificate-authority">#</a></h3>
<p>Create a shell script file <code>generate-called.sh</code> like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VALIDITY_DAYS<span style="color:#f92672">=</span><span style="color:#ae81ff">36500</span>
</span></span><span style="display:flex;"><span>CA_KEY_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-key&#34;</span>
</span></span><span style="display:flex;"><span>CA_CERT_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-cert&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>openssl req -new -x509 -keyout $CA_KEY_FILE -out $CA_CERT_FILE -days $VALIDITY_DAYS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Example Values ####</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Passphrase: password</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Country Name: US</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># State or Province: UT</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># City: Utah</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Organization Name: zjxjwxk</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Organizational Unit Name: zjxjwxk</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Common Name: zjxjwxk.github.io</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Email: zjxjwxk@gmail.com</span>
</span></span></code></pre></div><p>Run the script and input all information it needs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ ./generate-ca.sh
</span></span><span style="display:flex;"><span>......+......+..+......+.........+.+......+...............+++++++++++++++++++++++++++++++++++++++*.+....+.........+++++++++++++++++++++++++++++++++++++++*..+.........+......++++++
</span></span><span style="display:flex;"><span>....+.....+...+++++++++++++++++++++++++++++++++++++++*...+...+++++++++++++++++++++++++++++++++++++++*.........+...+....+............+........+.....................+......+.+...+.....+.......+...+.................+.........+...............+.+...+..+.........+...+.+...................................+.+.....+....+..++++++
</span></span><span style="display:flex;"><span>Enter PEM pass phrase:
</span></span><span style="display:flex;"><span>Verifying - Enter PEM pass phrase:
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>You are about to be asked to enter information that will be incorporated
</span></span><span style="display:flex;"><span>into your certificate request.
</span></span><span style="display:flex;"><span>What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span style="display:flex;"><span>There are quite a few fields but you can leave some blank
</span></span><span style="display:flex;"><span>For some fields there will be a default value,
</span></span><span style="display:flex;"><span>If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>Country Name <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> letter code<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>AU<span style="color:#f92672">]</span>:US
</span></span><span style="display:flex;"><span>State or Province Name <span style="color:#f92672">(</span>full name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Some-State<span style="color:#f92672">]</span>:UT
</span></span><span style="display:flex;"><span>Locality Name <span style="color:#f92672">(</span>eg, city<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:Utah
</span></span><span style="display:flex;"><span>Organization Name <span style="color:#f92672">(</span>eg, company<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Internet Widgits Pty Ltd<span style="color:#f92672">]</span>:zjxjwxk
</span></span><span style="display:flex;"><span>Organizational Unit Name <span style="color:#f92672">(</span>eg, section<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:zjxjwxk
</span></span><span style="display:flex;"><span>Common Name <span style="color:#f92672">(</span>e.g. server FQDN or YOUR name<span style="color:#f92672">)</span> <span style="color:#f92672">[]</span>:zjxjwxk.github.io
</span></span><span style="display:flex;"><span>Email Address <span style="color:#f92672">[]</span>:zjxjwxk@gmail.com
</span></span></code></pre></div><h3 id="generate-the-keystores">Generate the KeyStores<a hidden class="anchor" aria-hidden="true" href="#generate-the-keystores">#</a></h3>
<p>Create a shell script file <code>generate-keystore.sh</code> like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>COMMON_NAME<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>ORGANIZATIONAL_UNIT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zjxjwxk&#34;</span>
</span></span><span style="display:flex;"><span>ORGANIZATION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zjxjwxk&#34;</span>
</span></span><span style="display:flex;"><span>CITY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Utah&#34;</span>
</span></span><span style="display:flex;"><span>STATE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UT&#34;</span>
</span></span><span style="display:flex;"><span>COUNTRY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;US&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CA_ALIAS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-root&#34;</span>
</span></span><span style="display:flex;"><span>CA_CERT_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-cert&#34;</span> 
</span></span><span style="display:flex;"><span>VALIDITY_DAYS<span style="color:#f92672">=</span><span style="color:#ae81ff">36500</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate Keystore with Private Key</span>
</span></span><span style="display:flex;"><span>keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -validity $VALIDITY_DAYS -genkey -keyalg RSA -dname <span style="color:#e6db74">&#34;CN=</span>$COMMON_NAME<span style="color:#e6db74">, OU=</span>$ORGANIZATIONAL_UNIT<span style="color:#e6db74">, O=</span>$ORGANIZATION<span style="color:#e6db74">, L=</span>$CITY<span style="color:#e6db74">, ST=</span>$STATE<span style="color:#e6db74">, C=</span>$COUNTRY<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate Certificate Signing Request (CSR) using the newly created KeyStore</span>
</span></span><span style="display:flex;"><span>keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -certreq -file $COMMON_NAME.csr 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sign the CSR using the custom CA</span>
</span></span><span style="display:flex;"><span>openssl x509 -req -CA ca-cert -CAkey ca-key -in $COMMON_NAME.csr -out $COMMON_NAME.signed -days $VALIDITY_DAYS -CAcreateserial
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Import ROOT CA certificate into Keystore</span>
</span></span><span style="display:flex;"><span>keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $CA_ALIAS -importcert -file $CA_CERT_FILE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Import newly signed certificate into Keystore</span>
</span></span><span style="display:flex;"><span>keytool -keystore keystore/$COMMON_NAME.keystore.jks -alias $COMMON_NAME -importcert -file $COMMON_NAME.signed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clean-up </span>
</span></span><span style="display:flex;"><span>rm $COMMON_NAME.csr
</span></span><span style="display:flex;"><span>rm $COMMON_NAME.signed
</span></span><span style="display:flex;"><span>rm ca-cert.srl
</span></span></code></pre></div><p>Create the <code>keystore</code> folder in the same path and then run the script with a parameter, which will be the name using the key store (run this script 6 times for three brokers and three zookeepers), and then input the passphrase when needed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ ./generate-keystore.sh broker-1
</span></span><span style="display:flex;"><span>输入密钥库口令:  
</span></span><span style="display:flex;"><span>再次输入新口令: 
</span></span><span style="display:flex;"><span>输入 &lt;broker-1&gt; 的密钥口令
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">(</span>如果和密钥库口令相同, 按回车<span style="color:#f92672">)</span>:  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Warning:
</span></span><span style="display:flex;"><span>JKS 密钥库使用专用格式。建议使用 <span style="color:#e6db74">&#34;keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12&#34;</span> 迁移到行业标准格式 PKCS12。
</span></span><span style="display:flex;"><span>输入密钥库口令:  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Warning:
</span></span><span style="display:flex;"><span>JKS 密钥库使用专用格式。建议使用 <span style="color:#e6db74">&#34;keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12&#34;</span> 迁移到行业标准格式 PKCS12。
</span></span><span style="display:flex;"><span>Certificate request self-signature ok
</span></span><span style="display:flex;"><span>subject<span style="color:#f92672">=</span>C<span style="color:#f92672">=</span>US, ST<span style="color:#f92672">=</span>UT, L<span style="color:#f92672">=</span>Utah, O<span style="color:#f92672">=</span>zjxjwxk, OU<span style="color:#f92672">=</span>zjxjwxk, CN<span style="color:#f92672">=</span>broker-1
</span></span><span style="display:flex;"><span>Enter pass phrase <span style="color:#66d9ef">for</span> ca-key:
</span></span><span style="display:flex;"><span>输入密钥库口令:  
</span></span><span style="display:flex;"><span>所有者: EMAILADDRESS<span style="color:#f92672">=</span>zjxjwxk@gmail.com, CN<span style="color:#f92672">=</span>zjxjwxk.github.io, OU<span style="color:#f92672">=</span>zjxjwxk, O<span style="color:#f92672">=</span>zjxjwxk, L<span style="color:#f92672">=</span>Utah, ST<span style="color:#f92672">=</span>UT, C<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>发布者: EMAILADDRESS<span style="color:#f92672">=</span>zjxjwxk@gmail.com, CN<span style="color:#f92672">=</span>zjxjwxk.github.io, OU<span style="color:#f92672">=</span>zjxjwxk, O<span style="color:#f92672">=</span>zjxjwxk, L<span style="color:#f92672">=</span>Utah, ST<span style="color:#f92672">=</span>UT, C<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>序列号: 7f8120f61b9782eadb2fd5097a6e58e116ba5351
</span></span><span style="display:flex;"><span>有效期为 Sun Mar <span style="color:#ae81ff">16</span> 15:13:13 CST <span style="color:#ae81ff">2025</span> 至 Tue Feb <span style="color:#ae81ff">20</span> 15:13:13 CST <span style="color:#ae81ff">2125</span>
</span></span><span style="display:flex;"><span>证书指纹:
</span></span><span style="display:flex;"><span>	 MD5:  AE:1E:A0:89:D6:FC:FF:6C:73:83:A8:8E:72:EC:5C:14
</span></span><span style="display:flex;"><span>	 SHA1: 27:BD:36:3A:64:92:08:BF:C5:93:EA:50:EC:B6:39:53:08:30:C9:96
</span></span><span style="display:flex;"><span>	 SHA256: 7A:1A:E0:6D:91:C1:5E:FE:D1:6A:81:27:13:3E:08:5C:6A:D7:AF:A0:14:B4:C1:43:AA:65:85:AF:DC:B8:04:ED
</span></span><span style="display:flex;"><span>签名算法名称: SHA256withRSA
</span></span><span style="display:flex;"><span>主体公共密钥算法: <span style="color:#ae81ff">2048</span> 位 RSA 密钥
</span></span><span style="display:flex;"><span>版本: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>扩展: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#1: ObjectId: 2.5.29.35 Criticality=false</span>
</span></span><span style="display:flex;"><span>AuthorityKeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>KeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>0000: <span style="color:#ae81ff">85</span> <span style="color:#ae81ff">57</span> ED <span style="color:#ae81ff">32</span> DF F0 D2 E5   4B E9 DF 4E <span style="color:#ae81ff">77</span> 5E 3B CA  .W.2....K..Nw^;.
</span></span><span style="display:flex;"><span>0010: <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">70</span>                                        ...p
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#2: ObjectId: 2.5.29.19 Criticality=true</span>
</span></span><span style="display:flex;"><span>BasicConstraints:<span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  CA:true
</span></span><span style="display:flex;"><span>  PathLen:2147483647
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#3: ObjectId: 2.5.29.14 Criticality=false</span>
</span></span><span style="display:flex;"><span>SubjectKeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>KeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>0000: <span style="color:#ae81ff">85</span> <span style="color:#ae81ff">57</span> ED <span style="color:#ae81ff">32</span> DF F0 D2 E5   4B E9 DF 4E <span style="color:#ae81ff">77</span> 5E 3B CA  .W.2....K..Nw^;.
</span></span><span style="display:flex;"><span>0010: <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">70</span>                                        ...p
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>是否信任此证书? <span style="color:#f92672">[</span>否<span style="color:#f92672">]</span>:  y
</span></span><span style="display:flex;"><span>证书已添加到密钥库中
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Warning:
</span></span><span style="display:flex;"><span>JKS 密钥库使用专用格式。建议使用 <span style="color:#e6db74">&#34;keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12&#34;</span> 迁移到行业标准格式 PKCS12。
</span></span><span style="display:flex;"><span>输入密钥库口令:  
</span></span><span style="display:flex;"><span>证书回复已安装在密钥库中
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Warning:
</span></span><span style="display:flex;"><span>JKS 密钥库使用专用格式。建议使用 <span style="color:#e6db74">&#34;keytool -importkeystore -srckeystore keystore/broker-1.keystore.jks -destkeystore keystore/broker-1.keystore.jks -deststoretype pkcs12&#34;</span> 迁移到行业标准格式 PKCS12。
</span></span></code></pre></div><h3 id="create-the-truststores">Create the Truststores<a hidden class="anchor" aria-hidden="true" href="#create-the-truststores">#</a></h3>
<p>Create a shell script file <code>generate-truststore.sh</code> like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>INSTANCE<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>CA_ALIAS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-root&#34;</span>
</span></span><span style="display:flex;"><span>CA_CERT_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ca-cert&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Generate Truststore and import ROOT CA certificate ####</span>
</span></span><span style="display:flex;"><span>keytool -keystore truststore/$INSTANCE.truststore.jks -import -alias $CA_ALIAS -file $CA_CERT_FILE
</span></span></code></pre></div><p>Create the <code>truststroe</code> folder in the same path and then run the script with a parameter, which will be the name using the trust store (run this script 6 times for three brokers and three zookeepers), and then input the passphrase when needed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ ./generate-truststore.sh broker-1
</span></span><span style="display:flex;"><span>输入密钥库口令:  
</span></span><span style="display:flex;"><span>再次输入新口令: 
</span></span><span style="display:flex;"><span>所有者: EMAILADDRESS<span style="color:#f92672">=</span>zjxjwxk@gmail.com, CN<span style="color:#f92672">=</span>zjxjwxk.github.io, OU<span style="color:#f92672">=</span>zjxjwxk, O<span style="color:#f92672">=</span>zjxjwxk, L<span style="color:#f92672">=</span>Utah, ST<span style="color:#f92672">=</span>UT, C<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>发布者: EMAILADDRESS<span style="color:#f92672">=</span>zjxjwxk@gmail.com, CN<span style="color:#f92672">=</span>zjxjwxk.github.io, OU<span style="color:#f92672">=</span>zjxjwxk, O<span style="color:#f92672">=</span>zjxjwxk, L<span style="color:#f92672">=</span>Utah, ST<span style="color:#f92672">=</span>UT, C<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>序列号: 7f8120f61b9782eadb2fd5097a6e58e116ba5351
</span></span><span style="display:flex;"><span>有效期为 Sun Mar <span style="color:#ae81ff">16</span> 15:13:13 CST <span style="color:#ae81ff">2025</span> 至 Tue Feb <span style="color:#ae81ff">20</span> 15:13:13 CST <span style="color:#ae81ff">2125</span>
</span></span><span style="display:flex;"><span>证书指纹:
</span></span><span style="display:flex;"><span>	 MD5:  AE:1E:A0:89:D6:FC:FF:6C:73:83:A8:8E:72:EC:5C:14
</span></span><span style="display:flex;"><span>	 SHA1: 27:BD:36:3A:64:92:08:BF:C5:93:EA:50:EC:B6:39:53:08:30:C9:96
</span></span><span style="display:flex;"><span>	 SHA256: 7A:1A:E0:6D:91:C1:5E:FE:D1:6A:81:27:13:3E:08:5C:6A:D7:AF:A0:14:B4:C1:43:AA:65:85:AF:DC:B8:04:ED
</span></span><span style="display:flex;"><span>签名算法名称: SHA256withRSA
</span></span><span style="display:flex;"><span>主体公共密钥算法: <span style="color:#ae81ff">2048</span> 位 RSA 密钥
</span></span><span style="display:flex;"><span>版本: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>扩展: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#1: ObjectId: 2.5.29.35 Criticality=false</span>
</span></span><span style="display:flex;"><span>AuthorityKeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>KeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>0000: <span style="color:#ae81ff">85</span> <span style="color:#ae81ff">57</span> ED <span style="color:#ae81ff">32</span> DF F0 D2 E5   4B E9 DF 4E <span style="color:#ae81ff">77</span> 5E 3B CA  .W.2....K..Nw^;.
</span></span><span style="display:flex;"><span>0010: <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">70</span>                                        ...p
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#2: ObjectId: 2.5.29.19 Criticality=true</span>
</span></span><span style="display:flex;"><span>BasicConstraints:<span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  CA:true
</span></span><span style="display:flex;"><span>  PathLen:2147483647
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#3: ObjectId: 2.5.29.14 Criticality=false</span>
</span></span><span style="display:flex;"><span>SubjectKeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>KeyIdentifier <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>0000: <span style="color:#ae81ff">85</span> <span style="color:#ae81ff">57</span> ED <span style="color:#ae81ff">32</span> DF F0 D2 E5   4B E9 DF 4E <span style="color:#ae81ff">77</span> 5E 3B CA  .W.2....K..Nw^;.
</span></span><span style="display:flex;"><span>0010: <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">91</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">70</span>                                        ...p
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>是否信任此证书? <span style="color:#f92672">[</span>否<span style="color:#f92672">]</span>:  y
</span></span><span style="display:flex;"><span>证书已添加到密钥库中
</span></span></code></pre></div><p>Finally, the generated key stores and trust stores should look like this:</p>
<p><img alt="image-20250316155759108" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250316155759108.png"></p>
<h2 id="encrypt-zookeeper">Encrypt Zookeeper<a hidden class="anchor" aria-hidden="true" href="#encrypt-zookeeper">#</a></h2>
<p>Encrypting Zookeeper can be done in two ways: Online Fashion and Offline Fashion.</p>
<p>The configuration we need to add to each Zookeeper in the docker-compose file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>      <span style="color:#f92672">zookeeper-1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>        	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">./security/keystore/zookeeper-1.keystore.jks:/security/zookeeper-1.keystore.jks</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">./security/truststore/zookeeper-1.truststore.jks:/security/zookeeper-1.truststore.jks</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ZOO_CFG_EXTRA</span>: <span style="color:#e6db74">&#34;sslQuorum=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          portUnification=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.quorum.hostnameVerification=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.quorum.keyStore.location=/security/zookeeper-1.keystore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.quorum.keyStore.password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.quorum.trustStore.location=/security/zookeeper-1.truststore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.quorum.trustStore.password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          secureClientPort=2281
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.hostnameVerification=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.keyStore.location=/security/zookeeper-1.keystore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.keyStore.password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.trustStore.location=/security/zookeeper-1.truststore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          ssl.trustStore.password=password&#34;</span>
</span></span></code></pre></div><p>The configuration we need to add to each broker in the docker-compose file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>      <span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>        	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">./security/keystore/broker-1.keystore.jks:/kafka/security/broker-1.keystore.jks</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">./security/truststore/broker-1.truststore.jks:/kafka/security/broker-1.truststore.jks</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_SSL_CLIENT_ENABLE</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_CLIENT_CNXN_SOCKET</span>: <span style="color:#ae81ff">org.apache.zookeeper.ClientCnxnSocketNetty</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_SSL_KEYSTORE_LOCATION</span>: <span style="color:#ae81ff">/kafka/security/broker-1.keystore.jks</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_SSL_KEYSTORE_PASSWORD</span>: <span style="color:#ae81ff">password</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_SSL_TRUSTSTORE_LOCATION</span>: <span style="color:#ae81ff">/kafka/security/broker-1.truststore.jks</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">KAFKA_ZOOKEEPER_SSL_TRUSTSTORE_PASSWORD</span>: <span style="color:#ae81ff">password</span>
</span></span></code></pre></div><h2 id="encrypt-producers-and-consumers">Encrypt Producers and Consumers<a hidden class="anchor" aria-hidden="true" href="#encrypt-producers-and-consumers">#</a></h2>
<h3 id="configuration">Configuration<a hidden class="anchor" aria-hidden="true" href="#configuration">#</a></h3>
<p>Four supported protocols are PLAINTEXT, SSL, SASL_PLAINTEXT, and SASL_SSL. (SASL involves authentication).</p>
<p>Declaring a listener is quite simple as well, in the environment we need to set:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>  	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_LISTENERS</span>: <span style="color:#ae81ff">PLAINTEXT://broker-1:9091</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">PLAINTEXT://broker-1:9091</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">PLAINTEXT:PLAINTEXT</span>
</span></span></code></pre></div><p>If we want to use SSL, we need to change those to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>  	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_LISTENERS</span>: <span style="color:#ae81ff">SSL://broker-1:9192</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_ADVERTISED_LISTENERS</span>: <span style="color:#ae81ff">SSL://broker-1:9192</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="color:#ae81ff">SSL:SSL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SECURITY_INTER_BROKER_PROTOCOL</span>: <span style="color:#ae81ff">SSL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_CLIENT_AUTH</span>: <span style="color:#ae81ff">none</span>
</span></span></code></pre></div><p>Set the TrustStores and KeyStores:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">broker-1</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>  	<span style="color:#ae81ff">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_KEYSTORE_LOCATION</span>: <span style="color:#ae81ff">/kafka/security/broker-1.keystore.jks</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_KEYSTORE_PASSWORD</span>: <span style="color:#ae81ff">password</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_KEY_PASSWORD</span>: <span style="color:#ae81ff">passowrd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_TRUSTSTORE_LOCATION</span>: <span style="color:#ae81ff">/kafka/security/broker-1.truststore.jks</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">KAFKA_SSL_TRUSTSTORE_PASSWORD</span>: <span style="color:#ae81ff">password</span>
</span></span></code></pre></div><h3 id="consumer-and-producer-using-ssl-in-java">Consumer and Producer using SSL in Java<a hidden class="anchor" aria-hidden="true" href="#consumer-and-producer-using-ssl-in-java">#</a></h3>
<p>The difference between a consumer using SSL and a consumer using plaintext is that:</p>
<ol>
<li>
<p>Change the ports of each broker configured to the <code>ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG</code> to the ports using SSL.</p>
<ol>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>props.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;broker-1:9191,broker-2:9192,broker-3:9193&#34;</span>);
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Set the <code>CommonClientConfigs.SECURITY_PROTOCOL_CONFIG</code> to SSL.</p>
<ol>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>props.<span style="color:#a6e22e">put</span>(CommonClientConfigs.<span style="color:#a6e22e">SECURITY_PROTOCOL_CONFIG</span>, <span style="color:#e6db74">&#34;SSL&#34;</span>);
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Set the trust store key and the password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_LOCATION_CONFIG</span>, <span style="color:#e6db74">&#34;/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/consumer.truststore.jks&#34;</span>); <span style="color:#75715e">// Replace with the absolute path on your machine</span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_PASSWORD_CONFIG</span>, <span style="color:#e6db74">&#34;password&#34;</span>);
</span></span></code></pre></div></li>
</ol>
<p>The consumer using SSL should be like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.CommonClientConfigs;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.config.SslConfigs;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.StringDeserializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.Logger;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.LoggerFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.Duration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Collections;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.ExecutionException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicSSLConsumer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger log <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(BasicSSLConsumer.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        Properties props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;broker-1:9191,broker-2:9192,broker-3:9193&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ConsumerConfig.<span style="color:#a6e22e">GROUP_ID_CONFIG</span>, <span style="color:#e6db74">&#34;basic.consumer&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(CommonClientConfigs.<span style="color:#a6e22e">SECURITY_PROTOCOL_CONFIG</span>, <span style="color:#e6db74">&#34;SSL&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_LOCATION_CONFIG</span>, <span style="color:#e6db74">&#34;/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/consumer.truststore.jks&#34;</span>); <span style="color:#75715e">// Replace with the absolute path on your machine</span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_PASSWORD_CONFIG</span>, <span style="color:#e6db74">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        KafkaConsumer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaConsumer<span style="color:#f92672">&lt;&gt;</span>(props);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Thread haltedHook <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(consumer::close);
</span></span><span style="display:flex;"><span>        Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">addShutdownHook</span>(haltedHook);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        consumer.<span style="color:#a6e22e">subscribe</span>(Collections.<span style="color:#a6e22e">singletonList</span>(<span style="color:#e6db74">&#34;basic-topic&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            ConsumerRecords<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> records <span style="color:#f92672">=</span> consumer.<span style="color:#a6e22e">poll</span>(Duration.<span style="color:#a6e22e">ofMillis</span>(100));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            records.<span style="color:#a6e22e">forEach</span>(record <span style="color:#f92672">-&gt;</span> log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Consumed message: &#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">key</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> record.<span style="color:#a6e22e">value</span>()));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The producer is similar:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.CommonClientConfigs;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.clients.producer.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.config.SslConfigs;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.kafka.common.serialization.StringSerializer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.Logger;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.slf4j.LoggerFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Properties;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.UUID;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.ExecutionException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BasicSSLProducer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger log <span style="color:#f92672">=</span> LoggerFactory.<span style="color:#a6e22e">getLogger</span>(BasicSSLProducer.<span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        Properties props <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">BOOTSTRAP_SERVERS_CONFIG</span>, <span style="color:#e6db74">&#34;broker-1:9191,broker-2:9192,broker-3:9193&#34;</span>);
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(ProducerConfig.<span style="color:#a6e22e">VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(CommonClientConfigs.<span style="color:#a6e22e">SECURITY_PROTOCOL_CONFIG</span>, <span style="color:#e6db74">&#34;SSL&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_LOCATION_CONFIG</span>, <span style="color:#e6db74">&#34;/Users/zjxjwxk/Documents/Project/getting-started-kafka/module8/demo3/security/truststore/producer.truststore.jks&#34;</span>); <span style="color:#75715e">// Replace with the absolute path on your machine</span>
</span></span><span style="display:flex;"><span>        props.<span style="color:#a6e22e">put</span>(SslConfigs.<span style="color:#a6e22e">SSL_TRUSTSTORE_PASSWORD_CONFIG</span>, <span style="color:#e6db74">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        KafkaProducer<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> KafkaProducer<span style="color:#f92672">&lt;&gt;</span>(props);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Thread haltedHook <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(producer::close);
</span></span><span style="display:flex;"><span>        Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">addShutdownHook</span>(haltedHook);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> i <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            String key <span style="color:#f92672">=</span> String.<span style="color:#a6e22e">valueOf</span>(i);
</span></span><span style="display:flex;"><span>            String value <span style="color:#f92672">=</span> UUID.<span style="color:#a6e22e">randomUUID</span>().<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ProducerRecord<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> producerRecord <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> ProducerRecord<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;basic-topic&#34;</span>, key, value);
</span></span><span style="display:flex;"><span>            producer.<span style="color:#a6e22e">send</span>(producerRecord);
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Message sent: &#34;</span> <span style="color:#f92672">+</span> key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> value);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            i<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">sleep</span>(20);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="monitoring-kafka-scaling">Monitoring Kafka: Scaling<a hidden class="anchor" aria-hidden="true" href="#monitoring-kafka-scaling">#</a></h2>
<h3 id="cluster-level">Cluster Level<a hidden class="anchor" aria-hidden="true" href="#cluster-level">#</a></h3>
<p>If there are some problems with the cluster level, usually means a high load. Add a broker 4 and turn on the balancer. Then the load will be balanced between brokers.</p>
<pre tabindex="0"><code>confluent.balancer.enable=true
</code></pre><p><img alt="image-20250322160005373" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250322160005373.png"></p>
<h3 id="broker-level">Broker Level<a hidden class="anchor" aria-hidden="true" href="#broker-level">#</a></h3>
<p>If there are some problems with the broker level. We can just restart the broker.</p>
<p><img alt="image-20250322160921472" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250322160921472.png"></p>
<h3 id="topic-level">Topic Level<a hidden class="anchor" aria-hidden="true" href="#topic-level">#</a></h3>
<p>The only problem that load balancer from confluent doesn&rsquo;t detect is the topic level. To detect that, the command to run is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group <span style="color:#ae81ff">1</span>                          
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>               myorders        <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">0</span>               console-consumer-8a295fc9-0d1f-4712-9c60-8e5ce13c7155 /172.30.0.1     console-consumer
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>               myorders        <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">0</span>               console-consumer-8a295fc9-0d1f-4712-9c60-8e5ce13c7155 /172.30.0.1     console-consumer%
</span></span></code></pre></div><p>If a topic&rsquo;s LAG is high, the consumer is not catching up, which means we need more partitions.</p>
<p>Increasing the number of partitions of a topic is not easy. The best way is:</p>
<ol>
<li>Create another topic with more partitions.</li>
<li>Then create a Kafka Streams application that will read from the original topic and write to the output topic. When that steam application is done, then there is no lag.</li>
<li>Migrate producers and consumers to the new topic.</li>
</ol>
<p><img alt="image-20250322162955297" loading="lazy" src="/posts/mq/kafka/getting-started-with-apache-kafka/7-kafka-administration/images/image-20250322162955297.png"></p>
<h2 id="takeaway">Takeaway<a hidden class="anchor" aria-hidden="true" href="#takeaway">#</a></h2>
<ul>
<li>We need to secure all communications channels in Kafka by encrypting them with TLS.</li>
<li>We created TrustStroes for all entities and KeyStores for Brokers and Zookeepers.</li>
<li>To scale out Kafka, most of the problems are solved by the Confluent tool, SBC (Self-Balancing Clusters).</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://zjxjwxk.github.io/tags/mq/">MQ</a></li>
      <li><a href="https://zjxjwxk.github.io/tags/kafka/">Kafka</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://zjxjwxk.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/">
    <span class="title">« Prev</span>
    <br>
    <span>Docker 容器下的 MySQL 主从同步</span>
  </a>
  <a class="next" href="https://zjxjwxk.github.io/posts/mq/kafka/getting-started-with-apache-kafka/6-kafka-stream/">
    <span class="title">Next »</span>
    <br>
    <span>Kafka Stream</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on x"
            href="https://x.com/intent/tweet/?text=Kafka%20Administration&amp;url=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f&amp;hashtags=MQ%2cKafka">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f&amp;title=Kafka%20Administration&amp;summary=Kafka%20Administration&amp;source=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f&title=Kafka%20Administration">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on whatsapp"
            href="https://api.whatsapp.com/send?text=Kafka%20Administration%20-%20https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on telegram"
            href="https://telegram.me/share/url?text=Kafka%20Administration&amp;url=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kafka Administration on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Kafka%20Administration&u=https%3a%2f%2fzjxjwxk.github.io%2fposts%2fmq%2fkafka%2fgetting-started-with-apache-kafka%2f7-kafka-administration%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "xinkangwu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://zjxjwxk.github.io/">Xinkang&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
