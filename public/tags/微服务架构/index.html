<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>微服务架构 | Xinkang&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/index.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xinkang&#39;s Blog (Alt + H)">Xinkang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/tags/">Tags</a></div>
  <h1>
    微服务架构
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">微服务容器化系列（1）：服务编排前奏
    </h2>
  </header>
  <div class="entry-content">
    <p>服务 Docker 化 修改项目配置 由于镜像运行时 MySQL 数据库所在的主机地址是动态的，所以将项目中的 MySQL 数据库地址和 Zookeeper 注册中心地址配置为动态变量：
spring: dubbo: registry: zookeeper://${zk.address}:2181 datasource: url: jdbc:mysql://{mysql.address}:3306/cinema?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8 获取 Java 镜像 docker pull openjdk:8-jre 打包 Maven 项目 在项目根目录下，执行 Maven 的清除和打包命令（跳过测试）：
mvn clean &amp;&amp; mvn package -Dmaven.test.skip=true 这样就会在 target 目录下生成 jar 包（Spring Boot 项目）。
编写 Dockerfile 在 user 子模块的根目录下，创建 Dockerfile 文件，并编辑如下，Dockerfile 文件用于构建 Docker 镜像：
FROM openjdk:8-jre MAINTAINER zjxjwxk zjxjwxk@gmail.com COPY target/user.jar /user.jar ENTRYPOINT [&#34;java&#34;, &#34;-jar&#34;, &#34;/user.jar&#34;] 构建项目 Docker 镜像 docker build -t user:latest . 编写 build 脚本 在和 Dockerfile 同一目录下，创建一个 build.sh 脚本，用于打包和构建 Docker 镜像：
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-06-04 23:15:00 +0000 UTC'>June 4, 2020</span>&nbsp;·&nbsp;6 min</footer>
  <a class="entry-link" aria-label="post link to 微服务容器化系列（1）：服务编排前奏" href="http://localhost:1313/posts/docker/docker-&#43;-k8s-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96/1.-%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E5%89%8D%E5%A5%8F/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（12）：系统部署
    </h2>
  </header>
  <div class="entry-content">
    <p>运行环境 CentOS 6 云服务器 创建用户 创建一个 cinema 用户：
[root@huawei ~]# useradd cinema [root@huawei ~]# passwd cinema Changing password for user cinema. New password: BAD PASSWORD: it does not contain enough DIFFERENT characters Retype new password: passwd: all authentication tokens updated successfully. 给予其权限，首先需要赋予当前用户对 /etc/sudoers 的写权限，然后在 sudoers 文件中的 root ALL = (ALL) ALL 下增加一行，赋予其在任何地方执行任何命令的权限：
chmod u&#43;w /etc/sudoers vim sudoers ## Allow root to run any commands anywhere root ALL=(ALL) ALL cinema ALL=(ALL) ALL 最后，取消当前用户的写权限：
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-05-03 22:34:00 +0000 UTC'>May 3, 2020</span>&nbsp;·&nbsp;4 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（12）：系统部署" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/12.%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（11）：服务监控
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 了解 Dubbo 监控相关内容 熟练掌握 Dubbo-admin 使用 熟练掌握链路监控 完成业务系统部署 Dubbo-monitor 源码下载和打包 目前，还可以从当当网的项目 Dubbox 中获取（很久没有维护了）：https://github.com/dangdangdotcom/dubbox ，在项目中执行以下命令打包并拷贝到本地仓库（跳过单元测试）：
mvn package -Dmaven.test.skip=true 其中，可能会遇到 Missing artifact com.alibaba:dubbo:jar:2.8.4 的坑，需要在根项目的 pom.xml 文件中添加以下 maven 插件：
这样在本地仓库就有了 ~/.m2/repository/com/alibaba/dubbo-monitor-simple/2.8.4/dubbo-monitor-simple-2.8.4-assembly.tar.gz 这个 tar.gz 包，解压它可以得到以下文件：
启动服务监控 在 conf 文件夹下，编辑 dubbo.properties，将相关参数配置如下：
dubbo.container=log4j,spring,registry,jetty dubbo.application.name=simple-monitor dubbo.application.owner= #dubbo.registry.address=multicast://224.5.6.7:1234 dubbo.registry.address=zookeeper://127.0.0.1:2181 #dubbo.registry.address=redis://127.0.0.1:6379 #dubbo.registry.address=dubbo://127.0.0.1:9090 dubbo.protocol.port=7070 dubbo.jetty.port=8090 dubbo.jetty.directory=monitor dubbo.charts.directory=monitor/charts dubbo.statistics.directory=monitor/statistics dubbo.log4j.file=monitor/dubbo-monitor-simple.log dubbo.log4j.level=WARN 然后，进入 bin 目录，运行 start.sh 就可以启动 Dubbo-Monitor 了，运行在配置好的 8090 端口（需要先打开 Zookeeper）。
启动服务提供者和消费者后，可以在 Applications 中看到如下信息：
同时，可以点击 Providers 查看服务某一服务提供者的详细信息，并且可以将其取消注册：
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-04-24 23:11:00 +0000 UTC'>April 24, 2020</span>&nbsp;·&nbsp;3 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（11）：服务监控" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/11.%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（10）：分布式事务
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 事务简介 分布式事务的前世今生 分布式事务解决方案 主流分布式事务框架介绍 事务简介 事务是用来保证一组数据操作的完整性和一致性的 事务必须满足 ACID 的四大特性 事务具有四种隔离级别 事务具有七种传播行为 事务属性 原子性（Atomicity） 一致性（Consistency） 隔离型（Isolation） 持久性（Durability） 分布式事务 概念 分布式事务就是将多个节点的事务看成一个整体处理 分布式事务由事务参与者、资源服务器、事务管理器等组成 常见的分布式事务的例子：支付、下订单等 实现思路 两段式事务和三段式事务 基于 XA 的分布式事务 基于消息的最终一致性方案 TCC 编程式补偿性事务 分布式事务类型 两段式和三段式事务 两段式事务 三段式事务 基于 XA 的分布式事务 基于消息的一致性方案 TCC 补偿性事务 基于消息的一致性方案和 TCC 补偿性事务的区别 基于消息的事务是强一致性事务，会存在浪费 TCC 事务是柔性事务，在 try 阶段要对资源做预留 TCC 事务在确认或取消阶段释放资源 与基于消息的事务对比，TCC 的时效性更好 分布式事务框架 全局事务服务（Global Transaction Service，简称 GTS） 蚂蚁金服分布式事务（Distributed Transaction-eXtended，简称 DTX） 开源 TCC 框架（TCC-Transaction）（https://github.com/changmingxie/tcc-transaction） 开源 TCC 框架（ByteTCC）（https://github.com/liuyangming/ByteTCC） TCC-Transaction 分布式事务框架 Github 仓库：https://github.com/changmingxie/tcc-transaction
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-04-17 20:14:00 +0000 UTC'>April 17, 2020</span>&nbsp;·&nbsp;7 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（10）：分布式事务" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/10.%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（9）：Dubbo服务开发（支付模块开发）
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 完成支付模块业务开发 Dubbo 特性学习：隐式参数、参数验证等 Dubbo 本地存根 本地存根类似于 Dubbo 的静态代理 Dubbo 会在客户端生成一个代理，处理部分业务 Stub 必须有可传入 Proxy 的构造函数 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-stub.html
远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。
在 spring 配置文件中按以下方式配置：
&lt;dubbo:service interface=&#34;com.foo.BarService&#34; stub=&#34;true&#34; /&gt; 或
&lt;dubbo:service interface=&#34;com.foo.BarService&#34; stub=&#34;com.foo.BarServiceStub&#34; /&gt; 提供 Stub 的实现：
package com.foo; public class BarServiceStub implements BarService { private final BarService barService; // 构造函数传入真正的远程代理对象 public BarServiceStub(BarService barService){ this.barService = barService; } public String sayHello(String name) { // 此代码在客户端执行, 你可以在客户端做ThreadLocal本地缓存，或预先验证参数是否合法，等等 try { return barService.sayHello(name); } catch (Exception e) { // 你可以容错，可以做任何AOP拦截事项 return &#34;容错数据&#34;; } } } Stub 必须有可传入 Proxy 的构造函数。 在 interface 旁边放一个 Stub 实现，它实现 BarService 接口，并有一个传入远程 BarService 实例的构造函数 Dubbo 本地伪装 本地伪装是本地存根的一个子集 通常会使用本地伪装处理服务降级 建议本地伪装在客户端实现 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/local-mock.html
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-04-11 20:14:00 +0000 UTC'>April 11, 2020</span>&nbsp;·&nbsp;2 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（9）：Dubbo服务开发（支付模块开发）" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/9.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E6%94%AF%E4%BB%98%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（8）：Dubbo服务开发（订单模块开发）
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 完成订单模块业务开发 完成限流和熔断、降级相关内容 Dubbo 特性之分组、聚合和版本控制 订单模块问题 订单模块的横向和纵向分表如何解决？ 服务限流如何处理？ 服务熔断和降级？ 如何保证多版本的蓝绿上线？ 横向拆分和纵向拆分 Dubbo 服务分组 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/service-group.html
当一个接口有多种实现时，可以用 group 区分。
服务 &lt;dubbo:service group=&#34;feedback&#34; interface=&#34;com.xxx.IndexService&#34; /&gt; &lt;dubbo:service group=&#34;member&#34; interface=&#34;com.xxx.IndexService&#34; /&gt; 引用 &lt;dubbo:reference id=&#34;feedbackIndexService&#34; group=&#34;feedback&#34; interface=&#34;com.xxx.IndexService&#34; /&gt; &lt;dubbo:reference id=&#34;memberIndexService&#34; group=&#34;member&#34; interface=&#34;com.xxx.IndexService&#34; /&gt; 任意组：
&lt;dubbo:reference id=&#34;barService&#34; interface=&#34;com.foo.BarService&#34; group=&#34;*&#34; /&gt; Dubbo 分组聚合 https://dubbo.apache.org/zh-cn/docs/user/demos/group-merger.html
按组合并返回结果，比如菜单服务，接口一样，但有多种实现，用 group 区分，现在消费方需从每种 group 中调用一次返回结果，合并结果返回，这样就可以实现聚合菜单项。
配置 搜索所有分组
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;*&#34; merger=&#34;true&#34; /&gt; 合并指定分组
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;aaa,bbb&#34; merger=&#34;true&#34; /&gt; 指定方法合并结果，其它未指定的方法，将只调用一个 Group
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;*&#34;&gt; &lt;dubbo:method name=&#34;getMenuItems&#34; merger=&#34;true&#34; /&gt; &lt;/dubbo:reference&gt; 某个方法不合并结果，其它都合并结果
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;*&#34; merger=&#34;true&#34;&gt; &lt;dubbo:method name=&#34;getMenuItems&#34; merger=&#34;false&#34; /&gt; &lt;/dubbo:reference&gt; 指定合并策略，缺省根据返回值类型自动匹配，如果同一类型有两个合并器时，需指定合并器的名称
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;*&#34;&gt; &lt;dubbo:method name=&#34;getMenuItems&#34; merger=&#34;mymerge&#34; /&gt; &lt;/dubbo:reference&gt; 指定合并方法，将调用返回结果的指定方法进行合并，合并方法的参数类型必须是返回结果类型本身
&lt;dubbo:reference interface=&#34;com.xxx.MenuService&#34; group=&#34;*&#34;&gt; &lt;dubbo:method name=&#34;getMenuItems&#34; merger=&#34;.addAll&#34; /&gt; &lt;/dubbo:reference&gt; Dubbo 多版本 当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。
可以按照以下的步骤进行版本迁移：
在低压力时间段，先升级一半提供者为新版本 再将所有消费者升级为新版本 然后将剩下的一半提供者升级为新版本 配置 老版本服务提供者配置：
&lt;dubbo:service interface=&#34;com.foo.BarService&#34; version=&#34;1.0.0&#34; /&gt; 新版本服务提供者配置：
&lt;dubbo:service interface=&#34;com.foo.BarService&#34; version=&#34;2.0.0&#34; /&gt; 老版本服务消费者配置：
&lt;dubbo:reference id=&#34;barService&#34; interface=&#34;com.foo.BarService&#34; version=&#34;1.0.0&#34; /&gt; 新版本服务消费者配置：
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-04-05 19:30:00 +0000 UTC'>April 5, 2020</span>&nbsp;·&nbsp;2 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（8）：Dubbo服务开发（订单模块开发）" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/8.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（7）：Dubbo服务开发（影院模块开发）
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 完成影院模块业务开发 修改全局异常返回 学习 Dubbo 特性：结果缓存，连接和并发控制 Dubbo 结果缓存 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/result-cache.html
用于加速热门数据的访问速度，Dubbo 提供声明式缓存，以减少用户加缓存的工作量。
缓存类型 lru 基于最近最少使用原则删除多余缓存，保持最热的数据被缓存。 threadlocal 当前线程缓存，比如一个页面渲染，用到很多 portal，每个 portal 都要去查用户信息，通过线程缓存，可以减少这种多余访问。 配置 &lt;dubbo:reference interface=&#34;com.foo.BarService&#34; cache=&#34;lru&#34; /&gt; 或：
&lt;dubbo:reference interface=&#34;com.foo.BarService&#34;&gt; &lt;dubbo:method name=&#34;findBar&#34; cache=&#34;lru&#34; /&gt; &lt;/dubbo:reference&gt; 了解 Dubbo 结果缓存与 Redis 缓存等的区别：
Dubbo 结果缓存是本地缓存，保存在当前 JVM 中，多台机器存储多份缓存。适合数据量小的数据，存储在本地占用资源少，而且速度较快。 Redis 缓存则是分布式缓存，多台机器共享缓存。 小数据量的可以放在 Dubbo 结果缓存中，需要计算和共享的缓存数据可以放在 Redis 中。 Dubbo 连接、并发控制 Dubbo 可以对连接、并发数量进行控制 超出部分以错误形式返回 Dubbo 连接控制 官方文档：https://dubbo.apache.org/zh-cn/docs/user/demos/config-connections.html
服务端连接控制 限制服务器端接受的连接不能超过 10 个：
&lt;dubbo:provider protocol=&#34;dubbo&#34; accepts=&#34;10&#34; /&gt; 或
&lt;dubbo:protocol name=&#34;dubbo&#34; accepts=&#34;10&#34; /&gt; 客户端连接控制 限制客户端服务使用连接不能超过 10 个（如果是长连接，比如 Dubbo 协议，connections 表示该服务对每个提供者建立的长连接数）：
&lt;dubbo:reference interface=&#34;com.foo.BarService&#34; connections=&#34;10&#34; /&gt; 或
&lt;dubbo:service interface=&#34;com.foo.BarService&#34; connections=&#34;10&#34; /&gt; 如果 dubbo:service 和 dubbo:reference 都配了 connections，dubbo:reference 优先。
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-30 21:21:00 +0000 UTC'>March 30, 2020</span>&nbsp;·&nbsp;1 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（7）：Dubbo服务开发（影院模块开发）" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/7.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E5%BD%B1%E9%99%A2%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（6）：Dubbo服务开发（影片模块开发）
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 掌握 API 网关服务聚合功能的实现 掌握 Mybatis-plus 自定义 SQL 实现 掌握 Dubbo 异步调用 服务聚合 服务聚合就是将多个服务调用封装 服务聚合可以简化前端调用方式 服务聚合提供更好的安全性、可扩展性 业务功能开发流程 根据接口文档思考功能列表 实现 API 接口和实体 服务提供者实现 影片模块创建 从 guns-user 拷贝一份重命名为 guns-film，修改相关配置
API 网关功能聚合 优点 六个接口，一次请求，同一时刻节省了5次HTTP请求 同一个接口对外暴露，降低了前后端分离开发的难度和复杂度 缺点： 一次获取数据过多，容易出现问题 如 gateway 中的影片模块的获取首页信息接口，将 filmServiceApi 的多个方法所获得的对象聚合为 FilmIndexVO 对象返回给前端，将原本需要的多个接口聚合为一个 /film/getIndex 接口，避免了前端对不同接口的多次调用。
@RequestMapping(value = &#34;getIndex&#34;, method = RequestMethod.GET) public ResponseVO getIndex() { FilmIndexVO filmIndexVO = new FilmIndexVO(); // 获取banner信息 filmIndexVO.setBanners(filmServiceApi.getBanners()); // 获取热映的影片 filmIndexVO.setHotFilms(filmServiceApi.getHotFilms(true, 99, 99, 99, 99, 1, 8)); // 获取即将上映的影片 filmIndexVO.setSoonFilms(filmServiceApi.getSoonFilms(true, 99, 99, 99, 99, 1, 8)); // 获取票房排行榜 filmIndexVO.setBoxRanking(filmServiceApi.getBoxRanking()); // 获取人气榜单 filmIndexVO.setExpectRanking(filmServiceApi.getExpectRanking()); // 获取排行前100影片 filmIndexVO.setTop100(filmServiceApi.getTop()); return ResponseVO.success(IMG_PRE, filmIndexVO); } Mybatis-plus 自定义 SQL 实现 在相应的 Mapper 接口中添加方法
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-22 19:47:00 +0000 UTC'>March 22, 2020</span>&nbsp;·&nbsp;3 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（6）：Dubbo服务开发（影片模块开发）" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/6.dubbo%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E5%BD%B1%E7%89%87%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（5）：Dubbo基本特性（用户模块开发）
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 学会 API 网关权限验证和其他服务交互 学会开发 SpringBoot 的自定义配置 学会 Dubbo 负载均衡策略选择和使用 修改 Guns 中的 JWT 模块 增加忽略验证 URL 配置 修改返回内容匹配业务 增加 Threadlocal 的用户信息保存 业务功能开发 增加用户服务并提供接口 初步了解 API 网关与服务之间交互的过程 根据接口文档开发用户接口 创建用户表 DROP TABLE IF EXISTS user; CREATE TABLE user( UUID INT PRIMARY KEY AUTO_INCREMENT COMMENT &#39;主键编号&#39;, user_name VARCHAR(50) COMMENT &#39;用户账号&#39;, user_pwd VARCHAR(50) COMMENT &#39;用户密码&#39;, nick_name VARCHAR(50) COMMENT &#39;用户昵称&#39;, user_sex INT COMMENT &#39;用户性别 0-男，1-女&#39;, birthday VARCHAR(50) COMMENT &#39;出生日期&#39;, email VARCHAR(50) COMMENT &#39;用户邮箱&#39;, user_phone VARCHAR(50) COMMENT &#39;用户手机号&#39;, address VARCHAR(50) COMMENT &#39;用户住址&#39;, head_url VARCHAR(50) COMMENT &#39;头像URL&#39;, biography VARCHAR(200) COMMENT &#39;个人介绍&#39;, life_state INT COMMENT &#39;生活状态 0-单身，1-热恋中，2-已婚，3-为人父母&#39;, begin_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;, update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39; ) COMMENT &#39;用户表&#39; ENGINE = INNODB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = DYNAMIC; insert into user(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) values(&#39;admin&#39;,&#39;0192023a7bbd73250516f069df18b500&#39;,&#39;管理员&#39;,0,&#39;2018-07-31&#39;,&#39;admin@gmail.com&#39;,&#39;13888888888&#39;,&#39;浙江省杭州市西湖区某路某号&#39;,&#39;cinema/img/head-img.jpg&#39;,0,&#39;我是苦逼的管理员&#39;); insert into user(user_name,user_pwd,nick_name,user_sex,birthday,email,user_phone,address,head_url,life_state,biography) values(&#39;test&#39;,&#39;5e2de6bd1c9b50f6e27d4e55da43b917&#39;,&#39;测试用户&#39;,0,&#39;2018-08-20&#39;,&#39;test@gmail.com&#39;,&#39;13866666666&#39;,&#39;测试地址&#39;,&#39;cinema/img/head-img.jpg&#39;,1,&#39;我是测试用户&#39;); 用户服务与网关交互 在 guns 项目中复制一份 guns-gateway 模块并重命名为 guns-user（修改相应子模块和主模块的 pom.xml 等），并在 application.yml 中将其鉴权机制等关闭（网关才需要）
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-11 23:45:00 +0000 UTC'>March 11, 2020</span>&nbsp;·&nbsp;5 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（5）：Dubbo基本特性（用户模块开发）" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/5.dubbo%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Dubbo微服务影院系列（4）：业务基础环境构建
    </h2>
  </header>
  <div class="entry-content">
    <p>章节概要 构建基于 Guns &#43; SpringBoot &#43; Dubbo 的框架 学会抽离业务接口 学会 API 网关变形应用 API 网关介绍 API 网关有点类似于设计模式中的 Facade 模式 API 网关一般都是微服务系统中的门面 API 网关是微服务的重要组成部分 API 网关的常见作用 身份验证和安全 审查和检测 动态路由 压力测试 负载均衡（Dubbo 自带） 静态相应处理 Guns 环境构建 导入 guns 项目 创建 guns_rest 数据库 创建 user 表 -- ---------------------------- -- Table structure for user -- ---------------------------- DROP TABLE IF EXISTS `user`; CREATE TABLE `user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `userName` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL, PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic; -- ---------------------------- -- Records of user -- ---------------------------- INSERT INTO `user` VALUES (1, &#39;admin&#39;); SET FOREIGN_KEY_CHECKS = 1; 添加 log4j 依赖 &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt; &lt;/dependency&gt; 修改 datasource 的 url 修改 application.yml 中 spring 的 datasource 的 url 为
...</p>
  </div>
  <footer class="entry-footer"><span title='2020-03-09 22:25:00 +0000 UTC'>March 9, 2020</span>&nbsp;·&nbsp;2 min</footer>
  <a class="entry-link" aria-label="post link to Dubbo微服务影院系列（4）：业务基础环境构建" href="http://localhost:1313/posts/dubbo/dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BD%B1%E9%99%A2%E7%B3%BB%E5%88%97/4.%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="http://localhost:1313/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/page/2/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Xinkang&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
